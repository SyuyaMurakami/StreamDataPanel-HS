function dv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function pv(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var r=t.default;if(typeof r=="function"){var e=function i(){var n=!1;try{n=this instanceof i}catch{}return n?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),e}var is={exports:{}},ns={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nf;function _v(){return Nf||(Nf=1,(function(t){function r(A,B){var k=A.length;A.push(B);t:for(;0<k;){var j=k-1>>>1,$=A[j];if(0<n($,B))A[j]=B,A[k]=$,k=j;else break t}}function e(A){return A.length===0?null:A[0]}function i(A){if(A.length===0)return null;var B=A[0],k=A.pop();if(k!==B){A[0]=k;t:for(var j=0,$=A.length,rt=$>>>1;j<rt;){var Q=2*(j+1)-1,st=A[Q],et=Q+1,pt=A[et];if(0>n(st,k))et<$&&0>n(pt,st)?(A[j]=pt,A[et]=k,j=et):(A[j]=st,A[Q]=k,j=Q);else if(et<$&&0>n(pt,k))A[j]=pt,A[et]=k,j=et;else break t}}return B}function n(A,B){var k=A.sortIndex-B.sortIndex;return k!==0?k:A.id-B.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}var f=[],u=[],h=1,l=null,c=3,v=!1,d=!1,_=!1,p=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;function T(A){for(var B=e(u);B!==null;){if(B.callback===null)i(u);else if(B.startTime<=A)i(u),B.sortIndex=B.expirationTime,r(f,B);else break;B=e(u)}}function w(A){if(_=!1,T(A),!d)if(e(f)!==null)d=!0,x||(x=!0,L());else{var B=e(u);B!==null&&z(w,B.startTime-A)}}var x=!1,E=-1,S=5,M=-1;function C(){return p?!0:!(t.unstable_now()-M<S)}function R(){if(p=!1,x){var A=t.unstable_now();M=A;var B=!0;try{t:{d=!1,_&&(_=!1,g(E),E=-1),v=!0;var k=c;try{r:{for(T(A),l=e(f);l!==null&&!(l.expirationTime>A&&C());){var j=l.callback;if(typeof j=="function"){l.callback=null,c=l.priorityLevel;var $=j(l.expirationTime<=A);if(A=t.unstable_now(),typeof $=="function"){l.callback=$,T(A),B=!0;break r}l===e(f)&&i(f),T(A)}else i(f);l=e(f)}if(l!==null)B=!0;else{var rt=e(u);rt!==null&&z(w,rt.startTime-A),B=!1}}break t}finally{l=null,c=k,v=!1}B=void 0}}finally{B?L():x=!1}}}var L;if(typeof m=="function")L=function(){m(R)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,P=D.port2;D.port1.onmessage=R,L=function(){P.postMessage(null)}}else L=function(){y(R,0)};function z(A,B){E=y(function(){A(t.unstable_now())},B)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(A){A.callback=null},t.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<A?Math.floor(1e3/A):5},t.unstable_getCurrentPriorityLevel=function(){return c},t.unstable_next=function(A){switch(c){case 1:case 2:case 3:var B=3;break;default:B=c}var k=c;c=B;try{return A()}finally{c=k}},t.unstable_requestPaint=function(){p=!0},t.unstable_runWithPriority=function(A,B){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var k=c;c=A;try{return B()}finally{c=k}},t.unstable_scheduleCallback=function(A,B,k){var j=t.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?j+k:j):k=j,A){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=k+$,A={id:h++,callback:B,priorityLevel:A,startTime:k,expirationTime:$,sortIndex:-1},k>j?(A.sortIndex=k,r(u,A),e(f)===null&&A===e(u)&&(_?(g(E),E=-1):_=!0,z(w,k-j))):(A.sortIndex=$,r(f,A),d||v||(d=!0,x||(x=!0,L()))),A},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(A){var B=c;return function(){var k=c;c=B;try{return A.apply(this,arguments)}finally{c=k}}}})(ns)),ns}var Ff;function Fg(){return Ff||(Ff=1,is.exports=_v()),is.exports}var sn={exports:{}},yv=sn.exports,Bf;function Bg(){return Bf||(Bf=1,(function(t,r){(function(e,i){i(r)})(yv,(function(e){function i(G){return function(K,W,Y,lt,ot,qt,gt){return G(K,W,gt)}}function n(G){return function(K,W,Y,lt){if(!K||!W||typeof K!="object"||typeof W!="object")return G(K,W,Y,lt);var ot=lt.get(K),qt=lt.get(W);if(ot&&qt)return ot===W&&qt===K;lt.set(K,W),lt.set(W,K);var gt=G(K,W,Y,lt);return lt.delete(K),lt.delete(W),gt}}function a(G,X){var K={};for(var W in G)K[W]=G[W];for(var W in X)K[W]=X[W];return K}function s(G){return G.constructor===Object||G.constructor==null}function o(G){return typeof G.then=="function"}function f(G,X){return G===X||G!==G&&X!==X}var u="[object Arguments]",h="[object Boolean]",l="[object Date]",c="[object RegExp]",v="[object Map]",d="[object Number]",_="[object Object]",p="[object Set]",y="[object String]",g=Object.prototype.toString;function m(G){var X=G.areArraysEqual,K=G.areDatesEqual,W=G.areMapsEqual,Y=G.areObjectsEqual,lt=G.areRegExpsEqual,ot=G.areSetsEqual,qt=G.createIsNestedEqual,gt=qt(Qt);function Qt(_t,mt,ar){if(_t===mt)return!0;if(!_t||!mt||typeof _t!="object"||typeof mt!="object")return _t!==_t&&mt!==mt;if(s(_t)&&s(mt))return Y(_t,mt,gt,ar);var Gi=Array.isArray(_t),If=Array.isArray(mt);if(Gi||If)return Gi===If&&X(_t,mt,gt,ar);var Pr=g.call(_t);return Pr!==g.call(mt)?!1:Pr===l?K(_t,mt,gt,ar):Pr===c?lt(_t,mt,gt,ar):Pr===v?W(_t,mt,gt,ar):Pr===p?ot(_t,mt,gt,ar):Pr===_||Pr===u?o(_t)||o(mt)?!1:Y(_t,mt,gt,ar):Pr===h||Pr===d||Pr===y?f(_t.valueOf(),mt.valueOf()):!1}return Qt}function T(G,X,K,W){var Y=G.length;if(X.length!==Y)return!1;for(;Y-- >0;)if(!K(G[Y],X[Y],Y,Y,G,X,W))return!1;return!0}var w=n(T);function x(G,X){return f(G.valueOf(),X.valueOf())}function E(G,X,K,W){var Y=G.size===X.size;if(!Y)return!1;if(!G.size)return!0;var lt={},ot=0;return G.forEach(function(qt,gt){if(Y){var Qt=!1,_t=0;X.forEach(function(mt,ar){!Qt&&!lt[_t]&&(Qt=K(gt,ar,ot,_t,G,X,W)&&K(qt,mt,gt,ar,G,X,W))&&(lt[_t]=!0),_t++}),ot++,Y=Qt}}),Y}var S=n(E),M="_owner",C=Object.prototype.hasOwnProperty;function R(G,X,K,W){var Y=Object.keys(G),lt=Y.length;if(Object.keys(X).length!==lt)return!1;for(var ot;lt-- >0;){if(ot=Y[lt],ot===M){var qt=!!G.$$typeof,gt=!!X.$$typeof;if((qt||gt)&&qt!==gt)return!1}if(!C.call(X,ot)||!K(G[ot],X[ot],ot,ot,G,X,W))return!1}return!0}var L=n(R);function D(G,X){return G.source===X.source&&G.flags===X.flags}function P(G,X,K,W){var Y=G.size===X.size;if(!Y)return!1;if(!G.size)return!0;var lt={};return G.forEach(function(ot,qt){if(Y){var gt=!1,Qt=0;X.forEach(function(_t,mt){!gt&&!lt[Qt]&&(gt=K(ot,_t,qt,mt,G,X,W))&&(lt[Qt]=!0),Qt++}),Y=gt}}),Y}var z=n(P),A=Object.freeze({areArraysEqual:T,areDatesEqual:x,areMapsEqual:E,areObjectsEqual:R,areRegExpsEqual:D,areSetsEqual:P,createIsNestedEqual:i}),B=Object.freeze({areArraysEqual:w,areDatesEqual:x,areMapsEqual:S,areObjectsEqual:L,areRegExpsEqual:D,areSetsEqual:z,createIsNestedEqual:i}),k=m(A);function j(G,X){return k(G,X,void 0)}var $=m(a(A,{createIsNestedEqual:function(){return f}}));function rt(G,X){return $(G,X,void 0)}var Q=m(B);function st(G,X){return Q(G,X,new WeakMap)}var et=m(a(B,{createIsNestedEqual:function(){return f}}));function pt(G,X){return et(G,X,new WeakMap)}function At(G){return m(a(A,G(A)))}function Kt(G){var X=m(a(B,G(B)));return(function(K,W,Y){return Y===void 0&&(Y=new WeakMap),X(K,W,Y)})}e.circularDeepEqual=st,e.circularShallowEqual=pt,e.createCustomCircularEqual=Kt,e.createCustomEqual=At,e.deepEqual=j,e.sameValueZeroEqual=f,e.shallowEqual=rt,Object.defineProperty(e,"__esModule",{value:!0})}))})(sn,sn.exports)),sn.exports}var Bn={exports:{}},Uf;function Ug(){if(Uf)return Bn.exports;Uf=1;function t(e){var i,n,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(i=0;i<s;i++)e[i]&&(n=t(e[i]))&&(a&&(a+=" "),a+=n)}else for(n in e)e[n]&&(a&&(a+=" "),a+=n);return a}function r(){for(var e,i,n=0,a="",s=arguments.length;n<s;n++)(e=arguments[n])&&(i=t(e))&&(a&&(a+=" "),a+=i);return a}return Bn.exports=r,Bn.exports.clsx=r,Bn.exports}var as={exports:{}},ss,Hf;function gv(){if(Hf)return ss;Hf=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ss=t,ss}var os,zf;function mv(){if(zf)return os;zf=1;var t=gv();function r(){}function e(){}return e.resetWarningCache=r,os=function(){function i(s,o,f,u,h,l){if(l!==t){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}i.isRequired=i;function n(){return i}var a={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:n,element:i,elementType:i,instanceOf:n,node:i,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:e,resetWarningCache:r};return a.PropTypes=a,a},os}var kf;function Hg(){return kf||(kf=1,as.exports=mv()()),as.exports}var dl=(function(){if(typeof Map<"u")return Map;function t(r,e){var i=-1;return r.some(function(n,a){return n[0]===e?(i=a,!0):!1}),i}return(function(){function r(){this.__entries__=[]}return Object.defineProperty(r.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),r.prototype.get=function(e){var i=t(this.__entries__,e),n=this.__entries__[i];return n&&n[1]},r.prototype.set=function(e,i){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=i:this.__entries__.push([e,i])},r.prototype.delete=function(e){var i=this.__entries__,n=t(i,e);~n&&i.splice(n,1)},r.prototype.has=function(e){return!!~t(this.__entries__,e)},r.prototype.clear=function(){this.__entries__.splice(0)},r.prototype.forEach=function(e,i){i===void 0&&(i=null);for(var n=0,a=this.__entries__;n<a.length;n++){var s=a[n];e.call(i,s[1],s[0])}},r})()})(),yo=typeof window<"u"&&typeof document<"u"&&window.document===document,Ea=(function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()})(),Tv=(function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Ea):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)}})(),xv=2;function wv(t,r){var e=!1,i=!1,n=0;function a(){e&&(e=!1,t()),i&&o()}function s(){Tv(a)}function o(){var f=Date.now();if(e){if(f-n<xv)return;i=!0}else e=!0,i=!1,setTimeout(s,r);n=f}return o}var Ev=20,bv=["top","right","bottom","left","width","height","size","weight"],Sv=typeof MutationObserver<"u",Mv=(function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=wv(this.refresh.bind(this),Ev)}return t.prototype.addObserver=function(r){~this.observers_.indexOf(r)||this.observers_.push(r),this.connected_||this.connect_()},t.prototype.removeObserver=function(r){var e=this.observers_,i=e.indexOf(r);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){var r=this.updateObservers_();r&&this.refresh()},t.prototype.updateObservers_=function(){var r=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return r.forEach(function(e){return e.broadcastActive()}),r.length>0},t.prototype.connect_=function(){!yo||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Sv?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){!yo||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(r){var e=r.propertyName,i=e===void 0?"":e,n=bv.some(function(a){return!!~i.indexOf(a)});n&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t})(),pl=(function(t,r){for(var e=0,i=Object.keys(r);e<i.length;e++){var n=i[e];Object.defineProperty(t,n,{value:r[n],enumerable:!1,writable:!1,configurable:!0})}return t}),Di=(function(t){var r=t&&t.ownerDocument&&t.ownerDocument.defaultView;return r||Ea}),_l=qa(0,0,0,0);function ba(t){return parseFloat(t)||0}function Gf(t){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];return r.reduce(function(i,n){var a=t["border-"+n+"-width"];return i+ba(a)},0)}function Av(t){for(var r=["top","right","bottom","left"],e={},i=0,n=r;i<n.length;i++){var a=n[i],s=t["padding-"+a];e[a]=ba(s)}return e}function Rv(t){var r=t.getBBox();return qa(0,0,r.width,r.height)}function Cv(t){var r=t.clientWidth,e=t.clientHeight;if(!r&&!e)return _l;var i=Di(t).getComputedStyle(t),n=Av(i),a=n.left+n.right,s=n.top+n.bottom,o=ba(i.width),f=ba(i.height);if(i.boxSizing==="border-box"&&(Math.round(o+a)!==r&&(o-=Gf(i,"left","right")+a),Math.round(f+s)!==e&&(f-=Gf(i,"top","bottom")+s)),!Lv(t)){var u=Math.round(o+a)-r,h=Math.round(f+s)-e;Math.abs(u)!==1&&(o-=u),Math.abs(h)!==1&&(f-=h)}return qa(n.left,n.top,o,f)}var Pv=(function(){return typeof SVGGraphicsElement<"u"?function(t){return t instanceof Di(t).SVGGraphicsElement}:function(t){return t instanceof Di(t).SVGElement&&typeof t.getBBox=="function"}})();function Lv(t){return t===Di(t).document.documentElement}function Dv(t){return yo?Pv(t)?Rv(t):Cv(t):_l}function Ov(t){var r=t.x,e=t.y,i=t.width,n=t.height,a=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,s=Object.create(a.prototype);return pl(s,{x:r,y:e,width:i,height:n,top:e,right:r+i,bottom:n+e,left:r}),s}function qa(t,r,e,i){return{x:t,y:r,width:e,height:i}}var Iv=(function(){function t(r){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=qa(0,0,0,0),this.target=r}return t.prototype.isActive=function(){var r=Dv(this.target);return this.contentRect_=r,r.width!==this.broadcastWidth||r.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var r=this.contentRect_;return this.broadcastWidth=r.width,this.broadcastHeight=r.height,r},t})(),Nv=(function(){function t(r,e){var i=Ov(e);pl(this,{target:r,contentRect:i})}return t})(),Fv=(function(){function t(r,e,i){if(this.activeObservations_=[],this.observations_=new dl,typeof r!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=r,this.controller_=e,this.callbackCtx_=i}return t.prototype.observe=function(r){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(r instanceof Di(r).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(r)||(e.set(r,new Iv(r)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(r){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(r instanceof Di(r).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(r)&&(e.delete(r),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var r=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&r.activeObservations_.push(e)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var r=this.callbackCtx_,e=this.activeObservations_.map(function(i){return new Nv(i.target,i.broadcastRect())});this.callback_.call(r,e,r),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t})(),yl=typeof WeakMap<"u"?new WeakMap:new dl,gl=(function(){function t(r){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=Mv.getInstance(),i=new Fv(r,e,this);yl.set(this,i)}return t})();["observe","unobserve","disconnect"].forEach(function(t){gl.prototype[t]=function(){var r;return(r=yl.get(this))[t].apply(r,arguments)}});var Bv=(function(){return typeof Ea.ResizeObserver<"u"?Ea.ResizeObserver:gl})();const Uv=Object.freeze(Object.defineProperty({__proto__:null,default:Bv},Symbol.toStringTag,{value:"Module"})),zg=pv(Uv);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var go=function(t,r){return go=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},go(t,r)};function yt(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");go(t,r);function e(){this.constructor=t}t.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}var Wf=function(){return Wf=Object.assign||function(r){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=e[a])}return r},Wf.apply(this,arguments)},Hv=(function(){function t(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1}return t})(),zv=(function(){function t(){this.browser=new Hv,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow=typeof window<"u"}return t})(),St=new zv;typeof wx=="object"&&typeof wx.getSystemInfoSync=="function"?(St.wxa=!0,St.touchEventsSupported=!0):typeof document>"u"&&typeof self<"u"?St.worker=!0:!St.hasGlobalWindow||"Deno"in window?(St.node=!0,St.svgSupported=!0):kv(navigator.userAgent,St);function kv(t,r){var e=r.browser,i=t.match(/Firefox\/([\d.]+)/),n=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/.+?rv:(([\d.]+))/),a=t.match(/Edge?\/([\d.]+)/),s=/micromessenger/i.test(t);i&&(e.firefox=!0,e.version=i[1]),n&&(e.ie=!0,e.version=n[1]),a&&(e.edge=!0,e.version=a[1],e.newEdge=+a[1].split(".")[0]>18),s&&(e.weChat=!0),r.svgSupported=typeof SVGRect<"u",r.touchEventsSupported="ontouchstart"in window&&!e.ie&&!e.edge,r.pointerEventsSupported="onpointerdown"in window&&(e.edge||e.ie&&+e.version>=11),r.domSupported=typeof document<"u";var o=document.documentElement.style;r.transform3dSupported=(e.ie&&"transition"in o||e.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in o)&&!("OTransition"in o),r.transformSupported=r.transform3dSupported||e.ie&&+e.version>=9}var rf=12,ml="sans-serif",le=rf+"px "+ml,Gv=20,Wv=100,Vv="007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N";function qv(t){var r={};if(typeof JSON>"u")return r;for(var e=0;e<t.length;e++){var i=String.fromCharCode(e+32),n=(t.charCodeAt(e)-Gv)/Wv;r[i]=n}return r}var Xv=qv(Vv),je={createCanvas:function(){return typeof document<"u"&&document.createElement("canvas")},measureText:(function(){var t,r;return function(e,i){if(!t){var n=je.createCanvas();t=n&&n.getContext("2d")}if(t)return r!==i&&(r=t.font=i||le),t.measureText(e);e=e||"",i=i||le;var a=/((?:\d+)?\.?\d*)px/.exec(i),s=a&&+a[1]||rf,o=0;if(i.indexOf("mono")>=0)o=s*e.length;else for(var f=0;f<e.length;f++){var u=Xv[e[f]];o+=u==null?s:u*s}return{width:o}}})(),loadImage:function(t,r,e){var i=new Image;return i.onload=r,i.onerror=e,i.src=t,i}};function kg(t){for(var r in je)t[r]&&(je[r]=t[r])}var Tl=Ln(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(t,r){return t["[object "+r+"]"]=!0,t},{}),xl=Ln(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(t,r){return t["[object "+r+"Array]"]=!0,t},{}),Ui=Object.prototype.toString,Xa=Array.prototype,Yv=Xa.forEach,Zv=Xa.filter,ef=Xa.slice,jv=Xa.map,Vf=(function(){}).constructor,Un=Vf?Vf.prototype:null,nf="__proto__",$v=2311;function af(){return $v++}function Ya(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];typeof console<"u"&&console.error.apply(console,t)}function ce(t){if(t==null||typeof t!="object")return t;var r=t,e=Ui.call(t);if(e==="[object Array]"){if(!Ai(t)){r=[];for(var i=0,n=t.length;i<n;i++)r[i]=ce(t[i])}}else if(xl[e]){if(!Ai(t)){var a=t.constructor;if(a.from)r=a.from(t);else{r=new a(t.length);for(var i=0,n=t.length;i<n;i++)r[i]=t[i]}}}else if(!Tl[e]&&!Ai(t)&&!Ma(t)){r={};for(var s in t)t.hasOwnProperty(s)&&s!==nf&&(r[s]=ce(t[s]))}return r}function Be(t,r,e){if(!Hr(r)||!Hr(t))return e?ce(r):t;for(var i in r)if(r.hasOwnProperty(i)&&i!==nf){var n=t[i],a=r[i];Hr(a)&&Hr(n)&&!$e(a)&&!$e(n)&&!Ma(a)&&!Ma(n)&&!mo(a)&&!mo(n)&&!Ai(a)&&!Ai(n)?Be(n,a,e):(e||!(i in t))&&(t[i]=ce(r[i]))}return t}function Kv(t,r){for(var e=t[0],i=1,n=t.length;i<n;i++)e=Be(e,t[i],r);return e}function dt(t,r){if(Object.assign)Object.assign(t,r);else for(var e in r)r.hasOwnProperty(e)&&e!==nf&&(t[e]=r[e]);return t}function lr(t,r,e){for(var i=wt(r),n=0,a=i.length;n<a;n++){var s=i[n];(e?r[s]!=null:t[s]==null)&&(t[s]=r[s])}return t}var Qv=je.createCanvas;function Er(t,r){if(t){if(t.indexOf)return t.indexOf(r);for(var e=0,i=t.length;e<i;e++)if(t[e]===r)return e}return-1}function Jv(t,r){var e=t.prototype;function i(){}i.prototype=r.prototype,t.prototype=new i;for(var n in e)e.hasOwnProperty(n)&&(t.prototype[n]=e[n]);t.prototype.constructor=t,t.superClass=r}function sf(t,r,e){if(t="prototype"in t?t.prototype:t,r="prototype"in r?r.prototype:r,Object.getOwnPropertyNames)for(var i=Object.getOwnPropertyNames(r),n=0;n<i.length;n++){var a=i[n];a!=="constructor"&&(e?r[a]!=null:t[a]==null)&&(t[a]=r[a])}else lr(t,r,e)}function Mr(t){return!t||typeof t=="string"?!1:typeof t.length=="number"}function zt(t,r,e){if(t&&r)if(t.forEach&&t.forEach===Yv)t.forEach(r,e);else if(t.length===+t.length)for(var i=0,n=t.length;i<n;i++)r.call(e,t[i],i,t);else for(var a in t)t.hasOwnProperty(a)&&r.call(e,t[a],a,t)}function Lt(t,r,e){if(!t)return[];if(!r)return of(t);if(t.map&&t.map===jv)return t.map(r,e);for(var i=[],n=0,a=t.length;n<a;n++)i.push(r.call(e,t[n],n,t));return i}function Ln(t,r,e,i){if(t&&r){for(var n=0,a=t.length;n<a;n++)e=r.call(i,e,t[n],n,t);return e}}function Sa(t,r,e){if(!t)return[];if(!r)return of(t);if(t.filter&&t.filter===Zv)return t.filter(r,e);for(var i=[],n=0,a=t.length;n<a;n++)r.call(e,t[n],n,t)&&i.push(t[n]);return i}function td(t,r,e){if(t&&r){for(var i=0,n=t.length;i<n;i++)if(r.call(e,t[i],i,t))return t[i]}}function wt(t){if(!t)return[];if(Object.keys)return Object.keys(t);var r=[];for(var e in t)t.hasOwnProperty(e)&&r.push(e);return r}function rd(t,r){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];return function(){return t.apply(r,e.concat(ef.call(arguments)))}}var ed=Un&&Hi(Un.bind)?Un.call.bind(Un.bind):rd;function id(t){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];return function(){return t.apply(this,r.concat(ef.call(arguments)))}}function $e(t){return Array.isArray?Array.isArray(t):Ui.call(t)==="[object Array]"}function Hi(t){return typeof t=="function"}function Ar(t){return typeof t=="string"}function nd(t){return Ui.call(t)==="[object String]"}function Mi(t){return typeof t=="number"}function Hr(t){var r=typeof t;return r==="function"||!!t&&r==="object"}function mo(t){return!!Tl[Ui.call(t)]}function wl(t){return!!xl[Ui.call(t)]}function Ma(t){return typeof t=="object"&&typeof t.nodeType=="number"&&typeof t.ownerDocument=="object"}function Dn(t){return t.colorStops!=null}function El(t){return t.image!=null}function ad(t){return Ui.call(t)==="[object RegExp]"}function bl(t){return t!==t}function sd(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var e=0,i=t.length;e<i;e++)if(t[e]!=null)return t[e]}function Pt(t,r){return t??r}function vn(t,r,e){return t??r??e}function of(t){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];return ef.apply(t,r)}function Sl(t){if(typeof t=="number")return[t,t,t,t];var r=t.length;return r===2?[t[0],t[1],t[0],t[1]]:r===3?[t[0],t[1],t[2],t[1]]:t}function To(t,r){if(!t)throw new Error(r)}function Ue(t){return t==null?null:typeof t.trim=="function"?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var Ml="__ec_primitive__";function od(t){t[Ml]=!0}function Ai(t){return t[Ml]}var fd=(function(){function t(){this.data={}}return t.prototype.delete=function(r){var e=this.has(r);return e&&delete this.data[r],e},t.prototype.has=function(r){return this.data.hasOwnProperty(r)},t.prototype.get=function(r){return this.data[r]},t.prototype.set=function(r,e){return this.data[r]=e,this},t.prototype.keys=function(){return wt(this.data)},t.prototype.forEach=function(r){var e=this.data;for(var i in e)e.hasOwnProperty(i)&&r(e[i],i)},t})(),Al=typeof Map=="function";function ud(){return Al?new Map:new fd}var Rl=(function(){function t(r){var e=$e(r);this.data=ud();var i=this;r instanceof t?r.each(n):r&&zt(r,n);function n(a,s){e?i.set(a,s):i.set(s,a)}}return t.prototype.hasKey=function(r){return this.data.has(r)},t.prototype.get=function(r){return this.data.get(r)},t.prototype.set=function(r,e){return this.data.set(r,e),e},t.prototype.each=function(r,e){this.data.forEach(function(i,n){r.call(e,i,n)})},t.prototype.keys=function(){var r=this.data.keys();return Al?Array.from(r):r},t.prototype.removeKey=function(r){this.data.delete(r)},t})();function hd(t){return new Rl(t)}function ld(t,r){for(var e=new t.constructor(t.length+r.length),i=0;i<t.length;i++)e[i]=t[i];for(var n=t.length,i=0;i<r.length;i++)e[i+n]=r[i];return e}function On(t,r){var e;if(Object.create)e=Object.create(t);else{var i=function(){};i.prototype=t,e=new i}return r&&dt(e,r),e}function ff(t){var r=t.style;r.webkitUserSelect="none",r.userSelect="none",r.webkitTapHighlightColor="rgba(0,0,0,0)",r["-webkit-touch-callout"]="none"}function mn(t,r){return t.hasOwnProperty(r)}function oe(){}var dn=180/Math.PI;const Gg=Object.freeze(Object.defineProperty({__proto__:null,HashMap:Rl,RADIAN_TO_DEGREE:dn,assert:To,bind:ed,clone:ce,concatArray:ld,createCanvas:Qv,createHashMap:hd,createObject:On,curry:id,defaults:lr,disableUserSelect:ff,each:zt,eqNaN:bl,extend:dt,filter:Sa,find:td,guid:af,hasOwn:mn,indexOf:Er,inherits:Jv,isArray:$e,isArrayLike:Mr,isBuiltInObject:mo,isDom:Ma,isFunction:Hi,isGradientObject:Dn,isImagePatternObject:El,isNumber:Mi,isObject:Hr,isPrimitive:Ai,isRegExp:ad,isString:Ar,isStringSafe:nd,isTypedArray:wl,keys:wt,logError:Ya,map:Lt,merge:Be,mergeAll:Kv,mixin:sf,noop:oe,normalizeCssArray:Sl,reduce:Ln,retrieve:sd,retrieve2:Pt,retrieve3:vn,setAsPrimitive:od,slice:of,trim:Ue},Symbol.toStringTag,{value:"Module"}));function Qe(t,r){return t==null&&(t=0),r==null&&(r=0),[t,r]}function cd(t,r){return t[0]=r[0],t[1]=r[1],t}function Cl(t){return[t[0],t[1]]}function vd(t,r,e){return t[0]=r,t[1]=e,t}function xo(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function dd(t,r,e,i){return t[0]=r[0]+e[0]*i,t[1]=r[1]+e[1]*i,t}function Pl(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t}function uf(t){return Math.sqrt(hf(t))}var pd=uf;function hf(t){return t[0]*t[0]+t[1]*t[1]}var _d=hf;function yd(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t}function gd(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t}function md(t,r){return t[0]*r[0]+t[1]*r[1]}function va(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t}function Ll(t,r){var e=uf(r);return e===0?(t[0]=0,t[1]=0):(t[0]=r[0]/e,t[1]=r[1]/e),t}function Aa(t,r){return Math.sqrt((t[0]-r[0])*(t[0]-r[0])+(t[1]-r[1])*(t[1]-r[1]))}var Dl=Aa;function Ol(t,r){return(t[0]-r[0])*(t[0]-r[0])+(t[1]-r[1])*(t[1]-r[1])}var Xe=Ol;function Td(t,r){return t[0]=-r[0],t[1]=-r[1],t}function Il(t,r,e,i){return t[0]=r[0]+i*(e[0]-r[0]),t[1]=r[1]+i*(e[1]-r[1]),t}function Ri(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[2]*n+e[4],t[1]=e[1]*i+e[3]*n+e[5],t}function He(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t}function ze(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t}const Wg=Object.freeze(Object.defineProperty({__proto__:null,add:xo,applyTransform:Ri,clone:Cl,copy:cd,create:Qe,dist:Dl,distSquare:Xe,distance:Aa,distanceSquare:Ol,div:gd,dot:md,len:uf,lenSquare:hf,length:pd,lengthSquare:_d,lerp:Il,max:ze,min:He,mul:yd,negate:Td,normalize:Ll,scale:va,scaleAndAdd:dd,set:vd,sub:Pl},Symbol.toStringTag,{value:"Module"}));var ri=(function(){function t(r,e){this.target=r,this.topTarget=e&&e.topTarget}return t})(),xd=(function(){function t(r){this.handler=r,r.on("mousedown",this._dragStart,this),r.on("mousemove",this._drag,this),r.on("mouseup",this._dragEnd,this)}return t.prototype._dragStart=function(r){for(var e=r.target;e&&!e.draggable;)e=e.parent||e.__hostTarget;e&&(this._draggingTarget=e,e.dragging=!0,this._x=r.offsetX,this._y=r.offsetY,this.handler.dispatchToElement(new ri(e,r),"dragstart",r.event))},t.prototype._drag=function(r){var e=this._draggingTarget;if(e){var i=r.offsetX,n=r.offsetY,a=i-this._x,s=n-this._y;this._x=i,this._y=n,e.drift(a,s,r),this.handler.dispatchToElement(new ri(e,r),"drag",r.event);var o=this.handler.findHover(i,n,e).target,f=this._dropTarget;this._dropTarget=o,e!==o&&(f&&o!==f&&this.handler.dispatchToElement(new ri(f,r),"dragleave",r.event),o&&o!==f&&this.handler.dispatchToElement(new ri(o,r),"dragenter",r.event))}},t.prototype._dragEnd=function(r){var e=this._draggingTarget;e&&(e.dragging=!1),this.handler.dispatchToElement(new ri(e,r),"dragend",r.event),this._dropTarget&&this.handler.dispatchToElement(new ri(this._dropTarget,r),"drop",r.event),this._draggingTarget=null,this._dropTarget=null},t})(),zi=(function(){function t(r){r&&(this._$eventProcessor=r)}return t.prototype.on=function(r,e,i,n){this._$handlers||(this._$handlers={});var a=this._$handlers;if(typeof e=="function"&&(n=i,i=e,e=null),!i||!r)return this;var s=this._$eventProcessor;e!=null&&s&&s.normalizeQuery&&(e=s.normalizeQuery(e)),a[r]||(a[r]=[]);for(var o=0;o<a[r].length;o++)if(a[r][o].h===i)return this;var f={h:i,query:e,ctx:n||this,callAtLast:i.zrEventfulCallAtLast},u=a[r].length-1,h=a[r][u];return h&&h.callAtLast?a[r].splice(u,0,f):a[r].push(f),this},t.prototype.isSilent=function(r){var e=this._$handlers;return!e||!e[r]||!e[r].length},t.prototype.off=function(r,e){var i=this._$handlers;if(!i)return this;if(!r)return this._$handlers={},this;if(e){if(i[r]){for(var n=[],a=0,s=i[r].length;a<s;a++)i[r][a].h!==e&&n.push(i[r][a]);i[r]=n}i[r]&&i[r].length===0&&delete i[r]}else delete i[r];return this},t.prototype.trigger=function(r){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!this._$handlers)return this;var n=this._$handlers[r],a=this._$eventProcessor;if(n)for(var s=e.length,o=n.length,f=0;f<o;f++){var u=n[f];if(!(a&&a.filter&&u.query!=null&&!a.filter(r,u.query)))switch(s){case 0:u.h.call(u.ctx);break;case 1:u.h.call(u.ctx,e[0]);break;case 2:u.h.call(u.ctx,e[0],e[1]);break;default:u.h.apply(u.ctx,e);break}}return a&&a.afterTrigger&&a.afterTrigger(r),this},t.prototype.triggerWithContext=function(r){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!this._$handlers)return this;var n=this._$handlers[r],a=this._$eventProcessor;if(n)for(var s=e.length,o=e[s-1],f=n.length,u=0;u<f;u++){var h=n[u];if(!(a&&a.filter&&h.query!=null&&!a.filter(r,h.query)))switch(s){case 0:h.h.call(o);break;case 1:h.h.call(o,e[0]);break;case 2:h.h.call(o,e[0],e[1]);break;default:h.h.apply(o,e.slice(1,s-1));break}}return a&&a.afterTrigger&&a.afterTrigger(r),this},t})(),wd=Math.log(2);function wo(t,r,e,i,n,a){var s=i+"-"+n,o=t.length;if(a.hasOwnProperty(s))return a[s];if(r===1){var f=Math.round(Math.log((1<<o)-1&~n)/wd);return t[e][f]}for(var u=i|1<<e,h=e+1;i&1<<h;)h++;for(var l=0,c=0,v=0;c<o;c++){var d=1<<c;d&n||(l+=(v%2?-1:1)*t[e][c]*wo(t,r-1,h,u,n|d,a),v++)}return a[s]=l,l}function qf(t,r){var e=[[t[0],t[1],1,0,0,0,-r[0]*t[0],-r[0]*t[1]],[0,0,0,t[0],t[1],1,-r[1]*t[0],-r[1]*t[1]],[t[2],t[3],1,0,0,0,-r[2]*t[2],-r[2]*t[3]],[0,0,0,t[2],t[3],1,-r[3]*t[2],-r[3]*t[3]],[t[4],t[5],1,0,0,0,-r[4]*t[4],-r[4]*t[5]],[0,0,0,t[4],t[5],1,-r[5]*t[4],-r[5]*t[5]],[t[6],t[7],1,0,0,0,-r[6]*t[6],-r[6]*t[7]],[0,0,0,t[6],t[7],1,-r[7]*t[6],-r[7]*t[7]]],i={},n=wo(e,8,0,0,0,i);if(n!==0){for(var a=[],s=0;s<8;s++)for(var o=0;o<8;o++)a[o]==null&&(a[o]=0),a[o]+=((s+o)%2?-1:1)*wo(e,7,s===0?1:0,1<<s,1<<o,i)/n*r[s];return function(f,u,h){var l=u*a[6]+h*a[7]+1;f[0]=(u*a[0]+h*a[1]+a[2])/l,f[1]=(u*a[3]+h*a[4]+a[5])/l}}}var Xf="___zrEVENTSAVED",fs=[];function Vg(t,r,e,i,n){return Eo(fs,r,i,n,!0)&&Eo(t,e,fs[0],fs[1])}function Eo(t,r,e,i,n){if(r.getBoundingClientRect&&St.domSupported&&!Nl(r)){var a=r[Xf]||(r[Xf]={}),s=Ed(r,a),o=bd(s,a,n);if(o)return o(t,e,i),!0}return!1}function Ed(t,r){var e=r.markers;if(e)return e;e=r.markers=[];for(var i=["left","right"],n=["top","bottom"],a=0;a<4;a++){var s=document.createElement("div"),o=s.style,f=a%2,u=(a>>1)%2;o.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",i[f]+":0",n[u]+":0",i[1-f]+":auto",n[1-u]+":auto",""].join("!important;"),t.appendChild(s),e.push(s)}return e}function bd(t,r,e){for(var i=e?"invTrans":"trans",n=r[i],a=r.srcCoords,s=[],o=[],f=!0,u=0;u<4;u++){var h=t[u].getBoundingClientRect(),l=2*u,c=h.left,v=h.top;s.push(c,v),f=f&&a&&c===a[l]&&v===a[l+1],o.push(t[u].offsetLeft,t[u].offsetTop)}return f&&n?n:(r.srcCoords=s,r[i]=e?qf(o,s):qf(s,o))}function Nl(t){return t.nodeName.toUpperCase()==="CANVAS"}var Sd=/([&<>"'])/g,Md={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Ad(t){return t==null?"":(t+"").replace(Sd,function(r,e){return Md[e]})}var Rd=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,us=[],Cd=St.browser.firefox&&+St.browser.version.split(".")[0]<39;function bo(t,r,e,i){return e=e||{},i?Yf(t,r,e):Cd&&r.layerX!=null&&r.layerX!==r.offsetX?(e.zrX=r.layerX,e.zrY=r.layerY):r.offsetX!=null?(e.zrX=r.offsetX,e.zrY=r.offsetY):Yf(t,r,e),e}function Yf(t,r,e){if(St.domSupported&&t.getBoundingClientRect){var i=r.clientX,n=r.clientY;if(Nl(t)){var a=t.getBoundingClientRect();e.zrX=i-a.left,e.zrY=n-a.top;return}else if(Eo(us,t,i,n)){e.zrX=us[0],e.zrY=us[1];return}}e.zrX=e.zrY=0}function lf(t){return t||window.event}function xr(t,r,e){if(r=lf(r),r.zrX!=null)return r;var i=r.type,n=i&&i.indexOf("touch")>=0;if(n){var s=i!=="touchend"?r.targetTouches[0]:r.changedTouches[0];s&&bo(t,s,r,e)}else{bo(t,r,r,e);var a=Pd(r);r.zrDelta=a?a/120:-(r.detail||0)/3}var o=r.button;return r.which==null&&o!==void 0&&Rd.test(r.type)&&(r.which=o&1?1:o&2?3:o&4?2:0),r}function Pd(t){var r=t.wheelDelta;if(r)return r;var e=t.deltaX,i=t.deltaY;if(e==null||i==null)return r;var n=Math.abs(i!==0?i:e),a=i>0?-1:i<0?1:e>0?-1:1;return 3*n*a}function Ld(t,r,e,i){t.addEventListener(r,e,i)}function Dd(t,r,e,i){t.removeEventListener(r,e,i)}var Od=function(t){t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0};function qg(t){return t.which===2||t.which===3}var Id=(function(){function t(){this._track=[]}return t.prototype.recognize=function(r,e,i){return this._doTrack(r,e,i),this._recognize(r)},t.prototype.clear=function(){return this._track.length=0,this},t.prototype._doTrack=function(r,e,i){var n=r.touches;if(n){for(var a={points:[],touches:[],target:e,event:r},s=0,o=n.length;s<o;s++){var f=n[s],u=bo(i,f,{});a.points.push([u.zrX,u.zrY]),a.touches.push(f)}this._track.push(a)}},t.prototype._recognize=function(r){for(var e in hs)if(hs.hasOwnProperty(e)){var i=hs[e](this._track,r);if(i)return i}},t})();function Zf(t){var r=t[1][0]-t[0][0],e=t[1][1]-t[0][1];return Math.sqrt(r*r+e*e)}function Nd(t){return[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2]}var hs={pinch:function(t,r){var e=t.length;if(e){var i=(t[e-1]||{}).points,n=(t[e-2]||{}).points||i;if(n&&n.length>1&&i&&i.length>1){var a=Zf(i)/Zf(n);!isFinite(a)&&(a=1),r.pinchScale=a;var s=Nd(i);return r.pinchX=s[0],r.pinchY=s[1],{type:"pinch",target:t[0].target,event:r}}}}};function fe(){return[1,0,0,1,0,0]}function Fl(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function cf(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t}function Ci(t,r,e){var i=r[0]*e[0]+r[2]*e[1],n=r[1]*e[0]+r[3]*e[1],a=r[0]*e[2]+r[2]*e[3],s=r[1]*e[2]+r[3]*e[3],o=r[0]*e[4]+r[2]*e[5]+r[4],f=r[1]*e[4]+r[3]*e[5]+r[5];return t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=f,t}function Ra(t,r,e){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4]+e[0],t[5]=r[5]+e[1],t}function vf(t,r,e,i){i===void 0&&(i=[0,0]);var n=r[0],a=r[2],s=r[4],o=r[1],f=r[3],u=r[5],h=Math.sin(e),l=Math.cos(e);return t[0]=n*l+o*h,t[1]=-n*h+o*l,t[2]=a*l+f*h,t[3]=-a*h+l*f,t[4]=l*(s-i[0])+h*(u-i[1])+i[0],t[5]=l*(u-i[1])-h*(s-i[0])+i[1],t}function df(t,r,e){var i=e[0],n=e[1];return t[0]=r[0]*i,t[1]=r[1]*n,t[2]=r[2]*i,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*n,t}function Bl(t,r){var e=r[0],i=r[2],n=r[4],a=r[1],s=r[3],o=r[5],f=e*s-a*i;return f?(f=1/f,t[0]=s*f,t[1]=-a*f,t[2]=-i*f,t[3]=e*f,t[4]=(i*o-s*n)*f,t[5]=(a*n-e*o)*f,t):null}function Fd(t){var r=fe();return cf(r,t),r}const Xg=Object.freeze(Object.defineProperty({__proto__:null,clone:Fd,copy:cf,create:fe,identity:Fl,invert:Bl,mul:Ci,rotate:vf,scale:df,translate:Ra},Symbol.toStringTag,{value:"Module"}));var ut=(function(){function t(r,e){this.x=r||0,this.y=e||0}return t.prototype.copy=function(r){return this.x=r.x,this.y=r.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.set=function(r,e){return this.x=r,this.y=e,this},t.prototype.equal=function(r){return r.x===this.x&&r.y===this.y},t.prototype.add=function(r){return this.x+=r.x,this.y+=r.y,this},t.prototype.scale=function(r){this.x*=r,this.y*=r},t.prototype.scaleAndAdd=function(r,e){this.x+=r.x*e,this.y+=r.y*e},t.prototype.sub=function(r){return this.x-=r.x,this.y-=r.y,this},t.prototype.dot=function(r){return this.x*r.x+this.y*r.y},t.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var r=this.len();return this.x/=r,this.y/=r,this},t.prototype.distance=function(r){var e=this.x-r.x,i=this.y-r.y;return Math.sqrt(e*e+i*i)},t.prototype.distanceSquare=function(r){var e=this.x-r.x,i=this.y-r.y;return e*e+i*i},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.transform=function(r){if(r){var e=this.x,i=this.y;return this.x=r[0]*e+r[2]*i+r[4],this.y=r[1]*e+r[3]*i+r[5],this}},t.prototype.toArray=function(r){return r[0]=this.x,r[1]=this.y,r},t.prototype.fromArray=function(r){this.x=r[0],this.y=r[1]},t.set=function(r,e,i){r.x=e,r.y=i},t.copy=function(r,e){r.x=e.x,r.y=e.y},t.len=function(r){return Math.sqrt(r.x*r.x+r.y*r.y)},t.lenSquare=function(r){return r.x*r.x+r.y*r.y},t.dot=function(r,e){return r.x*e.x+r.y*e.y},t.add=function(r,e,i){r.x=e.x+i.x,r.y=e.y+i.y},t.sub=function(r,e,i){r.x=e.x-i.x,r.y=e.y-i.y},t.scale=function(r,e,i){r.x=e.x*i,r.y=e.y*i},t.scaleAndAdd=function(r,e,i,n){r.x=e.x+i.x*n,r.y=e.y+i.y*n},t.lerp=function(r,e,i,n){var a=1-n;r.x=a*e.x+n*i.x,r.y=a*e.y+n*i.y},t})(),Hn=Math.min,zn=Math.max,pe=new ut,_e=new ut,ye=new ut,ge=new ut,Wi=new ut,Vi=new ut,Mt=(function(){function t(r,e,i,n){i<0&&(r=r+i,i=-i),n<0&&(e=e+n,n=-n),this.x=r,this.y=e,this.width=i,this.height=n}return t.prototype.union=function(r){var e=Hn(r.x,this.x),i=Hn(r.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=zn(r.x+r.width,this.x+this.width)-e:this.width=r.width,isFinite(this.y)&&isFinite(this.height)?this.height=zn(r.y+r.height,this.y+this.height)-i:this.height=r.height,this.x=e,this.y=i},t.prototype.applyTransform=function(r){t.applyTransform(this,this,r)},t.prototype.calculateTransform=function(r){var e=this,i=r.width/e.width,n=r.height/e.height,a=fe();return Ra(a,a,[-e.x,-e.y]),df(a,a,[i,n]),Ra(a,a,[r.x,r.y]),a},t.prototype.intersect=function(r,e){if(!r)return!1;r instanceof t||(r=t.create(r));var i=this,n=i.x,a=i.x+i.width,s=i.y,o=i.y+i.height,f=r.x,u=r.x+r.width,h=r.y,l=r.y+r.height,c=!(a<f||u<n||o<h||l<s);if(e){var v=1/0,d=0,_=Math.abs(a-f),p=Math.abs(u-n),y=Math.abs(o-h),g=Math.abs(l-s),m=Math.min(_,p),T=Math.min(y,g);a<f||u<n?m>d&&(d=m,_<p?ut.set(Vi,-_,0):ut.set(Vi,p,0)):m<v&&(v=m,_<p?ut.set(Wi,_,0):ut.set(Wi,-p,0)),o<h||l<s?T>d&&(d=T,y<g?ut.set(Vi,0,-y):ut.set(Vi,0,g)):m<v&&(v=m,y<g?ut.set(Wi,0,y):ut.set(Wi,0,-g))}return e&&ut.copy(e,c?Wi:Vi),c},t.prototype.contain=function(r,e){var i=this;return r>=i.x&&r<=i.x+i.width&&e>=i.y&&e<=i.y+i.height},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copy=function(r){t.copy(this,r)},t.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},t.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},t.prototype.isZero=function(){return this.width===0||this.height===0},t.create=function(r){return new t(r.x,r.y,r.width,r.height)},t.copy=function(r,e){r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height},t.applyTransform=function(r,e,i){if(!i){r!==e&&t.copy(r,e);return}if(i[1]<1e-5&&i[1]>-1e-5&&i[2]<1e-5&&i[2]>-1e-5){var n=i[0],a=i[3],s=i[4],o=i[5];r.x=e.x*n+s,r.y=e.y*a+o,r.width=e.width*n,r.height=e.height*a,r.width<0&&(r.x+=r.width,r.width=-r.width),r.height<0&&(r.y+=r.height,r.height=-r.height);return}pe.x=ye.x=e.x,pe.y=ge.y=e.y,_e.x=ge.x=e.x+e.width,_e.y=ye.y=e.y+e.height,pe.transform(i),ge.transform(i),_e.transform(i),ye.transform(i),r.x=Hn(pe.x,_e.x,ye.x,ge.x),r.y=Hn(pe.y,_e.y,ye.y,ge.y);var f=zn(pe.x,_e.x,ye.x,ge.x),u=zn(pe.y,_e.y,ye.y,ge.y);r.width=f-r.x,r.height=u-r.y},t})(),Ul="silent";function Bd(t,r,e){return{type:t,event:e,target:r.target,topTarget:r.topTarget,cancelBubble:!1,offsetX:e.zrX,offsetY:e.zrY,gestureEvent:e.gestureEvent,pinchX:e.pinchX,pinchY:e.pinchY,pinchScale:e.pinchScale,wheelDelta:e.zrDelta,zrByTouch:e.zrByTouch,which:e.which,stop:Ud}}function Ud(){Od(this.event)}var Hd=(function(t){yt(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;return e.handler=null,e}return r.prototype.dispose=function(){},r.prototype.setCursor=function(){},r})(zi),qi=(function(){function t(r,e){this.x=r,this.y=e}return t})(),zd=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],ls=new Mt(0,0,0,0),Hl=(function(t){yt(r,t);function r(e,i,n,a,s){var o=t.call(this)||this;return o._hovered=new qi(0,0),o.storage=e,o.painter=i,o.painterRoot=a,o._pointerSize=s,n=n||new Hd,o.proxy=null,o.setHandlerProxy(n),o._draggingMgr=new xd(o),o}return r.prototype.setHandlerProxy=function(e){this.proxy&&this.proxy.dispose(),e&&(zt(zd,function(i){e.on&&e.on(i,this[i],this)},this),e.handler=this),this.proxy=e},r.prototype.mousemove=function(e){var i=e.zrX,n=e.zrY,a=zl(this,i,n),s=this._hovered,o=s.target;o&&!o.__zr&&(s=this.findHover(s.x,s.y),o=s.target);var f=this._hovered=a?new qi(i,n):this.findHover(i,n),u=f.target,h=this.proxy;h.setCursor&&h.setCursor(u?u.cursor:"default"),o&&u!==o&&this.dispatchToElement(s,"mouseout",e),this.dispatchToElement(f,"mousemove",e),u&&u!==o&&this.dispatchToElement(f,"mouseover",e)},r.prototype.mouseout=function(e){var i=e.zrEventControl;i!=="only_globalout"&&this.dispatchToElement(this._hovered,"mouseout",e),i!=="no_globalout"&&this.trigger("globalout",{type:"globalout",event:e})},r.prototype.resize=function(){this._hovered=new qi(0,0)},r.prototype.dispatch=function(e,i){var n=this[e];n&&n.call(this,i)},r.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},r.prototype.setCursorStyle=function(e){var i=this.proxy;i.setCursor&&i.setCursor(e)},r.prototype.dispatchToElement=function(e,i,n){e=e||{};var a=e.target;if(!(a&&a.silent)){for(var s="on"+i,o=Bd(i,e,n);a&&(a[s]&&(o.cancelBubble=!!a[s].call(a,o)),a.trigger(i,o),a=a.__hostTarget?a.__hostTarget:a.parent,!o.cancelBubble););o.cancelBubble||(this.trigger(i,o),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(f){typeof f[s]=="function"&&f[s].call(f,o),f.trigger&&f.trigger(i,o)}))}},r.prototype.findHover=function(e,i,n){var a=this.storage.getDisplayList(),s=new qi(e,i);if(jf(a,s,e,i,n),this._pointerSize&&!s.target){for(var o=[],f=this._pointerSize,u=f/2,h=new Mt(e-u,i-u,f,f),l=a.length-1;l>=0;l--){var c=a[l];c!==n&&!c.ignore&&!c.ignoreCoarsePointer&&(!c.parent||!c.parent.ignoreCoarsePointer)&&(ls.copy(c.getBoundingRect()),c.transform&&ls.applyTransform(c.transform),ls.intersect(h)&&o.push(c))}if(o.length)for(var v=4,d=Math.PI/12,_=Math.PI*2,p=0;p<u;p+=v)for(var y=0;y<_;y+=d){var g=e+p*Math.cos(y),m=i+p*Math.sin(y);if(jf(o,s,g,m,n),s.target)return s}}return s},r.prototype.processGesture=function(e,i){this._gestureMgr||(this._gestureMgr=new Id);var n=this._gestureMgr;i==="start"&&n.clear();var a=n.recognize(e,this.findHover(e.zrX,e.zrY,null).target,this.proxy.dom);if(i==="end"&&n.clear(),a){var s=a.type;e.gestureEvent=s;var o=new qi;o.target=a.target,this.dispatchToElement(o,s,a.event)}},r})(zi);zt(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(t){Hl.prototype[t]=function(r){var e=r.zrX,i=r.zrY,n=zl(this,e,i),a,s;if((t!=="mouseup"||!n)&&(a=this.findHover(e,i),s=a.target),t==="mousedown")this._downEl=s,this._downPoint=[r.zrX,r.zrY],this._upEl=s;else if(t==="mouseup")this._upEl=s;else if(t==="click"){if(this._downEl!==this._upEl||!this._downPoint||Dl(this._downPoint,[r.zrX,r.zrY])>4)return;this._downPoint=null}this.dispatchToElement(a,t,r)}});function kd(t,r,e){if(t[t.rectHover?"rectContain":"contain"](r,e)){for(var i=t,n=void 0,a=!1;i;){if(i.ignoreClip&&(a=!0),!a){var s=i.getClipPath();if(s&&!s.contain(r,e))return!1}i.silent&&(n=!0);var o=i.__hostTarget;i=o||i.parent}return n?Ul:!0}return!1}function jf(t,r,e,i,n){for(var a=t.length-1;a>=0;a--){var s=t[a],o=void 0;if(s!==n&&!s.ignore&&(o=kd(s,e,i))&&(!r.topTarget&&(r.topTarget=s),o!==Ul)){r.target=s;break}}}function zl(t,r,e){var i=t.painter;return r<0||r>i.getWidth()||e<0||e>i.getHeight()}var kl=32,Xi=7;function Gd(t){for(var r=0;t>=kl;)r|=t&1,t>>=1;return t+r}function $f(t,r,e,i){var n=r+1;if(n===e)return 1;if(i(t[n++],t[r])<0){for(;n<e&&i(t[n],t[n-1])<0;)n++;Wd(t,r,n)}else for(;n<e&&i(t[n],t[n-1])>=0;)n++;return n-r}function Wd(t,r,e){for(e--;r<e;){var i=t[r];t[r++]=t[e],t[e--]=i}}function Kf(t,r,e,i,n){for(i===r&&i++;i<e;i++){for(var a=t[i],s=r,o=i,f;s<o;)f=s+o>>>1,n(a,t[f])<0?o=f:s=f+1;var u=i-s;switch(u){case 3:t[s+3]=t[s+2];case 2:t[s+2]=t[s+1];case 1:t[s+1]=t[s];break;default:for(;u>0;)t[s+u]=t[s+u-1],u--}t[s]=a}}function cs(t,r,e,i,n,a){var s=0,o=0,f=1;if(a(t,r[e+n])>0){for(o=i-n;f<o&&a(t,r[e+n+f])>0;)s=f,f=(f<<1)+1,f<=0&&(f=o);f>o&&(f=o),s+=n,f+=n}else{for(o=n+1;f<o&&a(t,r[e+n-f])<=0;)s=f,f=(f<<1)+1,f<=0&&(f=o);f>o&&(f=o);var u=s;s=n-f,f=n-u}for(s++;s<f;){var h=s+(f-s>>>1);a(t,r[e+h])>0?s=h+1:f=h}return f}function vs(t,r,e,i,n,a){var s=0,o=0,f=1;if(a(t,r[e+n])<0){for(o=n+1;f<o&&a(t,r[e+n-f])<0;)s=f,f=(f<<1)+1,f<=0&&(f=o);f>o&&(f=o);var u=s;s=n-f,f=n-u}else{for(o=i-n;f<o&&a(t,r[e+n+f])>=0;)s=f,f=(f<<1)+1,f<=0&&(f=o);f>o&&(f=o),s+=n,f+=n}for(s++;s<f;){var h=s+(f-s>>>1);a(t,r[e+h])<0?f=h:s=h+1}return f}function Vd(t,r){var e=Xi,i,n,a=0,s=[];i=[],n=[];function o(v,d){i[a]=v,n[a]=d,a+=1}function f(){for(;a>1;){var v=a-2;if(v>=1&&n[v-1]<=n[v]+n[v+1]||v>=2&&n[v-2]<=n[v]+n[v-1])n[v-1]<n[v+1]&&v--;else if(n[v]>n[v+1])break;h(v)}}function u(){for(;a>1;){var v=a-2;v>0&&n[v-1]<n[v+1]&&v--,h(v)}}function h(v){var d=i[v],_=n[v],p=i[v+1],y=n[v+1];n[v]=_+y,v===a-3&&(i[v+1]=i[v+2],n[v+1]=n[v+2]),a--;var g=vs(t[p],t,d,_,0,r);d+=g,_-=g,_!==0&&(y=cs(t[d+_-1],t,p,y,y-1,r),y!==0&&(_<=y?l(d,_,p,y):c(d,_,p,y)))}function l(v,d,_,p){var y=0;for(y=0;y<d;y++)s[y]=t[v+y];var g=0,m=_,T=v;if(t[T++]=t[m++],--p===0){for(y=0;y<d;y++)t[T+y]=s[g+y];return}if(d===1){for(y=0;y<p;y++)t[T+y]=t[m+y];t[T+p]=s[g];return}for(var w=e,x,E,S;;){x=0,E=0,S=!1;do if(r(t[m],s[g])<0){if(t[T++]=t[m++],E++,x=0,--p===0){S=!0;break}}else if(t[T++]=s[g++],x++,E=0,--d===1){S=!0;break}while((x|E)<w);if(S)break;do{if(x=vs(t[m],s,g,d,0,r),x!==0){for(y=0;y<x;y++)t[T+y]=s[g+y];if(T+=x,g+=x,d-=x,d<=1){S=!0;break}}if(t[T++]=t[m++],--p===0){S=!0;break}if(E=cs(s[g],t,m,p,0,r),E!==0){for(y=0;y<E;y++)t[T+y]=t[m+y];if(T+=E,m+=E,p-=E,p===0){S=!0;break}}if(t[T++]=s[g++],--d===1){S=!0;break}w--}while(x>=Xi||E>=Xi);if(S)break;w<0&&(w=0),w+=2}if(e=w,e<1&&(e=1),d===1){for(y=0;y<p;y++)t[T+y]=t[m+y];t[T+p]=s[g]}else{if(d===0)throw new Error;for(y=0;y<d;y++)t[T+y]=s[g+y]}}function c(v,d,_,p){var y=0;for(y=0;y<p;y++)s[y]=t[_+y];var g=v+d-1,m=p-1,T=_+p-1,w=0,x=0;if(t[T--]=t[g--],--d===0){for(w=T-(p-1),y=0;y<p;y++)t[w+y]=s[y];return}if(p===1){for(T-=d,g-=d,x=T+1,w=g+1,y=d-1;y>=0;y--)t[x+y]=t[w+y];t[T]=s[m];return}for(var E=e;;){var S=0,M=0,C=!1;do if(r(s[m],t[g])<0){if(t[T--]=t[g--],S++,M=0,--d===0){C=!0;break}}else if(t[T--]=s[m--],M++,S=0,--p===1){C=!0;break}while((S|M)<E);if(C)break;do{if(S=d-vs(s[m],t,v,d,d-1,r),S!==0){for(T-=S,g-=S,d-=S,x=T+1,w=g+1,y=S-1;y>=0;y--)t[x+y]=t[w+y];if(d===0){C=!0;break}}if(t[T--]=s[m--],--p===1){C=!0;break}if(M=p-cs(t[g],s,0,p,p-1,r),M!==0){for(T-=M,m-=M,p-=M,x=T+1,w=m+1,y=0;y<M;y++)t[x+y]=s[w+y];if(p<=1){C=!0;break}}if(t[T--]=t[g--],--d===0){C=!0;break}E--}while(S>=Xi||M>=Xi);if(C)break;E<0&&(E=0),E+=2}if(e=E,e<1&&(e=1),p===1){for(T-=d,g-=d,x=T+1,w=g+1,y=d-1;y>=0;y--)t[x+y]=t[w+y];t[T]=s[m]}else{if(p===0)throw new Error;for(w=T-(p-1),y=0;y<p;y++)t[w+y]=s[y]}}return{mergeRuns:f,forceMergeRuns:u,pushRun:o}}function qd(t,r,e,i){e||(e=0),i||(i=t.length);var n=i-e;if(!(n<2)){var a=0;if(n<kl){a=$f(t,e,i,r),Kf(t,e,i,e+a,r);return}var s=Vd(t,r),o=Gd(n);do{if(a=$f(t,e,i,r),a<o){var f=n;f>o&&(f=o),Kf(t,e,e+f,e+a,r),a=f}s.pushRun(e,a),s.mergeRuns(),n-=a,e+=a}while(n!==0);s.forceMergeRuns()}}var or=1,on=2,yi=4,Qf=!1;function ds(){Qf||(Qf=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function Jf(t,r){return t.zlevel===r.zlevel?t.z===r.z?t.z2-r.z2:t.z-r.z:t.zlevel-r.zlevel}var Xd=(function(){function t(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=Jf}return t.prototype.traverse=function(r,e){for(var i=0;i<this._roots.length;i++)this._roots[i].traverse(r,e)},t.prototype.getDisplayList=function(r,e){e=e||!1;var i=this._displayList;return(r||!i.length)&&this.updateDisplayList(e),i},t.prototype.updateDisplayList=function(r){this._displayListLen=0;for(var e=this._roots,i=this._displayList,n=0,a=e.length;n<a;n++)this._updateAndAddDisplayable(e[n],null,r);i.length=this._displayListLen,qd(i,Jf)},t.prototype._updateAndAddDisplayable=function(r,e,i){if(!(r.ignore&&!i)){r.beforeUpdate(),r.update(),r.afterUpdate();var n=r.getClipPath();if(r.ignoreClip)e=null;else if(n){e?e=e.slice():e=[];for(var a=n,s=r;a;)a.parent=s,a.updateTransform(),e.push(a),s=a,a=a.getClipPath()}if(r.childrenRef){for(var o=r.childrenRef(),f=0;f<o.length;f++){var u=o[f];r.__dirty&&(u.__dirty|=or),this._updateAndAddDisplayable(u,e,i)}r.__dirty=0}else{var h=r;e&&e.length?h.__clipPaths=e:h.__clipPaths&&h.__clipPaths.length>0&&(h.__clipPaths=[]),isNaN(h.z)&&(ds(),h.z=0),isNaN(h.z2)&&(ds(),h.z2=0),isNaN(h.zlevel)&&(ds(),h.zlevel=0),this._displayList[this._displayListLen++]=h}var l=r.getDecalElement&&r.getDecalElement();l&&this._updateAndAddDisplayable(l,e,i);var c=r.getTextGuideLine();c&&this._updateAndAddDisplayable(c,e,i);var v=r.getTextContent();v&&this._updateAndAddDisplayable(v,e,i)}},t.prototype.addRoot=function(r){r.__zr&&r.__zr.storage===this||this._roots.push(r)},t.prototype.delRoot=function(r){if(r instanceof Array){for(var e=0,i=r.length;e<i;e++)this.delRoot(r[e]);return}var n=Er(this._roots,r);n>=0&&this._roots.splice(n,1)},t.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},t.prototype.getRoots=function(){return this._roots},t.prototype.dispose=function(){this._displayList=null,this._roots=null},t})(),Ca;Ca=St.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(t){return setTimeout(t,16)};var pn={linear:function(t){return t},quadraticIn:function(t){return t*t},quadraticOut:function(t){return t*(2-t)},quadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quarticIn:function(t){return t*t*t*t},quarticOut:function(t){return 1- --t*t*t*t},quarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quinticIn:function(t){return t*t*t*t*t},quinticOut:function(t){return--t*t*t*t*t+1},quinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sinusoidalIn:function(t){return 1-Math.cos(t*Math.PI/2)},sinusoidalOut:function(t){return Math.sin(t*Math.PI/2)},sinusoidalInOut:function(t){return .5*(1-Math.cos(Math.PI*t))},exponentialIn:function(t){return t===0?0:Math.pow(1024,t-1)},exponentialOut:function(t){return t===1?1:1-Math.pow(2,-10*t)},exponentialInOut:function(t){return t===0?0:t===1?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circularIn:function(t){return 1-Math.sqrt(1-t*t)},circularOut:function(t){return Math.sqrt(1- --t*t)},circularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var r,e=.1,i=.4;return t===0?0:t===1?1:(!e||e<1?(e=1,r=i/4):r=i*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/i)))},elasticOut:function(t){var r,e=.1,i=.4;return t===0?0:t===1?1:(!e||e<1?(e=1,r=i/4):r=i*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-r)*(2*Math.PI)/i)+1)},elasticInOut:function(t){var r,e=.1,i=.4;return t===0?0:t===1?1:(!e||e<1?(e=1,r=i/4):r=i*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?-.5*(e*Math.pow(2,10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/i)):e*Math.pow(2,-10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/i)*.5+1)},backIn:function(t){var r=1.70158;return t*t*((r+1)*t-r)},backOut:function(t){var r=1.70158;return--t*t*((r+1)*t+r)+1},backInOut:function(t){var r=2.5949095;return(t*=2)<1?.5*(t*t*((r+1)*t-r)):.5*((t-=2)*t*((r+1)*t+r)+2)},bounceIn:function(t){return 1-pn.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?pn.bounceIn(t*2)*.5:pn.bounceOut(t*2-1)*.5+.5}},kn=Math.pow,ue=Math.sqrt,Pa=1e-8,Gl=1e-4,tu=ue(3),Gn=1/3,Ur=Qe(),pr=Qe(),Pi=Qe();function ie(t){return t>-Pa&&t<Pa}function Wl(t){return t>Pa||t<-Pa}function Ut(t,r,e,i,n){var a=1-n;return a*a*(a*t+3*n*r)+n*n*(n*i+3*a*e)}function ru(t,r,e,i,n){var a=1-n;return 3*(((r-t)*a+2*(e-r)*n)*a+(i-e)*n*n)}function Vl(t,r,e,i,n,a){var s=i+3*(r-e)-t,o=3*(e-r*2+t),f=3*(r-t),u=t-n,h=o*o-3*s*f,l=o*f-9*s*u,c=f*f-3*o*u,v=0;if(ie(h)&&ie(l))if(ie(o))a[0]=0;else{var d=-f/o;d>=0&&d<=1&&(a[v++]=d)}else{var _=l*l-4*h*c;if(ie(_)){var p=l/h,d=-o/s+p,y=-p/2;d>=0&&d<=1&&(a[v++]=d),y>=0&&y<=1&&(a[v++]=y)}else if(_>0){var g=ue(_),m=h*o+1.5*s*(-l+g),T=h*o+1.5*s*(-l-g);m<0?m=-kn(-m,Gn):m=kn(m,Gn),T<0?T=-kn(-T,Gn):T=kn(T,Gn);var d=(-o-(m+T))/(3*s);d>=0&&d<=1&&(a[v++]=d)}else{var w=(2*h*o-3*s*l)/(2*ue(h*h*h)),x=Math.acos(w)/3,E=ue(h),S=Math.cos(x),d=(-o-2*E*S)/(3*s),y=(-o+E*(S+tu*Math.sin(x)))/(3*s),M=(-o+E*(S-tu*Math.sin(x)))/(3*s);d>=0&&d<=1&&(a[v++]=d),y>=0&&y<=1&&(a[v++]=y),M>=0&&M<=1&&(a[v++]=M)}}return v}function ql(t,r,e,i,n){var a=6*e-12*r+6*t,s=9*r+3*i-3*t-9*e,o=3*r-3*t,f=0;if(ie(s)){if(Wl(a)){var u=-o/a;u>=0&&u<=1&&(n[f++]=u)}}else{var h=a*a-4*s*o;if(ie(h))n[0]=-a/(2*s);else if(h>0){var l=ue(h),u=(-a+l)/(2*s),c=(-a-l)/(2*s);u>=0&&u<=1&&(n[f++]=u),c>=0&&c<=1&&(n[f++]=c)}}return f}function ve(t,r,e,i,n,a){var s=(r-t)*n+t,o=(e-r)*n+r,f=(i-e)*n+e,u=(o-s)*n+s,h=(f-o)*n+o,l=(h-u)*n+u;a[0]=t,a[1]=s,a[2]=u,a[3]=l,a[4]=l,a[5]=h,a[6]=f,a[7]=i}function Yd(t,r,e,i,n,a,s,o,f,u,h){var l,c=.005,v=1/0,d,_,p,y;Ur[0]=f,Ur[1]=u;for(var g=0;g<1;g+=.05)pr[0]=Ut(t,e,n,s,g),pr[1]=Ut(r,i,a,o,g),p=Xe(Ur,pr),p<v&&(l=g,v=p);v=1/0;for(var m=0;m<32&&!(c<Gl);m++)d=l-c,_=l+c,pr[0]=Ut(t,e,n,s,d),pr[1]=Ut(r,i,a,o,d),p=Xe(pr,Ur),d>=0&&p<v?(l=d,v=p):(Pi[0]=Ut(t,e,n,s,_),Pi[1]=Ut(r,i,a,o,_),y=Xe(Pi,Ur),_<=1&&y<v?(l=_,v=y):c*=.5);return h&&(h[0]=Ut(t,e,n,s,l),h[1]=Ut(r,i,a,o,l)),ue(v)}function Zd(t,r,e,i,n,a,s,o,f){for(var u=t,h=r,l=0,c=1/f,v=1;v<=f;v++){var d=v*c,_=Ut(t,e,n,s,d),p=Ut(r,i,a,o,d),y=_-u,g=p-h;l+=Math.sqrt(y*y+g*g),u=_,h=p}return l}function Gt(t,r,e,i){var n=1-i;return n*(n*t+2*i*r)+i*i*e}function eu(t,r,e,i){return 2*((1-i)*(r-t)+i*(e-r))}function jd(t,r,e,i,n){var a=t-2*r+e,s=2*(r-t),o=t-i,f=0;if(ie(a)){if(Wl(s)){var u=-o/s;u>=0&&u<=1&&(n[f++]=u)}}else{var h=s*s-4*a*o;if(ie(h)){var u=-s/(2*a);u>=0&&u<=1&&(n[f++]=u)}else if(h>0){var l=ue(h),u=(-s+l)/(2*a),c=(-s-l)/(2*a);u>=0&&u<=1&&(n[f++]=u),c>=0&&c<=1&&(n[f++]=c)}}return f}function Xl(t,r,e){var i=t+e-2*r;return i===0?.5:(t-r)/i}function La(t,r,e,i,n){var a=(r-t)*i+t,s=(e-r)*i+r,o=(s-a)*i+a;n[0]=t,n[1]=a,n[2]=o,n[3]=o,n[4]=s,n[5]=e}function $d(t,r,e,i,n,a,s,o,f){var u,h=.005,l=1/0;Ur[0]=s,Ur[1]=o;for(var c=0;c<1;c+=.05){pr[0]=Gt(t,e,n,c),pr[1]=Gt(r,i,a,c);var v=Xe(Ur,pr);v<l&&(u=c,l=v)}l=1/0;for(var d=0;d<32&&!(h<Gl);d++){var _=u-h,p=u+h;pr[0]=Gt(t,e,n,_),pr[1]=Gt(r,i,a,_);var v=Xe(pr,Ur);if(_>=0&&v<l)u=_,l=v;else{Pi[0]=Gt(t,e,n,p),Pi[1]=Gt(r,i,a,p);var y=Xe(Pi,Ur);p<=1&&y<l?(u=p,l=y):h*=.5}}return f&&(f[0]=Gt(t,e,n,u),f[1]=Gt(r,i,a,u)),ue(l)}function Kd(t,r,e,i,n,a,s){for(var o=t,f=r,u=0,h=1/s,l=1;l<=s;l++){var c=l*h,v=Gt(t,e,n,c),d=Gt(r,i,a,c),_=v-o,p=d-f;u+=Math.sqrt(_*_+p*p),o=v,f=d}return u}var Qd=/cubic-bezier\(([0-9,\.e ]+)\)/;function pf(t){var r=t&&Qd.exec(t);if(r){var e=r[1].split(","),i=+Ue(e[0]),n=+Ue(e[1]),a=+Ue(e[2]),s=+Ue(e[3]);if(isNaN(i+n+a+s))return;var o=[];return function(f){return f<=0?0:f>=1?1:Vl(0,i,a,1,f,o)&&Ut(0,n,s,1,o[0])}}}var Jd=(function(){function t(r){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=r.life||1e3,this._delay=r.delay||0,this.loop=r.loop||!1,this.onframe=r.onframe||oe,this.ondestroy=r.ondestroy||oe,this.onrestart=r.onrestart||oe,r.easing&&this.setEasing(r.easing)}return t.prototype.step=function(r,e){if(this._inited||(this._startTime=r+this._delay,this._inited=!0),this._paused){this._pausedTime+=e;return}var i=this._life,n=r-this._startTime-this._pausedTime,a=n/i;a<0&&(a=0),a=Math.min(a,1);var s=this.easingFunc,o=s?s(a):a;if(this.onframe(o),a===1)if(this.loop){var f=n%i;this._startTime=r-f,this._pausedTime=0,this.onrestart()}else return!0;return!1},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1},t.prototype.setEasing=function(r){this.easing=r,this.easingFunc=Hi(r)?r:pn[r]||pf(r)},t})(),Yl=(function(){function t(r){this.value=r}return t})(),tp=(function(){function t(){this._len=0}return t.prototype.insert=function(r){var e=new Yl(r);return this.insertEntry(e),e},t.prototype.insertEntry=function(r){this.head?(this.tail.next=r,r.prev=this.tail,r.next=null,this.tail=r):this.head=this.tail=r,this._len++},t.prototype.remove=function(r){var e=r.prev,i=r.next;e?e.next=i:this.head=i,i?i.prev=e:this.tail=e,r.next=r.prev=null,this._len--},t.prototype.len=function(){return this._len},t.prototype.clear=function(){this.head=this.tail=null,this._len=0},t})(),Za=(function(){function t(r){this._list=new tp,this._maxSize=10,this._map={},this._maxSize=r}return t.prototype.put=function(r,e){var i=this._list,n=this._map,a=null;if(n[r]==null){var s=i.len(),o=this._lastRemovedEntry;if(s>=this._maxSize&&s>0){var f=i.head;i.remove(f),delete n[f.key],a=f.value,this._lastRemovedEntry=f}o?o.value=e:o=new Yl(e),o.key=r,i.insertEntry(o),n[r]=o}return a},t.prototype.get=function(r){var e=this._map[r],i=this._list;if(e!=null)return e!==i.tail&&(i.remove(e),i.insertEntry(e)),e.value},t.prototype.clear=function(){this._list.clear(),this._map={}},t.prototype.len=function(){return this._list.len()},t})(),iu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function br(t){return t=Math.round(t),t<0?0:t>255?255:t}function rp(t){return t=Math.round(t),t<0?0:t>360?360:t}function Tn(t){return t<0?0:t>1?1:t}function ps(t){var r=t;return r.length&&r.charAt(r.length-1)==="%"?br(parseFloat(r)/100*255):br(parseInt(r,10))}function Ye(t){var r=t;return r.length&&r.charAt(r.length-1)==="%"?Tn(parseFloat(r)/100):Tn(parseFloat(r))}function _s(t,r,e){return e<0?e+=1:e>1&&(e-=1),e*6<1?t+(r-t)*e*6:e*2<1?r:e*3<2?t+(r-t)*(2/3-e)*6:t}function ne(t,r,e){return t+(r-t)*e}function vr(t,r,e,i,n){return t[0]=r,t[1]=e,t[2]=i,t[3]=n,t}function So(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}var Zl=new Za(20),Wn=null;function ei(t,r){Wn&&So(Wn,r),Wn=Zl.put(t,Wn||r.slice())}function fr(t,r){if(t){r=r||[];var e=Zl.get(t);if(e)return So(r,e);t=t+"";var i=t.replace(/ /g,"").toLowerCase();if(i in iu)return So(r,iu[i]),ei(t,r),r;var n=i.length;if(i.charAt(0)==="#"){if(n===4||n===5){var a=parseInt(i.slice(1,4),16);if(!(a>=0&&a<=4095)){vr(r,0,0,0,1);return}return vr(r,(a&3840)>>4|(a&3840)>>8,a&240|(a&240)>>4,a&15|(a&15)<<4,n===5?parseInt(i.slice(4),16)/15:1),ei(t,r),r}else if(n===7||n===9){var a=parseInt(i.slice(1,7),16);if(!(a>=0&&a<=16777215)){vr(r,0,0,0,1);return}return vr(r,(a&16711680)>>16,(a&65280)>>8,a&255,n===9?parseInt(i.slice(7),16)/255:1),ei(t,r),r}return}var s=i.indexOf("("),o=i.indexOf(")");if(s!==-1&&o+1===n){var f=i.substr(0,s),u=i.substr(s+1,o-(s+1)).split(","),h=1;switch(f){case"rgba":if(u.length!==4)return u.length===3?vr(r,+u[0],+u[1],+u[2],1):vr(r,0,0,0,1);h=Ye(u.pop());case"rgb":if(u.length>=3)return vr(r,ps(u[0]),ps(u[1]),ps(u[2]),u.length===3?h:Ye(u[3])),ei(t,r),r;vr(r,0,0,0,1);return;case"hsla":if(u.length!==4){vr(r,0,0,0,1);return}return u[3]=Ye(u[3]),Mo(u,r),ei(t,r),r;case"hsl":if(u.length!==3){vr(r,0,0,0,1);return}return Mo(u,r),ei(t,r),r;default:return}}vr(r,0,0,0,1)}}function Mo(t,r){var e=(parseFloat(t[0])%360+360)%360/360,i=Ye(t[1]),n=Ye(t[2]),a=n<=.5?n*(i+1):n+i-n*i,s=n*2-a;return r=r||[],vr(r,br(_s(s,a,e+1/3)*255),br(_s(s,a,e)*255),br(_s(s,a,e-1/3)*255),1),t.length===4&&(r[3]=t[3]),r}function ep(t){if(t){var r=t[0]/255,e=t[1]/255,i=t[2]/255,n=Math.min(r,e,i),a=Math.max(r,e,i),s=a-n,o=(a+n)/2,f,u;if(s===0)f=0,u=0;else{o<.5?u=s/(a+n):u=s/(2-a-n);var h=((a-r)/6+s/2)/s,l=((a-e)/6+s/2)/s,c=((a-i)/6+s/2)/s;r===a?f=c-l:e===a?f=1/3+h-c:i===a&&(f=2/3+l-h),f<0&&(f+=1),f>1&&(f-=1)}var v=[f*360,u,o];return t[3]!=null&&v.push(t[3]),v}}function Ao(t,r){var e=fr(t);if(e){for(var i=0;i<3;i++)r<0?e[i]=e[i]*(1-r)|0:e[i]=(255-e[i])*r+e[i]|0,e[i]>255?e[i]=255:e[i]<0&&(e[i]=0);return Je(e,e.length===4?"rgba":"rgb")}}function ip(t){var r=fr(t);if(r)return((1<<24)+(r[0]<<16)+(r[1]<<8)+ +r[2]).toString(16).slice(1)}function jl(t,r,e){if(!(!(r&&r.length)||!(t>=0&&t<=1))){e=e||[];var i=t*(r.length-1),n=Math.floor(i),a=Math.ceil(i),s=r[n],o=r[a],f=i-n;return e[0]=br(ne(s[0],o[0],f)),e[1]=br(ne(s[1],o[1],f)),e[2]=br(ne(s[2],o[2],f)),e[3]=Tn(ne(s[3],o[3],f)),e}}var np=jl;function $l(t,r,e){if(!(!(r&&r.length)||!(t>=0&&t<=1))){var i=t*(r.length-1),n=Math.floor(i),a=Math.ceil(i),s=fr(r[n]),o=fr(r[a]),f=i-n,u=Je([br(ne(s[0],o[0],f)),br(ne(s[1],o[1],f)),br(ne(s[2],o[2],f)),Tn(ne(s[3],o[3],f))],"rgba");return e?{color:u,leftIndex:n,rightIndex:a,value:i}:u}}var ap=$l;function sp(t,r,e,i){var n=fr(t);if(t)return n=ep(n),r!=null&&(n[0]=rp(r)),e!=null&&(n[1]=Ye(e)),i!=null&&(n[2]=Ye(i)),Je(Mo(n),"rgba")}function op(t,r){var e=fr(t);if(e&&r!=null)return e[3]=Tn(r),Je(e,"rgba")}function Je(t,r){if(!(!t||!t.length)){var e=t[0]+","+t[1]+","+t[2];return(r==="rgba"||r==="hsva"||r==="hsla")&&(e+=","+t[3]),r+"("+e+")"}}function xn(t,r){var e=fr(t);return e?(.299*e[0]+.587*e[1]+.114*e[2])*e[3]/255+(1-e[3])*r:0}function fp(){return Je([Math.round(Math.random()*255),Math.round(Math.random()*255),Math.round(Math.random()*255)],"rgb")}var nu=new Za(100);function Kl(t){if(Ar(t)){var r=nu.get(t);return r||(r=Ao(t,-.1),nu.put(t,r)),r}else if(Dn(t)){var e=dt({},t);return e.colorStops=Lt(t.colorStops,function(i){return{offset:i.offset,color:Ao(i.color,-.1)}}),e}return t}const Yg=Object.freeze(Object.defineProperty({__proto__:null,fastLerp:jl,fastMapToColor:np,lerp:$l,lift:Ao,liftColor:Kl,lum:xn,mapToColor:ap,modifyAlpha:op,modifyHSL:sp,parse:fr,random:fp,stringify:Je,toHex:ip},Symbol.toStringTag,{value:"Module"}));var Da=Math.round;function wn(t){var r;if(!t||t==="transparent")t="none";else if(typeof t=="string"&&t.indexOf("rgba")>-1){var e=fr(t);e&&(t="rgb("+e[0]+","+e[1]+","+e[2]+")",r=e[3])}return{color:t,opacity:r??1}}var au=1e-4;function ae(t){return t<au&&t>-au}function Vn(t){return Da(t*1e3)/1e3}function Ro(t){return Da(t*1e4)/1e4}function up(t){return"matrix("+Vn(t[0])+","+Vn(t[1])+","+Vn(t[2])+","+Vn(t[3])+","+Ro(t[4])+","+Ro(t[5])+")"}var hp={left:"start",right:"end",center:"middle",middle:"middle"};function lp(t,r,e){return e==="top"?t+=r/2:e==="bottom"&&(t-=r/2),t}function cp(t){return t&&(t.shadowBlur||t.shadowOffsetX||t.shadowOffsetY)}function vp(t){var r=t.style,e=t.getGlobalScale();return[r.shadowColor,(r.shadowBlur||0).toFixed(2),(r.shadowOffsetX||0).toFixed(2),(r.shadowOffsetY||0).toFixed(2),e[0],e[1]].join(",")}function Ql(t){return t&&!!t.image}function dp(t){return t&&!!t.svgElement}function _f(t){return Ql(t)||dp(t)}function Jl(t){return t.type==="linear"}function tc(t){return t.type==="radial"}function rc(t){return t&&(t.type==="linear"||t.type==="radial")}function ja(t){return"url(#"+t+")"}function ec(t){var r=t.getGlobalScale(),e=Math.max(r[0],r[1]);return Math.max(Math.ceil(Math.log(e)/Math.log(10)),1)}function ic(t){var r=t.x||0,e=t.y||0,i=(t.rotation||0)*dn,n=Pt(t.scaleX,1),a=Pt(t.scaleY,1),s=t.skewX||0,o=t.skewY||0,f=[];return(r||e)&&f.push("translate("+r+"px,"+e+"px)"),i&&f.push("rotate("+i+")"),(n!==1||a!==1)&&f.push("scale("+n+","+a+")"),(s||o)&&f.push("skew("+Da(s*dn)+"deg, "+Da(o*dn)+"deg)"),f.join(" ")}var pp=(function(){return St.hasGlobalWindow&&Hi(window.btoa)?function(t){return window.btoa(unescape(encodeURIComponent(t)))}:typeof Buffer<"u"?function(t){return Buffer.from(t).toString("base64")}:function(t){return null}})(),Co=Array.prototype.slice;function Xr(t,r,e){return(r-t)*e+t}function ys(t,r,e,i){for(var n=r.length,a=0;a<n;a++)t[a]=Xr(r[a],e[a],i);return t}function _p(t,r,e,i){for(var n=r.length,a=n&&r[0].length,s=0;s<n;s++){t[s]||(t[s]=[]);for(var o=0;o<a;o++)t[s][o]=Xr(r[s][o],e[s][o],i)}return t}function qn(t,r,e,i){for(var n=r.length,a=0;a<n;a++)t[a]=r[a]+e[a]*i;return t}function su(t,r,e,i){for(var n=r.length,a=n&&r[0].length,s=0;s<n;s++){t[s]||(t[s]=[]);for(var o=0;o<a;o++)t[s][o]=r[s][o]+e[s][o]*i}return t}function yp(t,r){for(var e=t.length,i=r.length,n=e>i?r:t,a=Math.min(e,i),s=n[a-1]||{color:[0,0,0,0],offset:0},o=a;o<Math.max(e,i);o++)n.push({offset:s.offset,color:s.color.slice()})}function gp(t,r,e){var i=t,n=r;if(!(!i.push||!n.push)){var a=i.length,s=n.length;if(a!==s){var o=a>s;if(o)i.length=s;else for(var f=a;f<s;f++)i.push(e===1?n[f]:Co.call(n[f]))}for(var u=i[0]&&i[0].length,f=0;f<i.length;f++)if(e===1)isNaN(i[f])&&(i[f]=n[f]);else for(var h=0;h<u;h++)isNaN(i[f][h])&&(i[f][h]=n[f][h])}}function da(t){if(Mr(t)){var r=t.length;if(Mr(t[0])){for(var e=[],i=0;i<r;i++)e.push(Co.call(t[i]));return e}return Co.call(t)}return t}function pa(t){return t[0]=Math.floor(t[0])||0,t[1]=Math.floor(t[1])||0,t[2]=Math.floor(t[2])||0,t[3]=t[3]==null?1:t[3],"rgba("+t.join(",")+")"}function mp(t){return Mr(t&&t[0])?2:1}var Xn=0,_a=1,nc=2,fn=3,Po=4,Lo=5,ou=6;function fu(t){return t===Po||t===Lo}function Yn(t){return t===_a||t===nc}var Yi=[0,0,0,0],Tp=(function(){function t(r){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=r}return t.prototype.isFinished=function(){return this._finished},t.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},t.prototype.needsAnimate=function(){return this.keyframes.length>=1},t.prototype.getAdditiveTrack=function(){return this._additiveTrack},t.prototype.addKeyframe=function(r,e,i){this._needsSort=!0;var n=this.keyframes,a=n.length,s=!1,o=ou,f=e;if(Mr(e)){var u=mp(e);o=u,(u===1&&!Mi(e[0])||u===2&&!Mi(e[0][0]))&&(s=!0)}else if(Mi(e)&&!bl(e))o=Xn;else if(Ar(e))if(!isNaN(+e))o=Xn;else{var h=fr(e);h&&(f=h,o=fn)}else if(Dn(e)){var l=dt({},f);l.colorStops=Lt(e.colorStops,function(v){return{offset:v.offset,color:fr(v.color)}}),Jl(e)?o=Po:tc(e)&&(o=Lo),f=l}a===0?this.valType=o:(o!==this.valType||o===ou)&&(s=!0),this.discrete=this.discrete||s;var c={time:r,value:f,rawValue:e,percent:0};return i&&(c.easing=i,c.easingFunc=Hi(i)?i:pn[i]||pf(i)),n.push(c),c},t.prototype.prepare=function(r,e){var i=this.keyframes;this._needsSort&&i.sort(function(_,p){return _.time-p.time});for(var n=this.valType,a=i.length,s=i[a-1],o=this.discrete,f=Yn(n),u=fu(n),h=0;h<a;h++){var l=i[h],c=l.value,v=s.value;l.percent=l.time/r,o||(f&&h!==a-1?gp(c,v,n):u&&yp(c.colorStops,v.colorStops))}if(!o&&n!==Lo&&e&&this.needsAnimate()&&e.needsAnimate()&&n===e.valType&&!e._finished){this._additiveTrack=e;for(var d=i[0].value,h=0;h<a;h++)n===Xn?i[h].additiveValue=i[h].value-d:n===fn?i[h].additiveValue=qn([],i[h].value,d,-1):Yn(n)&&(i[h].additiveValue=n===_a?qn([],i[h].value,d,-1):su([],i[h].value,d,-1))}},t.prototype.step=function(r,e){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var i=this._additiveTrack!=null,n=i?"additiveValue":"value",a=this.valType,s=this.keyframes,o=s.length,f=this.propName,u=a===fn,h,l=this._lastFr,c=Math.min,v,d;if(o===1)v=d=s[0];else{if(e<0)h=0;else if(e<this._lastFrP){var _=c(l+1,o-1);for(h=_;h>=0&&!(s[h].percent<=e);h--);h=c(h,o-2)}else{for(h=l;h<o&&!(s[h].percent>e);h++);h=c(h-1,o-2)}d=s[h+1],v=s[h]}if(v&&d){this._lastFr=h,this._lastFrP=e;var p=d.percent-v.percent,y=p===0?1:c((e-v.percent)/p,1);d.easingFunc&&(y=d.easingFunc(y));var g=i?this._additiveValue:u?Yi:r[f];if((Yn(a)||u)&&!g&&(g=this._additiveValue=[]),this.discrete)r[f]=y<1?v.rawValue:d.rawValue;else if(Yn(a))a===_a?ys(g,v[n],d[n],y):_p(g,v[n],d[n],y);else if(fu(a)){var m=v[n],T=d[n],w=a===Po;r[f]={type:w?"linear":"radial",x:Xr(m.x,T.x,y),y:Xr(m.y,T.y,y),colorStops:Lt(m.colorStops,function(E,S){var M=T.colorStops[S];return{offset:Xr(E.offset,M.offset,y),color:pa(ys([],E.color,M.color,y))}}),global:T.global},w?(r[f].x2=Xr(m.x2,T.x2,y),r[f].y2=Xr(m.y2,T.y2,y)):r[f].r=Xr(m.r,T.r,y)}else if(u)ys(g,v[n],d[n],y),i||(r[f]=pa(g));else{var x=Xr(v[n],d[n],y);i?this._additiveValue=x:r[f]=x}i&&this._addToTarget(r)}}},t.prototype._addToTarget=function(r){var e=this.valType,i=this.propName,n=this._additiveValue;e===Xn?r[i]=r[i]+n:e===fn?(fr(r[i],Yi),qn(Yi,Yi,n,1),r[i]=pa(Yi)):e===_a?qn(r[i],r[i],n,1):e===nc&&su(r[i],r[i],n,1)},t})(),yf=(function(){function t(r,e,i,n){if(this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=r,this._loop=e,e&&n){Ya("Can' use additive animation on looped animation.");return}this._additiveAnimators=n,this._allowDiscrete=i}return t.prototype.getMaxTime=function(){return this._maxTime},t.prototype.getDelay=function(){return this._delay},t.prototype.getLoop=function(){return this._loop},t.prototype.getTarget=function(){return this._target},t.prototype.changeTarget=function(r){this._target=r},t.prototype.when=function(r,e,i){return this.whenWithKeys(r,e,wt(e),i)},t.prototype.whenWithKeys=function(r,e,i,n){for(var a=this._tracks,s=0;s<i.length;s++){var o=i[s],f=a[o];if(!f){f=a[o]=new Tp(o);var u=void 0,h=this._getAdditiveTrack(o);if(h){var l=h.keyframes,c=l[l.length-1];u=c&&c.value,h.valType===fn&&u&&(u=pa(u))}else u=this._target[o];if(u==null)continue;r>0&&f.addKeyframe(0,da(u),n),this._trackKeys.push(o)}f.addKeyframe(r,da(e[o]),n)}return this._maxTime=Math.max(this._maxTime,r),this},t.prototype.pause=function(){this._clip.pause(),this._paused=!0},t.prototype.resume=function(){this._clip.resume(),this._paused=!1},t.prototype.isPaused=function(){return!!this._paused},t.prototype.duration=function(r){return this._maxTime=r,this._force=!0,this},t.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var r=this._doneCbs;if(r)for(var e=r.length,i=0;i<e;i++)r[i].call(this)},t.prototype._abortedCallback=function(){this._setTracksFinished();var r=this.animation,e=this._abortedCbs;if(r&&r.removeClip(this._clip),this._clip=null,e)for(var i=0;i<e.length;i++)e[i].call(this)},t.prototype._setTracksFinished=function(){for(var r=this._tracks,e=this._trackKeys,i=0;i<e.length;i++)r[e[i]].setFinished()},t.prototype._getAdditiveTrack=function(r){var e,i=this._additiveAnimators;if(i)for(var n=0;n<i.length;n++){var a=i[n].getTrack(r);a&&(e=a)}return e},t.prototype.start=function(r){if(!(this._started>0)){this._started=1;for(var e=this,i=[],n=this._maxTime||0,a=0;a<this._trackKeys.length;a++){var s=this._trackKeys[a],o=this._tracks[s],f=this._getAdditiveTrack(s),u=o.keyframes,h=u.length;if(o.prepare(n,f),o.needsAnimate())if(!this._allowDiscrete&&o.discrete){var l=u[h-1];l&&(e._target[o.propName]=l.rawValue),o.setFinished()}else i.push(o)}if(i.length||this._force){var c=new Jd({life:n,loop:this._loop,delay:this._delay||0,onframe:function(v){e._started=2;var d=e._additiveAnimators;if(d){for(var _=!1,p=0;p<d.length;p++)if(d[p]._clip){_=!0;break}_||(e._additiveAnimators=null)}for(var p=0;p<i.length;p++)i[p].step(e._target,v);var y=e._onframeCbs;if(y)for(var p=0;p<y.length;p++)y[p](e._target,v)},ondestroy:function(){e._doneCallback()}});this._clip=c,this.animation&&this.animation.addClip(c),r&&c.setEasing(r)}else this._doneCallback();return this}},t.prototype.stop=function(r){if(this._clip){var e=this._clip;r&&e.onframe(1),this._abortedCallback()}},t.prototype.delay=function(r){return this._delay=r,this},t.prototype.during=function(r){return r&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(r)),this},t.prototype.done=function(r){return r&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(r)),this},t.prototype.aborted=function(r){return r&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(r)),this},t.prototype.getClip=function(){return this._clip},t.prototype.getTrack=function(r){return this._tracks[r]},t.prototype.getTracks=function(){var r=this;return Lt(this._trackKeys,function(e){return r._tracks[e]})},t.prototype.stopTracks=function(r,e){if(!r.length||!this._clip)return!0;for(var i=this._tracks,n=this._trackKeys,a=0;a<r.length;a++){var s=i[r[a]];s&&!s.isFinished()&&(e?s.step(this._target,1):this._started===1&&s.step(this._target,0),s.setFinished())}for(var o=!0,a=0;a<n.length;a++)if(!i[n[a]].isFinished()){o=!1;break}return o&&this._abortedCallback(),o},t.prototype.saveTo=function(r,e,i){if(r){e=e||this._trackKeys;for(var n=0;n<e.length;n++){var a=e[n],s=this._tracks[a];if(!(!s||s.isFinished())){var o=s.keyframes,f=o[i?0:o.length-1];f&&(r[a]=da(f.rawValue))}}}},t.prototype.__changeFinalValue=function(r,e){e=e||wt(r);for(var i=0;i<e.length;i++){var n=e[i],a=this._tracks[n];if(a){var s=a.keyframes;if(s.length>1){var o=s.pop();a.addKeyframe(o.time,r[n]),a.prepare(this._maxTime,a.getAdditiveTrack())}}}},t})();function Ti(){return new Date().getTime()}var xp=(function(t){yt(r,t);function r(e){var i=t.call(this)||this;return i._running=!1,i._time=0,i._pausedTime=0,i._pauseStart=0,i._paused=!1,e=e||{},i.stage=e.stage||{},i}return r.prototype.addClip=function(e){e.animation&&this.removeClip(e),this._head?(this._tail.next=e,e.prev=this._tail,e.next=null,this._tail=e):this._head=this._tail=e,e.animation=this},r.prototype.addAnimator=function(e){e.animation=this;var i=e.getClip();i&&this.addClip(i)},r.prototype.removeClip=function(e){if(e.animation){var i=e.prev,n=e.next;i?i.next=n:this._head=n,n?n.prev=i:this._tail=i,e.next=e.prev=e.animation=null}},r.prototype.removeAnimator=function(e){var i=e.getClip();i&&this.removeClip(i),e.animation=null},r.prototype.update=function(e){for(var i=Ti()-this._pausedTime,n=i-this._time,a=this._head;a;){var s=a.next,o=a.step(i,n);o&&(a.ondestroy(),this.removeClip(a)),a=s}this._time=i,e||(this.trigger("frame",n),this.stage.update&&this.stage.update())},r.prototype._startLoop=function(){var e=this;this._running=!0;function i(){e._running&&(Ca(i),!e._paused&&e.update())}Ca(i)},r.prototype.start=function(){this._running||(this._time=Ti(),this._pausedTime=0,this._startLoop())},r.prototype.stop=function(){this._running=!1},r.prototype.pause=function(){this._paused||(this._pauseStart=Ti(),this._paused=!0)},r.prototype.resume=function(){this._paused&&(this._pausedTime+=Ti()-this._pauseStart,this._paused=!1)},r.prototype.clear=function(){for(var e=this._head;e;){var i=e.next;e.prev=e.next=e.animation=null,e=i}this._head=this._tail=null},r.prototype.isFinished=function(){return this._head==null},r.prototype.animate=function(e,i){i=i||{},this.start();var n=new yf(e,i.loop);return this.addAnimator(n),n},r})(zi),wp=300,gs=St.domSupported,ms=(function(){var t=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],r=["touchstart","touchend","touchmove"],e={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},i=Lt(t,function(n){var a=n.replace("mouse","pointer");return e.hasOwnProperty(a)?a:n});return{mouse:t,touch:r,pointer:i}})(),uu={mouse:["mousemove","mouseup"],pointer:["pointermove","pointerup"]},hu=!1;function Do(t){var r=t.pointerType;return r==="pen"||r==="touch"}function Ep(t){t.touching=!0,t.touchTimer!=null&&(clearTimeout(t.touchTimer),t.touchTimer=null),t.touchTimer=setTimeout(function(){t.touching=!1,t.touchTimer=null},700)}function Ts(t){t&&(t.zrByTouch=!0)}function bp(t,r){return xr(t.dom,new Sp(t,r),!0)}function ac(t,r){for(var e=r,i=!1;e&&e.nodeType!==9&&!(i=e.domBelongToZr||e!==r&&e===t.painterRoot);)e=e.parentNode;return i}var Sp=(function(){function t(r,e){this.stopPropagation=oe,this.stopImmediatePropagation=oe,this.preventDefault=oe,this.type=e.type,this.target=this.currentTarget=r.dom,this.pointerType=e.pointerType,this.clientX=e.clientX,this.clientY=e.clientY}return t})(),wr={mousedown:function(t){t=xr(this.dom,t),this.__mayPointerCapture=[t.zrX,t.zrY],this.trigger("mousedown",t)},mousemove:function(t){t=xr(this.dom,t);var r=this.__mayPointerCapture;r&&(t.zrX!==r[0]||t.zrY!==r[1])&&this.__togglePointerCapture(!0),this.trigger("mousemove",t)},mouseup:function(t){t=xr(this.dom,t),this.__togglePointerCapture(!1),this.trigger("mouseup",t)},mouseout:function(t){t=xr(this.dom,t);var r=t.toElement||t.relatedTarget;ac(this,r)||(this.__pointerCapturing&&(t.zrEventControl="no_globalout"),this.trigger("mouseout",t))},wheel:function(t){hu=!0,t=xr(this.dom,t),this.trigger("mousewheel",t)},mousewheel:function(t){hu||(t=xr(this.dom,t),this.trigger("mousewheel",t))},touchstart:function(t){t=xr(this.dom,t),Ts(t),this.__lastTouchMoment=new Date,this.handler.processGesture(t,"start"),wr.mousemove.call(this,t),wr.mousedown.call(this,t)},touchmove:function(t){t=xr(this.dom,t),Ts(t),this.handler.processGesture(t,"change"),wr.mousemove.call(this,t)},touchend:function(t){t=xr(this.dom,t),Ts(t),this.handler.processGesture(t,"end"),wr.mouseup.call(this,t),+new Date-+this.__lastTouchMoment<wp&&wr.click.call(this,t)},pointerdown:function(t){wr.mousedown.call(this,t)},pointermove:function(t){Do(t)||wr.mousemove.call(this,t)},pointerup:function(t){wr.mouseup.call(this,t)},pointerout:function(t){Do(t)||wr.mouseout.call(this,t)}};zt(["click","dblclick","contextmenu"],function(t){wr[t]=function(r){r=xr(this.dom,r),this.trigger(t,r)}});var Oo={pointermove:function(t){Do(t)||Oo.mousemove.call(this,t)},pointerup:function(t){Oo.mouseup.call(this,t)},mousemove:function(t){this.trigger("mousemove",t)},mouseup:function(t){var r=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",t),r&&(t.zrEventControl="only_globalout",this.trigger("mouseout",t))}};function Mp(t,r){var e=r.domHandlers;St.pointerEventsSupported?zt(ms.pointer,function(i){ya(r,i,function(n){e[i].call(t,n)})}):(St.touchEventsSupported&&zt(ms.touch,function(i){ya(r,i,function(n){e[i].call(t,n),Ep(r)})}),zt(ms.mouse,function(i){ya(r,i,function(n){n=lf(n),r.touching||e[i].call(t,n)})}))}function Ap(t,r){St.pointerEventsSupported?zt(uu.pointer,e):St.touchEventsSupported||zt(uu.mouse,e);function e(i){function n(a){a=lf(a),ac(t,a.target)||(a=bp(t,a),r.domHandlers[i].call(t,a))}ya(r,i,n,{capture:!0})}}function ya(t,r,e,i){t.mounted[r]=e,t.listenerOpts[r]=i,Ld(t.domTarget,r,e,i)}function xs(t){var r=t.mounted;for(var e in r)r.hasOwnProperty(e)&&Dd(t.domTarget,e,r[e],t.listenerOpts[e]);t.mounted={}}var lu=(function(){function t(r,e){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=r,this.domHandlers=e}return t})(),Rp=(function(t){yt(r,t);function r(e,i){var n=t.call(this)||this;return n.__pointerCapturing=!1,n.dom=e,n.painterRoot=i,n._localHandlerScope=new lu(e,wr),gs&&(n._globalHandlerScope=new lu(document,Oo)),Mp(n,n._localHandlerScope),n}return r.prototype.dispose=function(){xs(this._localHandlerScope),gs&&xs(this._globalHandlerScope)},r.prototype.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},r.prototype.__togglePointerCapture=function(e){if(this.__mayPointerCapture=null,gs&&+this.__pointerCapturing^+e){this.__pointerCapturing=e;var i=this._globalHandlerScope;e?Ap(this,i):xs(i)}},r})(zi),sc=1;St.hasGlobalWindow&&(sc=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var Oa=sc,Io=.4,No="#333",Fo="#ccc",Cp="#eee",cu=Fl,vu=5e-5;function me(t){return t>vu||t<-vu}var Te=[],ii=[],ws=fe(),Es=Math.abs,gf=(function(){function t(){}return t.prototype.getLocalTransform=function(r){return t.getLocalTransform(this,r)},t.prototype.setPosition=function(r){this.x=r[0],this.y=r[1]},t.prototype.setScale=function(r){this.scaleX=r[0],this.scaleY=r[1]},t.prototype.setSkew=function(r){this.skewX=r[0],this.skewY=r[1]},t.prototype.setOrigin=function(r){this.originX=r[0],this.originY=r[1]},t.prototype.needLocalTransform=function(){return me(this.rotation)||me(this.x)||me(this.y)||me(this.scaleX-1)||me(this.scaleY-1)||me(this.skewX)||me(this.skewY)},t.prototype.updateTransform=function(){var r=this.parent&&this.parent.transform,e=this.needLocalTransform(),i=this.transform;if(!(e||r)){i&&(cu(i),this.invTransform=null);return}i=i||fe(),e?this.getLocalTransform(i):cu(i),r&&(e?Ci(i,r,i):cf(i,r)),this.transform=i,this._resolveGlobalScaleRatio(i)},t.prototype._resolveGlobalScaleRatio=function(r){var e=this.globalScaleRatio;if(e!=null&&e!==1){this.getGlobalScale(Te);var i=Te[0]<0?-1:1,n=Te[1]<0?-1:1,a=((Te[0]-i)*e+i)/Te[0]||0,s=((Te[1]-n)*e+n)/Te[1]||0;r[0]*=a,r[1]*=a,r[2]*=s,r[3]*=s}this.invTransform=this.invTransform||fe(),Bl(this.invTransform,r)},t.prototype.getComputedTransform=function(){for(var r=this,e=[];r;)e.push(r),r=r.parent;for(;r=e.pop();)r.updateTransform();return this.transform},t.prototype.setLocalTransform=function(r){if(r){var e=r[0]*r[0]+r[1]*r[1],i=r[2]*r[2]+r[3]*r[3],n=Math.atan2(r[1],r[0]),a=Math.PI/2+n-Math.atan2(r[3],r[2]);i=Math.sqrt(i)*Math.cos(a),e=Math.sqrt(e),this.skewX=a,this.skewY=0,this.rotation=-n,this.x=+r[4],this.y=+r[5],this.scaleX=e,this.scaleY=i,this.originX=0,this.originY=0}},t.prototype.decomposeTransform=function(){if(this.transform){var r=this.parent,e=this.transform;r&&r.transform&&(r.invTransform=r.invTransform||fe(),Ci(ii,r.invTransform,e),e=ii);var i=this.originX,n=this.originY;(i||n)&&(ws[4]=i,ws[5]=n,Ci(ii,e,ws),ii[4]-=i,ii[5]-=n,e=ii),this.setLocalTransform(e)}},t.prototype.getGlobalScale=function(r){var e=this.transform;return r=r||[],e?(r[0]=Math.sqrt(e[0]*e[0]+e[1]*e[1]),r[1]=Math.sqrt(e[2]*e[2]+e[3]*e[3]),e[0]<0&&(r[0]=-r[0]),e[3]<0&&(r[1]=-r[1]),r):(r[0]=1,r[1]=1,r)},t.prototype.transformCoordToLocal=function(r,e){var i=[r,e],n=this.invTransform;return n&&Ri(i,i,n),i},t.prototype.transformCoordToGlobal=function(r,e){var i=[r,e],n=this.transform;return n&&Ri(i,i,n),i},t.prototype.getLineScale=function(){var r=this.transform;return r&&Es(r[0]-1)>1e-10&&Es(r[3]-1)>1e-10?Math.sqrt(Es(r[0]*r[3]-r[2]*r[1])):1},t.prototype.copyTransform=function(r){oc(this,r)},t.getLocalTransform=function(r,e){e=e||[];var i=r.originX||0,n=r.originY||0,a=r.scaleX,s=r.scaleY,o=r.anchorX,f=r.anchorY,u=r.rotation||0,h=r.x,l=r.y,c=r.skewX?Math.tan(r.skewX):0,v=r.skewY?Math.tan(-r.skewY):0;if(i||n||o||f){var d=i+o,_=n+f;e[4]=-d*a-c*_*s,e[5]=-_*s-v*d*a}else e[4]=e[5]=0;return e[0]=a,e[3]=s,e[1]=v*a,e[2]=c*s,u&&vf(e,e,u),e[4]+=i+h,e[5]+=n+l,e},t.initDefaultProps=(function(){var r=t.prototype;r.scaleX=r.scaleY=r.globalScaleRatio=1,r.x=r.y=r.originX=r.originY=r.skewX=r.skewY=r.rotation=r.anchorX=r.anchorY=0})(),t})(),En=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function oc(t,r){for(var e=0;e<En.length;e++){var i=En[e];t[i]=r[i]}}var du={};function ur(t,r){r=r||le;var e=du[r];e||(e=du[r]=new Za(500));var i=e.get(t);return i==null&&(i=je.measureText(t,r).width,e.put(t,i)),i}function pu(t,r,e,i){var n=ur(t,r),a=$a(r),s=un(0,n,e),o=gi(0,a,i),f=new Mt(s,o,n,a);return f}function Pp(t,r,e,i){var n=((t||"")+"").split(`
`),a=n.length;if(a===1)return pu(n[0],r,e,i);for(var s=new Mt(0,0,0,0),o=0;o<n.length;o++){var f=pu(n[o],r,e,i);o===0?s.copy(f):s.union(f)}return s}function un(t,r,e){return e==="right"?t-=r:e==="center"&&(t-=r/2),t}function gi(t,r,e){return e==="middle"?t-=r/2:e==="bottom"&&(t-=r),t}function $a(t){return ur("",t)}function bn(t,r){return typeof t=="string"?t.lastIndexOf("%")>=0?parseFloat(t)/100*r:parseFloat(t):t}function Lp(t,r,e){var i=r.position||"inside",n=r.distance!=null?r.distance:5,a=e.height,s=e.width,o=a/2,f=e.x,u=e.y,h="left",l="top";if(i instanceof Array)f+=bn(i[0],e.width),u+=bn(i[1],e.height),h=null,l=null;else switch(i){case"left":f-=n,u+=o,h="right",l="middle";break;case"right":f+=n+s,u+=o,l="middle";break;case"top":f+=s/2,u-=n,h="center",l="bottom";break;case"bottom":f+=s/2,u+=a+n,h="center";break;case"inside":f+=s/2,u+=o,h="center",l="middle";break;case"insideLeft":f+=n,u+=o,l="middle";break;case"insideRight":f+=s-n,u+=o,h="right",l="middle";break;case"insideTop":f+=s/2,u+=n,h="center";break;case"insideBottom":f+=s/2,u+=a-n,h="center",l="bottom";break;case"insideTopLeft":f+=n,u+=n;break;case"insideTopRight":f+=s-n,u+=n,h="right";break;case"insideBottomLeft":f+=n,u+=a-n,l="bottom";break;case"insideBottomRight":f+=s-n,u+=a-n,h="right",l="bottom";break}return t=t||{},t.x=f,t.y=u,t.align=h,t.verticalAlign=l,t}var bs="__zr_normal__",Ss=En.concat(["ignore"]),Dp=Ln(En,function(t,r){return t[r]=!0,t},{ignore:!1}),ni={},Op=new Mt(0,0,0,0),Ka=(function(){function t(r){this.id=af(),this.animators=[],this.currentStates=[],this.states={},this._init(r)}return t.prototype._init=function(r){this.attr(r)},t.prototype.drift=function(r,e,i){switch(this.draggable){case"horizontal":e=0;break;case"vertical":r=0;break}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=r,n[5]+=e,this.decomposeTransform(),this.markRedraw()},t.prototype.beforeUpdate=function(){},t.prototype.afterUpdate=function(){},t.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},t.prototype.updateInnerText=function(r){var e=this._textContent;if(e&&(!e.ignore||r)){this.textConfig||(this.textConfig={});var i=this.textConfig,n=i.local,a=e.innerTransformable,s=void 0,o=void 0,f=!1;a.parent=n?this:null;var u=!1;if(a.copyTransform(e),i.position!=null){var h=Op;i.layoutRect?h.copy(i.layoutRect):h.copy(this.getBoundingRect()),n||h.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(ni,i,h):Lp(ni,i,h),a.x=ni.x,a.y=ni.y,s=ni.align,o=ni.verticalAlign;var l=i.origin;if(l&&i.rotation!=null){var c=void 0,v=void 0;l==="center"?(c=h.width*.5,v=h.height*.5):(c=bn(l[0],h.width),v=bn(l[1],h.height)),u=!0,a.originX=-a.x+c+(n?0:h.x),a.originY=-a.y+v+(n?0:h.y)}}i.rotation!=null&&(a.rotation=i.rotation);var d=i.offset;d&&(a.x+=d[0],a.y+=d[1],u||(a.originX=-d[0],a.originY=-d[1]));var _=i.inside==null?typeof i.position=="string"&&i.position.indexOf("inside")>=0:i.inside,p=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),y=void 0,g=void 0,m=void 0;_&&this.canBeInsideText()?(y=i.insideFill,g=i.insideStroke,(y==null||y==="auto")&&(y=this.getInsideTextFill()),(g==null||g==="auto")&&(g=this.getInsideTextStroke(y),m=!0)):(y=i.outsideFill,g=i.outsideStroke,(y==null||y==="auto")&&(y=this.getOutsideFill()),(g==null||g==="auto")&&(g=this.getOutsideStroke(y),m=!0)),y=y||"#000",(y!==p.fill||g!==p.stroke||m!==p.autoStroke||s!==p.align||o!==p.verticalAlign)&&(f=!0,p.fill=y,p.stroke=g,p.autoStroke=m,p.align=s,p.verticalAlign=o,e.setDefaultTextStyle(p)),e.__dirty|=or,f&&e.dirtyStyle(!0)}},t.prototype.canBeInsideText=function(){return!0},t.prototype.getInsideTextFill=function(){return"#fff"},t.prototype.getInsideTextStroke=function(r){return"#000"},t.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?Fo:No},t.prototype.getOutsideStroke=function(r){var e=this.__zr&&this.__zr.getBackgroundColor(),i=typeof e=="string"&&fr(e);i||(i=[255,255,255,1]);for(var n=i[3],a=this.__zr.isDarkMode(),s=0;s<3;s++)i[s]=i[s]*n+(a?0:255)*(1-n);return i[3]=1,Je(i,"rgba")},t.prototype.traverse=function(r,e){},t.prototype.attrKV=function(r,e){r==="textConfig"?this.setTextConfig(e):r==="textContent"?this.setTextContent(e):r==="clipPath"?this.setClipPath(e):r==="extra"?(this.extra=this.extra||{},dt(this.extra,e)):this[r]=e},t.prototype.hide=function(){this.ignore=!0,this.markRedraw()},t.prototype.show=function(){this.ignore=!1,this.markRedraw()},t.prototype.attr=function(r,e){if(typeof r=="string")this.attrKV(r,e);else if(Hr(r))for(var i=r,n=wt(i),a=0;a<n.length;a++){var s=n[a];this.attrKV(s,r[s])}return this.markRedraw(),this},t.prototype.saveCurrentToNormalState=function(r){this._innerSaveToNormal(r);for(var e=this._normalState,i=0;i<this.animators.length;i++){var n=this.animators[i],a=n.__fromStateTransition;if(!(n.getLoop()||a&&a!==bs)){var s=n.targetName,o=s?e[s]:e;n.saveTo(o)}}},t.prototype._innerSaveToNormal=function(r){var e=this._normalState;e||(e=this._normalState={}),r.textConfig&&!e.textConfig&&(e.textConfig=this.textConfig),this._savePrimaryToNormal(r,e,Ss)},t.prototype._savePrimaryToNormal=function(r,e,i){for(var n=0;n<i.length;n++){var a=i[n];r[a]!=null&&!(a in e)&&(e[a]=this[a])}},t.prototype.hasState=function(){return this.currentStates.length>0},t.prototype.getState=function(r){return this.states[r]},t.prototype.ensureState=function(r){var e=this.states;return e[r]||(e[r]={}),e[r]},t.prototype.clearStates=function(r){this.useState(bs,!1,r)},t.prototype.useState=function(r,e,i,n){var a=r===bs,s=this.hasState();if(!(!s&&a)){var o=this.currentStates,f=this.stateTransition;if(!(Er(o,r)>=0&&(e||o.length===1))){var u;if(this.stateProxy&&!a&&(u=this.stateProxy(r)),u||(u=this.states&&this.states[r]),!u&&!a){Ya("State "+r+" not exists.");return}a||this.saveCurrentToNormalState(u);var h=!!(u&&u.hoverLayer||n);h&&this._toggleHoverLayerFlag(!0),this._applyStateObj(r,u,this._normalState,e,!i&&!this.__inHover&&f&&f.duration>0,f);var l=this._textContent,c=this._textGuide;return l&&l.useState(r,e,i,h),c&&c.useState(r,e,i,h),a?(this.currentStates=[],this._normalState={}):e?this.currentStates.push(r):this.currentStates=[r],this._updateAnimationTargets(),this.markRedraw(),!h&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~or),u}}},t.prototype.useStates=function(r,e,i){if(!r.length)this.clearStates();else{var n=[],a=this.currentStates,s=r.length,o=s===a.length;if(o){for(var f=0;f<s;f++)if(r[f]!==a[f]){o=!1;break}}if(o)return;for(var f=0;f<s;f++){var u=r[f],h=void 0;this.stateProxy&&(h=this.stateProxy(u,r)),h||(h=this.states[u]),h&&n.push(h)}var l=n[s-1],c=!!(l&&l.hoverLayer||i);c&&this._toggleHoverLayerFlag(!0);var v=this._mergeStates(n),d=this.stateTransition;this.saveCurrentToNormalState(v),this._applyStateObj(r.join(","),v,this._normalState,!1,!e&&!this.__inHover&&d&&d.duration>0,d);var _=this._textContent,p=this._textGuide;_&&_.useStates(r,e,c),p&&p.useStates(r,e,c),this._updateAnimationTargets(),this.currentStates=r.slice(),this.markRedraw(),!c&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~or)}},t.prototype.isSilent=function(){for(var r=this.silent,e=this.parent;!r&&e;){if(e.silent){r=!0;break}e=e.parent}return r},t.prototype._updateAnimationTargets=function(){for(var r=0;r<this.animators.length;r++){var e=this.animators[r];e.targetName&&e.changeTarget(this[e.targetName])}},t.prototype.removeState=function(r){var e=Er(this.currentStates,r);if(e>=0){var i=this.currentStates.slice();i.splice(e,1),this.useStates(i)}},t.prototype.replaceState=function(r,e,i){var n=this.currentStates.slice(),a=Er(n,r),s=Er(n,e)>=0;a>=0?s?n.splice(a,1):n[a]=e:i&&!s&&n.push(e),this.useStates(n)},t.prototype.toggleState=function(r,e){e?this.useState(r,!0):this.removeState(r)},t.prototype._mergeStates=function(r){for(var e={},i,n=0;n<r.length;n++){var a=r[n];dt(e,a),a.textConfig&&(i=i||{},dt(i,a.textConfig))}return i&&(e.textConfig=i),e},t.prototype._applyStateObj=function(r,e,i,n,a,s){var o=!(e&&n);e&&e.textConfig?(this.textConfig=dt({},n?this.textConfig:i.textConfig),dt(this.textConfig,e.textConfig)):o&&i.textConfig&&(this.textConfig=i.textConfig);for(var f={},u=!1,h=0;h<Ss.length;h++){var l=Ss[h],c=a&&Dp[l];e&&e[l]!=null?c?(u=!0,f[l]=e[l]):this[l]=e[l]:o&&i[l]!=null&&(c?(u=!0,f[l]=i[l]):this[l]=i[l])}if(!a)for(var h=0;h<this.animators.length;h++){var v=this.animators[h],d=v.targetName;v.getLoop()||v.__changeFinalValue(d?(e||i)[d]:e||i)}u&&this._transitionState(r,f,s)},t.prototype._attachComponent=function(r){if(!(r.__zr&&!r.__hostTarget)&&r!==this){var e=this.__zr;e&&r.addSelfToZr(e),r.__zr=e,r.__hostTarget=this}},t.prototype._detachComponent=function(r){r.__zr&&r.removeSelfFromZr(r.__zr),r.__zr=null,r.__hostTarget=null},t.prototype.getClipPath=function(){return this._clipPath},t.prototype.setClipPath=function(r){this._clipPath&&this._clipPath!==r&&this.removeClipPath(),this._attachComponent(r),this._clipPath=r,this.markRedraw()},t.prototype.removeClipPath=function(){var r=this._clipPath;r&&(this._detachComponent(r),this._clipPath=null,this.markRedraw())},t.prototype.getTextContent=function(){return this._textContent},t.prototype.setTextContent=function(r){var e=this._textContent;e!==r&&(e&&e!==r&&this.removeTextContent(),r.innerTransformable=new gf,this._attachComponent(r),this._textContent=r,this.markRedraw())},t.prototype.setTextConfig=function(r){this.textConfig||(this.textConfig={}),dt(this.textConfig,r),this.markRedraw()},t.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},t.prototype.removeTextContent=function(){var r=this._textContent;r&&(r.innerTransformable=null,this._detachComponent(r),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},t.prototype.getTextGuideLine=function(){return this._textGuide},t.prototype.setTextGuideLine=function(r){this._textGuide&&this._textGuide!==r&&this.removeTextGuideLine(),this._attachComponent(r),this._textGuide=r,this.markRedraw()},t.prototype.removeTextGuideLine=function(){var r=this._textGuide;r&&(this._detachComponent(r),this._textGuide=null,this.markRedraw())},t.prototype.markRedraw=function(){this.__dirty|=or;var r=this.__zr;r&&(this.__inHover?r.refreshHover():r.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},t.prototype.dirty=function(){this.markRedraw()},t.prototype._toggleHoverLayerFlag=function(r){this.__inHover=r;var e=this._textContent,i=this._textGuide;e&&(e.__inHover=r),i&&(i.__inHover=r)},t.prototype.addSelfToZr=function(r){if(this.__zr!==r){this.__zr=r;var e=this.animators;if(e)for(var i=0;i<e.length;i++)r.animation.addAnimator(e[i]);this._clipPath&&this._clipPath.addSelfToZr(r),this._textContent&&this._textContent.addSelfToZr(r),this._textGuide&&this._textGuide.addSelfToZr(r)}},t.prototype.removeSelfFromZr=function(r){if(this.__zr){this.__zr=null;var e=this.animators;if(e)for(var i=0;i<e.length;i++)r.animation.removeAnimator(e[i]);this._clipPath&&this._clipPath.removeSelfFromZr(r),this._textContent&&this._textContent.removeSelfFromZr(r),this._textGuide&&this._textGuide.removeSelfFromZr(r)}},t.prototype.animate=function(r,e,i){var n=r?this[r]:this,a=new yf(n,e,i);return r&&(a.targetName=r),this.addAnimator(a,r),a},t.prototype.addAnimator=function(r,e){var i=this.__zr,n=this;r.during(function(){n.updateDuringAnimation(e)}).done(function(){var a=n.animators,s=Er(a,r);s>=0&&a.splice(s,1)}),this.animators.push(r),i&&i.animation.addAnimator(r),i&&i.wakeUp()},t.prototype.updateDuringAnimation=function(r){this.markRedraw()},t.prototype.stopAnimation=function(r,e){for(var i=this.animators,n=i.length,a=[],s=0;s<n;s++){var o=i[s];!r||r===o.scope?o.stop(e):a.push(o)}return this.animators=a,this},t.prototype.animateTo=function(r,e,i){Ms(this,r,e,i)},t.prototype.animateFrom=function(r,e,i){Ms(this,r,e,i,!0)},t.prototype._transitionState=function(r,e,i,n){for(var a=Ms(this,e,i,n),s=0;s<a.length;s++)a[s].__fromStateTransition=r},t.prototype.getBoundingRect=function(){return null},t.prototype.getPaintRect=function(){return null},t.initDefaultProps=(function(){var r=t.prototype;r.type="element",r.name="",r.ignore=r.silent=r.isGroup=r.draggable=r.dragging=r.ignoreClip=r.__inHover=!1,r.__dirty=or;function e(i,n,a,s){Object.defineProperty(r,i,{get:function(){if(!this[n]){var f=this[n]=[];o(this,f)}return this[n]},set:function(f){this[a]=f[0],this[s]=f[1],this[n]=f,o(this,f)}});function o(f,u){Object.defineProperty(u,0,{get:function(){return f[a]},set:function(h){f[a]=h}}),Object.defineProperty(u,1,{get:function(){return f[s]},set:function(h){f[s]=h}})}}Object.defineProperty&&(e("position","_legacyPos","x","y"),e("scale","_legacyScale","scaleX","scaleY"),e("origin","_legacyOrigin","originX","originY"))})(),t})();sf(Ka,zi);sf(Ka,gf);function Ms(t,r,e,i,n){e=e||{};var a=[];fc(t,"",t,r,e,i,a,n);var s=a.length,o=!1,f=e.done,u=e.aborted,h=function(){o=!0,s--,s<=0&&(o?f&&f():u&&u())},l=function(){s--,s<=0&&(o?f&&f():u&&u())};s||f&&f(),a.length>0&&e.during&&a[0].during(function(d,_){e.during(_)});for(var c=0;c<a.length;c++){var v=a[c];h&&v.done(h),l&&v.aborted(l),e.force&&v.duration(e.duration),v.start(e.easing)}return a}function As(t,r,e){for(var i=0;i<e;i++)t[i]=r[i]}function Ip(t){return Mr(t[0])}function Np(t,r,e){if(Mr(r[e]))if(Mr(t[e])||(t[e]=[]),wl(r[e])){var i=r[e].length;t[e].length!==i&&(t[e]=new r[e].constructor(i),As(t[e],r[e],i))}else{var n=r[e],a=t[e],s=n.length;if(Ip(n))for(var o=n[0].length,f=0;f<s;f++)a[f]?As(a[f],n[f],o):a[f]=Array.prototype.slice.call(n[f]);else As(a,n,s);a.length=n.length}else t[e]=r[e]}function Fp(t,r){return t===r||Mr(t)&&Mr(r)&&Bp(t,r)}function Bp(t,r){var e=t.length;if(e!==r.length)return!1;for(var i=0;i<e;i++)if(t[i]!==r[i])return!1;return!0}function fc(t,r,e,i,n,a,s,o){for(var f=wt(i),u=n.duration,h=n.delay,l=n.additive,c=n.setToFinal,v=!Hr(a),d=t.animators,_=[],p=0;p<f.length;p++){var y=f[p],g=i[y];if(g!=null&&e[y]!=null&&(v||a[y]))if(Hr(g)&&!Mr(g)&&!Dn(g)){if(r){o||(e[y]=g,t.updateDuringAnimation(r));continue}fc(t,y,e[y],g,n,a&&a[y],s,o)}else _.push(y);else o||(e[y]=g,t.updateDuringAnimation(r),_.push(y))}var m=_.length;if(!l&&m)for(var T=0;T<d.length;T++){var w=d[T];if(w.targetName===r){var x=w.stopTracks(_);if(x){var E=Er(d,w);d.splice(E,1)}}}if(n.force||(_=Sa(_,function(R){return!Fp(i[R],e[R])}),m=_.length),m>0||n.force&&!s.length){var S=void 0,M=void 0,C=void 0;if(o){M={},c&&(S={});for(var T=0;T<m;T++){var y=_[T];M[y]=e[y],c?S[y]=i[y]:e[y]=i[y]}}else if(c){C={};for(var T=0;T<m;T++){var y=_[T];C[y]=da(e[y]),Np(e,i,y)}}var w=new yf(e,!1,!1,l?Sa(d,function(L){return L.targetName===r}):null);w.targetName=r,n.scope&&(w.scope=n.scope),c&&S&&w.whenWithKeys(0,S,_),C&&w.whenWithKeys(0,C,_),w.whenWithKeys(u??500,o?M:i,_).delay(h||0),t.addAnimator(w,r),s.push(w)}}var Ne=(function(t){yt(r,t);function r(e){var i=t.call(this)||this;return i.isGroup=!0,i._children=[],i.attr(e),i}return r.prototype.childrenRef=function(){return this._children},r.prototype.children=function(){return this._children.slice()},r.prototype.childAt=function(e){return this._children[e]},r.prototype.childOfName=function(e){for(var i=this._children,n=0;n<i.length;n++)if(i[n].name===e)return i[n]},r.prototype.childCount=function(){return this._children.length},r.prototype.add=function(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this},r.prototype.addBefore=function(e,i){if(e&&e!==this&&e.parent!==this&&i&&i.parent===this){var n=this._children,a=n.indexOf(i);a>=0&&(n.splice(a,0,e),this._doAdd(e))}return this},r.prototype.replace=function(e,i){var n=Er(this._children,e);return n>=0&&this.replaceAt(i,n),this},r.prototype.replaceAt=function(e,i){var n=this._children,a=n[i];if(e&&e!==this&&e.parent!==this&&e!==a){n[i]=e,a.parent=null;var s=this.__zr;s&&a.removeSelfFromZr(s),this._doAdd(e)}return this},r.prototype._doAdd=function(e){e.parent&&e.parent.remove(e),e.parent=this;var i=this.__zr;i&&i!==e.__zr&&e.addSelfToZr(i),i&&i.refresh()},r.prototype.remove=function(e){var i=this.__zr,n=this._children,a=Er(n,e);return a<0?this:(n.splice(a,1),e.parent=null,i&&e.removeSelfFromZr(i),i&&i.refresh(),this)},r.prototype.removeAll=function(){for(var e=this._children,i=this.__zr,n=0;n<e.length;n++){var a=e[n];i&&a.removeSelfFromZr(i),a.parent=null}return e.length=0,this},r.prototype.eachChild=function(e,i){for(var n=this._children,a=0;a<n.length;a++){var s=n[a];e.call(i,s,a)}return this},r.prototype.traverse=function(e,i){for(var n=0;n<this._children.length;n++){var a=this._children[n],s=e.call(i,a);a.isGroup&&!s&&a.traverse(e,i)}return this},r.prototype.addSelfToZr=function(e){t.prototype.addSelfToZr.call(this,e);for(var i=0;i<this._children.length;i++){var n=this._children[i];n.addSelfToZr(e)}},r.prototype.removeSelfFromZr=function(e){t.prototype.removeSelfFromZr.call(this,e);for(var i=0;i<this._children.length;i++){var n=this._children[i];n.removeSelfFromZr(e)}},r.prototype.getBoundingRect=function(e){for(var i=new Mt(0,0,0,0),n=e||this._children,a=[],s=null,o=0;o<n.length;o++){var f=n[o];if(!(f.ignore||f.invisible)){var u=f.getBoundingRect(),h=f.getLocalTransform(a);h?(Mt.applyTransform(i,u,h),s=s||i.clone(),s.union(i)):(s=s||u.clone(),s.union(u))}}return s||i},r})(Ka);Ne.prototype.type="group";/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/var ga={},ke={};function Up(t){delete ke[t]}function Hp(t){if(!t)return!1;if(typeof t=="string")return xn(t,1)<Io;if(t.colorStops){for(var r=t.colorStops,e=0,i=r.length,n=0;n<i;n++)e+=xn(r[n].color,1);return e/=i,e<Io}return!1}var zp=(function(){function t(r,e,i){var n=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,i=i||{},this.dom=e,this.id=r;var a=new Xd,s=i.renderer||"canvas";ga[s]||(s=wt(ga)[0]),i.useDirtyRect=i.useDirtyRect==null?!1:i.useDirtyRect;var o=new ga[s](e,a,i,r),f=i.ssr||o.ssrOnly;this.storage=a,this.painter=o;var u=!St.node&&!St.worker&&!f?new Rp(o.getViewportRoot(),o.root):null,h=i.useCoarsePointer,l=h==null||h==="auto"?St.touchEventsSupported:!!h,c=44,v;l&&(v=Pt(i.pointerSize,c)),this.handler=new Hl(a,o,u,o.root,v),this.animation=new xp({stage:{update:f?null:function(){return n._flush(!0)}}}),f||this.animation.start()}return t.prototype.add=function(r){this._disposed||!r||(this.storage.addRoot(r),r.addSelfToZr(this),this.refresh())},t.prototype.remove=function(r){this._disposed||!r||(this.storage.delRoot(r),r.removeSelfFromZr(this),this.refresh())},t.prototype.configLayer=function(r,e){this._disposed||(this.painter.configLayer&&this.painter.configLayer(r,e),this.refresh())},t.prototype.setBackgroundColor=function(r){this._disposed||(this.painter.setBackgroundColor&&this.painter.setBackgroundColor(r),this.refresh(),this._backgroundColor=r,this._darkMode=Hp(r))},t.prototype.getBackgroundColor=function(){return this._backgroundColor},t.prototype.setDarkMode=function(r){this._darkMode=r},t.prototype.isDarkMode=function(){return this._darkMode},t.prototype.refreshImmediately=function(r){this._disposed||(r||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1)},t.prototype.refresh=function(){this._disposed||(this._needsRefresh=!0,this.animation.start())},t.prototype.flush=function(){this._disposed||this._flush(!1)},t.prototype._flush=function(r){var e,i=Ti();this._needsRefresh&&(e=!0,this.refreshImmediately(r)),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately());var n=Ti();e?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:n-i})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},t.prototype.setSleepAfterStill=function(r){this._sleepAfterStill=r},t.prototype.wakeUp=function(){this._disposed||(this.animation.start(),this._stillFrameAccum=0)},t.prototype.refreshHover=function(){this._needsRefreshHover=!0},t.prototype.refreshHoverImmediately=function(){this._disposed||(this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.getType()==="canvas"&&this.painter.refreshHover())},t.prototype.resize=function(r){this._disposed||(r=r||{},this.painter.resize(r.width,r.height),this.handler.resize())},t.prototype.clearAnimation=function(){this._disposed||this.animation.clear()},t.prototype.getWidth=function(){if(!this._disposed)return this.painter.getWidth()},t.prototype.getHeight=function(){if(!this._disposed)return this.painter.getHeight()},t.prototype.setCursorStyle=function(r){this._disposed||this.handler.setCursorStyle(r)},t.prototype.findHover=function(r,e){if(!this._disposed)return this.handler.findHover(r,e)},t.prototype.on=function(r,e,i){return this._disposed||this.handler.on(r,e,i),this},t.prototype.off=function(r,e){this._disposed||this.handler.off(r,e)},t.prototype.trigger=function(r,e){this._disposed||this.handler.trigger(r,e)},t.prototype.clear=function(){if(!this._disposed){for(var r=this.storage.getRoots(),e=0;e<r.length;e++)r[e]instanceof Ne&&r[e].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()}},t.prototype.dispose=function(){this._disposed||(this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,this._disposed=!0,Up(this.id))},t})();function kp(t,r){var e=new zp(af(),t,r);return ke[e.id]=e,e}function Gp(t){t.dispose()}function Wp(){for(var t in ke)ke.hasOwnProperty(t)&&ke[t].dispose();ke={}}function Vp(t){return ke[t]}function qp(t,r){ga[t]=r}var Bo;function uc(t){if(typeof Bo=="function")return Bo(t)}function Xp(t){Bo=t}var Yp="5.6.1";const Zg=Object.freeze(Object.defineProperty({__proto__:null,dispose:Gp,disposeAll:Wp,getElementSSRData:uc,getInstance:Vp,init:kp,registerPainter:qp,registerSSRDataGetter:Xp,version:Yp},Symbol.toStringTag,{value:"Module"}));var Uo=new Za(50);function Zp(t){if(typeof t=="string"){var r=Uo.get(t);return r&&r.image}else return t}function mf(t,r,e,i,n){if(t)if(typeof t=="string"){if(r&&r.__zrImageSrc===t||!e)return r;var a=Uo.get(t),s={hostEl:e,cb:i,cbPayload:n};return a?(r=a.image,!Qa(r)&&a.pending.push(s)):(r=je.loadImage(t,_u,_u),r.__zrImageSrc=t,Uo.put(t,r.__cachedImgObj={image:r,pending:[s]})),r}else return t;else return r}function _u(){var t=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var r=0;r<t.pending.length;r++){var e=t.pending[r],i=e.cb;i&&i(this,e.cbPayload),e.hostEl.dirty()}t.pending.length=0}function Qa(t){return t&&t.width&&t.height}var Rs=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function jg(t,r,e,i,n){var a={};return hc(a,t,r,e,i,n),a.text}function hc(t,r,e,i,n,a){if(!e){t.text="",t.isTruncated=!1;return}var s=(r+"").split(`
`);a=lc(e,i,n,a);for(var o=!1,f={},u=0,h=s.length;u<h;u++)cc(f,s[u],a),s[u]=f.textLine,o=o||f.isTruncated;t.text=s.join(`
`),t.isTruncated=o}function lc(t,r,e,i){i=i||{};var n=dt({},i);n.font=r,e=Pt(e,"..."),n.maxIterations=Pt(i.maxIterations,2);var a=n.minChar=Pt(i.minChar,0);n.cnCharWidth=ur("",r);var s=n.ascCharWidth=ur("a",r);n.placeholder=Pt(i.placeholder,"");for(var o=t=Math.max(0,t-1),f=0;f<a&&o>=s;f++)o-=s;var u=ur(e,r);return u>o&&(e="",u=0),o=t-u,n.ellipsis=e,n.ellipsisWidth=u,n.contentWidth=o,n.containerWidth=t,n}function cc(t,r,e){var i=e.containerWidth,n=e.font,a=e.contentWidth;if(!i){t.textLine="",t.isTruncated=!1;return}var s=ur(r,n);if(s<=i){t.textLine=r,t.isTruncated=!1;return}for(var o=0;;o++){if(s<=a||o>=e.maxIterations){r+=e.ellipsis;break}var f=o===0?jp(r,a,e.ascCharWidth,e.cnCharWidth):s>0?Math.floor(r.length*a/s):0;r=r.substr(0,f),s=ur(r,n)}r===""&&(r=e.placeholder),t.textLine=r,t.isTruncated=!0}function jp(t,r,e,i){for(var n=0,a=0,s=t.length;a<s&&n<r;a++){var o=t.charCodeAt(a);n+=0<=o&&o<=127?e:i}return a}function $p(t,r){t!=null&&(t+="");var e=r.overflow,i=r.padding,n=r.font,a=e==="truncate",s=$a(n),o=Pt(r.lineHeight,s),f=!!r.backgroundColor,u=r.lineOverflow==="truncate",h=!1,l=r.width,c;l!=null&&(e==="break"||e==="breakAll")?c=t?vc(t,r.font,l,e==="breakAll",0).lines:[]:c=t?t.split(`
`):[];var v=c.length*o,d=Pt(r.height,v);if(v>d&&u){var _=Math.floor(d/o);h=h||c.length>_,c=c.slice(0,_)}if(t&&a&&l!=null)for(var p=lc(l,n,r.ellipsis,{minChar:r.truncateMinChar,placeholder:r.placeholder}),y={},g=0;g<c.length;g++)cc(y,c[g],p),c[g]=y.textLine,h=h||y.isTruncated;for(var m=d,T=0,g=0;g<c.length;g++)T=Math.max(ur(c[g],n),T);l==null&&(l=T);var w=T;return i&&(m+=i[0]+i[2],w+=i[1]+i[3],l+=i[1]+i[3]),f&&(w=l),{lines:c,height:d,outerWidth:w,outerHeight:m,lineHeight:o,calculatedLineHeight:s,contentWidth:T,contentHeight:v,width:l,isTruncated:h}}var Kp=(function(){function t(){}return t})(),yu=(function(){function t(r){this.tokens=[],r&&(this.tokens=r)}return t})(),Qp=(function(){function t(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[],this.isTruncated=!1}return t})();function Jp(t,r){var e=new Qp;if(t!=null&&(t+=""),!t)return e;for(var i=r.width,n=r.height,a=r.overflow,s=(a==="break"||a==="breakAll")&&i!=null?{width:i,accumWidth:0,breakAll:a==="breakAll"}:null,o=Rs.lastIndex=0,f;(f=Rs.exec(t))!=null;){var u=f.index;u>o&&Cs(e,t.substring(o,u),r,s),Cs(e,f[2],r,s,f[1]),o=Rs.lastIndex}o<t.length&&Cs(e,t.substring(o,t.length),r,s);var h=[],l=0,c=0,v=r.padding,d=a==="truncate",_=r.lineOverflow==="truncate",p={};function y($,rt,Q){$.width=rt,$.lineHeight=Q,l+=Q,c=Math.max(c,rt)}t:for(var g=0;g<e.lines.length;g++){for(var m=e.lines[g],T=0,w=0,x=0;x<m.tokens.length;x++){var E=m.tokens[x],S=E.styleName&&r.rich[E.styleName]||{},M=E.textPadding=S.padding,C=M?M[1]+M[3]:0,R=E.font=S.font||r.font;E.contentHeight=$a(R);var L=Pt(S.height,E.contentHeight);if(E.innerHeight=L,M&&(L+=M[0]+M[2]),E.height=L,E.lineHeight=vn(S.lineHeight,r.lineHeight,L),E.align=S&&S.align||r.align,E.verticalAlign=S&&S.verticalAlign||"middle",_&&n!=null&&l+E.lineHeight>n){var D=e.lines.length;x>0?(m.tokens=m.tokens.slice(0,x),y(m,w,T),e.lines=e.lines.slice(0,g+1)):e.lines=e.lines.slice(0,g),e.isTruncated=e.isTruncated||e.lines.length<D;break t}var P=S.width,z=P==null||P==="auto";if(typeof P=="string"&&P.charAt(P.length-1)==="%")E.percentWidth=P,h.push(E),E.contentWidth=ur(E.text,R);else{if(z){var A=S.backgroundColor,B=A&&A.image;B&&(B=Zp(B),Qa(B)&&(E.width=Math.max(E.width,B.width*L/B.height)))}var k=d&&i!=null?i-w:null;k!=null&&k<E.width?!z||k<C?(E.text="",E.width=E.contentWidth=0):(hc(p,E.text,k-C,R,r.ellipsis,{minChar:r.truncateMinChar}),E.text=p.text,e.isTruncated=e.isTruncated||p.isTruncated,E.width=E.contentWidth=ur(E.text,R)):E.contentWidth=ur(E.text,R)}E.width+=C,w+=E.width,S&&(T=Math.max(T,E.lineHeight))}y(m,w,T)}e.outerWidth=e.width=Pt(i,c),e.outerHeight=e.height=Pt(n,l),e.contentHeight=l,e.contentWidth=c,v&&(e.outerWidth+=v[1]+v[3],e.outerHeight+=v[0]+v[2]);for(var g=0;g<h.length;g++){var E=h[g],j=E.percentWidth;E.width=parseInt(j,10)/100*e.width}return e}function Cs(t,r,e,i,n){var a=r==="",s=n&&e.rich[n]||{},o=t.lines,f=s.font||e.font,u=!1,h,l;if(i){var c=s.padding,v=c?c[1]+c[3]:0;if(s.width!=null&&s.width!=="auto"){var d=bn(s.width,i.width)+v;o.length>0&&d+i.accumWidth>i.width&&(h=r.split(`
`),u=!0),i.accumWidth=d}else{var _=vc(r,f,i.width,i.breakAll,i.accumWidth);i.accumWidth=_.accumWidth+v,l=_.linesWidths,h=_.lines}}else h=r.split(`
`);for(var p=0;p<h.length;p++){var y=h[p],g=new Kp;if(g.styleName=n,g.text=y,g.isLineHolder=!y&&!a,typeof s.width=="number"?g.width=s.width:g.width=l?l[p]:ur(y,f),!p&&!u){var m=(o[o.length-1]||(o[0]=new yu)).tokens,T=m.length;T===1&&m[0].isLineHolder?m[0]=g:(y||!T||a)&&m.push(g)}else o.push(new yu([g]))}}function t0(t){var r=t.charCodeAt(0);return r>=32&&r<=591||r>=880&&r<=4351||r>=4608&&r<=5119||r>=7680&&r<=8303}var r0=Ln(",&?/;] ".split(""),function(t,r){return t[r]=!0,t},{});function e0(t){return t0(t)?!!r0[t]:!0}function vc(t,r,e,i,n){for(var a=[],s=[],o="",f="",u=0,h=0,l=0;l<t.length;l++){var c=t.charAt(l);if(c===`
`){f&&(o+=f,h+=u),a.push(o),s.push(h),o="",f="",u=0,h=0;continue}var v=ur(c,r),d=i?!1:!e0(c);if(a.length?h+v>e:n+h+v>e){h?(o||f)&&(d?(o||(o=f,f="",u=0,h=u),a.push(o),s.push(h-u),f+=c,u+=v,o="",h=u):(f&&(o+=f,f="",u=0),a.push(o),s.push(h),o=c,h=v)):d?(a.push(f),s.push(u),f=c,u=v):(a.push(c),s.push(v));continue}h+=v,d?(f+=c,u+=v):(f&&(o+=f,f="",u=0),o+=c)}return!a.length&&!o&&(o=t,f="",u=0),f&&(o+=f),o&&(a.push(o),s.push(h)),a.length===1&&(h+=n),{accumWidth:h,lines:a,linesWidths:s}}var Ho="__zr_style_"+Math.round(Math.random()*10),Ze={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},Ja={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};Ze[Ho]=!0;var gu=["z","z2","invisible"],i0=["invisible"],In=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype._init=function(e){for(var i=wt(e),n=0;n<i.length;n++){var a=i[n];a==="style"?this.useStyle(e[a]):t.prototype.attrKV.call(this,a,e[a])}this.style||this.useStyle({})},r.prototype.beforeBrush=function(){},r.prototype.afterBrush=function(){},r.prototype.innerBeforeBrush=function(){},r.prototype.innerAfterBrush=function(){},r.prototype.shouldBePainted=function(e,i,n,a){var s=this.transform;if(this.ignore||this.invisible||this.style.opacity===0||this.culling&&n0(this,e,i)||s&&!s[0]&&!s[3])return!1;if(n&&this.__clipPaths){for(var o=0;o<this.__clipPaths.length;++o)if(this.__clipPaths[o].isZeroArea())return!1}if(a&&this.parent)for(var f=this.parent;f;){if(f.ignore)return!1;f=f.parent}return!0},r.prototype.contain=function(e,i){return this.rectContain(e,i)},r.prototype.traverse=function(e,i){e.call(i,this)},r.prototype.rectContain=function(e,i){var n=this.transformCoordToLocal(e,i),a=this.getBoundingRect();return a.contain(n[0],n[1])},r.prototype.getPaintRect=function(){var e=this._paintRect;if(!this._paintRect||this.__dirty){var i=this.transform,n=this.getBoundingRect(),a=this.style,s=a.shadowBlur||0,o=a.shadowOffsetX||0,f=a.shadowOffsetY||0;e=this._paintRect||(this._paintRect=new Mt(0,0,0,0)),i?Mt.applyTransform(e,n,i):e.copy(n),(s||o||f)&&(e.width+=s*2+Math.abs(o),e.height+=s*2+Math.abs(f),e.x=Math.min(e.x,e.x+o-s),e.y=Math.min(e.y,e.y+f-s));var u=this.dirtyRectTolerance;e.isZero()||(e.x=Math.floor(e.x-u),e.y=Math.floor(e.y-u),e.width=Math.ceil(e.width+1+u*2),e.height=Math.ceil(e.height+1+u*2))}return e},r.prototype.setPrevPaintRect=function(e){e?(this._prevPaintRect=this._prevPaintRect||new Mt(0,0,0,0),this._prevPaintRect.copy(e)):this._prevPaintRect=null},r.prototype.getPrevPaintRect=function(){return this._prevPaintRect},r.prototype.animateStyle=function(e){return this.animate("style",e)},r.prototype.updateDuringAnimation=function(e){e==="style"?this.dirtyStyle():this.markRedraw()},r.prototype.attrKV=function(e,i){e!=="style"?t.prototype.attrKV.call(this,e,i):this.style?this.setStyle(i):this.useStyle(i)},r.prototype.setStyle=function(e,i){return typeof e=="string"?this.style[e]=i:dt(this.style,e),this.dirtyStyle(),this},r.prototype.dirtyStyle=function(e){e||this.markRedraw(),this.__dirty|=on,this._rect&&(this._rect=null)},r.prototype.dirty=function(){this.dirtyStyle()},r.prototype.styleChanged=function(){return!!(this.__dirty&on)},r.prototype.styleUpdated=function(){this.__dirty&=~on},r.prototype.createStyle=function(e){return On(Ze,e)},r.prototype.useStyle=function(e){e[Ho]||(e=this.createStyle(e)),this.__inHover?this.__hoverStyle=e:this.style=e,this.dirtyStyle()},r.prototype.isStyleObject=function(e){return e[Ho]},r.prototype._innerSaveToNormal=function(e){t.prototype._innerSaveToNormal.call(this,e);var i=this._normalState;e.style&&!i.style&&(i.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,i,gu)},r.prototype._applyStateObj=function(e,i,n,a,s,o){t.prototype._applyStateObj.call(this,e,i,n,a,s,o);var f=!(i&&a),u;if(i&&i.style?s?a?u=i.style:(u=this._mergeStyle(this.createStyle(),n.style),this._mergeStyle(u,i.style)):(u=this._mergeStyle(this.createStyle(),a?this.style:n.style),this._mergeStyle(u,i.style)):f&&(u=n.style),u)if(s){var h=this.style;if(this.style=this.createStyle(f?{}:h),f)for(var l=wt(h),c=0;c<l.length;c++){var v=l[c];v in u&&(u[v]=u[v],this.style[v]=h[v])}for(var d=wt(u),c=0;c<d.length;c++){var v=d[c];this.style[v]=this.style[v]}this._transitionState(e,{style:u},o,this.getAnimationStyleProps())}else this.useStyle(u);for(var _=this.__inHover?i0:gu,c=0;c<_.length;c++){var v=_[c];i&&i[v]!=null?this[v]=i[v]:f&&n[v]!=null&&(this[v]=n[v])}},r.prototype._mergeStates=function(e){for(var i=t.prototype._mergeStates.call(this,e),n,a=0;a<e.length;a++){var s=e[a];s.style&&(n=n||{},this._mergeStyle(n,s.style))}return n&&(i.style=n),i},r.prototype._mergeStyle=function(e,i){return dt(e,i),e},r.prototype.getAnimationStyleProps=function(){return Ja},r.initDefaultProps=(function(){var e=r.prototype;e.type="displayable",e.invisible=!1,e.z=0,e.z2=0,e.zlevel=0,e.culling=!1,e.cursor="pointer",e.rectHover=!1,e.incremental=!1,e._rect=null,e.dirtyRectTolerance=0,e.__dirty=or|on})(),r})(Ka),Ps=new Mt(0,0,0,0),Ls=new Mt(0,0,0,0);function n0(t,r,e){return Ps.copy(t.getBoundingRect()),t.transform&&Ps.applyTransform(t.transform),Ls.width=r,Ls.height=e,!Ps.intersect(Ls)}var tr=Math.min,rr=Math.max,Ds=Math.sin,Os=Math.cos,xe=Math.PI*2,Zn=Qe(),jn=Qe(),$n=Qe();function dc(t,r,e){if(t.length!==0){for(var i=t[0],n=i[0],a=i[0],s=i[1],o=i[1],f=1;f<t.length;f++)i=t[f],n=tr(n,i[0]),a=rr(a,i[0]),s=tr(s,i[1]),o=rr(o,i[1]);r[0]=n,r[1]=s,e[0]=a,e[1]=o}}function mu(t,r,e,i,n,a){n[0]=tr(t,e),n[1]=tr(r,i),a[0]=rr(t,e),a[1]=rr(r,i)}var Tu=[],xu=[];function a0(t,r,e,i,n,a,s,o,f,u){var h=ql,l=Ut,c=h(t,e,n,s,Tu);f[0]=1/0,f[1]=1/0,u[0]=-1/0,u[1]=-1/0;for(var v=0;v<c;v++){var d=l(t,e,n,s,Tu[v]);f[0]=tr(d,f[0]),u[0]=rr(d,u[0])}c=h(r,i,a,o,xu);for(var v=0;v<c;v++){var _=l(r,i,a,o,xu[v]);f[1]=tr(_,f[1]),u[1]=rr(_,u[1])}f[0]=tr(t,f[0]),u[0]=rr(t,u[0]),f[0]=tr(s,f[0]),u[0]=rr(s,u[0]),f[1]=tr(r,f[1]),u[1]=rr(r,u[1]),f[1]=tr(o,f[1]),u[1]=rr(o,u[1])}function s0(t,r,e,i,n,a,s,o){var f=Xl,u=Gt,h=rr(tr(f(t,e,n),1),0),l=rr(tr(f(r,i,a),1),0),c=u(t,e,n,h),v=u(r,i,a,l);s[0]=tr(t,n,c),s[1]=tr(r,a,v),o[0]=rr(t,n,c),o[1]=rr(r,a,v)}function o0(t,r,e,i,n,a,s,o,f){var u=He,h=ze,l=Math.abs(n-a);if(l%xe<1e-4&&l>1e-4){o[0]=t-e,o[1]=r-i,f[0]=t+e,f[1]=r+i;return}if(Zn[0]=Os(n)*e+t,Zn[1]=Ds(n)*i+r,jn[0]=Os(a)*e+t,jn[1]=Ds(a)*i+r,u(o,Zn,jn),h(f,Zn,jn),n=n%xe,n<0&&(n=n+xe),a=a%xe,a<0&&(a=a+xe),n>a&&!s?a+=xe:n<a&&s&&(n+=xe),s){var c=a;a=n,n=c}for(var v=0;v<a;v+=Math.PI/2)v>n&&($n[0]=Os(v)*e+t,$n[1]=Ds(v)*i+r,u(o,$n,o),h(f,$n,f))}var ct={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},we=[],Ee=[],Lr=[],Qr=[],Dr=[],Or=[],Is=Math.min,Ns=Math.max,be=Math.cos,Se=Math.sin,kr=Math.abs,zo=Math.PI,ee=zo*2,Fs=typeof Float32Array<"u",Zi=[];function Bs(t){var r=Math.round(t/zo*1e8)/1e8;return r%2*zo}function f0(t,r){var e=Bs(t[0]);e<0&&(e+=ee);var i=e-t[0],n=t[1];n+=i,!r&&n-e>=ee?n=e+ee:r&&e-n>=ee?n=e-ee:!r&&e>n?n=e+(ee-Bs(e-n)):r&&e<n&&(n=e-(ee-Bs(n-e))),t[0]=e,t[1]=n}var de=(function(){function t(r){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,r&&(this._saveData=!1),this._saveData&&(this.data=[])}return t.prototype.increaseVersion=function(){this._version++},t.prototype.getVersion=function(){return this._version},t.prototype.setScale=function(r,e,i){i=i||0,i>0&&(this._ux=kr(i/Oa/r)||0,this._uy=kr(i/Oa/e)||0)},t.prototype.setDPR=function(r){this.dpr=r},t.prototype.setContext=function(r){this._ctx=r},t.prototype.getContext=function(){return this._ctx},t.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},t.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},t.prototype.moveTo=function(r,e){return this._drawPendingPt(),this.addData(ct.M,r,e),this._ctx&&this._ctx.moveTo(r,e),this._x0=r,this._y0=e,this._xi=r,this._yi=e,this},t.prototype.lineTo=function(r,e){var i=kr(r-this._xi),n=kr(e-this._yi),a=i>this._ux||n>this._uy;if(this.addData(ct.L,r,e),this._ctx&&a&&this._ctx.lineTo(r,e),a)this._xi=r,this._yi=e,this._pendingPtDist=0;else{var s=i*i+n*n;s>this._pendingPtDist&&(this._pendingPtX=r,this._pendingPtY=e,this._pendingPtDist=s)}return this},t.prototype.bezierCurveTo=function(r,e,i,n,a,s){return this._drawPendingPt(),this.addData(ct.C,r,e,i,n,a,s),this._ctx&&this._ctx.bezierCurveTo(r,e,i,n,a,s),this._xi=a,this._yi=s,this},t.prototype.quadraticCurveTo=function(r,e,i,n){return this._drawPendingPt(),this.addData(ct.Q,r,e,i,n),this._ctx&&this._ctx.quadraticCurveTo(r,e,i,n),this._xi=i,this._yi=n,this},t.prototype.arc=function(r,e,i,n,a,s){this._drawPendingPt(),Zi[0]=n,Zi[1]=a,f0(Zi,s),n=Zi[0],a=Zi[1];var o=a-n;return this.addData(ct.A,r,e,i,i,n,o,0,s?0:1),this._ctx&&this._ctx.arc(r,e,i,n,a,s),this._xi=be(a)*i+r,this._yi=Se(a)*i+e,this},t.prototype.arcTo=function(r,e,i,n,a){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(r,e,i,n,a),this},t.prototype.rect=function(r,e,i,n){return this._drawPendingPt(),this._ctx&&this._ctx.rect(r,e,i,n),this.addData(ct.R,r,e,i,n),this},t.prototype.closePath=function(){this._drawPendingPt(),this.addData(ct.Z);var r=this._ctx,e=this._x0,i=this._y0;return r&&r.closePath(),this._xi=e,this._yi=i,this},t.prototype.fill=function(r){r&&r.fill(),this.toStatic()},t.prototype.stroke=function(r){r&&r.stroke(),this.toStatic()},t.prototype.len=function(){return this._len},t.prototype.setData=function(r){var e=r.length;!(this.data&&this.data.length===e)&&Fs&&(this.data=new Float32Array(e));for(var i=0;i<e;i++)this.data[i]=r[i];this._len=e},t.prototype.appendPath=function(r){r instanceof Array||(r=[r]);for(var e=r.length,i=0,n=this._len,a=0;a<e;a++)i+=r[a].len();Fs&&this.data instanceof Float32Array&&(this.data=new Float32Array(n+i));for(var a=0;a<e;a++)for(var s=r[a].data,o=0;o<s.length;o++)this.data[n++]=s[o];this._len=n},t.prototype.addData=function(r,e,i,n,a,s,o,f,u){if(this._saveData){var h=this.data;this._len+arguments.length>h.length&&(this._expandData(),h=this.data);for(var l=0;l<arguments.length;l++)h[this._len++]=arguments[l]}},t.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},t.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var r=[],e=0;e<this._len;e++)r[e]=this.data[e];this.data=r}},t.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var r=this.data;r instanceof Array&&(r.length=this._len,Fs&&this._len>11&&(this.data=new Float32Array(r)))}},t.prototype.getBoundingRect=function(){Lr[0]=Lr[1]=Dr[0]=Dr[1]=Number.MAX_VALUE,Qr[0]=Qr[1]=Or[0]=Or[1]=-Number.MAX_VALUE;var r=this.data,e=0,i=0,n=0,a=0,s;for(s=0;s<this._len;){var o=r[s++],f=s===1;switch(f&&(e=r[s],i=r[s+1],n=e,a=i),o){case ct.M:e=n=r[s++],i=a=r[s++],Dr[0]=n,Dr[1]=a,Or[0]=n,Or[1]=a;break;case ct.L:mu(e,i,r[s],r[s+1],Dr,Or),e=r[s++],i=r[s++];break;case ct.C:a0(e,i,r[s++],r[s++],r[s++],r[s++],r[s],r[s+1],Dr,Or),e=r[s++],i=r[s++];break;case ct.Q:s0(e,i,r[s++],r[s++],r[s],r[s+1],Dr,Or),e=r[s++],i=r[s++];break;case ct.A:var u=r[s++],h=r[s++],l=r[s++],c=r[s++],v=r[s++],d=r[s++]+v;s+=1;var _=!r[s++];f&&(n=be(v)*l+u,a=Se(v)*c+h),o0(u,h,l,c,v,d,_,Dr,Or),e=be(d)*l+u,i=Se(d)*c+h;break;case ct.R:n=e=r[s++],a=i=r[s++];var p=r[s++],y=r[s++];mu(n,a,n+p,a+y,Dr,Or);break;case ct.Z:e=n,i=a;break}He(Lr,Lr,Dr),ze(Qr,Qr,Or)}return s===0&&(Lr[0]=Lr[1]=Qr[0]=Qr[1]=0),new Mt(Lr[0],Lr[1],Qr[0]-Lr[0],Qr[1]-Lr[1])},t.prototype._calculateLength=function(){var r=this.data,e=this._len,i=this._ux,n=this._uy,a=0,s=0,o=0,f=0;this._pathSegLen||(this._pathSegLen=[]);for(var u=this._pathSegLen,h=0,l=0,c=0;c<e;){var v=r[c++],d=c===1;d&&(a=r[c],s=r[c+1],o=a,f=s);var _=-1;switch(v){case ct.M:a=o=r[c++],s=f=r[c++];break;case ct.L:{var p=r[c++],y=r[c++],g=p-a,m=y-s;(kr(g)>i||kr(m)>n||c===e-1)&&(_=Math.sqrt(g*g+m*m),a=p,s=y);break}case ct.C:{var T=r[c++],w=r[c++],p=r[c++],y=r[c++],x=r[c++],E=r[c++];_=Zd(a,s,T,w,p,y,x,E,10),a=x,s=E;break}case ct.Q:{var T=r[c++],w=r[c++],p=r[c++],y=r[c++];_=Kd(a,s,T,w,p,y,10),a=p,s=y;break}case ct.A:var S=r[c++],M=r[c++],C=r[c++],R=r[c++],L=r[c++],D=r[c++],P=D+L;c+=1,d&&(o=be(L)*C+S,f=Se(L)*R+M),_=Ns(C,R)*Is(ee,Math.abs(D)),a=be(P)*C+S,s=Se(P)*R+M;break;case ct.R:{o=a=r[c++],f=s=r[c++];var z=r[c++],A=r[c++];_=z*2+A*2;break}case ct.Z:{var g=o-a,m=f-s;_=Math.sqrt(g*g+m*m),a=o,s=f;break}}_>=0&&(u[l++]=_,h+=_)}return this._pathLen=h,h},t.prototype.rebuildPath=function(r,e){var i=this.data,n=this._ux,a=this._uy,s=this._len,o,f,u,h,l,c,v=e<1,d,_,p=0,y=0,g,m=0,T,w;if(!(v&&(this._pathSegLen||this._calculateLength(),d=this._pathSegLen,_=this._pathLen,g=e*_,!g)))t:for(var x=0;x<s;){var E=i[x++],S=x===1;switch(S&&(u=i[x],h=i[x+1],o=u,f=h),E!==ct.L&&m>0&&(r.lineTo(T,w),m=0),E){case ct.M:o=u=i[x++],f=h=i[x++],r.moveTo(u,h);break;case ct.L:{l=i[x++],c=i[x++];var M=kr(l-u),C=kr(c-h);if(M>n||C>a){if(v){var R=d[y++];if(p+R>g){var L=(g-p)/R;r.lineTo(u*(1-L)+l*L,h*(1-L)+c*L);break t}p+=R}r.lineTo(l,c),u=l,h=c,m=0}else{var D=M*M+C*C;D>m&&(T=l,w=c,m=D)}break}case ct.C:{var P=i[x++],z=i[x++],A=i[x++],B=i[x++],k=i[x++],j=i[x++];if(v){var R=d[y++];if(p+R>g){var L=(g-p)/R;ve(u,P,A,k,L,we),ve(h,z,B,j,L,Ee),r.bezierCurveTo(we[1],Ee[1],we[2],Ee[2],we[3],Ee[3]);break t}p+=R}r.bezierCurveTo(P,z,A,B,k,j),u=k,h=j;break}case ct.Q:{var P=i[x++],z=i[x++],A=i[x++],B=i[x++];if(v){var R=d[y++];if(p+R>g){var L=(g-p)/R;La(u,P,A,L,we),La(h,z,B,L,Ee),r.quadraticCurveTo(we[1],Ee[1],we[2],Ee[2]);break t}p+=R}r.quadraticCurveTo(P,z,A,B),u=A,h=B;break}case ct.A:var $=i[x++],rt=i[x++],Q=i[x++],st=i[x++],et=i[x++],pt=i[x++],At=i[x++],Kt=!i[x++],G=Q>st?Q:st,X=kr(Q-st)>.001,K=et+pt,W=!1;if(v){var R=d[y++];p+R>g&&(K=et+pt*(g-p)/R,W=!0),p+=R}if(X&&r.ellipse?r.ellipse($,rt,Q,st,At,et,K,Kt):r.arc($,rt,G,et,K,Kt),W)break t;S&&(o=be(et)*Q+$,f=Se(et)*st+rt),u=be(K)*Q+$,h=Se(K)*st+rt;break;case ct.R:o=u=i[x],f=h=i[x+1],l=i[x++],c=i[x++];var Y=i[x++],lt=i[x++];if(v){var R=d[y++];if(p+R>g){var ot=g-p;r.moveTo(l,c),r.lineTo(l+Is(ot,Y),c),ot-=Y,ot>0&&r.lineTo(l+Y,c+Is(ot,lt)),ot-=lt,ot>0&&r.lineTo(l+Ns(Y-ot,0),c+lt),ot-=Y,ot>0&&r.lineTo(l,c+Ns(lt-ot,0));break t}p+=R}r.rect(l,c,Y,lt);break;case ct.Z:if(v){var R=d[y++];if(p+R>g){var L=(g-p)/R;r.lineTo(u*(1-L)+o*L,h*(1-L)+f*L);break t}p+=R}r.closePath(),u=o,h=f}}},t.prototype.clone=function(){var r=new t,e=this.data;return r.data=e.slice?e.slice():Array.prototype.slice.call(e),r._len=this._len,r},t.CMD=ct,t.initDefaultProps=(function(){var r=t.prototype;r._saveData=!0,r._ux=0,r._uy=0,r._pendingPtDist=0,r._version=0})(),t})();function ai(t,r,e,i,n,a,s){if(n===0)return!1;var o=n,f=0,u=t;if(s>r+o&&s>i+o||s<r-o&&s<i-o||a>t+o&&a>e+o||a<t-o&&a<e-o)return!1;if(t!==e)f=(r-i)/(t-e),u=(t*i-e*r)/(t-e);else return Math.abs(a-t)<=o/2;var h=f*a-s+u,l=h*h/(f*f+1);return l<=o/2*o/2}function u0(t,r,e,i,n,a,s,o,f,u,h){if(f===0)return!1;var l=f;if(h>r+l&&h>i+l&&h>a+l&&h>o+l||h<r-l&&h<i-l&&h<a-l&&h<o-l||u>t+l&&u>e+l&&u>n+l&&u>s+l||u<t-l&&u<e-l&&u<n-l&&u<s-l)return!1;var c=Yd(t,r,e,i,n,a,s,o,u,h,null);return c<=l/2}function h0(t,r,e,i,n,a,s,o,f){if(s===0)return!1;var u=s;if(f>r+u&&f>i+u&&f>a+u||f<r-u&&f<i-u&&f<a-u||o>t+u&&o>e+u&&o>n+u||o<t-u&&o<e-u&&o<n-u)return!1;var h=$d(t,r,e,i,n,a,o,f,null);return h<=u/2}var wu=Math.PI*2;function Kn(t){return t%=wu,t<0&&(t+=wu),t}var ji=Math.PI*2;function l0(t,r,e,i,n,a,s,o,f){if(s===0)return!1;var u=s;o-=t,f-=r;var h=Math.sqrt(o*o+f*f);if(h-u>e||h+u<e)return!1;if(Math.abs(i-n)%ji<1e-4)return!0;if(a){var l=i;i=Kn(n),n=Kn(l)}else i=Kn(i),n=Kn(n);i>n&&(n+=ji);var c=Math.atan2(f,o);return c<0&&(c+=ji),c>=i&&c<=n||c+ji>=i&&c+ji<=n}function Yr(t,r,e,i,n,a){if(a>r&&a>i||a<r&&a<i||i===r)return 0;var s=(a-r)/(i-r),o=i<r?1:-1;(s===1||s===0)&&(o=i<r?.5:-.5);var f=s*(e-t)+t;return f===n?1/0:f>n?o:0}var Jr=de.CMD,Me=Math.PI*2,c0=1e-4;function v0(t,r){return Math.abs(t-r)<c0}var Yt=[-1,-1,-1],dr=[-1,-1];function d0(){var t=dr[0];dr[0]=dr[1],dr[1]=t}function p0(t,r,e,i,n,a,s,o,f,u){if(u>r&&u>i&&u>a&&u>o||u<r&&u<i&&u<a&&u<o)return 0;var h=Vl(r,i,a,o,u,Yt);if(h===0)return 0;for(var l=0,c=-1,v=void 0,d=void 0,_=0;_<h;_++){var p=Yt[_],y=p===0||p===1?.5:1,g=Ut(t,e,n,s,p);g<f||(c<0&&(c=ql(r,i,a,o,dr),dr[1]<dr[0]&&c>1&&d0(),v=Ut(r,i,a,o,dr[0]),c>1&&(d=Ut(r,i,a,o,dr[1]))),c===2?p<dr[0]?l+=v<r?y:-y:p<dr[1]?l+=d<v?y:-y:l+=o<d?y:-y:p<dr[0]?l+=v<r?y:-y:l+=o<v?y:-y)}return l}function _0(t,r,e,i,n,a,s,o){if(o>r&&o>i&&o>a||o<r&&o<i&&o<a)return 0;var f=jd(r,i,a,o,Yt);if(f===0)return 0;var u=Xl(r,i,a);if(u>=0&&u<=1){for(var h=0,l=Gt(r,i,a,u),c=0;c<f;c++){var v=Yt[c]===0||Yt[c]===1?.5:1,d=Gt(t,e,n,Yt[c]);d<s||(Yt[c]<u?h+=l<r?v:-v:h+=a<l?v:-v)}return h}else{var v=Yt[0]===0||Yt[0]===1?.5:1,d=Gt(t,e,n,Yt[0]);return d<s?0:a<r?v:-v}}function y0(t,r,e,i,n,a,s,o){if(o-=r,o>e||o<-e)return 0;var f=Math.sqrt(e*e-o*o);Yt[0]=-f,Yt[1]=f;var u=Math.abs(i-n);if(u<1e-4)return 0;if(u>=Me-1e-4){i=0,n=Me;var h=a?1:-1;return s>=Yt[0]+t&&s<=Yt[1]+t?h:0}if(i>n){var l=i;i=n,n=l}i<0&&(i+=Me,n+=Me);for(var c=0,v=0;v<2;v++){var d=Yt[v];if(d+t>s){var _=Math.atan2(o,d),h=a?1:-1;_<0&&(_=Me+_),(_>=i&&_<=n||_+Me>=i&&_+Me<=n)&&(_>Math.PI/2&&_<Math.PI*1.5&&(h=-h),c+=h)}}return c}function pc(t,r,e,i,n){for(var a=t.data,s=t.len(),o=0,f=0,u=0,h=0,l=0,c,v,d=0;d<s;){var _=a[d++],p=d===1;switch(_===Jr.M&&d>1&&(e||(o+=Yr(f,u,h,l,i,n))),p&&(f=a[d],u=a[d+1],h=f,l=u),_){case Jr.M:h=a[d++],l=a[d++],f=h,u=l;break;case Jr.L:if(e){if(ai(f,u,a[d],a[d+1],r,i,n))return!0}else o+=Yr(f,u,a[d],a[d+1],i,n)||0;f=a[d++],u=a[d++];break;case Jr.C:if(e){if(u0(f,u,a[d++],a[d++],a[d++],a[d++],a[d],a[d+1],r,i,n))return!0}else o+=p0(f,u,a[d++],a[d++],a[d++],a[d++],a[d],a[d+1],i,n)||0;f=a[d++],u=a[d++];break;case Jr.Q:if(e){if(h0(f,u,a[d++],a[d++],a[d],a[d+1],r,i,n))return!0}else o+=_0(f,u,a[d++],a[d++],a[d],a[d+1],i,n)||0;f=a[d++],u=a[d++];break;case Jr.A:var y=a[d++],g=a[d++],m=a[d++],T=a[d++],w=a[d++],x=a[d++];d+=1;var E=!!(1-a[d++]);c=Math.cos(w)*m+y,v=Math.sin(w)*T+g,p?(h=c,l=v):o+=Yr(f,u,c,v,i,n);var S=(i-y)*T/m+y;if(e){if(l0(y,g,T,w,w+x,E,r,S,n))return!0}else o+=y0(y,g,T,w,w+x,E,S,n);f=Math.cos(w+x)*m+y,u=Math.sin(w+x)*T+g;break;case Jr.R:h=f=a[d++],l=u=a[d++];var M=a[d++],C=a[d++];if(c=h+M,v=l+C,e){if(ai(h,l,c,l,r,i,n)||ai(c,l,c,v,r,i,n)||ai(c,v,h,v,r,i,n)||ai(h,v,h,l,r,i,n))return!0}else o+=Yr(c,l,c,v,i,n),o+=Yr(h,v,h,l,i,n);break;case Jr.Z:if(e){if(ai(f,u,h,l,r,i,n))return!0}else o+=Yr(f,u,h,l,i,n);f=h,u=l;break}}return!e&&!v0(u,l)&&(o+=Yr(f,u,h,l,i,n)||0),o!==0}function g0(t,r,e){return pc(t,0,!1,r,e)}function m0(t,r,e,i){return pc(t,r,!0,e,i)}var Ia=lr({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},Ze),T0={style:lr({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},Ja.style)},Us=En.concat(["invisible","culling","z","z2","zlevel","parent"]),Dt=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.update=function(){var e=this;t.prototype.update.call(this);var i=this.style;if(i.decal){var n=this._decalEl=this._decalEl||new r;n.buildPath===r.prototype.buildPath&&(n.buildPath=function(f){e.buildPath(f,e.shape)}),n.silent=!0;var a=n.style;for(var s in i)a[s]!==i[s]&&(a[s]=i[s]);a.fill=i.fill?i.decal:null,a.decal=null,a.shadowColor=null,i.strokeFirst&&(a.stroke=null);for(var o=0;o<Us.length;++o)n[Us[o]]=this[Us[o]];n.__dirty|=or}else this._decalEl&&(this._decalEl=null)},r.prototype.getDecalElement=function(){return this._decalEl},r.prototype._init=function(e){var i=wt(e);this.shape=this.getDefaultShape();var n=this.getDefaultStyle();n&&this.useStyle(n);for(var a=0;a<i.length;a++){var s=i[a],o=e[s];s==="style"?this.style?dt(this.style,o):this.useStyle(o):s==="shape"?dt(this.shape,o):t.prototype.attrKV.call(this,s,o)}this.style||this.useStyle({})},r.prototype.getDefaultStyle=function(){return null},r.prototype.getDefaultShape=function(){return{}},r.prototype.canBeInsideText=function(){return this.hasFill()},r.prototype.getInsideTextFill=function(){var e=this.style.fill;if(e!=="none"){if(Ar(e)){var i=xn(e,0);return i>.5?No:i>.2?Cp:Fo}else if(e)return Fo}return No},r.prototype.getInsideTextStroke=function(e){var i=this.style.fill;if(Ar(i)){var n=this.__zr,a=!!(n&&n.isDarkMode()),s=xn(e,0)<Io;if(a===s)return i}},r.prototype.buildPath=function(e,i,n){},r.prototype.pathUpdated=function(){this.__dirty&=~yi},r.prototype.getUpdatedPathProxy=function(e){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,e),this.path},r.prototype.createPathProxy=function(){this.path=new de(!1)},r.prototype.hasStroke=function(){var e=this.style,i=e.stroke;return!(i==null||i==="none"||!(e.lineWidth>0))},r.prototype.hasFill=function(){var e=this.style,i=e.fill;return i!=null&&i!=="none"},r.prototype.getBoundingRect=function(){var e=this._rect,i=this.style,n=!e;if(n){var a=!1;this.path||(a=!0,this.createPathProxy());var s=this.path;(a||this.__dirty&yi)&&(s.beginPath(),this.buildPath(s,this.shape,!1),this.pathUpdated()),e=s.getBoundingRect()}if(this._rect=e,this.hasStroke()&&this.path&&this.path.len()>0){var o=this._rectStroke||(this._rectStroke=e.clone());if(this.__dirty||n){o.copy(e);var f=i.strokeNoScale?this.getLineScale():1,u=i.lineWidth;if(!this.hasFill()){var h=this.strokeContainThreshold;u=Math.max(u,h??4)}f>1e-10&&(o.width+=u/f,o.height+=u/f,o.x-=u/f/2,o.y-=u/f/2)}return o}return e},r.prototype.contain=function(e,i){var n=this.transformCoordToLocal(e,i),a=this.getBoundingRect(),s=this.style;if(e=n[0],i=n[1],a.contain(e,i)){var o=this.path;if(this.hasStroke()){var f=s.lineWidth,u=s.strokeNoScale?this.getLineScale():1;if(u>1e-10&&(this.hasFill()||(f=Math.max(f,this.strokeContainThreshold)),m0(o,f/u,e,i)))return!0}if(this.hasFill())return g0(o,e,i)}return!1},r.prototype.dirtyShape=function(){this.__dirty|=yi,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},r.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},r.prototype.animateShape=function(e){return this.animate("shape",e)},r.prototype.updateDuringAnimation=function(e){e==="style"?this.dirtyStyle():e==="shape"?this.dirtyShape():this.markRedraw()},r.prototype.attrKV=function(e,i){e==="shape"?this.setShape(i):t.prototype.attrKV.call(this,e,i)},r.prototype.setShape=function(e,i){var n=this.shape;return n||(n=this.shape={}),typeof e=="string"?n[e]=i:dt(n,e),this.dirtyShape(),this},r.prototype.shapeChanged=function(){return!!(this.__dirty&yi)},r.prototype.createStyle=function(e){return On(Ia,e)},r.prototype._innerSaveToNormal=function(e){t.prototype._innerSaveToNormal.call(this,e);var i=this._normalState;e.shape&&!i.shape&&(i.shape=dt({},this.shape))},r.prototype._applyStateObj=function(e,i,n,a,s,o){t.prototype._applyStateObj.call(this,e,i,n,a,s,o);var f=!(i&&a),u;if(i&&i.shape?s?a?u=i.shape:(u=dt({},n.shape),dt(u,i.shape)):(u=dt({},a?this.shape:n.shape),dt(u,i.shape)):f&&(u=n.shape),u)if(s){this.shape=dt({},this.shape);for(var h={},l=wt(u),c=0;c<l.length;c++){var v=l[c];typeof u[v]=="object"?this.shape[v]=u[v]:h[v]=u[v]}this._transitionState(e,{shape:h},o)}else this.shape=u,this.dirtyShape()},r.prototype._mergeStates=function(e){for(var i=t.prototype._mergeStates.call(this,e),n,a=0;a<e.length;a++){var s=e[a];s.shape&&(n=n||{},this._mergeStyle(n,s.shape))}return n&&(i.shape=n),i},r.prototype.getAnimationStyleProps=function(){return T0},r.prototype.isZeroArea=function(){return!1},r.extend=function(e){var i=(function(a){yt(s,a);function s(o){var f=a.call(this,o)||this;return e.init&&e.init.call(f,o),f}return s.prototype.getDefaultStyle=function(){return ce(e.style)},s.prototype.getDefaultShape=function(){return ce(e.shape)},s})(r);for(var n in e)typeof e[n]=="function"&&(i.prototype[n]=e[n]);return i},r.initDefaultProps=(function(){var e=r.prototype;e.type="path",e.strokeContainThreshold=5,e.segmentIgnoreThreshold=0,e.subPixelOptimize=!1,e.autoBatch=!1,e.__dirty=or|on|yi})(),r})(In),x0=lr({strokeFirst:!0,font:le,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},Ia),Oi=(function(t){yt(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.hasStroke=function(){var e=this.style,i=e.stroke;return i!=null&&i!=="none"&&e.lineWidth>0},r.prototype.hasFill=function(){var e=this.style,i=e.fill;return i!=null&&i!=="none"},r.prototype.createStyle=function(e){return On(x0,e)},r.prototype.setBoundingRect=function(e){this._rect=e},r.prototype.getBoundingRect=function(){var e=this.style;if(!this._rect){var i=e.text;i!=null?i+="":i="";var n=Pp(i,e.font,e.textAlign,e.textBaseline);if(n.x+=e.x||0,n.y+=e.y||0,this.hasStroke()){var a=e.lineWidth;n.x-=a/2,n.y-=a/2,n.width+=a,n.height+=a}this._rect=n}return this._rect},r.initDefaultProps=(function(){var e=r.prototype;e.dirtyRectTolerance=10})(),r})(In);Oi.prototype.type="tspan";var w0=lr({x:0,y:0},Ze),E0={style:lr({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},Ja.style)};function b0(t){return!!(t&&typeof t!="string"&&t.width&&t.height)}var ki=(function(t){yt(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.createStyle=function(e){return On(w0,e)},r.prototype._getSize=function(e){var i=this.style,n=i[e];if(n!=null)return n;var a=b0(i.image)?i.image:this.__image;if(!a)return 0;var s=e==="width"?"height":"width",o=i[s];return o==null?a[e]:a[e]/a[s]*o},r.prototype.getWidth=function(){return this._getSize("width")},r.prototype.getHeight=function(){return this._getSize("height")},r.prototype.getAnimationStyleProps=function(){return E0},r.prototype.getBoundingRect=function(){var e=this.style;return this._rect||(this._rect=new Mt(e.x||0,e.y||0,this.getWidth(),this.getHeight())),this._rect},r})(In);ki.prototype.type="image";function S0(t,r){var e=r.x,i=r.y,n=r.width,a=r.height,s=r.r,o,f,u,h;n<0&&(e=e+n,n=-n),a<0&&(i=i+a,a=-a),typeof s=="number"?o=f=u=h=s:s instanceof Array?s.length===1?o=f=u=h=s[0]:s.length===2?(o=u=s[0],f=h=s[1]):s.length===3?(o=s[0],f=h=s[1],u=s[2]):(o=s[0],f=s[1],u=s[2],h=s[3]):o=f=u=h=0;var l;o+f>n&&(l=o+f,o*=n/l,f*=n/l),u+h>n&&(l=u+h,u*=n/l,h*=n/l),f+u>a&&(l=f+u,f*=a/l,u*=a/l),o+h>a&&(l=o+h,o*=a/l,h*=a/l),t.moveTo(e+o,i),t.lineTo(e+n-f,i),f!==0&&t.arc(e+n-f,i+f,f,-Math.PI/2,0),t.lineTo(e+n,i+a-u),u!==0&&t.arc(e+n-u,i+a-u,u,0,Math.PI/2),t.lineTo(e+h,i+a),h!==0&&t.arc(e+h,i+a-h,h,Math.PI/2,Math.PI),t.lineTo(e,i+o),o!==0&&t.arc(e+o,i+o,o,Math.PI,Math.PI*1.5)}var xi=Math.round;function M0(t,r,e){if(r){var i=r.x1,n=r.x2,a=r.y1,s=r.y2;t.x1=i,t.x2=n,t.y1=a,t.y2=s;var o=e&&e.lineWidth;return o&&(xi(i*2)===xi(n*2)&&(t.x1=t.x2=wi(i,o,!0)),xi(a*2)===xi(s*2)&&(t.y1=t.y2=wi(a,o,!0))),t}}function A0(t,r,e){if(r){var i=r.x,n=r.y,a=r.width,s=r.height;t.x=i,t.y=n,t.width=a,t.height=s;var o=e&&e.lineWidth;return o&&(t.x=wi(i,o,!0),t.y=wi(n,o,!0),t.width=Math.max(wi(i+a,o,!1)-t.x,a===0?0:1),t.height=Math.max(wi(n+s,o,!1)-t.y,s===0?0:1)),t}}function wi(t,r,e){if(!r)return t;var i=xi(t*2);return(i+xi(r))%2===0?i/2:(i+(e?1:-1))/2}var R0=(function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0}return t})(),C0={},Sn=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultShape=function(){return new R0},r.prototype.buildPath=function(e,i){var n,a,s,o;if(this.subPixelOptimize){var f=A0(C0,i,this.style);n=f.x,a=f.y,s=f.width,o=f.height,f.r=i.r,i=f}else n=i.x,a=i.y,s=i.width,o=i.height;i.r?S0(e,i):e.rect(n,a,s,o)},r.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},r})(Dt);Sn.prototype.type="rect";var Eu={fill:"#000"},bu=2,P0={style:lr({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},Ja.style)},L0=(function(t){yt(r,t);function r(e){var i=t.call(this)||this;return i.type="text",i._children=[],i._defaultStyle=Eu,i.attr(e),i}return r.prototype.childrenRef=function(){return this._children},r.prototype.update=function(){t.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var e=0;e<this._children.length;e++){var i=this._children[e];i.zlevel=this.zlevel,i.z=this.z,i.z2=this.z2,i.culling=this.culling,i.cursor=this.cursor,i.invisible=this.invisible}},r.prototype.updateTransform=function(){var e=this.innerTransformable;e?(e.updateTransform(),e.transform&&(this.transform=e.transform)):t.prototype.updateTransform.call(this)},r.prototype.getLocalTransform=function(e){var i=this.innerTransformable;return i?i.getLocalTransform(e):t.prototype.getLocalTransform.call(this,e)},r.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),t.prototype.getComputedTransform.call(this)},r.prototype._updateSubTexts=function(){this._childCursor=0,I0(this.style),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},r.prototype.addSelfToZr=function(e){t.prototype.addSelfToZr.call(this,e);for(var i=0;i<this._children.length;i++)this._children[i].__zr=e},r.prototype.removeSelfFromZr=function(e){t.prototype.removeSelfFromZr.call(this,e);for(var i=0;i<this._children.length;i++)this._children[i].__zr=null},r.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var e=new Mt(0,0,0,0),i=this._children,n=[],a=null,s=0;s<i.length;s++){var o=i[s],f=o.getBoundingRect(),u=o.getLocalTransform(n);u?(e.copy(f),e.applyTransform(u),a=a||e.clone(),a.union(e)):(a=a||f.clone(),a.union(f))}this._rect=a||e}return this._rect},r.prototype.setDefaultTextStyle=function(e){this._defaultStyle=e||Eu},r.prototype.setTextContent=function(e){},r.prototype._mergeStyle=function(e,i){if(!i)return e;var n=i.rich,a=e.rich||n&&{};return dt(e,i),n&&a?(this._mergeRich(a,n),e.rich=a):a&&(e.rich=a),e},r.prototype._mergeRich=function(e,i){for(var n=wt(i),a=0;a<n.length;a++){var s=n[a];e[s]=e[s]||{},dt(e[s],i[s])}},r.prototype.getAnimationStyleProps=function(){return P0},r.prototype._getOrCreateChild=function(e){var i=this._children[this._childCursor];return(!i||!(i instanceof e))&&(i=new e),this._children[this._childCursor++]=i,i.__zr=this.__zr,i.parent=this,i},r.prototype._updatePlainTexts=function(){var e=this.style,i=e.font||le,n=e.padding,a=Lu(e),s=$p(a,e),o=Hs(e),f=!!e.backgroundColor,u=s.outerHeight,h=s.outerWidth,l=s.contentWidth,c=s.lines,v=s.lineHeight,d=this._defaultStyle;this.isTruncated=!!s.isTruncated;var _=e.x||0,p=e.y||0,y=e.align||d.align||"left",g=e.verticalAlign||d.verticalAlign||"top",m=_,T=gi(p,s.contentHeight,g);if(o||n){var w=un(_,h,y),x=gi(p,u,g);o&&this._renderBackground(e,e,w,x,h,u)}T+=v/2,n&&(m=Pu(_,y,n),g==="top"?T+=n[0]:g==="bottom"&&(T-=n[2]));for(var E=0,S=!1,M=Cu("fill"in e?e.fill:(S=!0,d.fill)),C=Ru("stroke"in e?e.stroke:!f&&(!d.autoStroke||S)?(E=bu,d.stroke):null),R=e.textShadowBlur>0,L=e.width!=null&&(e.overflow==="truncate"||e.overflow==="break"||e.overflow==="breakAll"),D=s.calculatedLineHeight,P=0;P<c.length;P++){var z=this._getOrCreateChild(Oi),A=z.createStyle();z.useStyle(A),A.text=c[P],A.x=m,A.y=T,A.textAlign=y,A.textBaseline="middle",A.opacity=e.opacity,A.strokeFirst=!0,R&&(A.shadowBlur=e.textShadowBlur||0,A.shadowColor=e.textShadowColor||"transparent",A.shadowOffsetX=e.textShadowOffsetX||0,A.shadowOffsetY=e.textShadowOffsetY||0),A.stroke=C,A.fill=M,C&&(A.lineWidth=e.lineWidth||E,A.lineDash=e.lineDash,A.lineDashOffset=e.lineDashOffset||0),A.font=i,Mu(A,e),T+=v,L&&z.setBoundingRect(new Mt(un(A.x,l,A.textAlign),gi(A.y,D,A.textBaseline),l,D))}},r.prototype._updateRichTexts=function(){var e=this.style,i=Lu(e),n=Jp(i,e),a=n.width,s=n.outerWidth,o=n.outerHeight,f=e.padding,u=e.x||0,h=e.y||0,l=this._defaultStyle,c=e.align||l.align,v=e.verticalAlign||l.verticalAlign;this.isTruncated=!!n.isTruncated;var d=un(u,s,c),_=gi(h,o,v),p=d,y=_;f&&(p+=f[3],y+=f[0]);var g=p+a;Hs(e)&&this._renderBackground(e,e,d,_,s,o);for(var m=!!e.backgroundColor,T=0;T<n.lines.length;T++){for(var w=n.lines[T],x=w.tokens,E=x.length,S=w.lineHeight,M=w.width,C=0,R=p,L=g,D=E-1,P=void 0;C<E&&(P=x[C],!P.align||P.align==="left");)this._placeToken(P,e,S,y,R,"left",m),M-=P.width,R+=P.width,C++;for(;D>=0&&(P=x[D],P.align==="right");)this._placeToken(P,e,S,y,L,"right",m),M-=P.width,L-=P.width,D--;for(R+=(a-(R-p)-(g-L)-M)/2;C<=D;)P=x[C],this._placeToken(P,e,S,y,R+P.width/2,"center",m),R+=P.width,C++;y+=S}},r.prototype._placeToken=function(e,i,n,a,s,o,f){var u=i.rich[e.styleName]||{};u.text=e.text;var h=e.verticalAlign,l=a+n/2;h==="top"?l=a+e.height/2:h==="bottom"&&(l=a+n-e.height/2);var c=!e.isLineHolder&&Hs(u);c&&this._renderBackground(u,i,o==="right"?s-e.width:o==="center"?s-e.width/2:s,l-e.height/2,e.width,e.height);var v=!!u.backgroundColor,d=e.textPadding;d&&(s=Pu(s,o,d),l-=e.height/2-d[0]-e.innerHeight/2);var _=this._getOrCreateChild(Oi),p=_.createStyle();_.useStyle(p);var y=this._defaultStyle,g=!1,m=0,T=Cu("fill"in u?u.fill:"fill"in i?i.fill:(g=!0,y.fill)),w=Ru("stroke"in u?u.stroke:"stroke"in i?i.stroke:!v&&!f&&(!y.autoStroke||g)?(m=bu,y.stroke):null),x=u.textShadowBlur>0||i.textShadowBlur>0;p.text=e.text,p.x=s,p.y=l,x&&(p.shadowBlur=u.textShadowBlur||i.textShadowBlur||0,p.shadowColor=u.textShadowColor||i.textShadowColor||"transparent",p.shadowOffsetX=u.textShadowOffsetX||i.textShadowOffsetX||0,p.shadowOffsetY=u.textShadowOffsetY||i.textShadowOffsetY||0),p.textAlign=o,p.textBaseline="middle",p.font=e.font||le,p.opacity=vn(u.opacity,i.opacity,1),Mu(p,u),w&&(p.lineWidth=vn(u.lineWidth,i.lineWidth,m),p.lineDash=Pt(u.lineDash,i.lineDash),p.lineDashOffset=i.lineDashOffset||0,p.stroke=w),T&&(p.fill=T);var E=e.contentWidth,S=e.contentHeight;_.setBoundingRect(new Mt(un(p.x,E,p.textAlign),gi(p.y,S,p.textBaseline),E,S))},r.prototype._renderBackground=function(e,i,n,a,s,o){var f=e.backgroundColor,u=e.borderWidth,h=e.borderColor,l=f&&f.image,c=f&&!l,v=e.borderRadius,d=this,_,p;if(c||e.lineHeight||u&&h){_=this._getOrCreateChild(Sn),_.useStyle(_.createStyle()),_.style.fill=null;var y=_.shape;y.x=n,y.y=a,y.width=s,y.height=o,y.r=v,_.dirtyShape()}if(c){var g=_.style;g.fill=f||null,g.fillOpacity=Pt(e.fillOpacity,1)}else if(l){p=this._getOrCreateChild(ki),p.onload=function(){d.dirtyStyle()};var m=p.style;m.image=f.image,m.x=n,m.y=a,m.width=s,m.height=o}if(u&&h){var g=_.style;g.lineWidth=u,g.stroke=h,g.strokeOpacity=Pt(e.strokeOpacity,1),g.lineDash=e.borderDash,g.lineDashOffset=e.borderDashOffset||0,_.strokeContainThreshold=0,_.hasFill()&&_.hasStroke()&&(g.strokeFirst=!0,g.lineWidth*=2)}var T=(_||p).style;T.shadowBlur=e.shadowBlur||0,T.shadowColor=e.shadowColor||"transparent",T.shadowOffsetX=e.shadowOffsetX||0,T.shadowOffsetY=e.shadowOffsetY||0,T.opacity=vn(e.opacity,i.opacity,1)},r.makeFont=function(e){var i="";return yc(e)&&(i=[e.fontStyle,e.fontWeight,_c(e.fontSize),e.fontFamily||"sans-serif"].join(" ")),i&&Ue(i)||e.textFont||e.font},r})(In),D0={left:!0,right:1,center:1},O0={top:1,bottom:1,middle:1},Su=["fontStyle","fontWeight","fontSize","fontFamily"];function _c(t){return typeof t=="string"&&(t.indexOf("px")!==-1||t.indexOf("rem")!==-1||t.indexOf("em")!==-1)?t:isNaN(+t)?rf+"px":t+"px"}function Mu(t,r){for(var e=0;e<Su.length;e++){var i=Su[e],n=r[i];n!=null&&(t[i]=n)}}function yc(t){return t.fontSize!=null||t.fontFamily||t.fontWeight}function I0(t){return Au(t),zt(t.rich,Au),t}function Au(t){if(t){t.font=L0.makeFont(t);var r=t.align;r==="middle"&&(r="center"),t.align=r==null||D0[r]?r:"left";var e=t.verticalAlign;e==="center"&&(e="middle"),t.verticalAlign=e==null||O0[e]?e:"top";var i=t.padding;i&&(t.padding=Sl(t.padding))}}function Ru(t,r){return t==null||r<=0||t==="transparent"||t==="none"?null:t.image||t.colorStops?"#000":t}function Cu(t){return t==null||t==="none"?null:t.image||t.colorStops?"#000":t}function Pu(t,r,e){return r==="right"?t-e[1]:r==="center"?t+e[3]/2-e[1]/2:t+e[3]}function Lu(t){var r=t.text;return r!=null&&(r+=""),r}function Hs(t){return!!(t.backgroundColor||t.lineHeight||t.borderWidth&&t.borderColor)}var si=de.CMD,N0=[[],[],[]],Du=Math.sqrt,F0=Math.atan2;function gc(t,r){if(r){var e=t.data,i=t.len(),n,a,s,o,f,u,h=si.M,l=si.C,c=si.L,v=si.R,d=si.A,_=si.Q;for(s=0,o=0;s<i;){switch(n=e[s++],o=s,a=0,n){case h:a=1;break;case c:a=1;break;case l:a=3;break;case _:a=2;break;case d:var p=r[4],y=r[5],g=Du(r[0]*r[0]+r[1]*r[1]),m=Du(r[2]*r[2]+r[3]*r[3]),T=F0(-r[1]/m,r[0]/g);e[s]*=g,e[s++]+=p,e[s]*=m,e[s++]+=y,e[s++]*=g,e[s++]*=m,e[s++]+=T,e[s++]+=T,s+=2,o=s;break;case v:u[0]=e[s++],u[1]=e[s++],Ri(u,u,r),e[o++]=u[0],e[o++]=u[1],u[0]+=e[s++],u[1]+=e[s++],Ri(u,u,r),e[o++]=u[0],e[o++]=u[1]}for(f=0;f<a;f++){var w=N0[f];w[0]=e[s++],w[1]=e[s++],Ri(w,w,r),e[o++]=w[0],e[o++]=w[1]}}t.increaseVersion()}}var zs=Math.sqrt,Qn=Math.sin,Jn=Math.cos,$i=Math.PI;function Ou(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ko(t,r){return(t[0]*r[0]+t[1]*r[1])/(Ou(t)*Ou(r))}function Iu(t,r){return(t[0]*r[1]<t[1]*r[0]?-1:1)*Math.acos(ko(t,r))}function Nu(t,r,e,i,n,a,s,o,f,u,h){var l=f*($i/180),c=Jn(l)*(t-e)/2+Qn(l)*(r-i)/2,v=-1*Qn(l)*(t-e)/2+Jn(l)*(r-i)/2,d=c*c/(s*s)+v*v/(o*o);d>1&&(s*=zs(d),o*=zs(d));var _=(n===a?-1:1)*zs((s*s*(o*o)-s*s*(v*v)-o*o*(c*c))/(s*s*(v*v)+o*o*(c*c)))||0,p=_*s*v/o,y=_*-o*c/s,g=(t+e)/2+Jn(l)*p-Qn(l)*y,m=(r+i)/2+Qn(l)*p+Jn(l)*y,T=Iu([1,0],[(c-p)/s,(v-y)/o]),w=[(c-p)/s,(v-y)/o],x=[(-1*c-p)/s,(-1*v-y)/o],E=Iu(w,x);if(ko(w,x)<=-1&&(E=$i),ko(w,x)>=1&&(E=0),E<0){var S=Math.round(E/$i*1e6)/1e6;E=$i*2+S%2*$i}h.addData(u,g,m,s,o,T,E,l,a)}var B0=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/ig,U0=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function H0(t){var r=new de;if(!t)return r;var e=0,i=0,n=e,a=i,s,o=de.CMD,f=t.match(B0);if(!f)return r;for(var u=0;u<f.length;u++){for(var h=f[u],l=h.charAt(0),c=void 0,v=h.match(U0)||[],d=v.length,_=0;_<d;_++)v[_]=parseFloat(v[_]);for(var p=0;p<d;){var y=void 0,g=void 0,m=void 0,T=void 0,w=void 0,x=void 0,E=void 0,S=e,M=i,C=void 0,R=void 0;switch(l){case"l":e+=v[p++],i+=v[p++],c=o.L,r.addData(c,e,i);break;case"L":e=v[p++],i=v[p++],c=o.L,r.addData(c,e,i);break;case"m":e+=v[p++],i+=v[p++],c=o.M,r.addData(c,e,i),n=e,a=i,l="l";break;case"M":e=v[p++],i=v[p++],c=o.M,r.addData(c,e,i),n=e,a=i,l="L";break;case"h":e+=v[p++],c=o.L,r.addData(c,e,i);break;case"H":e=v[p++],c=o.L,r.addData(c,e,i);break;case"v":i+=v[p++],c=o.L,r.addData(c,e,i);break;case"V":i=v[p++],c=o.L,r.addData(c,e,i);break;case"C":c=o.C,r.addData(c,v[p++],v[p++],v[p++],v[p++],v[p++],v[p++]),e=v[p-2],i=v[p-1];break;case"c":c=o.C,r.addData(c,v[p++]+e,v[p++]+i,v[p++]+e,v[p++]+i,v[p++]+e,v[p++]+i),e+=v[p-2],i+=v[p-1];break;case"S":y=e,g=i,C=r.len(),R=r.data,s===o.C&&(y+=e-R[C-4],g+=i-R[C-3]),c=o.C,S=v[p++],M=v[p++],e=v[p++],i=v[p++],r.addData(c,y,g,S,M,e,i);break;case"s":y=e,g=i,C=r.len(),R=r.data,s===o.C&&(y+=e-R[C-4],g+=i-R[C-3]),c=o.C,S=e+v[p++],M=i+v[p++],e+=v[p++],i+=v[p++],r.addData(c,y,g,S,M,e,i);break;case"Q":S=v[p++],M=v[p++],e=v[p++],i=v[p++],c=o.Q,r.addData(c,S,M,e,i);break;case"q":S=v[p++]+e,M=v[p++]+i,e+=v[p++],i+=v[p++],c=o.Q,r.addData(c,S,M,e,i);break;case"T":y=e,g=i,C=r.len(),R=r.data,s===o.Q&&(y+=e-R[C-4],g+=i-R[C-3]),e=v[p++],i=v[p++],c=o.Q,r.addData(c,y,g,e,i);break;case"t":y=e,g=i,C=r.len(),R=r.data,s===o.Q&&(y+=e-R[C-4],g+=i-R[C-3]),e+=v[p++],i+=v[p++],c=o.Q,r.addData(c,y,g,e,i);break;case"A":m=v[p++],T=v[p++],w=v[p++],x=v[p++],E=v[p++],S=e,M=i,e=v[p++],i=v[p++],c=o.A,Nu(S,M,e,i,x,E,m,T,w,c,r);break;case"a":m=v[p++],T=v[p++],w=v[p++],x=v[p++],E=v[p++],S=e,M=i,e+=v[p++],i+=v[p++],c=o.A,Nu(S,M,e,i,x,E,m,T,w,c,r);break}}(l==="z"||l==="Z")&&(c=o.Z,r.addData(c),e=n,i=a),s=c}return r.toStatic(),r}var mc=(function(t){yt(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.applyTransform=function(e){},r})(Dt);function Tc(t){return t.setData!=null}function xc(t,r){var e=H0(t),i=dt({},r);return i.buildPath=function(n){if(Tc(n)){n.setData(e.data);var a=n.getContext();a&&n.rebuildPath(a,1)}else{var a=n;e.rebuildPath(a,1)}},i.applyTransform=function(n){gc(e,n),this.dirtyShape()},i}function z0(t,r){return new mc(xc(t,r))}function $g(t,r){var e=xc(t,r),i=(function(n){yt(a,n);function a(s){var o=n.call(this,s)||this;return o.applyTransform=e.applyTransform,o.buildPath=e.buildPath,o}return a})(mc);return i}function Kg(t,r){for(var e=[],i=t.length,n=0;n<i;n++){var a=t[n];e.push(a.getUpdatedPathProxy(!0))}var s=new Dt(r);return s.createPathProxy(),s.buildPath=function(o){if(Tc(o)){o.appendPath(e);var f=o.getContext();f&&o.rebuildPath(f,1)}},s}function wc(t,r){r=r||{};var e=new Dt;return t.shape&&e.setShape(t.shape),e.setStyle(t.style),r.bakeTransform?gc(e.path,t.getComputedTransform()):r.toLocal?e.setLocalTransform(t.getComputedTransform()):e.copyTransform(t),e.buildPath=t.buildPath,e.applyTransform=e.applyTransform,e.z=t.z,e.z2=t.z2,e.zlevel=t.zlevel,e}var k0=(function(){function t(){this.cx=0,this.cy=0,this.r=0}return t})(),Ec=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultShape=function(){return new k0},r.prototype.buildPath=function(e,i){e.moveTo(i.cx+i.r,i.cy),e.arc(i.cx,i.cy,i.r,0,Math.PI*2)},r})(Dt);Ec.prototype.type="circle";var G0=(function(){function t(){this.cx=0,this.cy=0,this.rx=0,this.ry=0}return t})(),bc=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultShape=function(){return new G0},r.prototype.buildPath=function(e,i){var n=.5522848,a=i.cx,s=i.cy,o=i.rx,f=i.ry,u=o*n,h=f*n;e.moveTo(a-o,s),e.bezierCurveTo(a-o,s-h,a-u,s-f,a,s-f),e.bezierCurveTo(a+u,s-f,a+o,s-h,a+o,s),e.bezierCurveTo(a+o,s+h,a+u,s+f,a,s+f),e.bezierCurveTo(a-u,s+f,a-o,s+h,a-o,s),e.closePath()},r})(Dt);bc.prototype.type="ellipse";var Sc=Math.PI,ks=Sc*2,Ae=Math.sin,oi=Math.cos,W0=Math.acos,kt=Math.atan2,Fu=Math.abs,_n=Math.sqrt,hn=Math.max,Ir=Math.min,mr=1e-4;function V0(t,r,e,i,n,a,s,o){var f=e-t,u=i-r,h=s-n,l=o-a,c=l*f-h*u;if(!(c*c<mr))return c=(h*(r-a)-l*(t-n))/c,[t+c*f,r+c*u]}function ta(t,r,e,i,n,a,s){var o=t-e,f=r-i,u=(s?a:-a)/_n(o*o+f*f),h=u*f,l=-u*o,c=t+h,v=r+l,d=e+h,_=i+l,p=(c+d)/2,y=(v+_)/2,g=d-c,m=_-v,T=g*g+m*m,w=n-a,x=c*_-d*v,E=(m<0?-1:1)*_n(hn(0,w*w*T-x*x)),S=(x*m-g*E)/T,M=(-x*g-m*E)/T,C=(x*m+g*E)/T,R=(-x*g+m*E)/T,L=S-p,D=M-y,P=C-p,z=R-y;return L*L+D*D>P*P+z*z&&(S=C,M=R),{cx:S,cy:M,x0:-h,y0:-l,x1:S*(n/w-1),y1:M*(n/w-1)}}function q0(t){var r;if($e(t)){var e=t.length;if(!e)return t;e===1?r=[t[0],t[0],0,0]:e===2?r=[t[0],t[0],t[1],t[1]]:e===3?r=t.concat(t[2]):r=t}else r=[t,t,t,t];return r}function X0(t,r){var e,i=hn(r.r,0),n=hn(r.r0||0,0),a=i>0,s=n>0;if(!(!a&&!s)){if(a||(i=n,n=0),n>i){var o=i;i=n,n=o}var f=r.startAngle,u=r.endAngle;if(!(isNaN(f)||isNaN(u))){var h=r.cx,l=r.cy,c=!!r.clockwise,v=Fu(u-f),d=v>ks&&v%ks;if(d>mr&&(v=d),!(i>mr))t.moveTo(h,l);else if(v>ks-mr)t.moveTo(h+i*oi(f),l+i*Ae(f)),t.arc(h,l,i,f,u,!c),n>mr&&(t.moveTo(h+n*oi(u),l+n*Ae(u)),t.arc(h,l,n,u,f,c));else{var _=void 0,p=void 0,y=void 0,g=void 0,m=void 0,T=void 0,w=void 0,x=void 0,E=void 0,S=void 0,M=void 0,C=void 0,R=void 0,L=void 0,D=void 0,P=void 0,z=i*oi(f),A=i*Ae(f),B=n*oi(u),k=n*Ae(u),j=v>mr;if(j){var $=r.cornerRadius;$&&(e=q0($),_=e[0],p=e[1],y=e[2],g=e[3]);var rt=Fu(i-n)/2;if(m=Ir(rt,y),T=Ir(rt,g),w=Ir(rt,_),x=Ir(rt,p),M=E=hn(m,T),C=S=hn(w,x),(E>mr||S>mr)&&(R=i*oi(u),L=i*Ae(u),D=n*oi(f),P=n*Ae(f),v<Sc)){var Q=V0(z,A,D,P,R,L,B,k);if(Q){var st=z-Q[0],et=A-Q[1],pt=R-Q[0],At=L-Q[1],Kt=1/Ae(W0((st*pt+et*At)/(_n(st*st+et*et)*_n(pt*pt+At*At)))/2),G=_n(Q[0]*Q[0]+Q[1]*Q[1]);M=Ir(E,(i-G)/(Kt+1)),C=Ir(S,(n-G)/(Kt-1))}}}if(!j)t.moveTo(h+z,l+A);else if(M>mr){var X=Ir(y,M),K=Ir(g,M),W=ta(D,P,z,A,i,X,c),Y=ta(R,L,B,k,i,K,c);t.moveTo(h+W.cx+W.x0,l+W.cy+W.y0),M<E&&X===K?t.arc(h+W.cx,l+W.cy,M,kt(W.y0,W.x0),kt(Y.y0,Y.x0),!c):(X>0&&t.arc(h+W.cx,l+W.cy,X,kt(W.y0,W.x0),kt(W.y1,W.x1),!c),t.arc(h,l,i,kt(W.cy+W.y1,W.cx+W.x1),kt(Y.cy+Y.y1,Y.cx+Y.x1),!c),K>0&&t.arc(h+Y.cx,l+Y.cy,K,kt(Y.y1,Y.x1),kt(Y.y0,Y.x0),!c))}else t.moveTo(h+z,l+A),t.arc(h,l,i,f,u,!c);if(!(n>mr)||!j)t.lineTo(h+B,l+k);else if(C>mr){var X=Ir(_,C),K=Ir(p,C),W=ta(B,k,R,L,n,-K,c),Y=ta(z,A,D,P,n,-X,c);t.lineTo(h+W.cx+W.x0,l+W.cy+W.y0),C<S&&X===K?t.arc(h+W.cx,l+W.cy,C,kt(W.y0,W.x0),kt(Y.y0,Y.x0),!c):(K>0&&t.arc(h+W.cx,l+W.cy,K,kt(W.y0,W.x0),kt(W.y1,W.x1),!c),t.arc(h,l,n,kt(W.cy+W.y1,W.cx+W.x1),kt(Y.cy+Y.y1,Y.cx+Y.x1),c),X>0&&t.arc(h+Y.cx,l+Y.cy,X,kt(Y.y1,Y.x1),kt(Y.y0,Y.x0),!c))}else t.lineTo(h+B,l+k),t.arc(h,l,n,u,f,c)}t.closePath()}}}var Y0=(function(){function t(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0,this.cornerRadius=0}return t})(),Go=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultShape=function(){return new Y0},r.prototype.buildPath=function(e,i){X0(e,i)},r.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},r})(Dt);Go.prototype.type="sector";var Z0=(function(){function t(){this.cx=0,this.cy=0,this.r=0,this.r0=0}return t})(),j0=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultShape=function(){return new Z0},r.prototype.buildPath=function(e,i){var n=i.cx,a=i.cy,s=Math.PI*2;e.moveTo(n+i.r,a),e.arc(n,a,i.r,0,s,!1),e.moveTo(n+i.r0,a),e.arc(n,a,i.r0,0,s,!0)},r})(Dt);j0.prototype.type="ring";function $0(t,r,e,i){var n=[],a=[],s=[],o=[],f,u,h,l;if(i){h=[1/0,1/0],l=[-1/0,-1/0];for(var c=0,v=t.length;c<v;c++)He(h,h,t[c]),ze(l,l,t[c]);He(h,h,i[0]),ze(l,l,i[1])}for(var c=0,v=t.length;c<v;c++){var d=t[c];if(e)f=t[c?c-1:v-1],u=t[(c+1)%v];else if(c===0||c===v-1){n.push(Cl(t[c]));continue}else f=t[c-1],u=t[c+1];Pl(a,u,f),va(a,a,r);var _=Aa(d,f),p=Aa(d,u),y=_+p;y!==0&&(_/=y,p/=y),va(s,a,-_),va(o,a,p);var g=xo([],d,s),m=xo([],d,o);i&&(ze(g,g,h),He(g,g,l),ze(m,m,h),He(m,m,l)),n.push(g),n.push(m)}return e&&n.push(n.shift()),n}function Mc(t,r,e){var i=r.smooth,n=r.points;if(n&&n.length>=2){if(i){var a=$0(n,i,e,r.smoothConstraint);t.moveTo(n[0][0],n[0][1]);for(var s=n.length,o=0;o<(e?s:s-1);o++){var f=a[o*2],u=a[o*2+1],h=n[(o+1)%s];t.bezierCurveTo(f[0],f[1],u[0],u[1],h[0],h[1])}}else{t.moveTo(n[0][0],n[0][1]);for(var o=1,l=n.length;o<l;o++)t.lineTo(n[o][0],n[o][1])}e&&t.closePath()}}var K0=(function(){function t(){this.points=null,this.smooth=0,this.smoothConstraint=null}return t})(),Tf=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultShape=function(){return new K0},r.prototype.buildPath=function(e,i){Mc(e,i,!0)},r})(Dt);Tf.prototype.type="polygon";var Q0=(function(){function t(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null}return t})(),Ac=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},r.prototype.getDefaultShape=function(){return new Q0},r.prototype.buildPath=function(e,i){Mc(e,i,!1)},r})(Dt);Ac.prototype.type="polyline";var J0={},t_=(function(){function t(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return t})(),Rc=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},r.prototype.getDefaultShape=function(){return new t_},r.prototype.buildPath=function(e,i){var n,a,s,o;if(this.subPixelOptimize){var f=M0(J0,i,this.style);n=f.x1,a=f.y1,s=f.x2,o=f.y2}else n=i.x1,a=i.y1,s=i.x2,o=i.y2;var u=i.percent;u!==0&&(e.moveTo(n,a),u<1&&(s=n*(1-u)+s*u,o=a*(1-u)+o*u),e.lineTo(s,o))},r.prototype.pointAt=function(e){var i=this.shape;return[i.x1*(1-e)+i.x2*e,i.y1*(1-e)+i.y2*e]},r})(Dt);Rc.prototype.type="line";var Jt=[],r_=(function(){function t(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1}return t})();function Bu(t,r,e){var i=t.cpx2,n=t.cpy2;return i!=null||n!=null?[(e?ru:Ut)(t.x1,t.cpx1,t.cpx2,t.x2,r),(e?ru:Ut)(t.y1,t.cpy1,t.cpy2,t.y2,r)]:[(e?eu:Gt)(t.x1,t.cpx1,t.x2,r),(e?eu:Gt)(t.y1,t.cpy1,t.y2,r)]}var e_=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},r.prototype.getDefaultShape=function(){return new r_},r.prototype.buildPath=function(e,i){var n=i.x1,a=i.y1,s=i.x2,o=i.y2,f=i.cpx1,u=i.cpy1,h=i.cpx2,l=i.cpy2,c=i.percent;c!==0&&(e.moveTo(n,a),h==null||l==null?(c<1&&(La(n,f,s,c,Jt),f=Jt[1],s=Jt[2],La(a,u,o,c,Jt),u=Jt[1],o=Jt[2]),e.quadraticCurveTo(f,u,s,o)):(c<1&&(ve(n,f,h,s,c,Jt),f=Jt[1],h=Jt[2],s=Jt[3],ve(a,u,l,o,c,Jt),u=Jt[1],l=Jt[2],o=Jt[3]),e.bezierCurveTo(f,u,h,l,s,o)))},r.prototype.pointAt=function(e){return Bu(this.shape,e,!1)},r.prototype.tangentAt=function(e){var i=Bu(this.shape,e,!0);return Ll(i,i)},r})(Dt);e_.prototype.type="bezier-curve";var i_=(function(){function t(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return t})(),n_=(function(t){yt(r,t);function r(e){return t.call(this,e)||this}return r.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},r.prototype.getDefaultShape=function(){return new i_},r.prototype.buildPath=function(e,i){var n=i.cx,a=i.cy,s=Math.max(i.r,0),o=i.startAngle,f=i.endAngle,u=i.clockwise,h=Math.cos(o),l=Math.sin(o);e.moveTo(h*s+n,l*s+a),e.arc(n,a,s,o,f,!u)},r})(Dt);n_.prototype.type="arc";var a_=(function(t){yt(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;return e.type="compound",e}return r.prototype._updatePathDirty=function(){for(var e=this.shape.paths,i=this.shapeChanged(),n=0;n<e.length;n++)i=i||e[n].shapeChanged();i&&this.dirtyShape()},r.prototype.beforeBrush=function(){this._updatePathDirty();for(var e=this.shape.paths||[],i=this.getGlobalScale(),n=0;n<e.length;n++)e[n].path||e[n].createPathProxy(),e[n].path.setScale(i[0],i[1],e[n].segmentIgnoreThreshold)},r.prototype.buildPath=function(e,i){for(var n=i.paths||[],a=0;a<n.length;a++)n[a].buildPath(e,n[a].shape,!0)},r.prototype.afterBrush=function(){for(var e=this.shape.paths||[],i=0;i<e.length;i++)e[i].pathUpdated()},r.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),Dt.prototype.getBoundingRect.call(this)},r})(Dt),Cc=(function(){function t(r){this.colorStops=r||[]}return t.prototype.addColorStop=function(r,e){this.colorStops.push({offset:r,color:e})},t})(),s_=(function(t){yt(r,t);function r(e,i,n,a,s,o){var f=t.call(this,s)||this;return f.x=e??0,f.y=i??0,f.x2=n??1,f.y2=a??0,f.type="linear",f.global=o||!1,f}return r})(Cc),o_=(function(t){yt(r,t);function r(e,i,n,a,s){var o=t.call(this,a)||this;return o.x=e??.5,o.y=i??.5,o.r=n??.5,o.type="radial",o.global=s||!1,o}return r})(Cc),Re=[0,0],Ce=[0,0],ra=new ut,ea=new ut,Qg=(function(){function t(r,e){this._corners=[],this._axes=[],this._origin=[0,0];for(var i=0;i<4;i++)this._corners[i]=new ut;for(var i=0;i<2;i++)this._axes[i]=new ut;r&&this.fromBoundingRect(r,e)}return t.prototype.fromBoundingRect=function(r,e){var i=this._corners,n=this._axes,a=r.x,s=r.y,o=a+r.width,f=s+r.height;if(i[0].set(a,s),i[1].set(o,s),i[2].set(o,f),i[3].set(a,f),e)for(var u=0;u<4;u++)i[u].transform(e);ut.sub(n[0],i[1],i[0]),ut.sub(n[1],i[3],i[0]),n[0].normalize(),n[1].normalize();for(var u=0;u<2;u++)this._origin[u]=n[u].dot(i[0])},t.prototype.intersect=function(r,e){var i=!0,n=!e;return ra.set(1/0,1/0),ea.set(0,0),!this._intersectCheckOneSide(this,r,ra,ea,n,1)&&(i=!1,n)||!this._intersectCheckOneSide(r,this,ra,ea,n,-1)&&(i=!1,n)||n||ut.copy(e,i?ra:ea),i},t.prototype._intersectCheckOneSide=function(r,e,i,n,a,s){for(var o=!0,f=0;f<2;f++){var u=this._axes[f];if(this._getProjMinMaxOnAxis(f,r._corners,Re),this._getProjMinMaxOnAxis(f,e._corners,Ce),Re[1]<Ce[0]||Re[0]>Ce[1]){if(o=!1,a)return o;var h=Math.abs(Ce[0]-Re[1]),l=Math.abs(Re[0]-Ce[1]);Math.min(h,l)>n.len()&&(h<l?ut.scale(n,u,-h*s):ut.scale(n,u,l*s))}else if(i){var h=Math.abs(Ce[0]-Re[1]),l=Math.abs(Re[0]-Ce[1]);Math.min(h,l)<i.len()&&(h<l?ut.scale(i,u,h*s):ut.scale(i,u,-l*s))}}return o},t.prototype._getProjMinMaxOnAxis=function(r,e,i){for(var n=this._axes[r],a=this._origin,s=e[0].dot(n)+a[r],o=s,f=s,u=1;u<e.length;u++){var h=e[u].dot(n)+a[r];o=Math.min(h,o),f=Math.max(h,f)}i[0]=o,i[1]=f},t})(),f_=[],Jg=(function(t){yt(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;return e.notClear=!0,e.incremental=!0,e._displayables=[],e._temporaryDisplayables=[],e._cursor=0,e}return r.prototype.traverse=function(e,i){e.call(i,this)},r.prototype.useStyle=function(){this.style={}},r.prototype.getCursor=function(){return this._cursor},r.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},r.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},r.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},r.prototype.addDisplayable=function(e,i){i?this._temporaryDisplayables.push(e):this._displayables.push(e),this.markRedraw()},r.prototype.addDisplayables=function(e,i){i=i||!1;for(var n=0;n<e.length;n++)this.addDisplayable(e[n],i)},r.prototype.getDisplayables=function(){return this._displayables},r.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},r.prototype.eachPendingDisplayable=function(e){for(var i=this._cursor;i<this._displayables.length;i++)e&&e(this._displayables[i]);for(var i=0;i<this._temporaryDisplayables.length;i++)e&&e(this._temporaryDisplayables[i])},r.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){var i=this._displayables[e];i.parent=this,i.update(),i.parent=null}for(var e=0;e<this._temporaryDisplayables.length;e++){var i=this._temporaryDisplayables[e];i.parent=this,i.update(),i.parent=null}},r.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new Mt(1/0,1/0,-1/0,-1/0),i=0;i<this._displayables.length;i++){var n=this._displayables[i],a=n.getBoundingRect().clone();n.needLocalTransform()&&a.applyTransform(n.getLocalTransform(f_)),e.union(a)}this._rect=e}return this._rect},r.prototype.contain=function(e,i){var n=this.transformCoordToLocal(e,i),a=this.getBoundingRect();if(a.contain(n[0],n[1]))for(var s=0;s<this._displayables.length;s++){var o=this._displayables[s];if(o.contain(e,i))return!0}return!1},r})(In),u_=Math.round(Math.random()*9),h_=typeof Object.defineProperty=="function",tm=(function(){function t(){this._id="__ec_inner_"+u_++}return t.prototype.get=function(r){return this._guard(r)[this._id]},t.prototype.set=function(r,e){var i=this._guard(r);return h_?Object.defineProperty(i,this._id,{value:e,enumerable:!1,configurable:!0}):i[this._id]=e,this},t.prototype.delete=function(r){return this.has(r)?(delete this._guard(r)[this._id],!0):!1},t.prototype.has=function(r){return!!this._guard(r)[this._id]},t.prototype._guard=function(r){if(r!==Object(r))throw TypeError("Value of WeakMap is not a non-null object.");return r},t})();function Ge(t){return isFinite(t)}function l_(t,r,e){var i=r.x==null?0:r.x,n=r.x2==null?1:r.x2,a=r.y==null?0:r.y,s=r.y2==null?0:r.y2;r.global||(i=i*e.width+e.x,n=n*e.width+e.x,a=a*e.height+e.y,s=s*e.height+e.y),i=Ge(i)?i:0,n=Ge(n)?n:1,a=Ge(a)?a:0,s=Ge(s)?s:0;var o=t.createLinearGradient(i,a,n,s);return o}function c_(t,r,e){var i=e.width,n=e.height,a=Math.min(i,n),s=r.x==null?.5:r.x,o=r.y==null?.5:r.y,f=r.r==null?.5:r.r;r.global||(s=s*i+e.x,o=o*n+e.y,f=f*a),s=Ge(s)?s:.5,o=Ge(o)?o:.5,f=f>=0&&Ge(f)?f:.5;var u=t.createRadialGradient(s,o,0,s,o,f);return u}function Wo(t,r,e){for(var i=r.type==="radial"?c_(t,r,e):l_(t,r,e),n=r.colorStops,a=0;a<n.length;a++)i.addColorStop(n[a].offset,n[a].color);return i}function v_(t,r){if(t===r||!t&&!r)return!1;if(!t||!r||t.length!==r.length)return!0;for(var e=0;e<t.length;e++)if(t[e]!==r[e])return!0;return!1}function ia(t){return parseInt(t,10)}function Ei(t,r,e){var i=["width","height"][r],n=["clientWidth","clientHeight"][r],a=["paddingLeft","paddingTop"][r],s=["paddingRight","paddingBottom"][r];if(e[i]!=null&&e[i]!=="auto")return parseFloat(e[i]);var o=document.defaultView.getComputedStyle(t);return(t[n]||ia(o[i])||ia(t.style[i]))-(ia(o[a])||0)-(ia(o[s])||0)|0}function d_(t,r){return!t||t==="solid"||!(r>0)?null:t==="dashed"?[4*r,2*r]:t==="dotted"?[r]:Mi(t)?[t]:$e(t)?t:null}function xf(t){var r=t.style,e=r.lineDash&&r.lineWidth>0&&d_(r.lineDash,r.lineWidth),i=r.lineDashOffset;if(e){var n=r.strokeNoScale&&t.getLineScale?t.getLineScale():1;n&&n!==1&&(e=Lt(e,function(a){return a/n}),i/=n)}return[e,i]}var p_=new de(!0);function Na(t){var r=t.stroke;return!(r==null||r==="none"||!(t.lineWidth>0))}function Uu(t){return typeof t=="string"&&t!=="none"}function Fa(t){var r=t.fill;return r!=null&&r!=="none"}function Hu(t,r){if(r.fillOpacity!=null&&r.fillOpacity!==1){var e=t.globalAlpha;t.globalAlpha=r.fillOpacity*r.opacity,t.fill(),t.globalAlpha=e}else t.fill()}function zu(t,r){if(r.strokeOpacity!=null&&r.strokeOpacity!==1){var e=t.globalAlpha;t.globalAlpha=r.strokeOpacity*r.opacity,t.stroke(),t.globalAlpha=e}else t.stroke()}function Vo(t,r,e){var i=mf(r.image,r.__image,e);if(Qa(i)){var n=t.createPattern(i,r.repeat||"repeat");if(typeof DOMMatrix=="function"&&n&&n.setTransform){var a=new DOMMatrix;a.translateSelf(r.x||0,r.y||0),a.rotateSelf(0,0,(r.rotation||0)*dn),a.scaleSelf(r.scaleX||1,r.scaleY||1),n.setTransform(a)}return n}}function __(t,r,e,i){var n,a=Na(e),s=Fa(e),o=e.strokePercent,f=o<1,u=!r.path;(!r.silent||f)&&u&&r.createPathProxy();var h=r.path||p_,l=r.__dirty;if(!i){var c=e.fill,v=e.stroke,d=s&&!!c.colorStops,_=a&&!!v.colorStops,p=s&&!!c.image,y=a&&!!v.image,g=void 0,m=void 0,T=void 0,w=void 0,x=void 0;(d||_)&&(x=r.getBoundingRect()),d&&(g=l?Wo(t,c,x):r.__canvasFillGradient,r.__canvasFillGradient=g),_&&(m=l?Wo(t,v,x):r.__canvasStrokeGradient,r.__canvasStrokeGradient=m),p&&(T=l||!r.__canvasFillPattern?Vo(t,c,r):r.__canvasFillPattern,r.__canvasFillPattern=T),y&&(w=l||!r.__canvasStrokePattern?Vo(t,v,r):r.__canvasStrokePattern,r.__canvasStrokePattern=T),d?t.fillStyle=g:p&&(T?t.fillStyle=T:s=!1),_?t.strokeStyle=m:y&&(w?t.strokeStyle=w:a=!1)}var E=r.getGlobalScale();h.setScale(E[0],E[1],r.segmentIgnoreThreshold);var S,M;t.setLineDash&&e.lineDash&&(n=xf(r),S=n[0],M=n[1]);var C=!0;(u||l&yi)&&(h.setDPR(t.dpr),f?h.setContext(null):(h.setContext(t),C=!1),h.reset(),r.buildPath(h,r.shape,i),h.toStatic(),r.pathUpdated()),C&&h.rebuildPath(t,f?o:1),S&&(t.setLineDash(S),t.lineDashOffset=M),i||(e.strokeFirst?(a&&zu(t,e),s&&Hu(t,e)):(s&&Hu(t,e),a&&zu(t,e))),S&&t.setLineDash([])}function y_(t,r,e){var i=r.__image=mf(e.image,r.__image,r,r.onload);if(!(!i||!Qa(i))){var n=e.x||0,a=e.y||0,s=r.getWidth(),o=r.getHeight(),f=i.width/i.height;if(s==null&&o!=null?s=o*f:o==null&&s!=null?o=s/f:s==null&&o==null&&(s=i.width,o=i.height),e.sWidth&&e.sHeight){var u=e.sx||0,h=e.sy||0;t.drawImage(i,u,h,e.sWidth,e.sHeight,n,a,s,o)}else if(e.sx&&e.sy){var u=e.sx,h=e.sy,l=s-u,c=o-h;t.drawImage(i,u,h,l,c,n,a,s,o)}else t.drawImage(i,n,a,s,o)}}function g_(t,r,e){var i,n=e.text;if(n!=null&&(n+=""),n){t.font=e.font||le,t.textAlign=e.textAlign,t.textBaseline=e.textBaseline;var a=void 0,s=void 0;t.setLineDash&&e.lineDash&&(i=xf(r),a=i[0],s=i[1]),a&&(t.setLineDash(a),t.lineDashOffset=s),e.strokeFirst?(Na(e)&&t.strokeText(n,e.x,e.y),Fa(e)&&t.fillText(n,e.x,e.y)):(Fa(e)&&t.fillText(n,e.x,e.y),Na(e)&&t.strokeText(n,e.x,e.y)),a&&t.setLineDash([])}}var ku=["shadowBlur","shadowOffsetX","shadowOffsetY"],Gu=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function Pc(t,r,e,i,n){var a=!1;if(!i&&(e=e||{},r===e))return!1;if(i||r.opacity!==e.opacity){er(t,n),a=!0;var s=Math.max(Math.min(r.opacity,1),0);t.globalAlpha=isNaN(s)?Ze.opacity:s}(i||r.blend!==e.blend)&&(a||(er(t,n),a=!0),t.globalCompositeOperation=r.blend||Ze.blend);for(var o=0;o<ku.length;o++){var f=ku[o];(i||r[f]!==e[f])&&(a||(er(t,n),a=!0),t[f]=t.dpr*(r[f]||0))}return(i||r.shadowColor!==e.shadowColor)&&(a||(er(t,n),a=!0),t.shadowColor=r.shadowColor||Ze.shadowColor),a}function Wu(t,r,e,i,n){var a=Mn(r,n.inHover),s=i?null:e&&Mn(e,n.inHover)||{};if(a===s)return!1;var o=Pc(t,a,s,i,n);if((i||a.fill!==s.fill)&&(o||(er(t,n),o=!0),Uu(a.fill)&&(t.fillStyle=a.fill)),(i||a.stroke!==s.stroke)&&(o||(er(t,n),o=!0),Uu(a.stroke)&&(t.strokeStyle=a.stroke)),(i||a.opacity!==s.opacity)&&(o||(er(t,n),o=!0),t.globalAlpha=a.opacity==null?1:a.opacity),r.hasStroke()){var f=a.lineWidth,u=f/(a.strokeNoScale&&r.getLineScale?r.getLineScale():1);t.lineWidth!==u&&(o||(er(t,n),o=!0),t.lineWidth=u)}for(var h=0;h<Gu.length;h++){var l=Gu[h],c=l[0];(i||a[c]!==s[c])&&(o||(er(t,n),o=!0),t[c]=a[c]||l[1])}return o}function m_(t,r,e,i,n){return Pc(t,Mn(r,n.inHover),e&&Mn(e,n.inHover),i,n)}function Lc(t,r){var e=r.transform,i=t.dpr||1;e?t.setTransform(i*e[0],i*e[1],i*e[2],i*e[3],i*e[4],i*e[5]):t.setTransform(i,0,0,i,0,0)}function T_(t,r,e){for(var i=!1,n=0;n<t.length;n++){var a=t[n];i=i||a.isZeroArea(),Lc(r,a),r.beginPath(),a.buildPath(r,a.shape),r.clip()}e.allClipped=i}function x_(t,r){return t&&r?t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||t[4]!==r[4]||t[5]!==r[5]:!(!t&&!r)}var Vu=1,qu=2,Xu=3,Yu=4;function w_(t){var r=Fa(t),e=Na(t);return!(t.lineDash||!(+r^+e)||r&&typeof t.fill!="string"||e&&typeof t.stroke!="string"||t.strokePercent<1||t.strokeOpacity<1||t.fillOpacity<1)}function er(t,r){r.batchFill&&t.fill(),r.batchStroke&&t.stroke(),r.batchFill="",r.batchStroke=""}function Mn(t,r){return r&&t.__hoverStyle||t.style}function E_(t,r){We(t,r,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function We(t,r,e,i){var n=r.transform;if(!r.shouldBePainted(e.viewWidth,e.viewHeight,!1,!1)){r.__dirty&=~or,r.__isRendered=!1;return}var a=r.__clipPaths,s=e.prevElClipPaths,o=!1,f=!1;if((!s||v_(a,s))&&(s&&s.length&&(er(t,e),t.restore(),f=o=!0,e.prevElClipPaths=null,e.allClipped=!1,e.prevEl=null),a&&a.length&&(er(t,e),t.save(),T_(a,t,e),o=!0),e.prevElClipPaths=a),e.allClipped){r.__isRendered=!1;return}r.beforeBrush&&r.beforeBrush(),r.innerBeforeBrush();var u=e.prevEl;u||(f=o=!0);var h=r instanceof Dt&&r.autoBatch&&w_(r.style);o||x_(n,u.transform)?(er(t,e),Lc(t,r)):h||er(t,e);var l=Mn(r,e.inHover);r instanceof Dt?(e.lastDrawType!==Vu&&(f=!0,e.lastDrawType=Vu),Wu(t,r,u,f,e),(!h||!e.batchFill&&!e.batchStroke)&&t.beginPath(),__(t,r,l,h),h&&(e.batchFill=l.fill||"",e.batchStroke=l.stroke||"")):r instanceof Oi?(e.lastDrawType!==Xu&&(f=!0,e.lastDrawType=Xu),Wu(t,r,u,f,e),g_(t,r,l)):r instanceof ki?(e.lastDrawType!==qu&&(f=!0,e.lastDrawType=qu),m_(t,r,u,f,e),y_(t,r,l)):r.getTemporalDisplayables&&(e.lastDrawType!==Yu&&(f=!0,e.lastDrawType=Yu),b_(t,r,e)),h&&i&&er(t,e),r.innerAfterBrush(),r.afterBrush&&r.afterBrush(),e.prevEl=r,r.__dirty=0,r.__isRendered=!0}function b_(t,r,e){var i=r.getDisplayables(),n=r.getTemporalDisplayables();t.save();var a={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:e.viewWidth,viewHeight:e.viewHeight,inHover:e.inHover},s,o;for(s=r.getCursor(),o=i.length;s<o;s++){var f=i[s];f.beforeBrush&&f.beforeBrush(),f.innerBeforeBrush(),We(t,f,a,s===o-1),f.innerAfterBrush(),f.afterBrush&&f.afterBrush(),a.prevEl=f}for(var u=0,h=n.length;u<h;u++){var f=n[u];f.beforeBrush&&f.beforeBrush(),f.innerBeforeBrush(),We(t,f,a,u===h-1),f.innerAfterBrush(),f.afterBrush&&f.afterBrush(),a.prevEl=f}r.clearTemporalDisplayables(),r.notClear=!0,t.restore()}var S_=1e-8;function Zu(t,r){return Math.abs(t-r)<S_}function rm(t,r,e){var i=0,n=t[0];if(!n)return!1;for(var a=1;a<t.length;a++){var s=t[a];i+=Yr(n[0],n[1],s[0],s[1],r,e),n=s}var o=t[0];return(!Zu(n[0],o[0])||!Zu(n[1],o[1]))&&(i+=Yr(n[0],n[1],o[0],o[1],r,e)),i!==0}var Gs=Math.sin,Ws=Math.cos,Dc=Math.PI,Pe=Math.PI*2,M_=180/Dc,Oc=(function(){function t(){}return t.prototype.reset=function(r){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,r||4)},t.prototype.moveTo=function(r,e){this._add("M",r,e)},t.prototype.lineTo=function(r,e){this._add("L",r,e)},t.prototype.bezierCurveTo=function(r,e,i,n,a,s){this._add("C",r,e,i,n,a,s)},t.prototype.quadraticCurveTo=function(r,e,i,n){this._add("Q",r,e,i,n)},t.prototype.arc=function(r,e,i,n,a,s){this.ellipse(r,e,i,i,0,n,a,s)},t.prototype.ellipse=function(r,e,i,n,a,s,o,f){var u=o-s,h=!f,l=Math.abs(u),c=ae(l-Pe)||(h?u>=Pe:-u>=Pe),v=u>0?u%Pe:u%Pe+Pe,d=!1;c?d=!0:ae(l)?d=!1:d=v>=Dc==!!h;var _=r+i*Ws(s),p=e+n*Gs(s);this._start&&this._add("M",_,p);var y=Math.round(a*M_);if(c){var g=1/this._p,m=(h?1:-1)*(Pe-g);this._add("A",i,n,y,1,+h,r+i*Ws(s+m),e+n*Gs(s+m)),g>.01&&this._add("A",i,n,y,0,+h,_,p)}else{var T=r+i*Ws(o),w=e+n*Gs(o);this._add("A",i,n,y,+d,+h,T,w)}},t.prototype.rect=function(r,e,i,n){this._add("M",r,e),this._add("l",i,0),this._add("l",0,n),this._add("l",-i,0),this._add("Z")},t.prototype.closePath=function(){this._d.length>0&&this._add("Z")},t.prototype._add=function(r,e,i,n,a,s,o,f,u){for(var h=[],l=this._p,c=1;c<arguments.length;c++){var v=arguments[c];if(isNaN(v)){this._invalid=!0;return}h.push(Math.round(v*l)/l)}this._d.push(r+h.join(" ")),this._start=r==="Z"},t.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(""),this._d=[]},t.prototype.getStr=function(){return this._str},t})(),wf="none",A_=Math.round;function R_(t){var r=t.fill;return r!=null&&r!==wf}function C_(t){var r=t.stroke;return r!=null&&r!==wf}var qo=["lineCap","miterLimit","lineJoin"],P_=Lt(qo,function(t){return"stroke-"+t.toLowerCase()});function L_(t,r,e,i){var n=r.opacity==null?1:r.opacity;if(e instanceof ki){t("opacity",n);return}if(R_(r)){var a=wn(r.fill);t("fill",a.color);var s=r.fillOpacity!=null?r.fillOpacity*a.opacity*n:a.opacity*n;s<1&&t("fill-opacity",s)}else t("fill",wf);if(C_(r)){var o=wn(r.stroke);t("stroke",o.color);var f=r.strokeNoScale?e.getLineScale():1,u=f?(r.lineWidth||0)/f:0,h=r.strokeOpacity!=null?r.strokeOpacity*o.opacity*n:o.opacity*n,l=r.strokeFirst;if(u!==1&&t("stroke-width",u),l&&t("paint-order",l?"stroke":"fill"),h<1&&t("stroke-opacity",h),r.lineDash){var c=xf(e),v=c[0],d=c[1];v&&(d=A_(d||0),t("stroke-dasharray",v.join(",")),(d||i)&&t("stroke-dashoffset",d))}for(var _=0;_<qo.length;_++){var p=qo[_];if(r[p]!==Ia[p]){var y=r[p]||Ia[p];y&&t(P_[_],y)}}}}var Ic="http://www.w3.org/2000/svg",Nc="http://www.w3.org/1999/xlink",D_="http://www.w3.org/2000/xmlns/",O_="http://www.w3.org/XML/1998/namespace",ju="ecmeta_";function Fc(t){return document.createElementNS(Ic,t)}function Ot(t,r,e,i,n){return{tag:t,attrs:e||{},children:i,text:n,key:r}}function I_(t,r){var e=[];if(r)for(var i in r){var n=r[i],a=i;n!==!1&&(n!==!0&&n!=null&&(a+='="'+n+'"'),e.push(a))}return"<"+t+" "+e.join(" ")+">"}function N_(t){return"</"+t+">"}function Ef(t,r){r=r||{};var e=r.newline?`
`:"";function i(n){var a=n.children,s=n.tag,o=n.attrs,f=n.text;return I_(s,o)+(s!=="style"?Ad(f):f||"")+(a?""+e+Lt(a,function(u){return i(u)}).join(e)+e:"")+N_(s)}return i(t)}function F_(t,r,e){e=e||{};var i=e.newline?`
`:"",n=" {"+i,a=i+"}",s=Lt(wt(t),function(f){return f+n+Lt(wt(t[f]),function(u){return u+":"+t[f][u]+";"}).join(i)+a}).join(i),o=Lt(wt(r),function(f){return"@keyframes "+f+n+Lt(wt(r[f]),function(u){return u+n+Lt(wt(r[f][u]),function(h){var l=r[f][u][h];return h==="d"&&(l='path("'+l+'")'),h+":"+l+";"}).join(i)+a}).join(i)+a}).join(i);return!s&&!o?"":["<![CDATA[",s,o,"]]>"].join(i)}function Xo(t){return{zrId:t,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssStyleCache:{},cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function $u(t,r,e,i){return Ot("svg","root",{width:t,height:r,xmlns:Ic,"xmlns:xlink":Nc,version:"1.1",baseProfile:"full",viewBox:i?"0 0 "+t+" "+r:!1},e)}var B_=0;function Bc(){return B_++}var Ku={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Ie="transform-origin";function U_(t,r,e){var i=dt({},t.shape);dt(i,r),t.buildPath(e,i);var n=new Oc;return n.reset(ec(t)),e.rebuildPath(n,1),n.generateStr(),n.getStr()}function H_(t,r){var e=r.originX,i=r.originY;(e||i)&&(t[Ie]=e+"px "+i+"px")}var z_={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function Uc(t,r){var e=r.zrId+"-ani-"+r.cssAnimIdx++;return r.cssAnims[e]=t,e}function k_(t,r,e){var i=t.shape.paths,n={},a,s;if(zt(i,function(f){var u=Xo(e.zrId);u.animation=!0,ts(f,{},u,!0);var h=u.cssAnims,l=u.cssNodes,c=wt(h),v=c.length;if(v){s=c[v-1];var d=h[s];for(var _ in d){var p=d[_];n[_]=n[_]||{d:""},n[_].d+=p.d||""}for(var y in l){var g=l[y].animation;g.indexOf(s)>=0&&(a=g)}}}),!!a){r.d=!1;var o=Uc(n,e);return a.replace(s,o)}}function Qu(t){return Ar(t)?Ku[t]?"cubic-bezier("+Ku[t]+")":pf(t)?t:"":""}function ts(t,r,e,i){var n=t.animators,a=n.length,s=[];if(t instanceof a_){var o=k_(t,r,e);if(o)s.push(o);else if(!a)return}else if(!a)return;for(var f={},u=0;u<a;u++){var h=n[u],l=[h.getMaxTime()/1e3+"s"],c=Qu(h.getClip().easing),v=h.getDelay();c?l.push(c):l.push("linear"),v&&l.push(v/1e3+"s"),h.getLoop()&&l.push("infinite");var d=l.join(" ");f[d]=f[d]||[d,[]],f[d][1].push(h)}function _(g){var m=g[1],T=m.length,w={},x={},E={},S="animation-timing-function";function M(G,X,K){for(var W=G.getTracks(),Y=G.getMaxTime(),lt=0;lt<W.length;lt++){var ot=W[lt];if(ot.needsAnimate()){var qt=ot.keyframes,gt=ot.propName;if(K&&(gt=K(gt)),gt)for(var Qt=0;Qt<qt.length;Qt++){var _t=qt[Qt],mt=Math.round(_t.time/Y*100)+"%",ar=Qu(_t.easing),Gi=_t.rawValue;(Ar(Gi)||Mi(Gi))&&(X[mt]=X[mt]||{},X[mt][gt]=_t.rawValue,ar&&(X[mt][S]=ar))}}}}for(var C=0;C<T;C++){var R=m[C],L=R.targetName;L?L==="shape"&&M(R,x):!i&&M(R,w)}for(var D in w){var P={};oc(P,t),dt(P,w[D]);var z=ic(P),A=w[D][S];E[D]=z?{transform:z}:{},H_(E[D],P),A&&(E[D][S]=A)}var B,k=!0;for(var D in x){E[D]=E[D]||{};var j=!B,A=x[D][S];j&&(B=new de);var $=B.len();B.reset(),E[D].d=U_(t,x[D],B);var rt=B.len();if(!j&&$!==rt){k=!1;break}A&&(E[D][S]=A)}if(!k)for(var D in E)delete E[D].d;if(!i)for(var C=0;C<T;C++){var R=m[C],L=R.targetName;L==="style"&&M(R,E,function(W){return z_[W]})}for(var Q=wt(E),st=!0,et,C=1;C<Q.length;C++){var pt=Q[C-1],At=Q[C];if(E[pt][Ie]!==E[At][Ie]){st=!1;break}et=E[pt][Ie]}if(st&&et){for(var D in E)E[D][Ie]&&delete E[D][Ie];r[Ie]=et}if(Sa(Q,function(G){return wt(E[G]).length>0}).length){var Kt=Uc(E,e);return Kt+" "+g[0]+" both"}}for(var p in f){var o=_(f[p]);o&&s.push(o)}if(s.length){var y=e.zrId+"-cls-"+Bc();e.cssNodes["."+y]={animation:s.join(",")},r.class=y}}function G_(t,r,e){if(!t.ignore)if(t.isSilent()){var i={"pointer-events":"none"};Ju(i,r,e)}else{var n=t.states.emphasis&&t.states.emphasis.style?t.states.emphasis.style:{},a=n.fill;if(!a){var s=t.style&&t.style.fill,o=t.states.select&&t.states.select.style&&t.states.select.style.fill,f=t.currentStates.indexOf("select")>=0&&o||s;f&&(a=Kl(f))}var u=n.lineWidth;if(u){var h=!n.strokeNoScale&&t.transform?t.transform[0]:1;u=u/h}var i={cursor:"pointer"};a&&(i.fill=a),n.stroke&&(i.stroke=n.stroke),u&&(i["stroke-width"]=u),Ju(i,r,e)}}function Ju(t,r,e,i){var n=JSON.stringify(t),a=e.cssStyleCache[n];a||(a=e.zrId+"-cls-"+Bc(),e.cssStyleCache[n]=a,e.cssNodes["."+a+":hover"]=t),r.class=r.class?r.class+" "+a:a}var An=Math.round;function Hc(t){return t&&Ar(t.src)}function zc(t){return t&&Hi(t.toDataURL)}function bf(t,r,e,i){L_(function(n,a){var s=n==="fill"||n==="stroke";s&&rc(a)?Gc(r,t,n,i):s&&_f(a)?Wc(e,t,n,i):t[n]=a,s&&i.ssr&&a==="none"&&(t["pointer-events"]="visible")},r,e,!1),j_(e,t,i)}function Sf(t,r){var e=uc(r);e&&(e.each(function(i,n){i!=null&&(t[(ju+n).toLowerCase()]=i+"")}),r.isSilent()&&(t[ju+"silent"]="true"))}function th(t){return ae(t[0]-1)&&ae(t[1])&&ae(t[2])&&ae(t[3]-1)}function W_(t){return ae(t[4])&&ae(t[5])}function Mf(t,r,e){if(r&&!(W_(r)&&th(r))){var i=1e4;t.transform=th(r)?"translate("+An(r[4]*i)/i+" "+An(r[5]*i)/i+")":up(r)}}function rh(t,r,e){for(var i=t.points,n=[],a=0;a<i.length;a++)n.push(An(i[a][0]*e)/e),n.push(An(i[a][1]*e)/e);r.points=n.join(" ")}function eh(t){return!t.smooth}function V_(t){var r=Lt(t,function(e){return typeof e=="string"?[e,e]:e});return function(e,i,n){for(var a=0;a<r.length;a++){var s=r[a],o=e[s[0]];o!=null&&(i[s[1]]=An(o*n)/n)}}}var q_={circle:[V_(["cx","cy","r"])],polyline:[rh,eh],polygon:[rh,eh]};function X_(t){for(var r=t.animators,e=0;e<r.length;e++)if(r[e].targetName==="shape")return!0;return!1}function kc(t,r){var e=t.style,i=t.shape,n=q_[t.type],a={},s=r.animation,o="path",f=t.style.strokePercent,u=r.compress&&ec(t)||4;if(n&&!r.willUpdate&&!(n[1]&&!n[1](i))&&!(s&&X_(t))&&!(f<1)){o=t.type;var h=Math.pow(10,u);n[0](i,a,h)}else{var l=!t.path||t.shapeChanged();t.path||t.createPathProxy();var c=t.path;l&&(c.beginPath(),t.buildPath(c,t.shape),t.pathUpdated());var v=c.getVersion(),d=t,_=d.__svgPathBuilder;(d.__svgPathVersion!==v||!_||f!==d.__svgPathStrokePercent)&&(_||(_=d.__svgPathBuilder=new Oc),_.reset(u),c.rebuildPath(_,f),_.generateStr(),d.__svgPathVersion=v,d.__svgPathStrokePercent=f),a.d=_.getStr()}return Mf(a,t.transform),bf(a,e,t,r),Sf(a,t),r.animation&&ts(t,a,r),r.emphasis&&G_(t,a,r),Ot(o,t.id+"",a)}function Y_(t,r){var e=t.style,i=e.image;if(i&&!Ar(i)&&(Hc(i)?i=i.src:zc(i)&&(i=i.toDataURL())),!!i){var n=e.x||0,a=e.y||0,s=e.width,o=e.height,f={href:i,width:s,height:o};return n&&(f.x=n),a&&(f.y=a),Mf(f,t.transform),bf(f,e,t,r),Sf(f,t),r.animation&&ts(t,f,r),Ot("image",t.id+"",f)}}function Z_(t,r){var e=t.style,i=e.text;if(i!=null&&(i+=""),!(!i||isNaN(e.x)||isNaN(e.y))){var n=e.font||le,a=e.x||0,s=lp(e.y||0,$a(n),e.textBaseline),o=hp[e.textAlign]||e.textAlign,f={"dominant-baseline":"central","text-anchor":o};if(yc(e)){var u="",h=e.fontStyle,l=_c(e.fontSize);if(!parseFloat(l))return;var c=e.fontFamily||ml,v=e.fontWeight;u+="font-size:"+l+";font-family:"+c+";",h&&h!=="normal"&&(u+="font-style:"+h+";"),v&&v!=="normal"&&(u+="font-weight:"+v+";"),f.style=u}else f.style="font: "+n;return i.match(/\s/)&&(f["xml:space"]="preserve"),a&&(f.x=a),s&&(f.y=s),Mf(f,t.transform),bf(f,e,t,r),Sf(f,t),r.animation&&ts(t,f,r),Ot("text",t.id+"",f,void 0,i)}}function ih(t,r){if(t instanceof Dt)return kc(t,r);if(t instanceof ki)return Y_(t,r);if(t instanceof Oi)return Z_(t,r)}function j_(t,r,e){var i=t.style;if(cp(i)){var n=vp(t),a=e.shadowCache,s=a[n];if(!s){var o=t.getGlobalScale(),f=o[0],u=o[1];if(!f||!u)return;var h=i.shadowOffsetX||0,l=i.shadowOffsetY||0,c=i.shadowBlur,v=wn(i.shadowColor),d=v.opacity,_=v.color,p=c/2/f,y=c/2/u,g=p+" "+y;s=e.zrId+"-s"+e.shadowIdx++,e.defs[s]=Ot("filter",s,{id:s,x:"-100%",y:"-100%",width:"300%",height:"300%"},[Ot("feDropShadow","",{dx:h/f,dy:l/u,stdDeviation:g,"flood-color":_,"flood-opacity":d})]),a[n]=s}r.filter=ja(s)}}function Gc(t,r,e,i){var n=t[e],a,s={gradientUnits:n.global?"userSpaceOnUse":"objectBoundingBox"};if(Jl(n))a="linearGradient",s.x1=n.x,s.y1=n.y,s.x2=n.x2,s.y2=n.y2;else if(tc(n))a="radialGradient",s.cx=Pt(n.x,.5),s.cy=Pt(n.y,.5),s.r=Pt(n.r,.5);else return;for(var o=n.colorStops,f=[],u=0,h=o.length;u<h;++u){var l=Ro(o[u].offset)*100+"%",c=o[u].color,v=wn(c),d=v.color,_=v.opacity,p={offset:l};p["stop-color"]=d,_<1&&(p["stop-opacity"]=_),f.push(Ot("stop",u+"",p))}var y=Ot(a,"",s,f),g=Ef(y),m=i.gradientCache,T=m[g];T||(T=i.zrId+"-g"+i.gradientIdx++,m[g]=T,s.id=T,i.defs[T]=Ot(a,T,s,f)),r[e]=ja(T)}function Wc(t,r,e,i){var n=t.style[e],a=t.getBoundingRect(),s={},o=n.repeat,f=o==="no-repeat",u=o==="repeat-x",h=o==="repeat-y",l;if(Ql(n)){var c=n.imageWidth,v=n.imageHeight,d=void 0,_=n.image;if(Ar(_)?d=_:Hc(_)?d=_.src:zc(_)&&(d=_.toDataURL()),typeof Image>"u"){var p="Image width/height must been given explictly in svg-ssr renderer.";To(c,p),To(v,p)}else if(c==null||v==null){var y=function(C,R){if(C){var L=C.elm,D=c||R.width,P=v||R.height;C.tag==="pattern"&&(u?(P=1,D/=a.width):h&&(D=1,P/=a.height)),C.attrs.width=D,C.attrs.height=P,L&&(L.setAttribute("width",D),L.setAttribute("height",P))}},g=mf(d,null,t,function(C){f||y(x,C),y(l,C)});g&&g.width&&g.height&&(c=c||g.width,v=v||g.height)}l=Ot("image","img",{href:d,width:c,height:v}),s.width=c,s.height=v}else n.svgElement&&(l=ce(n.svgElement),s.width=n.svgWidth,s.height=n.svgHeight);if(l){var m,T;f?m=T=1:u?(T=1,m=s.width/a.width):h?(m=1,T=s.height/a.height):s.patternUnits="userSpaceOnUse",m!=null&&!isNaN(m)&&(s.width=m),T!=null&&!isNaN(T)&&(s.height=T);var w=ic(n);w&&(s.patternTransform=w);var x=Ot("pattern","",s,[l]),E=Ef(x),S=i.patternCache,M=S[E];M||(M=i.zrId+"-p"+i.patternIdx++,S[E]=M,s.id=M,x=i.defs[M]=Ot("pattern",M,s,[l])),r[e]=ja(M)}}function $_(t,r,e){var i=e.clipPathCache,n=e.defs,a=i[t.id];if(!a){a=e.zrId+"-c"+e.clipPathIdx++;var s={id:a};i[t.id]=a,n[a]=Ot("clipPath",a,s,[kc(t,e)])}r["clip-path"]=ja(a)}function nh(t){return document.createTextNode(t)}function Fe(t,r,e){t.insertBefore(r,e)}function ah(t,r){t.removeChild(r)}function sh(t,r){t.appendChild(r)}function Vc(t){return t.parentNode}function qc(t){return t.nextSibling}function Vs(t,r){t.textContent=r}var oh=58,K_=120,Q_=Ot("","");function Yo(t){return t===void 0}function Br(t){return t!==void 0}function J_(t,r,e){for(var i={},n=r;n<=e;++n){var a=t[n].key;a!==void 0&&(i[a]=n)}return i}function ln(t,r){var e=t.key===r.key,i=t.tag===r.tag;return i&&e}function Rn(t){var r,e=t.children,i=t.tag;if(Br(i)){var n=t.elm=Fc(i);if(Af(Q_,t),$e(e))for(r=0;r<e.length;++r){var a=e[r];a!=null&&sh(n,Rn(a))}else Br(t.text)&&!Hr(t.text)&&sh(n,nh(t.text))}else t.elm=nh(t.text);return t.elm}function Xc(t,r,e,i,n){for(;i<=n;++i){var a=e[i];a!=null&&Fe(t,Rn(a),r)}}function Ba(t,r,e,i){for(;e<=i;++e){var n=r[e];if(n!=null)if(Br(n.tag)){var a=Vc(n.elm);ah(a,n.elm)}else ah(t,n.elm)}}function Af(t,r){var e,i=r.elm,n=t&&t.attrs||{},a=r.attrs||{};if(n!==a){for(e in a){var s=a[e],o=n[e];o!==s&&(s===!0?i.setAttribute(e,""):s===!1?i.removeAttribute(e):e==="style"?i.style.cssText=s:e.charCodeAt(0)!==K_?i.setAttribute(e,s):e==="xmlns:xlink"||e==="xmlns"?i.setAttributeNS(D_,e,s):e.charCodeAt(3)===oh?i.setAttributeNS(O_,e,s):e.charCodeAt(5)===oh?i.setAttributeNS(Nc,e,s):i.setAttribute(e,s))}for(e in n)e in a||i.removeAttribute(e)}}function ty(t,r,e){for(var i=0,n=0,a=r.length-1,s=r[0],o=r[a],f=e.length-1,u=e[0],h=e[f],l,c,v,d;i<=a&&n<=f;)s==null?s=r[++i]:o==null?o=r[--a]:u==null?u=e[++n]:h==null?h=e[--f]:ln(s,u)?(mi(s,u),s=r[++i],u=e[++n]):ln(o,h)?(mi(o,h),o=r[--a],h=e[--f]):ln(s,h)?(mi(s,h),Fe(t,s.elm,qc(o.elm)),s=r[++i],h=e[--f]):ln(o,u)?(mi(o,u),Fe(t,o.elm,s.elm),o=r[--a],u=e[++n]):(Yo(l)&&(l=J_(r,i,a)),c=l[u.key],Yo(c)?Fe(t,Rn(u),s.elm):(v=r[c],v.tag!==u.tag?Fe(t,Rn(u),s.elm):(mi(v,u),r[c]=void 0,Fe(t,v.elm,s.elm))),u=e[++n]);(i<=a||n<=f)&&(i>a?(d=e[f+1]==null?null:e[f+1].elm,Xc(t,d,e,n,f)):Ba(t,r,i,a))}function mi(t,r){var e=r.elm=t.elm,i=t.children,n=r.children;t!==r&&(Af(t,r),Yo(r.text)?Br(i)&&Br(n)?i!==n&&ty(e,i,n):Br(n)?(Br(t.text)&&Vs(e,""),Xc(e,null,n,0,n.length-1)):Br(i)?Ba(e,i,0,i.length-1):Br(t.text)&&Vs(e,""):t.text!==r.text&&(Br(i)&&Ba(e,i,0,i.length-1),Vs(e,r.text)))}function ry(t,r){if(ln(t,r))mi(t,r);else{var e=t.elm,i=Vc(e);Rn(r),i!==null&&(Fe(i,r.elm,qc(e)),Ba(i,[t],0,0))}return r}var ey=0,em=(function(){function t(r,e,i){if(this.type="svg",this.refreshHover=fh(),this.configLayer=fh(),this.storage=e,this._opts=i=dt({},i),this.root=r,this._id="zr"+ey++,this._oldVNode=$u(i.width,i.height),r&&!i.ssr){var n=this._viewport=document.createElement("div");n.style.cssText="position:relative;overflow:hidden";var a=this._svgDom=this._oldVNode.elm=Fc("svg");Af(null,this._oldVNode),n.appendChild(a),r.appendChild(n)}this.resize(i.width,i.height)}return t.prototype.getType=function(){return this.type},t.prototype.getViewportRoot=function(){return this._viewport},t.prototype.getViewportRootOffset=function(){var r=this.getViewportRoot();if(r)return{offsetLeft:r.offsetLeft||0,offsetTop:r.offsetTop||0}},t.prototype.getSvgDom=function(){return this._svgDom},t.prototype.refresh=function(){if(this.root){var r=this.renderToVNode({willUpdate:!0});r.attrs.style="position:absolute;left:0;top:0;user-select:none",ry(this._oldVNode,r),this._oldVNode=r}},t.prototype.renderOneToVNode=function(r){return ih(r,Xo(this._id))},t.prototype.renderToVNode=function(r){r=r||{};var e=this.storage.getDisplayList(!0),i=this._width,n=this._height,a=Xo(this._id);a.animation=r.animation,a.willUpdate=r.willUpdate,a.compress=r.compress,a.emphasis=r.emphasis,a.ssr=this._opts.ssr;var s=[],o=this._bgVNode=iy(i,n,this._backgroundColor,a);o&&s.push(o);var f=r.compress?null:this._mainVNode=Ot("g","main",{},[]);this._paintList(e,a,f?f.children:s),f&&s.push(f);var u=Lt(wt(a.defs),function(c){return a.defs[c]});if(u.length&&s.push(Ot("defs","defs",{},u)),r.animation){var h=F_(a.cssNodes,a.cssAnims,{newline:!0});if(h){var l=Ot("style","stl",{},[],h);s.push(l)}}return $u(i,n,s,r.useViewBox)},t.prototype.renderToString=function(r){return r=r||{},Ef(this.renderToVNode({animation:Pt(r.cssAnimation,!0),emphasis:Pt(r.cssEmphasis,!0),willUpdate:!1,compress:!0,useViewBox:Pt(r.useViewBox,!0)}),{newline:!0})},t.prototype.setBackgroundColor=function(r){this._backgroundColor=r},t.prototype.getSvgRoot=function(){return this._mainVNode&&this._mainVNode.elm},t.prototype._paintList=function(r,e,i){for(var n=r.length,a=[],s=0,o,f,u=0,h=0;h<n;h++){var l=r[h];if(!l.invisible){var c=l.__clipPaths,v=c&&c.length||0,d=f&&f.length||0,_=void 0;for(_=Math.max(v-1,d-1);_>=0&&!(c&&f&&c[_]===f[_]);_--);for(var p=d-1;p>_;p--)s--,o=a[s-1];for(var y=_+1;y<v;y++){var g={};$_(c[y],g,e);var m=Ot("g","clip-g-"+u++,g,[]);(o?o.children:i).push(m),a[s++]=m,o=m}f=c;var T=ih(l,e);T&&(o?o.children:i).push(T)}}},t.prototype.resize=function(r,e){var i=this._opts,n=this.root,a=this._viewport;if(r!=null&&(i.width=r),e!=null&&(i.height=e),n&&a&&(a.style.display="none",r=Ei(n,0,i),e=Ei(n,1,i),a.style.display=""),this._width!==r||this._height!==e){if(this._width=r,this._height=e,a){var s=a.style;s.width=r+"px",s.height=e+"px"}if(_f(this._backgroundColor))this.refresh();else{var o=this._svgDom;o&&(o.setAttribute("width",r),o.setAttribute("height",e));var f=this._bgVNode&&this._bgVNode.elm;f&&(f.setAttribute("width",r),f.setAttribute("height",e))}}},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t.prototype.dispose=function(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null},t.prototype.clear=function(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null},t.prototype.toDataURL=function(r){var e=this.renderToString(),i="data:image/svg+xml;";return r?(e=pp(e),e&&i+"base64,"+e):i+"charset=UTF-8,"+encodeURIComponent(e)},t})();function fh(t){return function(){}}function iy(t,r,e,i){var n;if(e&&e!=="none")if(n=Ot("rect","bg",{width:t,height:r,x:"0",y:"0"}),rc(e))Gc({fill:e},n.attrs,"fill",i);else if(_f(e))Wc({style:{fill:e},dirty:oe,getBoundingRect:function(){return{width:t,height:r}}},n.attrs,"fill",i);else{var a=wn(e),s=a.color,o=a.opacity;n.attrs.fill=s,o<1&&(n.attrs["fill-opacity"]=o)}return n}function uh(t,r,e){var i=je.createCanvas(),n=r.getWidth(),a=r.getHeight(),s=i.style;return s&&(s.position="absolute",s.left="0",s.top="0",s.width=n+"px",s.height=a+"px",i.setAttribute("data-zr-dom-id",t)),i.width=n*e,i.height=a*e,i}var qs=(function(t){yt(r,t);function r(e,i,n){var a=t.call(this)||this;a.motionBlur=!1,a.lastFrameAlpha=.7,a.dpr=1,a.virtual=!1,a.config={},a.incremental=!1,a.zlevel=0,a.maxRepaintRectCount=5,a.__dirty=!0,a.__firstTimePaint=!0,a.__used=!1,a.__drawIndex=0,a.__startIndex=0,a.__endIndex=0,a.__prevStartIndex=null,a.__prevEndIndex=null;var s;n=n||Oa,typeof e=="string"?s=uh(e,i,n):Hr(e)&&(s=e,e=s.id),a.id=e,a.dom=s;var o=s.style;return o&&(ff(s),s.onselectstart=function(){return!1},o.padding="0",o.margin="0",o.borderWidth="0"),a.painter=i,a.dpr=n,a}return r.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},r.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},r.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},r.prototype.setUnpainted=function(){this.__firstTimePaint=!0},r.prototype.createBackBuffer=function(){var e=this.dpr;this.domBack=uh("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),e!==1&&this.ctxBack.scale(e,e)},r.prototype.createRepaintRects=function(e,i,n,a){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var s=[],o=this.maxRepaintRectCount,f=!1,u=new Mt(0,0,0,0);function h(g){if(!(!g.isFinite()||g.isZero()))if(s.length===0){var m=new Mt(0,0,0,0);m.copy(g),s.push(m)}else{for(var T=!1,w=1/0,x=0,E=0;E<s.length;++E){var S=s[E];if(S.intersect(g)){var M=new Mt(0,0,0,0);M.copy(S),M.union(g),s[E]=M,T=!0;break}else if(f){u.copy(g),u.union(S);var C=g.width*g.height,R=S.width*S.height,L=u.width*u.height,D=L-C-R;D<w&&(w=D,x=E)}}if(f&&(s[x].union(g),T=!0),!T){var m=new Mt(0,0,0,0);m.copy(g),s.push(m)}f||(f=s.length>=o)}}for(var l=this.__startIndex;l<this.__endIndex;++l){var c=e[l];if(c){var v=c.shouldBePainted(n,a,!0,!0),d=c.__isRendered&&(c.__dirty&or||!v)?c.getPrevPaintRect():null;d&&h(d);var _=v&&(c.__dirty&or||!c.__isRendered)?c.getPaintRect():null;_&&h(_)}}for(var l=this.__prevStartIndex;l<this.__prevEndIndex;++l){var c=i[l],v=c&&c.shouldBePainted(n,a,!0,!0);if(c&&(!v||!c.__zr)&&c.__isRendered){var d=c.getPrevPaintRect();d&&h(d)}}var p;do{p=!1;for(var l=0;l<s.length;){if(s[l].isZero()){s.splice(l,1);continue}for(var y=l+1;y<s.length;)s[l].intersect(s[y])?(p=!0,s[l].union(s[y]),s.splice(y,1)):y++;l++}}while(p);return this._paintRects=s,s},r.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},r.prototype.resize=function(e,i){var n=this.dpr,a=this.dom,s=a.style,o=this.domBack;s&&(s.width=e+"px",s.height=i+"px"),a.width=e*n,a.height=i*n,o&&(o.width=e*n,o.height=i*n,n!==1&&this.ctxBack.scale(n,n))},r.prototype.clear=function(e,i,n){var a=this.dom,s=this.ctx,o=a.width,f=a.height;i=i||this.clearColor;var u=this.motionBlur&&!e,h=this.lastFrameAlpha,l=this.dpr,c=this;u&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(a,0,0,o/l,f/l));var v=this.domBack;function d(_,p,y,g){if(s.clearRect(_,p,y,g),i&&i!=="transparent"){var m=void 0;if(Dn(i)){var T=i.global||i.__width===y&&i.__height===g;m=T&&i.__canvasGradient||Wo(s,i,{x:0,y:0,width:y,height:g}),i.__canvasGradient=m,i.__width=y,i.__height=g}else El(i)&&(i.scaleX=i.scaleX||l,i.scaleY=i.scaleY||l,m=Vo(s,i,{dirty:function(){c.setUnpainted(),c.painter.refresh()}}));s.save(),s.fillStyle=m||i,s.fillRect(_,p,y,g),s.restore()}u&&(s.save(),s.globalAlpha=h,s.drawImage(v,_,p,y,g),s.restore())}!n||u?d(0,0,o,f):n.length&&zt(n,function(_){d(_.x*l,_.y*l,_.width*l,_.height*l)})},r})(zi),hh=1e5,Le=314159,na=.01,ny=.001;function ay(t){return t?t.__builtin__?!0:!(typeof t.resize!="function"||typeof t.refresh!="function"):!1}function sy(t,r){var e=document.createElement("div");return e.style.cssText=["position:relative","width:"+t+"px","height:"+r+"px","padding:0","margin:0","border-width:0"].join(";")+";",e}var im=(function(){function t(r,e,i,n){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var a=!r.nodeName||r.nodeName.toUpperCase()==="CANVAS";this._opts=i=dt({},i||{}),this.dpr=i.devicePixelRatio||Oa,this._singleCanvas=a,this.root=r;var s=r.style;s&&(ff(r),r.innerHTML=""),this.storage=e;var o=this._zlevelList;this._prevDisplayList=[];var f=this._layers;if(a){var h=r,l=h.width,c=h.height;i.width!=null&&(l=i.width),i.height!=null&&(c=i.height),this.dpr=i.devicePixelRatio||1,h.width=l*this.dpr,h.height=c*this.dpr,this._width=l,this._height=c;var v=new qs(h,this,this.dpr);v.__builtin__=!0,v.initContext(),f[Le]=v,v.zlevel=Le,o.push(Le),this._domRoot=r}else{this._width=Ei(r,0,i),this._height=Ei(r,1,i);var u=this._domRoot=sy(this._width,this._height);r.appendChild(u)}}return t.prototype.getType=function(){return"canvas"},t.prototype.isSingleCanvas=function(){return this._singleCanvas},t.prototype.getViewportRoot=function(){return this._domRoot},t.prototype.getViewportRootOffset=function(){var r=this.getViewportRoot();if(r)return{offsetLeft:r.offsetLeft||0,offsetTop:r.offsetTop||0}},t.prototype.refresh=function(r){var e=this.storage.getDisplayList(!0),i=this._prevDisplayList,n=this._zlevelList;this._redrawId=Math.random(),this._paintList(e,i,r,this._redrawId);for(var a=0;a<n.length;a++){var s=n[a],o=this._layers[s];if(!o.__builtin__&&o.refresh){var f=a===0?this._backgroundColor:null;o.refresh(f)}}return this._opts.useDirtyRect&&(this._prevDisplayList=e.slice()),this},t.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},t.prototype._paintHoverList=function(r){var e=r.length,i=this._hoverlayer;if(i&&i.clear(),!!e){for(var n={inHover:!0,viewWidth:this._width,viewHeight:this._height},a,s=0;s<e;s++){var o=r[s];o.__inHover&&(i||(i=this._hoverlayer=this.getLayer(hh)),a||(a=i.ctx,a.save()),We(a,o,n,s===e-1))}a&&a.restore()}},t.prototype.getHoverLayer=function(){return this.getLayer(hh)},t.prototype.paintOne=function(r,e){E_(r,e)},t.prototype._paintList=function(r,e,i,n){if(this._redrawId===n){i=i||!1,this._updateLayerStatus(r);var a=this._doPaintList(r,e,i),s=a.finished,o=a.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),o&&this._paintHoverList(r),s)this.eachLayer(function(u){u.afterBrush&&u.afterBrush()});else{var f=this;Ca(function(){f._paintList(r,e,i,n)})}}},t.prototype._compositeManually=function(){var r=this.getLayer(Le).ctx,e=this._domRoot.width,i=this._domRoot.height;r.clearRect(0,0,e,i),this.eachBuiltinLayer(function(n){n.virtual&&r.drawImage(n.dom,0,0,e,i)})},t.prototype._doPaintList=function(r,e,i){for(var n=this,a=[],s=this._opts.useDirtyRect,o=0;o<this._zlevelList.length;o++){var f=this._zlevelList[o],u=this._layers[f];u.__builtin__&&u!==this._hoverlayer&&(u.__dirty||i)&&a.push(u)}for(var h=!0,l=!1,c=function(_){var p=a[_],y=p.ctx,g=s&&p.createRepaintRects(r,e,v._width,v._height),m=i?p.__startIndex:p.__drawIndex,T=!i&&p.incremental&&Date.now,w=T&&Date.now(),x=p.zlevel===v._zlevelList[0]?v._backgroundColor:null;if(p.__startIndex===p.__endIndex)p.clear(!1,x,g);else if(m===p.__startIndex){var E=r[m];(!E.incremental||!E.notClear||i)&&p.clear(!1,x,g)}m===-1&&(console.error("For some unknown reason. drawIndex is -1"),m=p.__startIndex);var S,M=function(D){var P={inHover:!1,allClipped:!1,prevEl:null,viewWidth:n._width,viewHeight:n._height};for(S=m;S<p.__endIndex;S++){var z=r[S];if(z.__inHover&&(l=!0),n._doPaintEl(z,p,s,D,P,S===p.__endIndex-1),T){var A=Date.now()-w;if(A>15)break}}P.prevElClipPaths&&y.restore()};if(g)if(g.length===0)S=p.__endIndex;else for(var C=v.dpr,R=0;R<g.length;++R){var L=g[R];y.save(),y.beginPath(),y.rect(L.x*C,L.y*C,L.width*C,L.height*C),y.clip(),M(L),y.restore()}else y.save(),M(),y.restore();p.__drawIndex=S,p.__drawIndex<p.__endIndex&&(h=!1)},v=this,d=0;d<a.length;d++)c(d);return St.wxa&&zt(this._layers,function(_){_&&_.ctx&&_.ctx.draw&&_.ctx.draw()}),{finished:h,needsRefreshHover:l}},t.prototype._doPaintEl=function(r,e,i,n,a,s){var o=e.ctx;if(i){var f=r.getPaintRect();(!n||f&&f.intersect(n))&&(We(o,r,a,s),r.setPrevPaintRect(f))}else We(o,r,a,s)},t.prototype.getLayer=function(r,e){this._singleCanvas&&!this._needsManuallyCompositing&&(r=Le);var i=this._layers[r];return i||(i=new qs("zr_"+r,this,this.dpr),i.zlevel=r,i.__builtin__=!0,this._layerConfig[r]?Be(i,this._layerConfig[r],!0):this._layerConfig[r-na]&&Be(i,this._layerConfig[r-na],!0),e&&(i.virtual=e),this.insertLayer(r,i),i.initContext()),i},t.prototype.insertLayer=function(r,e){var i=this._layers,n=this._zlevelList,a=n.length,s=this._domRoot,o=null,f=-1;if(!i[r]&&ay(e)){if(a>0&&r>n[0]){for(f=0;f<a-1&&!(n[f]<r&&n[f+1]>r);f++);o=i[n[f]]}if(n.splice(f+1,0,r),i[r]=e,!e.virtual)if(o){var u=o.dom;u.nextSibling?s.insertBefore(e.dom,u.nextSibling):s.appendChild(e.dom)}else s.firstChild?s.insertBefore(e.dom,s.firstChild):s.appendChild(e.dom);e.painter||(e.painter=this)}},t.prototype.eachLayer=function(r,e){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n];r.call(e,this._layers[a],a)}},t.prototype.eachBuiltinLayer=function(r,e){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n],s=this._layers[a];s.__builtin__&&r.call(e,s,a)}},t.prototype.eachOtherLayer=function(r,e){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n],s=this._layers[a];s.__builtin__||r.call(e,s,a)}},t.prototype.getLayers=function(){return this._layers},t.prototype._updateLayerStatus=function(r){this.eachBuiltinLayer(function(l,c){l.__dirty=l.__used=!1});function e(l){a&&(a.__endIndex!==l&&(a.__dirty=!0),a.__endIndex=l)}if(this._singleCanvas)for(var i=1;i<r.length;i++){var n=r[i];if(n.zlevel!==r[i-1].zlevel||n.incremental){this._needsManuallyCompositing=!0;break}}var a=null,s=0,o,f;for(f=0;f<r.length;f++){var n=r[f],u=n.zlevel,h=void 0;o!==u&&(o=u,s=0),n.incremental?(h=this.getLayer(u+ny,this._needsManuallyCompositing),h.incremental=!0,s=1):h=this.getLayer(u+(s>0?na:0),this._needsManuallyCompositing),h.__builtin__||Ya("ZLevel "+u+" has been used by unkown layer "+h.id),h!==a&&(h.__used=!0,h.__startIndex!==f&&(h.__dirty=!0),h.__startIndex=f,h.incremental?h.__drawIndex=-1:h.__drawIndex=f,e(f),a=h),n.__dirty&or&&!n.__inHover&&(h.__dirty=!0,h.incremental&&h.__drawIndex<0&&(h.__drawIndex=f))}e(f),this.eachBuiltinLayer(function(l,c){!l.__used&&l.getElementCount()>0&&(l.__dirty=!0,l.__startIndex=l.__endIndex=l.__drawIndex=0),l.__dirty&&l.__drawIndex<0&&(l.__drawIndex=l.__startIndex)})},t.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},t.prototype._clearLayer=function(r){r.clear()},t.prototype.setBackgroundColor=function(r){this._backgroundColor=r,zt(this._layers,function(e){e.setUnpainted()})},t.prototype.configLayer=function(r,e){if(e){var i=this._layerConfig;i[r]?Be(i[r],e,!0):i[r]=e;for(var n=0;n<this._zlevelList.length;n++){var a=this._zlevelList[n];if(a===r||a===r+na){var s=this._layers[a];Be(s,i[r],!0)}}}},t.prototype.delLayer=function(r){var e=this._layers,i=this._zlevelList,n=e[r];n&&(n.dom.parentNode.removeChild(n.dom),delete e[r],i.splice(Er(i,r),1))},t.prototype.resize=function(r,e){if(this._domRoot.style){var i=this._domRoot;i.style.display="none";var n=this._opts,a=this.root;if(r!=null&&(n.width=r),e!=null&&(n.height=e),r=Ei(a,0,n),e=Ei(a,1,n),i.style.display="",this._width!==r||e!==this._height){i.style.width=r+"px",i.style.height=e+"px";for(var s in this._layers)this._layers.hasOwnProperty(s)&&this._layers[s].resize(r,e);this.refresh(!0)}this._width=r,this._height=e}else{if(r==null||e==null)return;this._width=r,this._height=e,this.getLayer(Le).resize(r,e)}return this},t.prototype.clearLayer=function(r){var e=this._layers[r];e&&e.clear()},t.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},t.prototype.getRenderedCanvas=function(r){if(r=r||{},this._singleCanvas&&!this._compositeManually)return this._layers[Le].dom;var e=new qs("image",this,r.pixelRatio||this.dpr);e.initContext(),e.clear(!1,r.backgroundColor||this._backgroundColor);var i=e.ctx;if(r.pixelRatio<=this.dpr){this.refresh();var n=e.dom.width,a=e.dom.height;this.eachLayer(function(l){l.__builtin__?i.drawImage(l.dom,0,0,n,a):l.renderToCanvas&&(i.save(),l.renderToCanvas(i),i.restore())})}else for(var s={inHover:!1,viewWidth:this._width,viewHeight:this._height},o=this.storage.getDisplayList(!0),f=0,u=o.length;f<u;f++){var h=o[f];We(i,h,s,f===u-1)}return e.dom},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t})();function oy(t){if(Ar(t)){var r=new DOMParser;t=r.parseFromString(t,"text/xml")}var e=t;for(e.nodeType===9&&(e=e.firstChild);e.nodeName.toLowerCase()!=="svg"||e.nodeType!==1;)e=e.nextSibling;return e}var Xs,Ua={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},lh=wt(Ua),Ha={"alignment-baseline":"textBaseline","stop-color":"stopColor"},ch=wt(Ha),fy=(function(){function t(){this._defs={},this._root=null}return t.prototype.parse=function(r,e){e=e||{};var i=oy(r);this._defsUsePending=[];var n=new Ne;this._root=n;var a=[],s=i.getAttribute("viewBox")||"",o=parseFloat(i.getAttribute("width")||e.width),f=parseFloat(i.getAttribute("height")||e.height);isNaN(o)&&(o=null),isNaN(f)&&(f=null),sr(i,n,null,!0,!1);for(var u=i.firstChild;u;)this._parseNode(u,n,a,null,!1,!1),u=u.nextSibling;ly(this._defs,this._defsUsePending),this._defsUsePending=[];var h,l;if(s){var c=rs(s);c.length>=4&&(h={x:parseFloat(c[0]||0),y:parseFloat(c[1]||0),width:parseFloat(c[2]),height:parseFloat(c[3])})}if(h&&o!=null&&f!=null&&(l=_y(h,{x:0,y:0,width:o,height:f}),!e.ignoreViewBox)){var v=n;n=new Ne,n.add(v),v.scaleX=v.scaleY=l.scale,v.x=l.x,v.y=l.y}return!e.ignoreRootClip&&o!=null&&f!=null&&n.setClipPath(new Sn({shape:{x:0,y:0,width:o,height:f}})),{root:n,width:o,height:f,viewBoxRect:h,viewBoxTransform:l,named:a}},t.prototype._parseNode=function(r,e,i,n,a,s){var o=r.nodeName.toLowerCase(),f,u=n;if(o==="defs"&&(a=!0),o==="text"&&(s=!0),o==="defs"||o==="switch")f=e;else{if(!a){var h=Xs[o];if(h&&mn(Xs,o)){f=h.call(this,r,e);var l=r.getAttribute("name");if(l){var c={name:l,namedFrom:null,svgNodeTagLower:o,el:f};i.push(c),o==="g"&&(u=c)}else n&&i.push({name:n.name,namedFrom:n,svgNodeTagLower:o,el:f});e.add(f)}}var v=vh[o];if(v&&mn(vh,o)){var d=v.call(this,r),_=r.getAttribute("id");_&&(this._defs[_]=d)}}if(f&&f.isGroup)for(var p=r.firstChild;p;)p.nodeType===1?this._parseNode(p,f,i,u,a,s):p.nodeType===3&&s&&this._parseText(p,f),p=p.nextSibling},t.prototype._parseText=function(r,e){var i=new Oi({style:{text:r.textContent},silent:!0,x:this._textX||0,y:this._textY||0});cr(e,i),sr(r,i,this._defsUsePending,!1,!1),uy(i,e);var n=i.style,a=n.fontSize;a&&a<9&&(n.fontSize=9,i.scaleX*=a/9,i.scaleY*=a/9);var s=(n.fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ");n.font=s;var o=i.getBoundingRect();return this._textX+=o.width,e.add(i),i},t.internalField=(function(){Xs={g:function(r,e){var i=new Ne;return cr(e,i),sr(r,i,this._defsUsePending,!1,!1),i},rect:function(r,e){var i=new Sn;return cr(e,i),sr(r,i,this._defsUsePending,!1,!1),i.setShape({x:parseFloat(r.getAttribute("x")||"0"),y:parseFloat(r.getAttribute("y")||"0"),width:parseFloat(r.getAttribute("width")||"0"),height:parseFloat(r.getAttribute("height")||"0")}),i.silent=!0,i},circle:function(r,e){var i=new Ec;return cr(e,i),sr(r,i,this._defsUsePending,!1,!1),i.setShape({cx:parseFloat(r.getAttribute("cx")||"0"),cy:parseFloat(r.getAttribute("cy")||"0"),r:parseFloat(r.getAttribute("r")||"0")}),i.silent=!0,i},line:function(r,e){var i=new Rc;return cr(e,i),sr(r,i,this._defsUsePending,!1,!1),i.setShape({x1:parseFloat(r.getAttribute("x1")||"0"),y1:parseFloat(r.getAttribute("y1")||"0"),x2:parseFloat(r.getAttribute("x2")||"0"),y2:parseFloat(r.getAttribute("y2")||"0")}),i.silent=!0,i},ellipse:function(r,e){var i=new bc;return cr(e,i),sr(r,i,this._defsUsePending,!1,!1),i.setShape({cx:parseFloat(r.getAttribute("cx")||"0"),cy:parseFloat(r.getAttribute("cy")||"0"),rx:parseFloat(r.getAttribute("rx")||"0"),ry:parseFloat(r.getAttribute("ry")||"0")}),i.silent=!0,i},polygon:function(r,e){var i=r.getAttribute("points"),n;i&&(n=_h(i));var a=new Tf({shape:{points:n||[]},silent:!0});return cr(e,a),sr(r,a,this._defsUsePending,!1,!1),a},polyline:function(r,e){var i=r.getAttribute("points"),n;i&&(n=_h(i));var a=new Ac({shape:{points:n||[]},silent:!0});return cr(e,a),sr(r,a,this._defsUsePending,!1,!1),a},image:function(r,e){var i=new ki;return cr(e,i),sr(r,i,this._defsUsePending,!1,!1),i.setStyle({image:r.getAttribute("xlink:href")||r.getAttribute("href"),x:+r.getAttribute("x"),y:+r.getAttribute("y"),width:+r.getAttribute("width"),height:+r.getAttribute("height")}),i.silent=!0,i},text:function(r,e){var i=r.getAttribute("x")||"0",n=r.getAttribute("y")||"0",a=r.getAttribute("dx")||"0",s=r.getAttribute("dy")||"0";this._textX=parseFloat(i)+parseFloat(a),this._textY=parseFloat(n)+parseFloat(s);var o=new Ne;return cr(e,o),sr(r,o,this._defsUsePending,!1,!0),o},tspan:function(r,e){var i=r.getAttribute("x"),n=r.getAttribute("y");i!=null&&(this._textX=parseFloat(i)),n!=null&&(this._textY=parseFloat(n));var a=r.getAttribute("dx")||"0",s=r.getAttribute("dy")||"0",o=new Ne;return cr(e,o),sr(r,o,this._defsUsePending,!1,!0),this._textX+=parseFloat(a),this._textY+=parseFloat(s),o},path:function(r,e){var i=r.getAttribute("d")||"",n=z0(i);return cr(e,n),sr(r,n,this._defsUsePending,!1,!1),n.silent=!0,n}}})(),t})(),vh={lineargradient:function(t){var r=parseInt(t.getAttribute("x1")||"0",10),e=parseInt(t.getAttribute("y1")||"0",10),i=parseInt(t.getAttribute("x2")||"10",10),n=parseInt(t.getAttribute("y2")||"0",10),a=new s_(r,e,i,n);return dh(t,a),ph(t,a),a},radialgradient:function(t){var r=parseInt(t.getAttribute("cx")||"0",10),e=parseInt(t.getAttribute("cy")||"0",10),i=parseInt(t.getAttribute("r")||"0",10),n=new o_(r,e,i);return dh(t,n),ph(t,n),n}};function dh(t,r){var e=t.getAttribute("gradientUnits");e==="userSpaceOnUse"&&(r.global=!0)}function ph(t,r){for(var e=t.firstChild;e;){if(e.nodeType===1&&e.nodeName.toLocaleLowerCase()==="stop"){var i=e.getAttribute("offset"),n=void 0;i&&i.indexOf("%")>0?n=parseInt(i,10)/100:i?n=parseFloat(i):n=0;var a={};Yc(e,a,a);var s=a.stopColor||e.getAttribute("stop-color")||"#000000";r.colorStops.push({offset:n,color:s})}e=e.nextSibling}}function cr(t,r){t&&t.__inheritedStyle&&(r.__inheritedStyle||(r.__inheritedStyle={}),lr(r.__inheritedStyle,t.__inheritedStyle))}function _h(t){for(var r=rs(t),e=[],i=0;i<r.length;i+=2){var n=parseFloat(r[i]),a=parseFloat(r[i+1]);e.push([n,a])}return e}function sr(t,r,e,i,n){var a=r,s=a.__inheritedStyle=a.__inheritedStyle||{},o={};t.nodeType===1&&(dy(t,r),Yc(t,s,o),i||py(t,s,o)),a.style=a.style||{},s.fill!=null&&(a.style.fill=yh(a,"fill",s.fill,e)),s.stroke!=null&&(a.style.stroke=yh(a,"stroke",s.stroke,e)),zt(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(f){s[f]!=null&&(a.style[f]=parseFloat(s[f]))}),zt(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(f){s[f]!=null&&(a.style[f]=s[f])}),n&&(a.__selfStyle=o),s.lineDash&&(a.style.lineDash=Lt(rs(s.lineDash),function(f){return parseFloat(f)})),(s.visibility==="hidden"||s.visibility==="collapse")&&(a.invisible=!0),s.display==="none"&&(a.ignore=!0)}function uy(t,r){var e=r.__selfStyle;if(e){var i=e.textBaseline,n=i;!i||i==="auto"||i==="baseline"?n="alphabetic":i==="before-edge"||i==="text-before-edge"?n="top":i==="after-edge"||i==="text-after-edge"?n="bottom":(i==="central"||i==="mathematical")&&(n="middle"),t.style.textBaseline=n}var a=r.__inheritedStyle;if(a){var s=a.textAlign,o=s;s&&(s==="middle"&&(o="center"),t.style.textAlign=o)}}var hy=/^url\(\s*#(.*?)\)/;function yh(t,r,e,i){var n=e&&e.match(hy);if(n){var a=Ue(n[1]);i.push([t,r,a]);return}return e==="none"&&(e=null),e}function ly(t,r){for(var e=0;e<r.length;e++){var i=r[e];i[0].style[i[1]]=t[i[2]]}}var cy=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function rs(t){return t.match(cy)||[]}var vy=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,Ys=Math.PI/180;function dy(t,r){var e=t.getAttribute("transform");if(e){e=e.replace(/,/g," ");var i=[],n=null;e.replace(vy,function(l,c,v){return i.push(c,v),""});for(var a=i.length-1;a>0;a-=2){var s=i[a],o=i[a-1],f=rs(s);switch(n=n||fe(),o){case"translate":Ra(n,n,[parseFloat(f[0]),parseFloat(f[1]||"0")]);break;case"scale":df(n,n,[parseFloat(f[0]),parseFloat(f[1]||f[0])]);break;case"rotate":vf(n,n,-parseFloat(f[0])*Ys,[parseFloat(f[1]||"0"),parseFloat(f[2]||"0")]);break;case"skewX":var u=Math.tan(parseFloat(f[0])*Ys);Ci(n,[1,0,u,1,0,0],n);break;case"skewY":var h=Math.tan(parseFloat(f[0])*Ys);Ci(n,[1,h,0,1,0,0],n);break;case"matrix":n[0]=parseFloat(f[0]),n[1]=parseFloat(f[1]),n[2]=parseFloat(f[2]),n[3]=parseFloat(f[3]),n[4]=parseFloat(f[4]),n[5]=parseFloat(f[5]);break}}r.setLocalTransform(n)}}var gh=/([^\s:;]+)\s*:\s*([^:;]+)/g;function Yc(t,r,e){var i=t.getAttribute("style");if(i){gh.lastIndex=0;for(var n;(n=gh.exec(i))!=null;){var a=n[1],s=mn(Ua,a)?Ua[a]:null;s&&(r[s]=n[2]);var o=mn(Ha,a)?Ha[a]:null;o&&(e[o]=n[2])}}}function py(t,r,e){for(var i=0;i<lh.length;i++){var n=lh[i],a=t.getAttribute(n);a!=null&&(r[Ua[n]]=a)}for(var i=0;i<ch.length;i++){var n=ch[i],a=t.getAttribute(n);a!=null&&(e[Ha[n]]=a)}}function _y(t,r){var e=r.width/t.width,i=r.height/t.height,n=Math.min(e,i);return{scale:n,x:-(t.x+t.width/2)*n+(r.x+r.width/2),y:-(t.y+t.height/2)*n+(r.y+r.height/2)}}function nm(t,r){var e=new fy;return e.parse(t,r)}var Nr=de.CMD;function bi(t,r){return Math.abs(t-r)<1e-5}function Zo(t){var r=t.data,e=t.len(),i=[],n,a=0,s=0,o=0,f=0;function u(D,P){n&&n.length>2&&i.push(n),n=[D,P]}function h(D,P,z,A){bi(D,z)&&bi(P,A)||n.push(D,P,z,A,z,A)}function l(D,P,z,A,B,k){var j=Math.abs(P-D),$=Math.tan(j/4)*4/3,rt=P<D?-1:1,Q=Math.cos(D),st=Math.sin(D),et=Math.cos(P),pt=Math.sin(P),At=Q*B+z,Kt=st*k+A,G=et*B+z,X=pt*k+A,K=B*$*rt,W=k*$*rt;n.push(At-K*st,Kt+W*Q,G+K*pt,X-W*et,G,X)}for(var c,v,d,_,p=0;p<e;){var y=r[p++],g=p===1;switch(g&&(a=r[p],s=r[p+1],o=a,f=s,(y===Nr.L||y===Nr.C||y===Nr.Q)&&(n=[o,f])),y){case Nr.M:a=o=r[p++],s=f=r[p++],u(o,f);break;case Nr.L:c=r[p++],v=r[p++],h(a,s,c,v),a=c,s=v;break;case Nr.C:n.push(r[p++],r[p++],r[p++],r[p++],a=r[p++],s=r[p++]);break;case Nr.Q:c=r[p++],v=r[p++],d=r[p++],_=r[p++],n.push(a+2/3*(c-a),s+2/3*(v-s),d+2/3*(c-d),_+2/3*(v-_),d,_),a=d,s=_;break;case Nr.A:var m=r[p++],T=r[p++],w=r[p++],x=r[p++],E=r[p++],S=r[p++]+E;p+=1;var M=!r[p++];c=Math.cos(E)*w+m,v=Math.sin(E)*x+T,g?(o=c,f=v,u(o,f)):h(a,s,c,v),a=Math.cos(S)*w+m,s=Math.sin(S)*x+T;for(var C=(M?-1:1)*Math.PI/2,R=E;M?R>S:R<S;R+=C){var L=M?Math.max(R+C,S):Math.min(R+C,S);l(R,L,m,T,w,x)}break;case Nr.R:o=a=r[p++],f=s=r[p++],c=o+r[p++],v=f+r[p++],u(c,f),h(c,f,c,v),h(c,v,o,v),h(o,v,o,f),h(o,f,c,f);break;case Nr.Z:n&&h(a,s,o,f),a=o,s=f;break}}return n&&n.length>2&&i.push(n),i}function jo(t,r,e,i,n,a,s,o,f,u){if(bi(t,e)&&bi(r,i)&&bi(n,s)&&bi(a,o)){f.push(s,o);return}var h=2/u,l=h*h,c=s-t,v=o-r,d=Math.sqrt(c*c+v*v);c/=d,v/=d;var _=e-t,p=i-r,y=n-s,g=a-o,m=_*_+p*p,T=y*y+g*g;if(m<l&&T<l){f.push(s,o);return}var w=c*_+v*p,x=-c*y-v*g,E=m-w*w,S=T-x*x;if(E<l&&w>=0&&S<l&&x>=0){f.push(s,o);return}var M=[],C=[];ve(t,e,n,s,.5,M),ve(r,i,a,o,.5,C),jo(M[0],C[0],M[1],C[1],M[2],C[2],M[3],C[3],f,u),jo(M[4],C[4],M[5],C[5],M[6],C[6],M[7],C[7],f,u)}function yy(t,r){var e=Zo(t),i=[];r=r||1;for(var n=0;n<e.length;n++){var a=e[n],s=[],o=a[0],f=a[1];s.push(o,f);for(var u=2;u<a.length;){var h=a[u++],l=a[u++],c=a[u++],v=a[u++],d=a[u++],_=a[u++];jo(o,f,h,l,c,v,d,_,s,r),o=d,f=_}i.push(s)}return i}function Zc(t,r,e){var i=t[r],n=t[1-r],a=Math.abs(i/n),s=Math.ceil(Math.sqrt(a*e)),o=Math.floor(e/s);o===0&&(o=1,s=e);for(var f=[],u=0;u<s;u++)f.push(o);var h=s*o,l=e-h;if(l>0)for(var u=0;u<l;u++)f[u%s]+=1;return f}function mh(t,r,e){for(var i=t.r0,n=t.r,a=t.startAngle,s=t.endAngle,o=Math.abs(s-a),f=o*n,u=n-i,h=f>Math.abs(u),l=Zc([f,u],h?0:1,r),c=(h?o:u)/l.length,v=0;v<l.length;v++)for(var d=(h?u:o)/l[v],_=0;_<l[v];_++){var p={};h?(p.startAngle=a+c*v,p.endAngle=a+c*(v+1),p.r0=i+d*_,p.r=i+d*(_+1)):(p.startAngle=a+d*_,p.endAngle=a+d*(_+1),p.r0=i+c*v,p.r=i+c*(v+1)),p.clockwise=t.clockwise,p.cx=t.cx,p.cy=t.cy,e.push(p)}}function gy(t,r,e){for(var i=t.width,n=t.height,a=i>n,s=Zc([i,n],a?0:1,r),o=a?"width":"height",f=a?"height":"width",u=a?"x":"y",h=a?"y":"x",l=t[o]/s.length,c=0;c<s.length;c++)for(var v=t[f]/s[c],d=0;d<s[c];d++){var _={};_[u]=c*l,_[h]=d*v,_[o]=l,_[f]=v,_.x+=t.x,_.y+=t.y,e.push(_)}}function Th(t,r,e,i){return t*i-e*r}function my(t,r,e,i,n,a,s,o){var f=e-t,u=i-r,h=s-n,l=o-a,c=Th(h,l,f,u);if(Math.abs(c)<1e-6)return null;var v=t-n,d=r-a,_=Th(v,d,h,l)/c;return _<0||_>1?null:new ut(_*f+t,_*u+r)}function Ty(t,r,e){var i=new ut;ut.sub(i,e,r),i.normalize();var n=new ut;ut.sub(n,t,r);var a=n.dot(i);return a}function fi(t,r){var e=t[t.length-1];e&&e[0]===r[0]&&e[1]===r[1]||t.push(r)}function xy(t,r,e){for(var i=t.length,n=[],a=0;a<i;a++){var s=t[a],o=t[(a+1)%i],f=my(s[0],s[1],o[0],o[1],r.x,r.y,e.x,e.y);f&&n.push({projPt:Ty(f,r,e),pt:f,idx:a})}if(n.length<2)return[{points:t},{points:t}];n.sort(function(p,y){return p.projPt-y.projPt});var u=n[0],h=n[n.length-1];if(h.idx<u.idx){var l=u;u=h,h=l}for(var c=[u.pt.x,u.pt.y],v=[h.pt.x,h.pt.y],d=[c],_=[v],a=u.idx+1;a<=h.idx;a++)fi(d,t[a].slice());fi(d,v),fi(d,c);for(var a=h.idx+1;a<=u.idx+i;a++)fi(_,t[a%i].slice());return fi(_,c),fi(_,v),[{points:d},{points:_}]}function xh(t){var r=t.points,e=[],i=[];dc(r,e,i);var n=new Mt(e[0],e[1],i[0]-e[0],i[1]-e[1]),a=n.width,s=n.height,o=n.x,f=n.y,u=new ut,h=new ut;return a>s?(u.x=h.x=o+a/2,u.y=f,h.y=f+s):(u.y=h.y=f+s/2,u.x=o,h.x=o+a),xy(r,u,h)}function za(t,r,e,i){if(e===1)i.push(r);else{var n=Math.floor(e/2),a=t(r);za(t,a[0],n,i),za(t,a[1],e-n,i)}return i}function wy(t,r){for(var e=[],i=0;i<r;i++)e.push(wc(t));return e}function Ey(t,r){r.setStyle(t.style),r.z=t.z,r.z2=t.z2,r.zlevel=t.zlevel}function by(t){for(var r=[],e=0;e<t.length;)r.push([t[e++],t[e++]]);return r}function Sy(t,r){var e=[],i=t.shape,n;switch(t.type){case"rect":gy(i,r,e),n=Sn;break;case"sector":mh(i,r,e),n=Go;break;case"circle":mh({r0:0,r:i.r,startAngle:0,endAngle:Math.PI*2,cx:i.cx,cy:i.cy},r,e),n=Go;break;default:var a=t.getComputedTransform(),s=a?Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1],a[2]*a[2]+a[3]*a[3])):1,o=Lt(yy(t.getUpdatedPathProxy(),s),function(y){return by(y)}),f=o.length;if(f===0)za(xh,{points:o[0]},r,e);else if(f===r)for(var u=0;u<f;u++)e.push({points:o[u]});else{var h=0,l=Lt(o,function(y){var g=[],m=[];dc(y,g,m);var T=(m[1]-g[1])*(m[0]-g[0]);return h+=T,{poly:y,area:T}});l.sort(function(y,g){return g.area-y.area});for(var c=r,u=0;u<f;u++){var v=l[u];if(c<=0)break;var d=u===f-1?c:Math.ceil(v.area/h*r);d<0||(za(xh,{points:v.poly},d,e),c-=d)}}n=Tf;break}if(!n)return wy(t,r);for(var _=[],u=0;u<e.length;u++){var p=new n;p.setShape(e[u]),Ey(t,p),_.push(p)}return _}function My(t,r){var e=t.length,i=r.length;if(e===i)return[t,r];for(var n=[],a=[],s=e<i?t:r,o=Math.min(e,i),f=Math.abs(i-e)/6,u=(o-2)/6,h=Math.ceil(f/u)+1,l=[s[0],s[1]],c=f,v=2;v<o;){var d=s[v-2],_=s[v-1],p=s[v++],y=s[v++],g=s[v++],m=s[v++],T=s[v++],w=s[v++];if(c<=0){l.push(p,y,g,m,T,w);continue}for(var x=Math.min(c,h-1)+1,E=1;E<=x;E++){var S=E/x;ve(d,p,g,T,S,n),ve(_,y,m,w,S,a),d=n[3],_=a[3],l.push(n[1],a[1],n[2],a[2],d,_),p=n[5],y=a[5],g=n[6],m=a[6]}c-=x-1}return s===t?[l,r]:[t,l]}function wh(t,r){for(var e=t.length,i=t[e-2],n=t[e-1],a=[],s=0;s<r.length;)a[s++]=i,a[s++]=n;return a}function Ay(t,r){for(var e,i,n,a=[],s=[],o=0;o<Math.max(t.length,r.length);o++){var f=t[o],u=r[o],h=void 0,l=void 0;f?u?(e=My(f,u),h=e[0],l=e[1],i=h,n=l):(l=wh(n||f,f),h=f):(h=wh(i||u,u),l=u),a.push(h),s.push(l)}return[a,s]}function Eh(t){for(var r=0,e=0,i=0,n=t.length,a=0,s=n-2;a<n;s=a,a+=2){var o=t[s],f=t[s+1],u=t[a],h=t[a+1],l=o*h-u*f;r+=l,e+=(o+u)*l,i+=(f+h)*l}return r===0?[t[0]||0,t[1]||0]:[e/r/3,i/r/3,r]}function Ry(t,r,e,i){for(var n=(t.length-2)/6,a=1/0,s=0,o=t.length,f=o-2,u=0;u<n;u++){for(var h=u*6,l=0,c=0;c<o;c+=2){var v=c===0?h:(h+c-2)%f+2,d=t[v]-e[0],_=t[v+1]-e[1],p=r[c]-i[0],y=r[c+1]-i[1],g=p-d,m=y-_;l+=g*g+m*m}l<a&&(a=l,s=u)}return s}function Cy(t){for(var r=[],e=t.length,i=0;i<e;i+=2)r[i]=t[e-i-2],r[i+1]=t[e-i-1];return r}function Py(t,r,e,i){for(var n=[],a,s=0;s<t.length;s++){var o=t[s],f=r[s],u=Eh(o),h=Eh(f);a==null&&(a=u[2]<0!=h[2]<0);var l=[],c=[],v=0,d=1/0,_=[],p=o.length;a&&(o=Cy(o));for(var y=Ry(o,f,u,h)*6,g=p-2,m=0;m<g;m+=2){var T=(y+m)%g+2;l[m+2]=o[T]-u[0],l[m+3]=o[T+1]-u[1]}l[0]=o[y]-u[0],l[1]=o[y+1]-u[1];for(var w=i/e,x=-i/2;x<=i/2;x+=w){for(var E=Math.sin(x),S=Math.cos(x),M=0,m=0;m<o.length;m+=2){var C=l[m],R=l[m+1],L=f[m]-h[0],D=f[m+1]-h[1],P=L*S-D*E,z=L*E+D*S;_[m]=P,_[m+1]=z;var A=P-C,B=z-R;M+=A*A+B*B}if(M<d){d=M,v=x;for(var k=0;k<_.length;k++)c[k]=_[k]}}n.push({from:l,to:c,fromCp:u,toCp:h,rotation:-v})}return n}function $o(t){return t.__isCombineMorphing}var jc="__mOriginal_";function ka(t,r,e){var i=jc+r,n=t[i]||t[r];t[i]||(t[i]=t[r]);var a=e.replace,s=e.after,o=e.before;t[r]=function(){var f=arguments,u;return o&&o.apply(this,f),a?u=a.apply(this,f):u=n.apply(this,f),s&&s.apply(this,f),u}}function yn(t,r){var e=jc+r;t[e]&&(t[r]=t[e],t[e]=null)}function bh(t,r){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.length;){var a=i[n],s=i[n+1];i[n++]=r[0]*a+r[2]*s+r[4],i[n++]=r[1]*a+r[3]*s+r[5]}}function $c(t,r){var e=t.getUpdatedPathProxy(),i=r.getUpdatedPathProxy(),n=Ay(Zo(e),Zo(i)),a=n[0],s=n[1],o=t.getComputedTransform(),f=r.getComputedTransform();function u(){this.transform=null}o&&bh(a,o),f&&bh(s,f),ka(r,"updateTransform",{replace:u}),r.transform=null;var h=Py(a,s,10,Math.PI),l=[];ka(r,"buildPath",{replace:function(c){for(var v=r.__morphT,d=1-v,_=[],p=0;p<h.length;p++){var y=h[p],g=y.from,m=y.to,T=y.rotation*v,w=y.fromCp,x=y.toCp,E=Math.sin(T),S=Math.cos(T);Il(_,w,x,v);for(var M=0;M<g.length;M+=2){var C=g[M],R=g[M+1],L=m[M],D=m[M+1],P=C*d+L*v,z=R*d+D*v;l[M]=P*S-z*E+_[0],l[M+1]=P*E+z*S+_[1]}var A=l[0],B=l[1];c.moveTo(A,B);for(var M=2;M<g.length;){var L=l[M++],D=l[M++],k=l[M++],j=l[M++],$=l[M++],rt=l[M++];A===L&&B===D&&k===$&&j===rt?c.lineTo($,rt):c.bezierCurveTo(L,D,k,j,$,rt),A=$,B=rt}}}})}function Kc(t,r,e){if(!t||!r)return r;var i=e.done,n=e.during;$c(t,r),r.__morphT=0;function a(){yn(r,"buildPath"),yn(r,"updateTransform"),r.__morphT=-1,r.createPathProxy(),r.dirtyShape()}return r.animateTo({__morphT:1},lr({during:function(s){r.dirtyShape(),n&&n(s)},done:function(){a(),i&&i()}},e)),r}function Ly(t,r,e,i,n,a){var s=16;t=n===e?0:Math.round(32767*(t-e)/(n-e)),r=a===i?0:Math.round(32767*(r-i)/(a-i));for(var o=0,f,u=(1<<s)/2;u>0;u/=2){var h=0,l=0;(t&u)>0&&(h=1),(r&u)>0&&(l=1),o+=u*u*(3*h^l),l===0&&(h===1&&(t=u-1-t,r=u-1-r),f=t,t=r,r=f)}return o}function Ga(t){var r=1/0,e=1/0,i=-1/0,n=-1/0,a=Lt(t,function(o){var f=o.getBoundingRect(),u=o.getComputedTransform(),h=f.x+f.width/2+(u?u[4]:0),l=f.y+f.height/2+(u?u[5]:0);return r=Math.min(h,r),e=Math.min(l,e),i=Math.max(h,i),n=Math.max(l,n),[h,l]}),s=Lt(a,function(o,f){return{cp:o,z:Ly(o[0],o[1],r,e,i,n),path:t[f]}});return s.sort(function(o,f){return o.z-f.z}).map(function(o){return o.path})}function Qc(t){return Sy(t.path,t.count)}function Ko(){return{fromIndividuals:[],toIndividuals:[],count:0}}function am(t,r,e){var i=[];function n(w){for(var x=0;x<w.length;x++){var E=w[x];$o(E)?n(E.childrenRef()):E instanceof Dt&&i.push(E)}}n(t);var a=i.length;if(!a)return Ko();var s=e.dividePath||Qc,o=s({path:r,count:a});if(o.length!==a)return console.error("Invalid morphing: unmatched splitted path"),Ko();i=Ga(i),o=Ga(o);for(var f=e.done,u=e.during,h=e.individualDelay,l=new gf,c=0;c<a;c++){var v=i[c],d=o[c];d.parent=r,d.copyTransform(l),h||$c(v,d)}r.__isCombineMorphing=!0,r.childrenRef=function(){return o};function _(w){for(var x=0;x<o.length;x++)o[x].addSelfToZr(w)}ka(r,"addSelfToZr",{after:function(w){_(w)}}),ka(r,"removeSelfFromZr",{after:function(w){for(var x=0;x<o.length;x++)o[x].removeSelfFromZr(w)}});function p(){r.__isCombineMorphing=!1,r.__morphT=-1,r.childrenRef=null,yn(r,"addSelfToZr"),yn(r,"removeSelfFromZr")}var y=o.length;if(h)for(var g=y,m=function(){g--,g===0&&(p(),f&&f())},c=0;c<y;c++){var T=h?lr({delay:(e.delay||0)+h(c,y,i[c],o[c]),done:m},e):e;Kc(i[c],o[c],T)}else r.__morphT=0,r.animateTo({__morphT:1},lr({during:function(w){for(var x=0;x<y;x++){var E=o[x];E.__morphT=r.__morphT,E.dirtyShape()}u&&u(w)},done:function(){p();for(var w=0;w<t.length;w++)yn(t[w],"updateTransform");f&&f()}},e));return r.__zr&&_(r.__zr),{fromIndividuals:i,toIndividuals:o,count:y}}function sm(t,r,e){var i=r.length,n=[],a=e.dividePath||Qc;function s(v){for(var d=0;d<v.length;d++){var _=v[d];$o(_)?s(_.childrenRef()):_ instanceof Dt&&n.push(_)}}if($o(t)){s(t.childrenRef());var o=n.length;if(o<i)for(var f=0,u=o;u<i;u++)n.push(wc(n[f++%o]));n.length=i}else{n=a({path:t,count:i});for(var h=t.getComputedTransform(),u=0;u<n.length;u++)n[u].setLocalTransform(h);if(n.length!==i)return console.error("Invalid morphing: unmatched splitted path"),Ko()}n=Ga(n),r=Ga(r);for(var l=e.individualDelay,u=0;u<i;u++){var c=l?lr({delay:(e.delay||0)+l(u,i,n[u],r[u])},e):e;Kc(n[u],r[u],c)}return{fromIndividuals:n,toIndividuals:r,count:r.length}}var Gr={},Wr={},Zs={},Sh;function Dy(){return Sh||(Sh=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=1,e=function(){return"".concat(r++)};t.default=e})(Zs)),Zs}var Ki={},Qi={},js={},Mh;function Jc(){return Mh||(Mh=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(i){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:60,a=null;return function(){for(var s=this,o=arguments.length,f=new Array(o),u=0;u<o;u++)f[u]=arguments[u];clearTimeout(a),a=setTimeout(function(){i.apply(s,f)},n)}};t.default=r})(js)),js}var Vr={},Ah;function Rf(){if(Ah)return Vr;Ah=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.SizeSensorId=Vr.SensorTabIndex=Vr.SensorClassName=void 0;var t="size-sensor-id";Vr.SizeSensorId=t;var r="size-sensor-object";Vr.SensorClassName=r;var e="-1";return Vr.SensorTabIndex=e,Vr}var Rh;function Oy(){if(Rh)return Qi;Rh=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.createSensor=void 0;var t=e(Jc()),r=Rf();function e(n){return n&&n.__esModule?n:{default:n}}var i=function(a,s){var o=void 0,f=[],u=function(){getComputedStyle(a).position==="static"&&(a.style.position="relative");var _=document.createElement("object");return _.onload=function(){_.contentDocument.defaultView.addEventListener("resize",h),h()},_.style.display="block",_.style.position="absolute",_.style.top="0",_.style.left="0",_.style.height="100%",_.style.width="100%",_.style.overflow="hidden",_.style.pointerEvents="none",_.style.zIndex="-1",_.style.opacity="0",_.setAttribute("class",r.SensorClassName),_.setAttribute("tabindex",r.SensorTabIndex),_.type="text/html",a.appendChild(_),_.data="about:blank",_},h=(0,t.default)(function(){f.forEach(function(d){d(a)})}),l=function(_){o||(o=u()),f.indexOf(_)===-1&&f.push(_)},c=function(){o&&o.parentNode&&(o.contentDocument&&o.contentDocument.defaultView.removeEventListener("resize",h),o.parentNode.removeChild(o),a.removeAttribute(r.SizeSensorId),o=void 0,f=[],s&&s())},v=function(_){var p=f.indexOf(_);p!==-1&&f.splice(p,1),f.length===0&&o&&c()};return{element:a,bind:l,destroy:c,unbind:v}};return Qi.createSensor=i,Qi}var Ji={},Ch;function Iy(){if(Ch)return Ji;Ch=1,Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.createSensor=void 0;var t=Rf(),r=e(Jc());function e(n){return n&&n.__esModule?n:{default:n}}var i=function(a,s){var o=void 0,f=[],u=(0,r.default)(function(){f.forEach(function(d){d(a)})}),h=function(){var _=new ResizeObserver(u);return _.observe(a),u(),_},l=function(_){o||(o=h()),f.indexOf(_)===-1&&f.push(_)},c=function(){o.disconnect(),f=[],o=void 0,a.removeAttribute(t.SizeSensorId),s&&s()},v=function(_){var p=f.indexOf(_);p!==-1&&f.splice(p,1),f.length===0&&o&&c()};return{element:a,bind:l,destroy:c,unbind:v}};return Ji.createSensor=i,Ji}var Ph;function Ny(){if(Ph)return Ki;Ph=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.createSensor=void 0;var t=Oy(),r=Iy(),e=typeof ResizeObserver<"u"?r.createSensor:t.createSensor;return Ki.createSensor=e,Ki}var Lh;function Fy(){if(Lh)return Wr;Lh=1,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.removeSensor=Wr.getSensor=Wr.Sensors=void 0;var t=i(Dy()),r=Ny(),e=Rf();function i(f){return f&&f.__esModule?f:{default:f}}var n={};Wr.Sensors=n;function a(f){f&&n[f]&&delete n[f]}var s=function(u){var h=u.getAttribute(e.SizeSensorId);if(h&&n[h])return n[h];var l=(0,t.default)();u.setAttribute(e.SizeSensorId,l);var c=(0,r.createSensor)(u,function(){return a(l)});return n[l]=c,c};Wr.getSensor=s;var o=function(u){var h=u.element.getAttribute(e.SizeSensorId);u.destroy(),a(h)};return Wr.removeSensor=o,Wr}var Dh;function By(){if(Dh)return Gr;Dh=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.ver=Gr.clear=Gr.bind=void 0;var t=Fy(),r=function(a,s){var o=(0,t.getSensor)(a);return o.bind(s),function(){o.unbind(s)}};Gr.bind=r;var e=function(a){var s=(0,t.getSensor)(a);(0,t.removeSensor)(s)};Gr.clear=e;var i="1.0.2";return Gr.ver=i,Gr}var om=By(),$s,Oh;function Uy(){return Oh||(Oh=1,$s=function t(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){if(r.constructor!==e.constructor)return!1;var i,n,a;if(Array.isArray(r)){if(i=r.length,i!=e.length)return!1;for(n=i;n--!==0;)if(!t(r[n],e[n]))return!1;return!0}if(r.constructor===RegExp)return r.source===e.source&&r.flags===e.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===e.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===e.toString();if(a=Object.keys(r),i=a.length,i!==Object.keys(e).length)return!1;for(n=i;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,a[n]))return!1;for(n=i;n--!==0;){var s=a[n];if(!t(r[s],e[s]))return!1}return!0}return r!==r&&e!==e}),$s}var Hy=Uy();const fm=dv(Hy);function Ih(t,r,e){typeof r=="object"&&(e=r,r=null);var i=this,n;if(!(t instanceof Function)){n=[];for(var a in t)t.hasOwnProperty(a)&&n.push(a)}var s=function(f){if(i.apply(this,arguments),t instanceof Function?Nh(this,t.call(this,f)):zy(this,t,n),this.constructor===s)for(var u=s.__initializers__,h=0;h<u.length;h++)u[h].apply(this,arguments)};s.__super__=i,i.__initializers__?s.__initializers__=i.__initializers__.slice():s.__initializers__=[],r&&s.__initializers__.push(r);var o=function(){};return o.prototype=i.prototype,s.prototype=new o,s.prototype.constructor=s,Nh(s.prototype,e),s.extend=i.extend,s.derive=i.extend,s}function Nh(t,r){if(r)for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])}function zy(t,r,e){for(var i=0;i<e.length;i++){var n=e[i];t[n]=r[n]}}const ky={extend:Ih,derive:Ih};function Gy(t,r){this.action=t,this.context=r}var Wy={trigger:function(t){if(this.hasOwnProperty("__handlers__")&&this.__handlers__.hasOwnProperty(t)){var r=this.__handlers__[t],e=r.length,i=-1,n=arguments;switch(n.length){case 1:for(;++i<e;)r[i].action.call(r[i].context);return;case 2:for(;++i<e;)r[i].action.call(r[i].context,n[1]);return;case 3:for(;++i<e;)r[i].action.call(r[i].context,n[1],n[2]);return;case 4:for(;++i<e;)r[i].action.call(r[i].context,n[1],n[2],n[3]);return;case 5:for(;++i<e;)r[i].action.call(r[i].context,n[1],n[2],n[3],n[4]);return;default:for(;++i<e;)r[i].action.apply(r[i].context,Array.prototype.slice.call(n,1));return}}},on:function(t,r,e){if(!(!t||!r)){var i=this.__handlers__||(this.__handlers__={});if(!i[t])i[t]=[];else if(this.has(t,r))return;var n=new Gy(r,e||this);return i[t].push(n),this}},once:function(t,r,e){if(!t||!r)return;var i=this;function n(){i.off(t,n),r.apply(this,arguments)}return this.on(t,n,e)},before:function(t,r,e){if(!(!t||!r))return t="before"+t,this.on(t,r,e)},after:function(t,r,e){if(!(!t||!r))return t="after"+t,this.on(t,r,e)},success:function(t,r){return this.once("success",t,r)},error:function(t,r){return this.once("error",t,r)},off:function(t,r){var e=this.__handlers__||(this.__handlers__={});if(!r){e[t]=[];return}if(e[t]){for(var i=e[t],n=[],a=0;a<i.length;a++)r&&i[a].action!==r&&n.push(i[a]);e[t]=n}return this},has:function(t,r){var e=this.__handlers__;if(!e||!e[t])return!1;for(var i=e[t],n=0;n<i.length;n++)if(i[n].action===r)return!0}},Vy=0,qy=Array.prototype,Xy=qy.forEach,Ct={genGUID:function(){return++Vy},relative2absolute:function(t,r){if(!r||t.match(/^\//))return t;for(var e=t.split("/"),i=r.split("/"),n=e[0];n==="."||n==="..";)n===".."&&i.pop(),e.shift(),n=e[0];return i.join("/")+"/"+e.join("/")},extend:function(t,r){if(r)for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);return t},defaults:function(t,r){if(r)for(var e in r)t[e]===void 0&&(t[e]=r[e]);return t},extendWithPropList:function(t,r,e){if(r)for(var i=0;i<e.length;i++){var n=e[i];t[n]=r[n]}return t},defaultsWithPropList:function(t,r,e){if(r)for(var i=0;i<e.length;i++){var n=e[i];t[n]==null&&(t[n]=r[n])}return t},each:function(t,r,e){if(t&&r)if(t.forEach&&t.forEach===Xy)t.forEach(r,e);else if(t.length===+t.length)for(var i=0,n=t.length;i<n;i++)r.call(e,t[i],i,t);else for(var a in t)t.hasOwnProperty(a)&&r.call(e,t[a],a,t)},isObject:function(t){return t===Object(t)},isArray:function(t){return Array.isArray(t)},isArrayLike:function(t){return t?t.length===+t.length:!1},clone:function(t){if(Ct.isObject(t)){if(Ct.isArray(t))return t.slice();if(Ct.isArrayLike(t)){for(var r=new t.constructor(t.length),e=0;e<t.length;e++)r[e]=t[e];return r}else return Ct.extend({},t)}else return t}},Vt=function(){this.__uid__=Ct.genGUID()};Vt.__initializers__=[function(t){Ct.extend(this,t)}];Ct.extend(Vt,ky);Ct.extend(Vt.prototype,Wy);var Fh=["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_shader_texture_lod","WEBGL_draw_buffers","EXT_frag_depth","EXT_sRGB","ANGLE_instanced_arrays"],Bh=["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE"];function Yy(t){for(var r={},e={},i=0;i<Fh.length;i++){var n=Fh[i];s(n)}for(var i=0;i<Bh.length;i++){var a=Bh[i];e[a]=t.getParameter(t[a])}this.getExtension=function(o){return o in r||s(o),r[o]},this.getParameter=function(o){return e[o]};function s(o){if(t.getExtension){var f=t.getExtension(o);f||(f=t.getExtension("MOZ_"+o)),f||(f=t.getExtension("WEBKIT_"+o)),r[o]=f}}}const I={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CW:2304,CCW:2305,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FRAMEBUFFER:36160,RENDERBUFFER:36161,DEPTH_STENCIL:34041,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306};function Zy(t){var r=new XMLHttpRequest;r.open("get",t.url),r.responseType=t.responseType||"text",t.onprogress&&(r.onprogress=function(e){if(e.lengthComputable){var i=e.loaded/e.total;t.onprogress(i,e.loaded,e.total)}else t.onprogress(null)}),r.onload=function(e){r.status>=400?t.onerror&&t.onerror():t.onload&&t.onload(r.response)},t.onerror&&(r.onerror=t.onerror),r.send(null)}const jy={get:Zy};var Ks,at={};at.supportWebGL=function(){if(Ks==null)try{var t=document.createElement("canvas"),r=t.getContext("webgl")||t.getContext("experimental-webgl");if(!r)throw new Error}catch{Ks=!1}return Ks};at.Int8Array=typeof Int8Array>"u"?Array:Int8Array;at.Uint8Array=typeof Uint8Array>"u"?Array:Uint8Array;at.Uint16Array=typeof Uint16Array>"u"?Array:Uint16Array;at.Uint32Array=typeof Uint32Array>"u"?Array:Uint32Array;at.Int16Array=typeof Int16Array>"u"?Array:Int16Array;at.Float32Array=typeof Float32Array>"u"?Array:Float32Array;at.Float64Array=typeof Float64Array>"u"?Array:Float64Array;var Ve={};typeof window<"u"?Ve=window:typeof global<"u"&&(Ve=global);at.requestAnimationFrame=Ve.requestAnimationFrame||Ve.msRequestAnimationFrame||Ve.mozRequestAnimationFrame||Ve.webkitRequestAnimationFrame||function(t){setTimeout(t,16)};at.createCanvas=function(){return document.createElement("canvas")};at.createImage=function(){return new Ve.Image};at.request={get:jy.get};at.addEventListener=function(t,r,e,i){t.addEventListener(r,e,i)};at.removeEventListener=function(t,r,e){t.removeEventListener(r,e)};var Nt=function(){this.head=null,this.tail=null,this._length=0};Nt.prototype.insert=function(t){var r=new Nt.Entry(t);return this.insertEntry(r),r};Nt.prototype.insertAt=function(t,r){if(!(t<0)){for(var e=this.head,i=0;e&&i!=t;)e=e.next,i++;if(e){var n=new Nt.Entry(r),a=e.prev;a?(a.next=n,n.prev=a):this.head=n,n.next=e,e.prev=n}else this.insert(r)}};Nt.prototype.insertBeforeEntry=function(t,r){var e=new Nt.Entry(t),i=r.prev;i?(i.next=e,e.prev=i):this.head=e,e.next=r,r.prev=e,this._length++};Nt.prototype.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,this.tail=t):this.head=this.tail=t,this._length++};Nt.prototype.remove=function(t){var r=t.prev,e=t.next;r?r.next=e:this.head=e,e?e.prev=r:this.tail=r,t.next=t.prev=null,this._length--};Nt.prototype.removeAt=function(t){if(!(t<0)){for(var r=this.head,e=0;r&&e!=t;)r=r.next,e++;if(r)return this.remove(r),r.value}};Nt.prototype.getHead=function(){if(this.head)return this.head.value};Nt.prototype.getTail=function(){if(this.tail)return this.tail.value};Nt.prototype.getAt=function(t){if(!(t<0)){for(var r=this.head,e=0;r&&e!=t;)r=r.next,e++;return r.value}};Nt.prototype.indexOf=function(t){for(var r=this.head,e=0;r;){if(r.value===t)return e;r=r.next,e++}};Nt.prototype.length=function(){return this._length};Nt.prototype.isEmpty=function(){return this._length===0};Nt.prototype.forEach=function(t,r){for(var e=this.head,i=0,n=typeof r<"u";e;)n?t.call(r,e.value,i):t(e.value,i),e=e.next,i++};Nt.prototype.clear=function(){this.tail=this.head=null,this._length=0};Nt.Entry=function(t){this.value=t,this.next=null,this.prev=null};var ti=function(t){this._list=new Nt,this._map={},this._maxSize=t||10};ti.prototype.setMaxSize=function(t){this._maxSize=t};ti.prototype.put=function(t,r){if(!this._map.hasOwnProperty(t)){var e=this._list.length();if(e>=this._maxSize&&e>0){var i=this._list.head;this._list.remove(i),delete this._map[i.key]}var n=this._list.insert(r);n.key=t,this._map[t]=n}};ti.prototype.get=function(t){var r=this._map[t];if(this._map.hasOwnProperty(t))return r!==this._list.tail&&(this._list.remove(r),this._list.insertEntry(r)),r.value};ti.prototype.remove=function(t){var r=this._map[t];typeof r<"u"&&(delete this._map[t],this._list.remove(r))};ti.prototype.clear=function(){this._list.clear(),this._map={}};var Et={},Uh={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Sr(t){return t=Math.round(t),t<0?0:t>255?255:t}function $y(t){return t=Math.round(t),t<0?0:t>360?360:t}function Cn(t){return t<0?0:t>1?1:t}function Qs(t){return t.length&&t.charAt(t.length-1)==="%"?Sr(parseFloat(t)/100*255):Sr(parseInt(t,10))}function Ii(t){return t.length&&t.charAt(t.length-1)==="%"?Cn(parseFloat(t)/100):Cn(parseFloat(t))}function Js(t,r,e){return e<0?e+=1:e>1&&(e-=1),e*6<1?t+(r-t)*e*6:e*2<1?r:e*3<2?t+(r-t)*(2/3-e)*6:t}function se(t,r,e){return t+(r-t)*e}function Tr(t,r,e,i,n){return t[0]=r,t[1]=e,t[2]=i,t[3]=n,t}function Qo(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}var tv=new ti(20),aa=null;function ui(t,r){aa&&Qo(aa,r),aa=tv.put(t,aa||r.slice())}Et.parse=function(t,r){if(t){r=r||[];var e=tv.get(t);if(e)return Qo(r,e);t=t+"";var i=t.replace(/ /g,"").toLowerCase();if(i in Uh)return Qo(r,Uh[i]),ui(t,r),r;if(i.charAt(0)==="#"){if(i.length===4){var n=parseInt(i.substr(1),16);if(!(n>=0&&n<=4095)){Tr(r,0,0,0,1);return}return Tr(r,(n&3840)>>4|(n&3840)>>8,n&240|(n&240)>>4,n&15|(n&15)<<4,1),ui(t,r),r}else if(i.length===7){var n=parseInt(i.substr(1),16);if(!(n>=0&&n<=16777215)){Tr(r,0,0,0,1);return}return Tr(r,(n&16711680)>>16,(n&65280)>>8,n&255,1),ui(t,r),r}return}var a=i.indexOf("("),s=i.indexOf(")");if(a!==-1&&s+1===i.length){var o=i.substr(0,a),f=i.substr(a+1,s-(a+1)).split(","),u=1;switch(o){case"rgba":if(f.length!==4){Tr(r,0,0,0,1);return}u=Ii(f.pop());case"rgb":if(f.length!==3){Tr(r,0,0,0,1);return}return Tr(r,Qs(f[0]),Qs(f[1]),Qs(f[2]),u),ui(t,r),r;case"hsla":if(f.length!==4){Tr(r,0,0,0,1);return}return f[3]=Ii(f[3]),Jo(f,r),ui(t,r),r;case"hsl":if(f.length!==3){Tr(r,0,0,0,1);return}return Jo(f,r),ui(t,r),r;default:return}}Tr(r,0,0,0,1)}};Et.parseToFloat=function(t,r){if(r=Et.parse(t,r),!!r)return r[0]/=255,r[1]/=255,r[2]/=255,r};function Jo(t,r){var e=(parseFloat(t[0])%360+360)%360/360,i=Ii(t[1]),n=Ii(t[2]),a=n<=.5?n*(i+1):n+i-n*i,s=n*2-a;return r=r||[],Tr(r,Sr(Js(s,a,e+1/3)*255),Sr(Js(s,a,e)*255),Sr(Js(s,a,e-1/3)*255),1),t.length===4&&(r[3]=t[3]),r}function Ky(t){if(t){var r=t[0]/255,e=t[1]/255,i=t[2]/255,n=Math.min(r,e,i),a=Math.max(r,e,i),s=a-n,o=(a+n)/2,f,u;if(s===0)f=0,u=0;else{o<.5?u=s/(a+n):u=s/(2-a-n);var h=((a-r)/6+s/2)/s,l=((a-e)/6+s/2)/s,c=((a-i)/6+s/2)/s;r===a?f=c-l:e===a?f=1/3+h-c:i===a&&(f=2/3+l-h),f<0&&(f+=1),f>1&&(f-=1)}var v=[f*360,u,o];return t[3]!=null&&v.push(t[3]),v}}Et.lift=function(t,r){var e=Et.parse(t);if(e){for(var i=0;i<3;i++)r<0?e[i]=e[i]*(1-r)|0:e[i]=(255-e[i])*r+e[i]|0;return Et.stringify(e,e.length===4?"rgba":"rgb")}};Et.toHex=function(t){var r=Et.parse(t);if(r)return((1<<24)+(r[0]<<16)+(r[1]<<8)+ +r[2]).toString(16).slice(1)};Et.fastLerp=function(t,r,e){if(!(!(r&&r.length)||!(t>=0&&t<=1))){e=e||[];var i=t*(r.length-1),n=Math.floor(i),a=Math.ceil(i),s=r[n],o=r[a],f=i-n;return e[0]=Sr(se(s[0],o[0],f)),e[1]=Sr(se(s[1],o[1],f)),e[2]=Sr(se(s[2],o[2],f)),e[3]=Cn(se(s[3],o[3],f)),e}};Et.fastMapToColor=Et.fastLerp;Et.lerp=function(t,r,e){if(!(!(r&&r.length)||!(t>=0&&t<=1))){var i=t*(r.length-1),n=Math.floor(i),a=Math.ceil(i),s=Et.parse(r[n]),o=Et.parse(r[a]),f=i-n,u=Et.stringify([Sr(se(s[0],o[0],f)),Sr(se(s[1],o[1],f)),Sr(se(s[2],o[2],f)),Cn(se(s[3],o[3],f))],"rgba");return e?{color:u,leftIndex:n,rightIndex:a,value:i}:u}};Et.mapToColor=Et.lerp;Et.modifyHSL=function(t,r,e,i){if(t=Et.parse(t),t)return t=Ky(t),r!=null&&(t[0]=$y(r)),e!=null&&(t[1]=Ii(e)),i!=null&&(t[2]=Ii(i)),Et.stringify(Jo(t),"rgba")};Et.modifyAlpha=function(t,r){if(t=Et.parse(t),t&&r!=null)return t[3]=Cn(r),Et.stringify(t,"rgba")};Et.stringify=function(t,r){if(!(!t||!t.length)){var e=t[0]+","+t[1]+","+t[2];return(r==="rgba"||r==="hsva"||r==="hsla")&&(e+=","+t[3]),r+"("+e+")"}};var Qy=Et.parseToFloat,to={};function Hh(t){var r=Object.keys(t);r.sort();for(var e=[],i=0;i<r.length;i++){var n=r[i],a=t[n];a===null?e.push(n):e.push(n+" "+a.toString())}return e.join(`
`)}function Jy(t,r,e){e.sort();for(var i=[],n=0;n<e.length;n++){var a=e[n];i.push(a)}var s=Hh(t)+`
`+Hh(r)+`
`+i.join(`
`);if(to[s])return to[s];var o=Ct.genGUID();return to[s]=o,o}var Nn=Vt.extend(function(){return{name:"",depthTest:!0,depthMask:!0,transparent:!1,blend:null,autoUpdateTextureStatus:!0,uniforms:{},vertexDefines:{},fragmentDefines:{},_textureStatus:{},_enabledUniforms:null}},function(){this.name||(this.name="MATERIAL_"+this.__uid__),this.shader&&this.attachShader(this.shader,!0)},{precision:"highp",setUniform:function(t,r){r===void 0&&console.warn('Uniform value "'+t+'" is undefined');var e=this.uniforms[t];e&&(typeof r=="string"&&(r=Qy(r)||r),e.value=r,this.autoUpdateTextureStatus&&e.type==="t"&&(r?this.enableTexture(t):this.disableTexture(t)))},setUniforms:function(t){for(var r in t){var e=t[r];this.setUniform(r,e)}},isUniformEnabled:function(t){return this._enabledUniforms.indexOf(t)>=0},getEnabledUniforms:function(){return this._enabledUniforms},getTextureUniforms:function(){return this._textureUniforms},set:function(t,r){if(typeof t=="object")for(var e in t){var i=t[e];this.setUniform(e,i)}else this.setUniform(t,r)},get:function(t){var r=this.uniforms[t];if(r)return r.value},attachShader:function(t,r){var e=this.uniforms;this.uniforms=t.createUniforms(),this.shader=t;var i=this.uniforms;this._enabledUniforms=Object.keys(i),this._enabledUniforms.sort(),this._textureUniforms=this._enabledUniforms.filter(function(u){var h=this.uniforms[u].type;return h==="t"||h==="tv"},this);var n=this.vertexDefines,a=this.fragmentDefines;if(this.vertexDefines=Ct.clone(t.vertexDefines),this.fragmentDefines=Ct.clone(t.fragmentDefines),r){for(var s in e)i[s]&&(i[s].value=e[s].value);Ct.defaults(this.vertexDefines,n),Ct.defaults(this.fragmentDefines,a)}var o={};for(var f in t.textures)o[f]={shaderType:t.textures[f].shaderType,type:t.textures[f].type,enabled:r&&this._textureStatus[f]?this._textureStatus[f].enabled:!1};this._textureStatus=o,this._programKey=""},clone:function(){var t=new this.constructor({name:this.name,shader:this.shader});for(var r in this.uniforms)t.uniforms[r].value=this.uniforms[r].value;return t.depthTest=this.depthTest,t.depthMask=this.depthMask,t.transparent=this.transparent,t.blend=this.blend,t.vertexDefines=Ct.clone(this.vertexDefines),t.fragmentDefines=Ct.clone(this.fragmentDefines),t.enableTexture(this.getEnabledTextures()),t.precision=this.precision,t},define:function(t,r,e){var i=this.vertexDefines,n=this.fragmentDefines;t!=="vertex"&&t!=="fragment"&&t!=="both"&&arguments.length<3&&(e=r,r=t,t="both"),e=e??null,(t==="vertex"||t==="both")&&i[r]!==e&&(i[r]=e,this._programKey=""),(t==="fragment"||t==="both")&&n[r]!==e&&(n[r]=e,t!=="both"&&(this._programKey=""))},undefine:function(t,r){t!=="vertex"&&t!=="fragment"&&t!=="both"&&arguments.length<2&&(r=t,t="both"),(t==="vertex"||t==="both")&&this.isDefined("vertex",r)&&(delete this.vertexDefines[r],this._programKey=""),(t==="fragment"||t==="both")&&this.isDefined("fragment",r)&&(delete this.fragmentDefines[r],t!=="both"&&(this._programKey=""))},isDefined:function(t,r){switch(t){case"vertex":return this.vertexDefines[r]!==void 0;case"fragment":return this.fragmentDefines[r]!==void 0}},getDefine:function(t,r){switch(t){case"vertex":return this.vertexDefines[r];case"fragment":return this.fragmentDefines[r]}},enableTexture:function(t){if(Array.isArray(t)){for(var r=0;r<t.length;r++)this.enableTexture(t[r]);return}var e=this._textureStatus[t];if(e){var i=e.enabled;i||(e.enabled=!0,this._programKey="")}},enableTexturesAll:function(){var t=this._textureStatus;for(var r in t)t[r].enabled=!0;this._programKey=""},disableTexture:function(t){if(Array.isArray(t)){for(var r=0;r<t.length;r++)this.disableTexture(t[r]);return}var e=this._textureStatus[t];if(e){var i=!e.enabled;i||(e.enabled=!1,this._programKey="")}},disableTexturesAll:function(){var t=this._textureStatus;for(var r in t)t[r].enabled=!1;this._programKey=""},isTextureEnabled:function(t){var r=this._textureStatus;return!!r[t]&&r[t].enabled},getEnabledTextures:function(){var t=[],r=this._textureStatus;for(var e in r)r[e].enabled&&t.push(e);return t},dirtyDefines:function(){this._programKey=""},getProgramKey:function(){return this._programKey||(this._programKey=Jy(this.vertexDefines,this.fragmentDefines,this.getEnabledTextures())),this._programKey}}),ma=1e-6,Bt=Array,Si=Math.random,U={};U.create=function(){var t=new Bt(2);return t[0]=0,t[1]=0,t};U.clone=function(t){var r=new Bt(2);return r[0]=t[0],r[1]=t[1],r};U.fromValues=function(t,r){var e=new Bt(2);return e[0]=t,e[1]=r,e};U.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t};U.set=function(t,r,e){return t[0]=r,t[1]=e,t};U.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t};U.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t};U.sub=U.subtract;U.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t};U.mul=U.multiply;U.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t};U.div=U.divide;U.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t};U.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t};U.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t};U.scaleAndAdd=function(t,r,e,i){return t[0]=r[0]+e[0]*i,t[1]=r[1]+e[1]*i,t};U.distance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1];return Math.sqrt(e*e+i*i)};U.dist=U.distance;U.squaredDistance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1];return e*e+i*i};U.sqrDist=U.squaredDistance;U.length=function(t){var r=t[0],e=t[1];return Math.sqrt(r*r+e*e)};U.len=U.length;U.squaredLength=function(t){var r=t[0],e=t[1];return r*r+e*e};U.sqrLen=U.squaredLength;U.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t};U.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t};U.normalize=function(t,r){var e=r[0],i=r[1],n=e*e+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=r[0]*n,t[1]=r[1]*n),t};U.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]};U.cross=function(t,r,e){var i=r[0]*e[1]-r[1]*e[0];return t[0]=t[1]=0,t[2]=i,t};U.lerp=function(t,r,e,i){var n=r[0],a=r[1];return t[0]=n+i*(e[0]-n),t[1]=a+i*(e[1]-a),t};U.random=function(t,r){r=r||1;var e=GLMAT_RANDOM()*2*Math.PI;return t[0]=Math.cos(e)*r,t[1]=Math.sin(e)*r,t};U.transformMat2=function(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[2]*n,t[1]=e[1]*i+e[3]*n,t};U.transformMat2d=function(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[2]*n+e[4],t[1]=e[1]*i+e[3]*n+e[5],t};U.transformMat3=function(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[3]*n+e[6],t[1]=e[1]*i+e[4]*n+e[7],t};U.transformMat4=function(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[4]*n+e[12],t[1]=e[1]*i+e[5]*n+e[13],t};U.forEach=(function(){var t=U.create();return function(r,e,i,n,a,s){var o,f;for(e||(e=2),i||(i=0),n?f=Math.min(n*e+i,r.length):f=r.length,o=i;o<f;o+=e)t[0]=r[o],t[1]=r[o+1],a(t,t,s),r[o]=t[0],r[o+1]=t[1];return r}})();var tt=function(t,r){t=t||0,r=r||0,this.array=U.fromValues(t,r),this._dirty=!0};tt.prototype={constructor:tt,add:function(t){return U.add(this.array,this.array,t.array),this._dirty=!0,this},set:function(t,r){return this.array[0]=t,this.array[1]=r,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this._dirty=!0,this},clone:function(){return new tt(this.x,this.y)},copy:function(t){return U.copy(this.array,t.array),this._dirty=!0,this},cross:function(t,r){return U.cross(t.array,this.array,r.array),t._dirty=!0,this},dist:function(t){return U.dist(this.array,t.array)},distance:function(t){return U.distance(this.array,t.array)},div:function(t){return U.div(this.array,this.array,t.array),this._dirty=!0,this},divide:function(t){return U.divide(this.array,this.array,t.array),this._dirty=!0,this},dot:function(t){return U.dot(this.array,t.array)},len:function(){return U.len(this.array)},length:function(){return U.length(this.array)},lerp:function(t,r,e){return U.lerp(this.array,t.array,r.array,e),this._dirty=!0,this},min:function(t){return U.min(this.array,this.array,t.array),this._dirty=!0,this},max:function(t){return U.max(this.array,this.array,t.array),this._dirty=!0,this},mul:function(t){return U.mul(this.array,this.array,t.array),this._dirty=!0,this},multiply:function(t){return U.multiply(this.array,this.array,t.array),this._dirty=!0,this},negate:function(){return U.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return U.normalize(this.array,this.array),this._dirty=!0,this},random:function(t){return U.random(this.array,t),this._dirty=!0,this},scale:function(t){return U.scale(this.array,this.array,t),this._dirty=!0,this},scaleAndAdd:function(t,r){return U.scaleAndAdd(this.array,this.array,t.array,r),this._dirty=!0,this},sqrDist:function(t){return U.sqrDist(this.array,t.array)},squaredDistance:function(t){return U.squaredDistance(this.array,t.array)},sqrLen:function(){return U.sqrLen(this.array)},squaredLength:function(){return U.squaredLength(this.array)},sub:function(t){return U.sub(this.array,this.array,t.array),this._dirty=!0,this},subtract:function(t){return U.subtract(this.array,this.array,t.array),this._dirty=!0,this},transformMat2:function(t){return U.transformMat2(this.array,this.array,t.array),this._dirty=!0,this},transformMat2d:function(t){return U.transformMat2d(this.array,this.array,t.array),this._dirty=!0,this},transformMat3:function(t){return U.transformMat3(this.array,this.array,t.array),this._dirty=!0,this},transformMat4:function(t){return U.transformMat4(this.array,this.array,t.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};if(Object.defineProperty){var zh=tt.prototype;Object.defineProperty(zh,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),Object.defineProperty(zh,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}})}tt.add=function(t,r,e){return U.add(t.array,r.array,e.array),t._dirty=!0,t};tt.set=function(t,r,e){return U.set(t.array,r,e),t._dirty=!0,t};tt.copy=function(t,r){return U.copy(t.array,r.array),t._dirty=!0,t};tt.cross=function(t,r,e){return U.cross(t.array,r.array,e.array),t._dirty=!0,t};tt.dist=function(t,r){return U.distance(t.array,r.array)};tt.distance=tt.dist;tt.div=function(t,r,e){return U.divide(t.array,r.array,e.array),t._dirty=!0,t};tt.divide=tt.div;tt.dot=function(t,r){return U.dot(t.array,r.array)};tt.len=function(t){return U.length(t.array)};tt.lerp=function(t,r,e,i){return U.lerp(t.array,r.array,e.array,i),t._dirty=!0,t};tt.min=function(t,r,e){return U.min(t.array,r.array,e.array),t._dirty=!0,t};tt.max=function(t,r,e){return U.max(t.array,r.array,e.array),t._dirty=!0,t};tt.mul=function(t,r,e){return U.multiply(t.array,r.array,e.array),t._dirty=!0,t};tt.multiply=tt.mul;tt.negate=function(t,r){return U.negate(t.array,r.array),t._dirty=!0,t};tt.normalize=function(t,r){return U.normalize(t.array,r.array),t._dirty=!0,t};tt.random=function(t,r){return U.random(t.array,r),t._dirty=!0,t};tt.scale=function(t,r,e){return U.scale(t.array,r.array,e),t._dirty=!0,t};tt.scaleAndAdd=function(t,r,e,i){return U.scaleAndAdd(t.array,r.array,e.array,i),t._dirty=!0,t};tt.sqrDist=function(t,r){return U.sqrDist(t.array,r.array)};tt.squaredDistance=tt.sqrDist;tt.sqrLen=function(t){return U.sqrLen(t.array)};tt.squaredLength=tt.sqrLen;tt.sub=function(t,r,e){return U.subtract(t.array,r.array,e.array),t._dirty=!0,t};tt.subtract=tt.sub;tt.transformMat2=function(t,r,e){return U.transformMat2(t.array,r.array,e.array),t._dirty=!0,t};tt.transformMat2d=function(t,r,e){return U.transformMat2d(t.array,r.array,e.array),t._dirty=!0,t};tt.transformMat3=function(t,r,e){return U.transformMat3(t.array,r.array,e.array),t._dirty=!0,t};tt.transformMat4=function(t,r,e){return U.transformMat4(t.array,r.array,e.array),t._dirty=!0,t};var kh=1,Gh=2,ro=3,Wh={};function t1(t){for(var r=t.split(`
`),e=0,i=r.length;e<i;e++)r[e]=e+1+": "+r[e];return r.join(`
`)}function Vh(t,r,e){if(!t.getShaderParameter(r,t.COMPILE_STATUS))return[t.getShaderInfoLog(r),t1(e)].join(`
`)}var qh=new at.Float32Array(16),r1=Vt.extend({uniformSemantics:{},attributes:{}},function(){this._locations={},this._textureSlot=0,this._program=null},{bind:function(t){this._textureSlot=0,t.gl.useProgram(this._program)},hasUniform:function(t){var r=this._locations[t];return r!=null},useTextureSlot:function(t,r,e){r&&(t.gl.activeTexture(t.gl.TEXTURE0+e),r.isRenderable()?r.bind(t):r.unbind(t))},currentTextureSlot:function(){return this._textureSlot},resetTextureSlot:function(t){this._textureSlot=t||0},takeCurrentTextureSlot:function(t,r){var e=this._textureSlot;return this.useTextureSlot(t,r,e),this._textureSlot++,e},setUniform:function(t,r,e,i){var n=this._locations,a=n[e];if(a==null)return!1;switch(r){case"m4":if(!(i instanceof Float32Array)){for(var s=0;s<i.length;s++)qh[s]=i[s];i=qh}t.uniformMatrix4fv(a,!1,i);break;case"2i":t.uniform2i(a,i[0],i[1]);break;case"2f":t.uniform2f(a,i[0],i[1]);break;case"3i":t.uniform3i(a,i[0],i[1],i[2]);break;case"3f":t.uniform3f(a,i[0],i[1],i[2]);break;case"4i":t.uniform4i(a,i[0],i[1],i[2],i[3]);break;case"4f":t.uniform4f(a,i[0],i[1],i[2],i[3]);break;case"1i":t.uniform1i(a,i);break;case"1f":t.uniform1f(a,i);break;case"1fv":t.uniform1fv(a,i);break;case"1iv":t.uniform1iv(a,i);break;case"2iv":t.uniform2iv(a,i);break;case"2fv":t.uniform2fv(a,i);break;case"3iv":t.uniform3iv(a,i);break;case"3fv":t.uniform3fv(a,i);break;case"4iv":t.uniform4iv(a,i);break;case"4fv":t.uniform4fv(a,i);break;case"m2":case"m2v":t.uniformMatrix2fv(a,!1,i);break;case"m3":case"m3v":t.uniformMatrix3fv(a,!1,i);break;case"m4v":if(Array.isArray(i)&&Array.isArray(i[0])){for(var o=new at.Float32Array(i.length*16),f=0,s=0;s<i.length;s++)for(var u=i[s],h=0;h<16;h++)o[f++]=u[h];t.uniformMatrix4fv(a,!1,o)}else t.uniformMatrix4fv(a,!1,i);break}return!0},setUniformOfSemantic:function(t,r,e){var i=this.uniformSemantics[r];return i?this.setUniform(t,i.type,i.symbol,e):!1},enableAttributes:function(t,r,e){var i=t.gl,n=this._program,a=this._locations,s;e?s=e.__enabledAttributeList:s=Wh[t.__uid__],s||(e?s=e.__enabledAttributeList=[]:s=Wh[t.__uid__]=[]);for(var o=[],f=0;f<r.length;f++){var u=r[f];if(!this.attributes[u]){o[f]=-1;continue}var h=a[u];if(h==null){if(h=i.getAttribLocation(n,u),h===-1){o[f]=-1;continue}a[u]=h}o[f]=h,s[h]?s[h]=Gh:s[h]=kh}for(var f=0;f<s.length;f++)switch(s[f]){case kh:i.enableVertexAttribArray(f),s[f]=ro;break;case Gh:s[f]=ro;break;case ro:i.disableVertexAttribArray(f),s[f]=0;break}return o},getAttribLocation:function(t,r){var e=this._locations,i=e[r];return i==null&&(i=t.getAttribLocation(this._program,r),e[r]=i),i},buildProgram:function(t,r,e,i){var n=t.createShader(t.VERTEX_SHADER),a=t.createProgram();t.shaderSource(n,e),t.compileShader(n);var s=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(s,i),t.compileShader(s);var o=Vh(t,n,e);if(o||(o=Vh(t,s,i),o))return o;if(t.attachShader(a,n),t.attachShader(a,s),r.attributeSemantics.POSITION)t.bindAttribLocation(a,0,r.attributeSemantics.POSITION.symbol);else{var f=Object.keys(this.attributes);t.bindAttribLocation(a,0,f[0])}if(t.linkProgram(a),t.deleteShader(n),t.deleteShader(s),this._program=a,this.vertexCode=e,this.fragmentCode=i,!t.getProgramParameter(a,t.LINK_STATUS))return`Could not link program
`+t.getProgramInfoLog(a);for(var u=0;u<r.uniforms.length;u++){var h=r.uniforms[u];this._locations[h]=t.getUniformLocation(a,h)}}}),e1=/for\s*?\(int\s*?_idx_\s*\=\s*([\w-]+)\;\s*_idx_\s*<\s*([\w-]+);\s*_idx_\s*\+\+\s*\)\s*\{\{([\s\S]+?)(?=\}\})\}\}/g;function Xh(t,r,e){function i(s,o,f,u){var h="";isNaN(o)&&(o in r?o=r[o]:o=n[o]),isNaN(f)&&(f in r?f=r[f]:f=n[f]);for(var l=parseInt(o);l<parseInt(f);l++)h+="{"+u.replace(/float\s*\(\s*_idx_\s*\)/g,l.toFixed(1)).replace(/_idx_/g,l)+"}";return h}var n={};for(var a in e)n[a+"_COUNT"]=e[a];return t.replace(e1,i)}function eo(t,r,e){var i=[];if(r)for(var n in r){var a=r[n];a>0&&i.push("#define "+n.toUpperCase()+"_COUNT "+a)}if(e)for(var s=0;s<e.length;s++){var o=e[s];i.push("#define "+o.toUpperCase()+"_ENABLED")}for(var o in t){var f=t[o];f===null?i.push("#define "+o):i.push("#define "+o+" "+f.toString())}return i.join(`
`)}function i1(t){for(var r=[],e=0;e<t.length;e++)r.push("#extension GL_"+t[e]+" : enable");return r.join(`
`)}function n1(t){return["precision",t,"float"].join(" ")+`;
`+["precision",t,"int"].join(" ")+`;
`+["precision",t,"sampler2D"].join(" ")+`;
`}function rv(t){this._renderer=t,this._cache={}}rv.prototype.getProgram=function(t,r,e){var i=this._cache,n=t.isSkinnedMesh&&t.isSkinnedMesh(),a=t.isInstancedMesh&&t.isInstancedMesh(),s="s"+r.shader.shaderID+"m"+r.getProgramKey();e&&(s+="se"+e.getProgramKey(t.lightGroup)),n&&(s+=",sk"+t.joints.length),a&&(s+=",is");var T=i[s];if(T)return T;var o=e?e.getLightsNumbers(t.lightGroup):{},f=this._renderer,u=f.gl,h=r.getEnabledTextures(),l="";if(n){var c={SKINNING:null,JOINT_COUNT:t.joints.length};t.joints.length>f.getMaxJointNumber()&&(c.USE_SKIN_MATRICES_TEXTURE=null),l+=`
`+eo(c)+`
`}a&&(l+=`
#define INSTANCING
`);var v=l+eo(r.vertexDefines,o,h),d=l+eo(r.fragmentDefines,o,h),_=v+`
`+r.shader.vertex,p=["OES_standard_derivatives","EXT_shader_texture_lod"].filter(function(x){return f.getGLExtension(x)!=null});p.indexOf("EXT_shader_texture_lod")>=0&&(d+=`
#define SUPPORT_TEXTURE_LOD`),p.indexOf("OES_standard_derivatives")>=0&&(d+=`
#define SUPPORT_STANDARD_DERIVATIVES`);var y=i1(p)+`
`+n1(r.precision)+`
`+d+`
`+r.shader.fragment,g=Xh(_,r.vertexDefines,o),m=Xh(y,r.fragmentDefines,o),T=new r1;T.uniformSemantics=r.shader.uniformSemantics,T.attributes=r.shader.attributes;var w=T.buildProgram(u,r.shader,g,m);return T.__error=w,i[s]=T,T};var Yh=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g,a1=/attribute\s+(float|int|vec2|vec3|vec4)\s+([\s\S]*?);/g,Zh=/#define\s+(\w+)?(\s+[\d-.]+)?\s*;?\s*\n/g,s1={bool:"1i",int:"1i",sampler2D:"t",samplerCube:"t",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"};function qr(t){for(var r=[],e=0;e<t;e++)r[e]=0;return r}var jh={bool:function(){return!0},int:function(){return 0},float:function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return qr(2)},vec3:function(){return qr(3)},vec4:function(){return qr(4)},ivec2:function(){return qr(2)},ivec3:function(){return qr(3)},ivec4:function(){return qr(4)},mat2:function(){return qr(4)},mat3:function(){return qr(9)},mat4:function(){return qr(16)},array:function(){return[]}},tf=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","JOINT","WEIGHT"],ev=["SKIN_MATRIX","VIEWPORT_SIZE","VIEWPORT","DEVICEPIXELRATIO","WINDOW_SIZE","NEAR","FAR","TIME"],iv=["WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],o1={vec4:4,vec3:3,vec2:2,float:1},io={},nv={};function f1(t,r){var e="vertex:"+t+"fragment:"+r;if(io[e])return io[e];var i=Ct.genGUID();return io[e]=i,nv[i]={vertex:t,fragment:r},i}function $h(t){return t.replace(/[ \t]*\/\/.*\n/g,"").replace(/[ \t]*\/\*[\s\S]*?\*\//g,"")}function hi(){console.error("Wrong uniform/attributes syntax")}function Kh(t,r){for(var e=/[,=\(\):]/,i=r.replace(/:\s*\[\s*(.*)\s*\]/g,"="+t+"($1)").replace(/\s+/g,"").split(/(?=[,=\(\):])/g),n=[],a=0;a<i.length;a++)i[a].match(e)?n.push(i[a].charAt(0),i[a].slice(1)):n.push(i[a]);i=n;var s=0,o=1,f=2,u=3,h=4,l=5,c=s,v={},d=null,_;p(i[0]);function p(m){m||hi();var T=m.match(/\[(.*?)\]/);_=m.replace(/\[(.*?)\]/,""),v[_]={},T&&(v[_].isArray=!0,v[_].arraySize=T[1])}for(var a=1;a<i.length;a++){var y=i[a];if(y){if(y==="="){if(c!==s&&c!==u){hi();break}c=o;continue}else if(y===":"){c=h;continue}else if(y===","){if(c===f){if(!(d instanceof Array)){hi();break}d.push(+i[++a])}else c=l;continue}else if(y===")"){v[_].value=new at.Float32Array(d),d=null,c=l;continue}else if(y==="("){if(c!==f){hi();break}if(!(d instanceof Array)){hi();break}d.push(+i[++a]);continue}else if(y.indexOf("vec")>=0){if(c!==o&&c!==h){hi();break}c=f,d=[];continue}else if(c===o){t==="bool"?v[_].value=y==="true":v[_].value=parseFloat(y),d=null;continue}else if(c===h){var g=y;tf.indexOf(g)>=0||ev.indexOf(g)>=0||iv.indexOf(g)>=0?v[_].semantic=g:g==="ignore"||g==="unconfigurable"?v[_].ignore=!0:t==="bool"?v[_].value=g==="true":v[_].value=parseFloat(g);continue}p(y),c=s}}return v}function J(t,r){typeof t=="object"&&(r=t.fragment,t=t.vertex),t=$h(t),r=$h(r),this._shaderID=f1(t,r),this._vertexCode=J.parseImport(t),this._fragmentCode=J.parseImport(r),this.attributeSemantics={},this.matrixSemantics={},this.uniformSemantics={},this.matrixSemanticKeys=[],this.uniformTemplates={},this.attributes={},this.textures={},this.vertexDefines={},this.fragmentDefines={},this._parseAttributes(),this._parseUniforms(),this._parseDefines()}J.prototype={constructor:J,createUniforms:function(){var t={};for(var r in this.uniformTemplates){var e=this.uniformTemplates[r];t[r]={type:e.type,value:e.value()}}return t},_parseImport:function(){this._vertexCode=J.parseImport(this.vertex),this._fragmentCode=J.parseImport(this.fragment)},_addSemanticUniform:function(t,r,e){if(tf.indexOf(e)>=0)this.attributeSemantics[e]={symbol:t,type:r};else if(iv.indexOf(e)>=0){var i=!1,n=e;e.match(/TRANSPOSE$/)&&(i=!0,n=e.slice(0,-9)),this.matrixSemantics[e]={symbol:t,type:r,isTranspose:i,semanticNoTranspose:n}}else ev.indexOf(e)>=0&&(this.uniformSemantics[e]={symbol:t,type:r})},_addMaterialUniform:function(t,r,e,i,n,a){a[t]={type:e,value:n?jh.array:i||jh[r],semantic:null}},_parseUniforms:function(){var t={},r=this,e="vertex";this._uniformList=[],this._vertexCode=this._vertexCode.replace(Yh,n),e="fragment",this._fragmentCode=this._fragmentCode.replace(Yh,n),r.matrixSemanticKeys=Object.keys(this.matrixSemantics);function i(a){return a!=null?function(){return a}:null}function n(a,s,o){var f=Kh(s,o),u=[];for(var h in f){var l=f[h],c=l.semantic,v=h,d=s1[s],_=i(f[h].value);f[h].isArray&&(v+="["+f[h].arraySize+"]",d+="v"),u.push(v),r._uniformList.push(h),l.ignore||((s==="sampler2D"||s==="samplerCube")&&(r.textures[h]={shaderType:e,type:s}),c?r._addSemanticUniform(h,d,c):r._addMaterialUniform(h,s,d,_,f[h].isArray,t))}return u.length>0?"uniform "+s+" "+u.join(",")+`;
`:""}this.uniformTemplates=t},_parseAttributes:function(){var t={},r=this;this._vertexCode=this._vertexCode.replace(a1,e);function e(i,n,a){var s=Kh(n,a),o=o1[n]||1,f=[];for(var u in s){var h=s[u].semantic;if(t[u]={type:"float",size:o,semantic:h||null},h){if(tf.indexOf(h)<0)throw new Error('Unkown semantic "'+h+'"');r.attributeSemantics[h]={symbol:u,type:n}}f.push(u)}return"attribute "+n+" "+f.join(",")+`;
`}this.attributes=t},_parseDefines:function(){var t=this,r="vertex";this._vertexCode=this._vertexCode.replace(Zh,e),r="fragment",this._fragmentCode=this._fragmentCode.replace(Zh,e);function e(i,n,a){var s=r==="vertex"?t.vertexDefines:t.fragmentDefines;return s[n]||(a==="false"?s[n]=!1:a==="true"?s[n]=!0:s[n]=a?isNaN(parseFloat(a))?a.trim():parseFloat(a):null),""}},clone:function(){var t=nv[this._shaderID],r=new J(t.vertex,t.fragment);return r}};Object.defineProperty&&(Object.defineProperty(J.prototype,"shaderID",{get:function(){return this._shaderID}}),Object.defineProperty(J.prototype,"vertex",{get:function(){return this._vertexCode}}),Object.defineProperty(J.prototype,"fragment",{get:function(){return this._fragmentCode}}),Object.defineProperty(J.prototype,"uniforms",{get:function(){return this._uniformList}}));var u1=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;J.parseImport=function(t){return t=t.replace(u1,function(n,e,i){var n=J.source(i);return n?J.parseImport(n):(console.error('Shader chunk "'+i+'" not existed in library'),"")}),t};var h1=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;J.import=function(t){t.replace(h1,function(r,e,i,a){var a=a.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+\x24)/g,"");if(a){for(var s=i.split("."),o=J.codes,f=0,u;f<s.length-1;)u=s[f++],o[u]||(o[u]={}),o=o[u];u=s[f],o[u]=a}return a})};J.codes={};J.source=function(t){for(var r=t.split("."),e=J.codes,i=0;e&&i<r.length;){var n=r[i++];e=e[n]}return typeof e!="string"?(console.error('Shader "'+t+'" not existed in library'),""):e};const l1=`@export clay.prez.vertex
uniform mat4 WVP : WORLDVIEWPROJECTION;
attribute vec3 pos : POSITION;
attribute vec2 uv : TEXCOORD_0;
uniform vec2 uvRepeat : [1.0, 1.0];
uniform vec2 uvOffset : [0.0, 0.0];
@import clay.chunk.skinning_header
@import clay.chunk.instancing_header
varying vec2 v_Texcoord;
void main()
{
 vec4 P = vec4(pos, 1.0);
#ifdef SKINNING
 @import clay.chunk.skin_matrix
 P = skinMatrixWS * P;
#endif
#ifdef INSTANCING
 @import clay.chunk.instancing_matrix
 P = instanceMat * P;
#endif
 gl_Position = WVP * P;
 v_Texcoord = uv * uvRepeat + uvOffset;
}
@end
@export clay.prez.fragment
uniform sampler2D alphaMap;
uniform float alphaCutoff: 0.0;
varying vec2 v_Texcoord;
void main()
{
 if (alphaCutoff > 0.0) {
 if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {
 discard;
 }
 }
 gl_FragColor = vec4(0.0,0.0,0.0,1.0);
}
@end`;var F={};F.create=function(){var t=new Bt(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};F.clone=function(t){var r=new Bt(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r};F.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t};F.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};F.transpose=function(t,r){if(t===r){var e=r[1],i=r[2],n=r[3],a=r[6],s=r[7],o=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=i,t[9]=a,t[11]=r[14],t[12]=n,t[13]=s,t[14]=o}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t};F.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],f=r[6],u=r[7],h=r[8],l=r[9],c=r[10],v=r[11],d=r[12],_=r[13],p=r[14],y=r[15],g=e*o-i*s,m=e*f-n*s,T=e*u-a*s,w=i*f-n*o,x=i*u-a*o,E=n*u-a*f,S=h*_-l*d,M=h*p-c*d,C=h*y-v*d,R=l*p-c*_,L=l*y-v*_,D=c*y-v*p,P=g*D-m*L+T*R+w*C-x*M+E*S;return P?(P=1/P,t[0]=(o*D-f*L+u*R)*P,t[1]=(n*L-i*D-a*R)*P,t[2]=(_*E-p*x+y*w)*P,t[3]=(c*x-l*E-v*w)*P,t[4]=(f*C-s*D-u*M)*P,t[5]=(e*D-n*C+a*M)*P,t[6]=(p*T-d*E-y*m)*P,t[7]=(h*E-c*T+v*m)*P,t[8]=(s*L-o*C+u*S)*P,t[9]=(i*C-e*L-a*S)*P,t[10]=(d*x-_*T+y*g)*P,t[11]=(l*T-h*x-v*g)*P,t[12]=(o*M-s*R-f*S)*P,t[13]=(e*R-i*M+n*S)*P,t[14]=(_*m-d*w-p*g)*P,t[15]=(h*w-l*m+c*g)*P,t):null};F.adjoint=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],f=r[6],u=r[7],h=r[8],l=r[9],c=r[10],v=r[11],d=r[12],_=r[13],p=r[14],y=r[15];return t[0]=o*(c*y-v*p)-l*(f*y-u*p)+_*(f*v-u*c),t[1]=-(i*(c*y-v*p)-l*(n*y-a*p)+_*(n*v-a*c)),t[2]=i*(f*y-u*p)-o*(n*y-a*p)+_*(n*u-a*f),t[3]=-(i*(f*v-u*c)-o*(n*v-a*c)+l*(n*u-a*f)),t[4]=-(s*(c*y-v*p)-h*(f*y-u*p)+d*(f*v-u*c)),t[5]=e*(c*y-v*p)-h*(n*y-a*p)+d*(n*v-a*c),t[6]=-(e*(f*y-u*p)-s*(n*y-a*p)+d*(n*u-a*f)),t[7]=e*(f*v-u*c)-s*(n*v-a*c)+h*(n*u-a*f),t[8]=s*(l*y-v*_)-h*(o*y-u*_)+d*(o*v-u*l),t[9]=-(e*(l*y-v*_)-h*(i*y-a*_)+d*(i*v-a*l)),t[10]=e*(o*y-u*_)-s*(i*y-a*_)+d*(i*u-a*o),t[11]=-(e*(o*v-u*l)-s*(i*v-a*l)+h*(i*u-a*o)),t[12]=-(s*(l*p-c*_)-h*(o*p-f*_)+d*(o*c-f*l)),t[13]=e*(l*p-c*_)-h*(i*p-n*_)+d*(i*c-n*l),t[14]=-(e*(o*p-f*_)-s*(i*p-n*_)+d*(i*f-n*o)),t[15]=e*(o*c-f*l)-s*(i*c-n*l)+h*(i*f-n*o),t};F.determinant=function(t){var r=t[0],e=t[1],i=t[2],n=t[3],a=t[4],s=t[5],o=t[6],f=t[7],u=t[8],h=t[9],l=t[10],c=t[11],v=t[12],d=t[13],_=t[14],p=t[15],y=r*s-e*a,g=r*o-i*a,m=r*f-n*a,T=e*o-i*s,w=e*f-n*s,x=i*f-n*o,E=u*d-h*v,S=u*_-l*v,M=u*p-c*v,C=h*_-l*d,R=h*p-c*d,L=l*p-c*_;return y*L-g*R+m*C+T*M-w*S+x*E};F.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],f=r[5],u=r[6],h=r[7],l=r[8],c=r[9],v=r[10],d=r[11],_=r[12],p=r[13],y=r[14],g=r[15],m=e[0],T=e[1],w=e[2],x=e[3];return t[0]=m*i+T*o+w*l+x*_,t[1]=m*n+T*f+w*c+x*p,t[2]=m*a+T*u+w*v+x*y,t[3]=m*s+T*h+w*d+x*g,m=e[4],T=e[5],w=e[6],x=e[7],t[4]=m*i+T*o+w*l+x*_,t[5]=m*n+T*f+w*c+x*p,t[6]=m*a+T*u+w*v+x*y,t[7]=m*s+T*h+w*d+x*g,m=e[8],T=e[9],w=e[10],x=e[11],t[8]=m*i+T*o+w*l+x*_,t[9]=m*n+T*f+w*c+x*p,t[10]=m*a+T*u+w*v+x*y,t[11]=m*s+T*h+w*d+x*g,m=e[12],T=e[13],w=e[14],x=e[15],t[12]=m*i+T*o+w*l+x*_,t[13]=m*n+T*f+w*c+x*p,t[14]=m*a+T*u+w*v+x*y,t[15]=m*s+T*h+w*d+x*g,t};F.multiplyAffine=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[4],o=r[5],f=r[6],u=r[8],h=r[9],l=r[10],c=r[12],v=r[13],d=r[14],_=e[0],p=e[1],y=e[2];return t[0]=_*i+p*s+y*u,t[1]=_*n+p*o+y*h,t[2]=_*a+p*f+y*l,_=e[4],p=e[5],y=e[6],t[4]=_*i+p*s+y*u,t[5]=_*n+p*o+y*h,t[6]=_*a+p*f+y*l,_=e[8],p=e[9],y=e[10],t[8]=_*i+p*s+y*u,t[9]=_*n+p*o+y*h,t[10]=_*a+p*f+y*l,_=e[12],p=e[13],y=e[14],t[12]=_*i+p*s+y*u+c,t[13]=_*n+p*o+y*h+v,t[14]=_*a+p*f+y*l+d,t};F.mul=F.multiply;F.mulAffine=F.multiplyAffine;F.translate=function(t,r,e){var i=e[0],n=e[1],a=e[2],s,o,f,u,h,l,c,v,d,_,p,y;return r===t?(t[12]=r[0]*i+r[4]*n+r[8]*a+r[12],t[13]=r[1]*i+r[5]*n+r[9]*a+r[13],t[14]=r[2]*i+r[6]*n+r[10]*a+r[14],t[15]=r[3]*i+r[7]*n+r[11]*a+r[15]):(s=r[0],o=r[1],f=r[2],u=r[3],h=r[4],l=r[5],c=r[6],v=r[7],d=r[8],_=r[9],p=r[10],y=r[11],t[0]=s,t[1]=o,t[2]=f,t[3]=u,t[4]=h,t[5]=l,t[6]=c,t[7]=v,t[8]=d,t[9]=_,t[10]=p,t[11]=y,t[12]=s*i+h*n+d*a+r[12],t[13]=o*i+l*n+_*a+r[13],t[14]=f*i+c*n+p*a+r[14],t[15]=u*i+v*n+y*a+r[15]),t};F.scale=function(t,r,e){var i=e[0],n=e[1],a=e[2];return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=r[3]*i,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=r[7]*n,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t};F.rotate=function(t,r,e,i){var n=i[0],a=i[1],s=i[2],o=Math.sqrt(n*n+a*a+s*s),f,u,h,l,c,v,d,_,p,y,g,m,T,w,x,E,S,M,C,R,L,D,P,z;return Math.abs(o)<ma?null:(o=1/o,n*=o,a*=o,s*=o,f=Math.sin(e),u=Math.cos(e),h=1-u,l=r[0],c=r[1],v=r[2],d=r[3],_=r[4],p=r[5],y=r[6],g=r[7],m=r[8],T=r[9],w=r[10],x=r[11],E=n*n*h+u,S=a*n*h+s*f,M=s*n*h-a*f,C=n*a*h-s*f,R=a*a*h+u,L=s*a*h+n*f,D=n*s*h+a*f,P=a*s*h-n*f,z=s*s*h+u,t[0]=l*E+_*S+m*M,t[1]=c*E+p*S+T*M,t[2]=v*E+y*S+w*M,t[3]=d*E+g*S+x*M,t[4]=l*C+_*R+m*L,t[5]=c*C+p*R+T*L,t[6]=v*C+y*R+w*L,t[7]=d*C+g*R+x*L,t[8]=l*D+_*P+m*z,t[9]=c*D+p*P+T*z,t[10]=v*D+y*P+w*z,t[11]=d*D+g*P+x*z,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)};F.rotateX=function(t,r,e){var i=Math.sin(e),n=Math.cos(e),a=r[4],s=r[5],o=r[6],f=r[7],u=r[8],h=r[9],l=r[10],c=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*n+u*i,t[5]=s*n+h*i,t[6]=o*n+l*i,t[7]=f*n+c*i,t[8]=u*n-a*i,t[9]=h*n-s*i,t[10]=l*n-o*i,t[11]=c*n-f*i,t};F.rotateY=function(t,r,e){var i=Math.sin(e),n=Math.cos(e),a=r[0],s=r[1],o=r[2],f=r[3],u=r[8],h=r[9],l=r[10],c=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*n-u*i,t[1]=s*n-h*i,t[2]=o*n-l*i,t[3]=f*n-c*i,t[8]=a*i+u*n,t[9]=s*i+h*n,t[10]=o*i+l*n,t[11]=f*i+c*n,t};F.rotateZ=function(t,r,e){var i=Math.sin(e),n=Math.cos(e),a=r[0],s=r[1],o=r[2],f=r[3],u=r[4],h=r[5],l=r[6],c=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*n+u*i,t[1]=s*n+h*i,t[2]=o*n+l*i,t[3]=f*n+c*i,t[4]=u*n-a*i,t[5]=h*n-s*i,t[6]=l*n-o*i,t[7]=c*n-f*i,t};F.fromRotationTranslation=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=i+i,f=n+n,u=a+a,h=i*o,l=i*f,c=i*u,v=n*f,d=n*u,_=a*u,p=s*o,y=s*f,g=s*u;return t[0]=1-(v+_),t[1]=l+g,t[2]=c-y,t[3]=0,t[4]=l-g,t[5]=1-(h+_),t[6]=d+p,t[7]=0,t[8]=c+y,t[9]=d-p,t[10]=1-(h+v),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t};F.fromQuat=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e+e,o=i+i,f=n+n,u=e*s,h=i*s,l=i*o,c=n*s,v=n*o,d=n*f,_=a*s,p=a*o,y=a*f;return t[0]=1-l-d,t[1]=h+y,t[2]=c-p,t[3]=0,t[4]=h-y,t[5]=1-u-d,t[6]=v+_,t[7]=0,t[8]=c+p,t[9]=v-_,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};F.frustum=function(t,r,e,i,n,a,s){var o=1/(e-r),f=1/(n-i),u=1/(a-s);return t[0]=a*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*f,t[6]=0,t[7]=0,t[8]=(e+r)*o,t[9]=(n+i)*f,t[10]=(s+a)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*a*2*u,t[15]=0,t};F.perspective=function(t,r,e,i,n){var a=1/Math.tan(r/2),s=1/(i-n);return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*s,t[15]=0,t};F.ortho=function(t,r,e,i,n,a,s){var o=1/(r-e),f=1/(i-n),u=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(r+e)*o,t[13]=(n+i)*f,t[14]=(s+a)*u,t[15]=1,t};F.lookAt=function(t,r,e,i){var n,a,s,o,f,u,h,l,c,v,d=r[0],_=r[1],p=r[2],y=i[0],g=i[1],m=i[2],T=e[0],w=e[1],x=e[2];return Math.abs(d-T)<ma&&Math.abs(_-w)<ma&&Math.abs(p-x)<ma?F.identity(t):(h=d-T,l=_-w,c=p-x,v=1/Math.sqrt(h*h+l*l+c*c),h*=v,l*=v,c*=v,n=g*c-m*l,a=m*h-y*c,s=y*l-g*h,v=Math.sqrt(n*n+a*a+s*s),v?(v=1/v,n*=v,a*=v,s*=v):(n=0,a=0,s=0),o=l*s-c*a,f=c*n-h*s,u=h*a-l*n,v=Math.sqrt(o*o+f*f+u*u),v?(v=1/v,o*=v,f*=v,u*=v):(o=0,f=0,u=0),t[0]=n,t[1]=o,t[2]=h,t[3]=0,t[4]=a,t[5]=f,t[6]=l,t[7]=0,t[8]=s,t[9]=u,t[10]=c,t[11]=0,t[12]=-(n*d+a*_+s*p),t[13]=-(o*d+f*_+u*p),t[14]=-(h*d+l*_+c*p),t[15]=1,t)};F.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))};var b={};b.create=function(){var t=new Bt(3);return t[0]=0,t[1]=0,t[2]=0,t};b.clone=function(t){var r=new Bt(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r};b.fromValues=function(t,r,e){var i=new Bt(3);return i[0]=t,i[1]=r,i[2]=e,i};b.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t};b.set=function(t,r,e,i){return t[0]=r,t[1]=e,t[2]=i,t};b.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t};b.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t};b.sub=b.subtract;b.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t};b.mul=b.multiply;b.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t};b.div=b.divide;b.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t};b.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t};b.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t};b.scaleAndAdd=function(t,r,e,i){return t[0]=r[0]+e[0]*i,t[1]=r[1]+e[1]*i,t[2]=r[2]+e[2]*i,t};b.distance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2];return Math.sqrt(e*e+i*i+n*n)};b.dist=b.distance;b.squaredDistance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2];return e*e+i*i+n*n};b.sqrDist=b.squaredDistance;b.length=function(t){var r=t[0],e=t[1],i=t[2];return Math.sqrt(r*r+e*e+i*i)};b.len=b.length;b.squaredLength=function(t){var r=t[0],e=t[1],i=t[2];return r*r+e*e+i*i};b.sqrLen=b.squaredLength;b.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t};b.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t};b.normalize=function(t,r){var e=r[0],i=r[1],n=r[2],a=e*e+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a),t};b.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]};b.cross=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=e[0],o=e[1],f=e[2];return t[0]=n*f-a*o,t[1]=a*s-i*f,t[2]=i*o-n*s,t};b.lerp=function(t,r,e,i){var n=r[0],a=r[1],s=r[2];return t[0]=n+i*(e[0]-n),t[1]=a+i*(e[1]-a),t[2]=s+i*(e[2]-s),t};b.random=function(t,r){r=r||1;var e=Si()*2*Math.PI,i=Si()*2-1,n=Math.sqrt(1-i*i)*r;return t[0]=Math.cos(e)*n,t[1]=Math.sin(e)*n,t[2]=i*r,t};b.transformMat4=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=e[3]*i+e[7]*n+e[11]*a+e[15];return s=s||1,t[0]=(e[0]*i+e[4]*n+e[8]*a+e[12])/s,t[1]=(e[1]*i+e[5]*n+e[9]*a+e[13])/s,t[2]=(e[2]*i+e[6]*n+e[10]*a+e[14])/s,t};b.transformMat3=function(t,r,e){var i=r[0],n=r[1],a=r[2];return t[0]=i*e[0]+n*e[3]+a*e[6],t[1]=i*e[1]+n*e[4]+a*e[7],t[2]=i*e[2]+n*e[5]+a*e[8],t};b.transformQuat=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=e[0],o=e[1],f=e[2],u=e[3],h=u*i+o*a-f*n,l=u*n+f*i-s*a,c=u*a+s*n-o*i,v=-s*i-o*n-f*a;return t[0]=h*u+v*-s+l*-f-c*-o,t[1]=l*u+v*-o+c*-s-h*-f,t[2]=c*u+v*-f+h*-o-l*-s,t};b.rotateX=function(t,r,e,i){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t};b.rotateY=function(t,r,e,i){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t};b.rotateZ=function(t,r,e,i){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t};b.forEach=(function(){var t=b.create();return function(r,e,i,n,a,s){var o,f;for(e||(e=3),i||(i=0),n?f=Math.min(n*e+i,r.length):f=r.length,o=i;o<f;o+=e)t[0]=r[o],t[1]=r[o+1],t[2]=r[o+2],a(t,t,s),r[o]=t[0],r[o+1]=t[1],r[o+2]=t[2];return r}})();b.angle=function(t,r){var e=b.fromValues(t[0],t[1],t[2]),i=b.fromValues(r[0],r[1],r[2]);b.normalize(e,e),b.normalize(i,i);var n=b.dot(e,i);return n>1?0:Math.acos(n)};J.import(l1);var xt=F.create,Qh={};function Jh(t){return t.material}function c1(t,r,e){return r.uniforms[e].value}function v1(t,r,e,i){return e!==i}function d1(t){return!0}function tl(){}var rl={float:I.FLOAT,byte:I.BYTE,ubyte:I.UNSIGNED_BYTE,short:I.SHORT,ushort:I.UNSIGNED_SHORT};function p1(t,r,e){this.availableAttributes=t,this.availableAttributeSymbols=r,this.indicesBuffer=e,this.vao=null}function _1(t){var r,e;this.bind=function(i){r||(r=at.createCanvas(),r.width=r.height=1,r.getContext("2d"));var n=i.gl,a=!e;a&&(e=n.createTexture()),n.bindTexture(n.TEXTURE_2D,e),a&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)},this.unbind=function(i){i.gl.bindTexture(i.gl.TEXTURE_2D,null)},this.isRenderable=function(){return!0}}var zr=Vt.extend(function(){return{canvas:null,_width:100,_height:100,devicePixelRatio:typeof window<"u"&&window.devicePixelRatio||1,clearColor:[0,0,0,0],clearBit:17664,alpha:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,throwError:!0,gl:null,viewport:{},maxJointNumber:20,__currentFrameBuffer:null,_viewportStack:[],_clearStack:[],_sceneRendering:null}},function(){this.canvas||(this.canvas=at.createCanvas());var t=this.canvas;try{var r={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer};if(this.gl=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!this.gl)throw new Error;this._glinfo=new Yy(this.gl),this.gl.targetRenderer&&console.error("Already created a renderer"),this.gl.targetRenderer=this,this.resize()}catch(e){throw"Error creating WebGL Context "+e}this._programMgr=new rv(this),this._placeholderTexture=new _1},{resize:function(t,r){var e=this.canvas,i=this.devicePixelRatio;t!=null?(e.style&&(e.style.width=t+"px",e.style.height=r+"px"),e.width=t*i,e.height=r*i,this._width=t,this._height=r):(this._width=e.width/i,this._height=e.height/i),this.setViewport(0,0,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getViewportAspect:function(){var t=this.viewport;return t.width/t.height},setDevicePixelRatio:function(t){this.devicePixelRatio=t,this.resize(this._width,this._height)},getDevicePixelRatio:function(){return this.devicePixelRatio},getGLExtension:function(t){return this._glinfo.getExtension(t)},getGLParameter:function(t){return this._glinfo.getParameter(t)},setViewport:function(t,r,e,i,n){if(typeof t=="object"){var a=t;t=a.x,r=a.y,e=a.width,i=a.height,n=a.devicePixelRatio}n=n||this.devicePixelRatio,this.gl.viewport(t*n,r*n,e*n,i*n),this.viewport={x:t,y:r,width:e,height:i,devicePixelRatio:n}},saveViewport:function(){this._viewportStack.push(this.viewport)},restoreViewport:function(){this._viewportStack.length>0&&this.setViewport(this._viewportStack.pop())},saveClear:function(){this._clearStack.push({clearBit:this.clearBit,clearColor:this.clearColor})},restoreClear:function(){if(this._clearStack.length>0){var t=this._clearStack.pop();this.clearColor=t.clearColor,this.clearBit=t.clearBit}},bindSceneRendering:function(t){this._sceneRendering=t},render:function(t,r,e,i){var n=this.gl,a=this.clearColor;if(this.clearBit){n.colorMask(!0,!0,!0,!0),n.depthMask(!0);var s=this.viewport,o=!1,f=s.devicePixelRatio;(s.width!==this._width||s.height!==this._height||f&&f!==this.devicePixelRatio||s.x||s.y)&&(o=!0,n.enable(n.SCISSOR_TEST),n.scissor(s.x*f,s.y*f,s.width*f,s.height*f)),n.clearColor(a[0],a[1],a[2],a[3]),n.clear(this.clearBit),o&&n.disable(n.SCISSOR_TEST)}if(e||t.update(!1),t.updateLights(),r=r||t.getMainCamera(),!r){console.error("Can't find camera in the scene.");return}r.update();var u=t.updateRenderList(r,!0);this._sceneRendering=t;var h=u.opaque,l=u.transparent,c=t.material;t.trigger("beforerender",this,t,r,u),i?(this.renderPreZ(h,t,r),n.depthFunc(n.LEQUAL)):n.depthFunc(n.LESS);for(var v=xt(),d=b.create(),_=0;_<l.length;_++){var p=l[_];F.multiplyAffine(v,r.viewMatrix.array,p.worldTransform.array),b.transformMat4(d,p.position.array,v),p.__depth=d[2]}this.renderPass(h,r,{getMaterial:function(y){return c||y.material},sortCompare:this.opaqueSortCompare}),this.renderPass(l,r,{getMaterial:function(y){return c||y.material},sortCompare:this.transparentSortCompare}),t.trigger("afterrender",this,t,r,u),this._sceneRendering=null},getProgram:function(t,r,e){return r=r||t.material,this._programMgr.getProgram(t,r,e)},validateProgram:function(t){if(t.__error){var r=t.__error;if(Qh[t.__uid__])return;if(Qh[t.__uid__]=!0,this.throwError)throw new Error(r);this.trigger("error",r)}},updatePrograms:function(t,r,e){var i=e&&e.getMaterial||Jh;r=r||null;for(var n=0;n<t.length;n++){var a=t[n],s=i.call(this,a);if(n>0){var o=t[n-1],f=o.joints?o.joints.length:0,u=a.joints?a.joints.length:0;if(u===f&&a.material===o.material&&a.lightGroup===o.lightGroup){a.__program=o.__program;continue}}var h=this._programMgr.getProgram(a,s,r);this.validateProgram(h),a.__program=h}},renderPass:function(t,r,e){this.trigger("beforerenderpass",this,t,r,e),e=e||{},e.getMaterial=e.getMaterial||Jh,e.getUniform=e.getUniform||c1,e.isMaterialChanged=e.isMaterialChanged||v1,e.beforeRender=e.beforeRender||tl,e.afterRender=e.afterRender||tl;var i=e.ifRender||d1;this.updatePrograms(t,this._sceneRendering,e),e.sortCompare&&t.sort(e.sortCompare);var n=this.viewport,a=n.devicePixelRatio,s=[n.x*a,n.y*a,n.width*a,n.height*a],o=this.devicePixelRatio,f=this.__currentFrameBuffer?[this.__currentFrameBuffer.getTextureWidth(),this.__currentFrameBuffer.getTextureHeight()]:[this._width*o,this._height*o],u=[s[2],s[3]],h=Date.now();r?(F.copy(Tt.VIEW,r.viewMatrix.array),F.copy(Tt.PROJECTION,r.projectionMatrix.array),F.copy(Tt.VIEWINVERSE,r.worldTransform.array)):(F.identity(Tt.VIEW),F.identity(Tt.PROJECTION),F.identity(Tt.VIEWINVERSE)),F.multiply(Tt.VIEWPROJECTION,Tt.PROJECTION,Tt.VIEW),F.invert(Tt.PROJECTIONINVERSE,Tt.PROJECTION),F.invert(Tt.VIEWPROJECTIONINVERSE,Tt.VIEWPROJECTION);for(var l=this.gl,c=this._sceneRendering,v,d,_,p,y,g,m,T,w,x,E,S,M=null,C=0;C<t.length;C++){var R=t[C],L=R.worldTransform!=null,D;if(i(R)){L&&(D=R.isSkinnedMesh&&R.isSkinnedMesh()?R.offsetMatrix?R.offsetMatrix.array:Tt.IDENTITY:R.worldTransform.array);var P=R.geometry,z=e.getMaterial.call(this,R),A=R.__program,B=z.shader,k=P.__uid__+"-"+A.__uid__,j=k!==x;x=k,L&&(F.copy(Tt.WORLD,D),F.multiply(Tt.WORLDVIEWPROJECTION,Tt.VIEWPROJECTION,D),F.multiplyAffine(Tt.WORLDVIEW,Tt.VIEW,D),(B.matrixSemantics.WORLDINVERSE||B.matrixSemantics.WORLDINVERSETRANSPOSE)&&F.invert(Tt.WORLDINVERSE,D),(B.matrixSemantics.WORLDVIEWINVERSE||B.matrixSemantics.WORLDVIEWINVERSETRANSPOSE)&&F.invert(Tt.WORLDVIEWINVERSE,Tt.WORLDVIEW),(B.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||B.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE)&&F.invert(Tt.WORLDVIEWPROJECTIONINVERSE,Tt.WORLDVIEWPROJECTION)),R.beforeRender&&R.beforeRender(this),e.beforeRender.call(this,R,z,v);var $=A!==d;$?(A.bind(this),A.setUniformOfSemantic(l,"VIEWPORT",s),A.setUniformOfSemantic(l,"WINDOW_SIZE",f),r&&(A.setUniformOfSemantic(l,"NEAR",r.near),A.setUniformOfSemantic(l,"FAR",r.far)),A.setUniformOfSemantic(l,"DEVICEPIXELRATIO",a),A.setUniformOfSemantic(l,"TIME",h),A.setUniformOfSemantic(l,"VIEWPORT_SIZE",u),c&&c.setLightUniforms(A,R.lightGroup,this)):A=d,($||e.isMaterialChanged(R,_,z,v))&&(z.depthTest!==p&&(z.depthTest?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),p=z.depthTest),z.depthMask!==y&&(l.depthMask(z.depthMask),y=z.depthMask),z.transparent!==w&&(z.transparent?l.enable(l.BLEND):l.disable(l.BLEND),w=z.transparent),z.transparent&&(z.blend?z.blend(l):(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA))),S=this._bindMaterial(R,z,A,_||null,v||null,d||null,e.getUniform),v=z);var rt=B.matrixSemanticKeys;if(L)for(var Q=0;Q<rt.length;Q++){var st=rt[Q],et=B.matrixSemantics[st],pt=Tt[st];if(et.isTranspose){var At=Tt[et.semanticNoTranspose];F.transpose(pt,At)}A.setUniform(l,et.type,et.symbol,pt)}R.cullFace!==m&&(m=R.cullFace,l.cullFace(m)),R.frontFace!==T&&(T=R.frontFace,l.frontFace(T)),R.culling!==g&&(g=R.culling,g?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE)),this._updateSkeleton(R,A,S),j&&(E=this._bindVAO(M,B,P,A)),this._renderObject(R,E,A),e.afterRender(this,R),R.afterRender&&R.afterRender(this),d=A,_=R}}this.trigger("afterrenderpass",this,t,r,e)},getMaxJointNumber:function(){return this.maxJointNumber},_updateSkeleton:function(t,r,e){var i=this.gl,n=t.skeleton;if(n)if(n.update(),t.joints.length>this.getMaxJointNumber()){var a=n.getSubSkinMatricesTexture(t.__uid__,t.joints);r.useTextureSlot(this,a,e),r.setUniform(i,"1i","skinMatricesTexture",e),r.setUniform(i,"1f","skinMatricesTextureSize",a.width)}else{var s=n.getSubSkinMatrices(t.__uid__,t.joints);r.setUniformOfSemantic(i,"SKIN_MATRIX",s)}},_renderObject:function(t,r,e){var i=this.gl,n=t.geometry,a=t.mode;a==null&&(a=4);var s=null,o=t.isInstancedMesh&&t.isInstancedMesh();if(o&&(s=this.getGLExtension("ANGLE_instanced_arrays"),!s)){console.warn("Device not support ANGLE_instanced_arrays extension");return}var f;if(o&&(f=this._bindInstancedAttributes(t,e,s)),r.indicesBuffer){var u=this.getGLExtension("OES_element_index_uint"),h=u&&n.indices instanceof Uint32Array,l=h?i.UNSIGNED_INT:i.UNSIGNED_SHORT;o?s.drawElementsInstancedANGLE(a,r.indicesBuffer.count,l,0,t.getInstanceCount()):i.drawElements(a,r.indicesBuffer.count,l,0)}else o?s.drawArraysInstancedANGLE(a,0,n.vertexCount,t.getInstanceCount()):i.drawArrays(a,0,n.vertexCount);if(o)for(var c=0;c<f.length;c++)i.disableVertexAttribArray(f[c])},_bindInstancedAttributes:function(t,r,e){for(var i=this.gl,n=t.getInstancedAttributesBuffers(this),a=[],s=0;s<n.length;s++){var o=n[s],f=r.getAttribLocation(i,o.symbol);if(!(f<0)){var u=rl[o.type]||i.FLOAT;i.enableVertexAttribArray(f),i.bindBuffer(i.ARRAY_BUFFER,o.buffer),i.vertexAttribPointer(f,o.size,u,!1,0,0),e.vertexAttribDivisorANGLE(f,o.divisor),a.push(f)}}return a},_bindMaterial:function(t,r,e,i,n,a,s){for(var o=this.gl,f=a===e,u=e.currentTextureSlot(),h=r.getEnabledUniforms(),l=r.getTextureUniforms(),c=this._placeholderTexture,v=0;v<l.length;v++){var d=l[v],_=s(t,r,d),p=r.uniforms[d].type;if(p==="t"&&_)_.__slot=-1;else if(p==="tv")for(var y=0;y<_.length;y++)_[y]&&(_[y].__slot=-1)}c.__slot=-1;for(var v=0;v<h.length;v++){var d=h[v],g=r.uniforms[d],_=s(t,r,d),p=g.type,m=p==="t";if(m&&(!_||!_.isRenderable())&&(_=c),n&&f){var T=s(i,n,d);if(m&&(!T||!T.isRenderable())&&(T=c),T===_){if(m)e.takeCurrentTextureSlot(this,null);else if(p==="tv"&&_)for(var y=0;y<_.length;y++)e.takeCurrentTextureSlot(this,null);continue}}if(_!=null)if(m)if(_.__slot<0){var w=e.currentTextureSlot(),x=e.setUniform(o,"1i",d,w);x&&(e.takeCurrentTextureSlot(this,_),_.__slot=w)}else e.setUniform(o,"1i",d,_.__slot);else if(Array.isArray(_)){if(_.length===0)continue;if(p==="tv"){if(!e.hasUniform(d))continue;for(var E=[],y=0;y<_.length;y++){var S=_[y];if(S.__slot<0){var w=e.currentTextureSlot();E.push(w),e.takeCurrentTextureSlot(this,S),S.__slot=w}else E.push(S.__slot)}e.setUniform(o,"1iv",d,E)}else e.setUniform(o,g.type,d,_)}else e.setUniform(o,g.type,d,_)}var M=e.currentTextureSlot();return e.resetTextureSlot(u),M},_bindVAO:function(t,r,e,i){var n=!e.dynamic,a=this.gl,s=this.__uid__+"-"+i.__uid__,o=e.__vaoCache[s];if(!o){var f=e.getBufferChunks(this);if(!f||!f.length)return;for(var u=f[0],h=u.attributeBuffers,T=u.indicesBuffer,m=[],l=[],c=0;c<h.length;c++){var v=h[c],d=v.name,_=v.semantic,p;if(_){var y=r.attributeSemantics[_];p=y&&y.symbol}else p=d;p&&i.attributes[p]&&(m.push(v),l.push(p))}o=new p1(m,l,T),n&&(e.__vaoCache[s]=o)}var g=!0;t&&n&&(o.vao==null?o.vao=t.createVertexArrayOES():g=!1,t.bindVertexArrayOES(o.vao));var m=o.availableAttributes,T=o.indicesBuffer;if(g){for(var w=i.enableAttributes(this,o.availableAttributeSymbols,t&&n&&o),c=0;c<m.length;c++){var x=w[c];if(x!==-1){var v=m[c],E=v.buffer,S=v.size,M=rl[v.type]||a.FLOAT;a.bindBuffer(a.ARRAY_BUFFER,E),a.vertexAttribPointer(x,S,M,!1,0,0)}}e.isUseIndices()&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,T.buffer)}return o},renderPreZ:function(t,r,e){var i=this.gl,n=this._prezMaterial||new Nn({shader:new J(J.source("clay.prez.vertex"),J.source("clay.prez.fragment"))});this._prezMaterial=n,i.colorMask(!1,!1,!1,!1),i.depthMask(!0),this.renderPass(t,e,{ifRender:function(a){return!a.ignorePreZ},isMaterialChanged:function(a,s){var o=a.material,f=s.material;return o.get("diffuseMap")!==f.get("diffuseMap")||(o.get("alphaCutoff")||0)!==(f.get("alphaCutoff")||0)},getUniform:function(a,s,o){if(o==="alphaMap")return a.material.get("diffuseMap");if(o==="alphaCutoff"){if(a.material.isDefined("fragment","ALPHA_TEST")&&a.material.get("diffuseMap")){var f=a.material.get("alphaCutoff");return f||0}return 0}else return o==="uvRepeat"?a.material.get("uvRepeat"):o==="uvOffset"?a.material.get("uvOffset"):s.get(o)},getMaterial:function(){return n},sort:this.opaqueSortCompare}),i.colorMask(!0,!0,!0,!0),i.depthMask(!0)},disposeScene:function(t){this.disposeNode(t,!0,!0),t.dispose()},disposeNode:function(t,r,e){t.getParent()&&t.getParent().remove(t);var i={};t.traverse(function(n){var a=n.material;if(n.geometry&&r&&n.geometry.dispose(this),e&&a&&!i[a.__uid__]){for(var s=a.getTextureUniforms(),o=0;o<s.length;o++){var f=s[o],u=a.uniforms[f].value,h=a.uniforms[f].type;if(u){if(h==="t")u.dispose&&u.dispose(this);else if(h==="tv")for(var l=0;l<u.length;l++)u[l]&&u[l].dispose&&u[l].dispose(this)}}i[a.__uid__]=!0}n.dispose&&n.dispose(this)},this)},disposeGeometry:function(t){t.dispose(this)},disposeTexture:function(t){t.dispose(this)},disposeFrameBuffer:function(t){t.dispose(this)},dispose:function(){},screenToNDC:function(t,r,e){e||(e=new tt),r=this._height-r;var i=this.viewport,n=e.array;return n[0]=(t-i.x)/i.width,n[0]=n[0]*2-1,n[1]=(r-i.y)/i.height,n[1]=n[1]*2-1,e}});zr.opaqueSortCompare=zr.prototype.opaqueSortCompare=function(t,r){return t.renderOrder===r.renderOrder?t.__program===r.__program?t.material===r.material?t.geometry.__uid__-r.geometry.__uid__:t.material.__uid__-r.material.__uid__:t.__program&&r.__program?t.__program.__uid__-r.__program.__uid__:0:t.renderOrder-r.renderOrder};zr.transparentSortCompare=zr.prototype.transparentSortCompare=function(t,r){return t.renderOrder===r.renderOrder?t.__depth===r.__depth?t.__program===r.__program?t.material===r.material?t.geometry.__uid__-r.geometry.__uid__:t.material.__uid__-r.material.__uid__:t.__program&&r.__program?t.__program.__uid__-r.__program.__uid__:0:t.__depth-r.__depth:t.renderOrder-r.renderOrder};var Tt={IDENTITY:xt(),WORLD:xt(),VIEW:xt(),PROJECTION:xt(),WORLDVIEW:xt(),VIEWPROJECTION:xt(),WORLDVIEWPROJECTION:xt(),WORLDINVERSE:xt(),VIEWINVERSE:xt(),PROJECTIONINVERSE:xt(),WORLDVIEWINVERSE:xt(),VIEWPROJECTIONINVERSE:xt(),WORLDVIEWPROJECTIONINVERSE:xt(),WORLDTRANSPOSE:xt(),VIEWTRANSPOSE:xt(),PROJECTIONTRANSPOSE:xt(),WORLDVIEWTRANSPOSE:xt(),VIEWPROJECTIONTRANSPOSE:xt(),WORLDVIEWPROJECTIONTRANSPOSE:xt(),WORLDINVERSETRANSPOSE:xt(),VIEWINVERSETRANSPOSE:xt(),PROJECTIONINVERSETRANSPOSE:xt(),WORLDVIEWINVERSETRANSPOSE:xt(),VIEWPROJECTIONINVERSETRANSPOSE:xt(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:xt()};zr.COLOR_BUFFER_BIT=I.COLOR_BUFFER_BIT;zr.DEPTH_BUFFER_BIT=I.DEPTH_BUFFER_BIT;zr.STENCIL_BUFFER_BIT=I.STENCIL_BUFFER_BIT;var O=function(t,r,e){t=t||0,r=r||0,e=e||0,this.array=b.fromValues(t,r,e),this._dirty=!0};O.prototype={constructor:O,add:function(t){return b.add(this.array,this.array,t.array),this._dirty=!0,this},set:function(t,r,e){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this._dirty=!0,this},clone:function(){return new O(this.x,this.y,this.z)},copy:function(t){return b.copy(this.array,t.array),this._dirty=!0,this},cross:function(t,r){return b.cross(this.array,t.array,r.array),this._dirty=!0,this},dist:function(t){return b.dist(this.array,t.array)},distance:function(t){return b.distance(this.array,t.array)},div:function(t){return b.div(this.array,this.array,t.array),this._dirty=!0,this},divide:function(t){return b.divide(this.array,this.array,t.array),this._dirty=!0,this},dot:function(t){return b.dot(this.array,t.array)},len:function(){return b.len(this.array)},length:function(){return b.length(this.array)},lerp:function(t,r,e){return b.lerp(this.array,t.array,r.array,e),this._dirty=!0,this},min:function(t){return b.min(this.array,this.array,t.array),this._dirty=!0,this},max:function(t){return b.max(this.array,this.array,t.array),this._dirty=!0,this},mul:function(t){return b.mul(this.array,this.array,t.array),this._dirty=!0,this},multiply:function(t){return b.multiply(this.array,this.array,t.array),this._dirty=!0,this},negate:function(){return b.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return b.normalize(this.array,this.array),this._dirty=!0,this},random:function(t){return b.random(this.array,t),this._dirty=!0,this},scale:function(t){return b.scale(this.array,this.array,t),this._dirty=!0,this},scaleAndAdd:function(t,r){return b.scaleAndAdd(this.array,this.array,t.array,r),this._dirty=!0,this},sqrDist:function(t){return b.sqrDist(this.array,t.array)},squaredDistance:function(t){return b.squaredDistance(this.array,t.array)},sqrLen:function(){return b.sqrLen(this.array)},squaredLength:function(){return b.squaredLength(this.array)},sub:function(t){return b.sub(this.array,this.array,t.array),this._dirty=!0,this},subtract:function(t){return b.subtract(this.array,this.array,t.array),this._dirty=!0,this},transformMat3:function(t){return b.transformMat3(this.array,this.array,t.array),this._dirty=!0,this},transformMat4:function(t){return b.transformMat4(this.array,this.array,t.array),this._dirty=!0,this},transformQuat:function(t){return b.transformQuat(this.array,this.array,t.array),this._dirty=!0,this},applyProjection:function(t){var r=this.array;if(t=t.array,t[15]===0){var e=-1/r[2];r[0]=t[0]*r[0]*e,r[1]=t[5]*r[1]*e,r[2]=(t[10]*r[2]+t[14])*e}else r[0]=t[0]*r[0]+t[12],r[1]=t[5]*r[1]+t[13],r[2]=t[10]*r[2]+t[14];return this._dirty=!0,this},eulerFromQuat:function(t,r){O.eulerFromQuat(this,t,r)},eulerFromMat3:function(t,r){O.eulerFromMat3(this,t,r)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var sa=Object.defineProperty;if(sa){var no=O.prototype;sa(no,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),sa(no,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}}),sa(no,"z",{get:function(){return this.array[2]},set:function(t){this.array[2]=t,this._dirty=!0}})}O.add=function(t,r,e){return b.add(t.array,r.array,e.array),t._dirty=!0,t};O.set=function(t,r,e,i){b.set(t.array,r,e,i),t._dirty=!0};O.copy=function(t,r){return b.copy(t.array,r.array),t._dirty=!0,t};O.cross=function(t,r,e){return b.cross(t.array,r.array,e.array),t._dirty=!0,t};O.dist=function(t,r){return b.distance(t.array,r.array)};O.distance=O.dist;O.div=function(t,r,e){return b.divide(t.array,r.array,e.array),t._dirty=!0,t};O.divide=O.div;O.dot=function(t,r){return b.dot(t.array,r.array)};O.len=function(t){return b.length(t.array)};O.lerp=function(t,r,e,i){return b.lerp(t.array,r.array,e.array,i),t._dirty=!0,t};O.min=function(t,r,e){return b.min(t.array,r.array,e.array),t._dirty=!0,t};O.max=function(t,r,e){return b.max(t.array,r.array,e.array),t._dirty=!0,t};O.mul=function(t,r,e){return b.multiply(t.array,r.array,e.array),t._dirty=!0,t};O.multiply=O.mul;O.negate=function(t,r){return b.negate(t.array,r.array),t._dirty=!0,t};O.normalize=function(t,r){return b.normalize(t.array,r.array),t._dirty=!0,t};O.random=function(t,r){return b.random(t.array,r),t._dirty=!0,t};O.scale=function(t,r,e){return b.scale(t.array,r.array,e),t._dirty=!0,t};O.scaleAndAdd=function(t,r,e,i){return b.scaleAndAdd(t.array,r.array,e.array,i),t._dirty=!0,t};O.sqrDist=function(t,r){return b.sqrDist(t.array,r.array)};O.squaredDistance=O.sqrDist;O.sqrLen=function(t){return b.sqrLen(t.array)};O.squaredLength=O.sqrLen;O.sub=function(t,r,e){return b.subtract(t.array,r.array,e.array),t._dirty=!0,t};O.subtract=O.sub;O.transformMat3=function(t,r,e){return b.transformMat3(t.array,r.array,e.array),t._dirty=!0,t};O.transformMat4=function(t,r,e){return b.transformMat4(t.array,r.array,e.array),t._dirty=!0,t};O.transformQuat=function(t,r,e){return b.transformQuat(t.array,r.array,e.array),t._dirty=!0,t};function _r(t,r,e){return t<r?r:t>e?e:t}var vt=Math.atan2,yr=Math.asin,li=Math.abs;O.eulerFromQuat=function(t,r,c){t._dirty=!0,r=r.array;var i=t.array,n=r[0],a=r[1],s=r[2],o=r[3],f=n*n,u=a*a,h=s*s,l=o*o,c=(c||"XYZ").toUpperCase();switch(c){case"XYZ":i[0]=vt(2*(n*o-a*s),l-f-u+h),i[1]=yr(_r(2*(n*s+a*o),-1,1)),i[2]=vt(2*(s*o-n*a),l+f-u-h);break;case"YXZ":i[0]=yr(_r(2*(n*o-a*s),-1,1)),i[1]=vt(2*(n*s+a*o),l-f-u+h),i[2]=vt(2*(n*a+s*o),l-f+u-h);break;case"ZXY":i[0]=yr(_r(2*(n*o+a*s),-1,1)),i[1]=vt(2*(a*o-s*n),l-f-u+h),i[2]=vt(2*(s*o-n*a),l-f+u-h);break;case"ZYX":i[0]=vt(2*(n*o+s*a),l-f-u+h),i[1]=yr(_r(2*(a*o-n*s),-1,1)),i[2]=vt(2*(n*a+s*o),l+f-u-h);break;case"YZX":i[0]=vt(2*(n*o-s*a),l-f+u-h),i[1]=vt(2*(a*o-n*s),l+f-u-h),i[2]=yr(_r(2*(n*a+s*o),-1,1));break;case"XZY":i[0]=vt(2*(n*o+a*s),l-f+u-h),i[1]=vt(2*(n*s+a*o),l+f-u-h),i[2]=yr(_r(2*(s*o-n*a),-1,1));break;default:console.warn("Unkown order: "+c)}return t};O.eulerFromMat3=function(t,r,d){var i=r.array,n=i[0],a=i[3],s=i[6],o=i[1],f=i[4],u=i[7],h=i[2],l=i[5],c=i[8],v=t.array,d=(d||"XYZ").toUpperCase();switch(d){case"XYZ":v[1]=yr(_r(s,-1,1)),li(s)<.99999?(v[0]=vt(-u,c),v[2]=vt(-a,n)):(v[0]=vt(l,f),v[2]=0);break;case"YXZ":v[0]=yr(-_r(u,-1,1)),li(u)<.99999?(v[1]=vt(s,c),v[2]=vt(o,f)):(v[1]=vt(-h,n),v[2]=0);break;case"ZXY":v[0]=yr(_r(l,-1,1)),li(l)<.99999?(v[1]=vt(-h,c),v[2]=vt(-a,f)):(v[1]=0,v[2]=vt(o,n));break;case"ZYX":v[1]=yr(-_r(h,-1,1)),li(h)<.99999?(v[0]=vt(l,c),v[2]=vt(o,n)):(v[0]=0,v[2]=vt(-a,f));break;case"YZX":v[2]=yr(_r(o,-1,1)),li(o)<.99999?(v[0]=vt(-u,f),v[1]=vt(-h,n)):(v[0]=0,v[1]=vt(s,c));break;case"XZY":v[2]=yr(-_r(a,-1,1)),li(a)<.99999?(v[0]=vt(l,f),v[1]=vt(s,n)):(v[0]=vt(-u,c),v[1]=0);break;default:console.warn("Unkown order: "+d)}return t._dirty=!0,t};Object.defineProperties(O,{POSITIVE_X:{get:function(){return new O(1,0,0)}},NEGATIVE_X:{get:function(){return new O(-1,0,0)}},POSITIVE_Y:{get:function(){return new O(0,1,0)}},NEGATIVE_Y:{get:function(){return new O(0,-1,0)}},POSITIVE_Z:{get:function(){return new O(0,0,1)}},NEGATIVE_Z:{get:function(){return new O(0,0,-1)}},UP:{get:function(){return new O(0,1,0)}},ZERO:{get:function(){return new O}}});var ao=1e-5,Li=function(t,r){this.origin=t||new O,this.direction=r||new O};Li.prototype={constructor:Li,intersectPlane:function(t,r){var e=t.normal.array,i=t.distance,n=this.origin.array,a=this.direction.array,s=b.dot(e,a);if(s===0)return null;r||(r=new O);var o=(b.dot(e,n)-i)/s;return b.scaleAndAdd(r.array,n,a,-o),r._dirty=!0,r},mirrorAgainstPlane:function(t){var r=b.dot(t.normal.array,this.direction.array);b.scaleAndAdd(this.direction.array,this.direction.array,t.normal.array,-r*2),this.direction._dirty=!0},distanceToPoint:(function(){var t=b.create();return function(r){b.sub(t,r,this.origin.array);var e=b.dot(t,this.direction.array);if(e<0)return b.distance(this.origin.array,r);var i=b.lenSquared(t);return Math.sqrt(i-e*e)}})(),intersectSphere:(function(){var t=b.create();return function(r,e,i){var n=this.origin.array,a=this.direction.array;r=r.array,b.sub(t,r,n);var s=b.dot(t,a),o=b.squaredLength(t),f=o-s*s,u=e*e;if(!(f>u)){var h=Math.sqrt(u-f),l=s-h,c=s+h;return i||(i=new O),l<0?c<0?null:(b.scaleAndAdd(i.array,n,a,c),i):(b.scaleAndAdd(i.array,n,a,l),i)}}})(),intersectBoundingBox:function(t,r){var e=this.direction.array,i=this.origin.array,n=t.min.array,a=t.max.array,s=1/e[0],o=1/e[1],f=1/e[2],u,h,l,c,v,d;if(s>=0?(u=(n[0]-i[0])*s,h=(a[0]-i[0])*s):(h=(n[0]-i[0])*s,u=(a[0]-i[0])*s),o>=0?(l=(n[1]-i[1])*o,c=(a[1]-i[1])*o):(c=(n[1]-i[1])*o,l=(a[1]-i[1])*o),u>c||l>h||((l>u||u!==u)&&(u=l),(c<h||h!==h)&&(h=c),f>=0?(v=(n[2]-i[2])*f,d=(a[2]-i[2])*f):(d=(n[2]-i[2])*f,v=(a[2]-i[2])*f),u>d||v>h)||((v>u||u!==u)&&(u=v),(d<h||h!==h)&&(h=d),h<0))return null;var _=u>=0?u:h;return r||(r=new O),b.scaleAndAdd(r.array,i,e,_),r},intersectTriangle:(function(){var t=b.create(),r=b.create(),e=b.create(),i=b.create();return function(n,a,s,o,f,u){var h=this.direction.array,l=this.origin.array;n=n.array,a=a.array,s=s.array,b.sub(t,a,n),b.sub(r,s,n),b.cross(i,r,h);var c=b.dot(t,i);if(o){if(c>-ao)return null}else if(c>-ao&&c<ao)return null;b.sub(e,l,n);var v=b.dot(i,e)/c;if(v<0||v>1)return null;b.cross(i,t,e);var d=b.dot(h,i)/c;if(d<0||d>1||v+d>1)return null;b.cross(i,t,r);var _=-b.dot(e,i)/c;return _<0?null:(f||(f=new O),u&&O.set(u,1-v-d,v,d),b.scaleAndAdd(f.array,l,h,_),f)}})(),applyTransform:function(t){O.add(this.direction,this.direction,this.origin),O.transformMat4(this.origin,this.origin,t),O.transformMat4(this.direction,this.direction,t),O.sub(this.direction,this.direction,this.origin),O.normalize(this.direction,this.direction)},copy:function(t){O.copy(this.origin,t.origin),O.copy(this.direction,t.direction)},clone:function(){var t=new Li;return t.copy(this),t}};var N={};N.create=function(){var t=new Bt(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t};N.clone=function(t){var r=new Bt(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r};N.fromValues=function(t,r,e,i){var n=new Bt(4);return n[0]=t,n[1]=r,n[2]=e,n[3]=i,n};N.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t};N.set=function(t,r,e,i,n){return t[0]=r,t[1]=e,t[2]=i,t[3]=n,t};N.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t};N.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t};N.sub=N.subtract;N.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t[3]=r[3]*e[3],t};N.mul=N.multiply;N.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t[3]=r[3]/e[3],t};N.div=N.divide;N.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t[3]=Math.min(r[3],e[3]),t};N.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t[3]=Math.max(r[3],e[3]),t};N.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t};N.scaleAndAdd=function(t,r,e,i){return t[0]=r[0]+e[0]*i,t[1]=r[1]+e[1]*i,t[2]=r[2]+e[2]*i,t[3]=r[3]+e[3]*i,t};N.distance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2],a=r[3]-t[3];return Math.sqrt(e*e+i*i+n*n+a*a)};N.dist=N.distance;N.squaredDistance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2],a=r[3]-t[3];return e*e+i*i+n*n+a*a};N.sqrDist=N.squaredDistance;N.length=function(t){var r=t[0],e=t[1],i=t[2],n=t[3];return Math.sqrt(r*r+e*e+i*i+n*n)};N.len=N.length;N.squaredLength=function(t){var r=t[0],e=t[1],i=t[2],n=t[3];return r*r+e*e+i*i+n*n};N.sqrLen=N.squaredLength;N.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t};N.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t[3]=1/r[3],t};N.normalize=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e*e+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s),t[0]=r[0]*s,t[1]=r[1]*s,t[2]=r[2]*s,t[3]=r[3]*s),t};N.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]};N.lerp=function(t,r,e,i){var n=r[0],a=r[1],s=r[2],o=r[3];return t[0]=n+i*(e[0]-n),t[1]=a+i*(e[1]-a),t[2]=s+i*(e[2]-s),t[3]=o+i*(e[3]-o),t};N.random=function(t,r){return r=r||1,t[0]=Si(),t[1]=Si(),t[2]=Si(),t[3]=Si(),N.normalize(t,t),N.scale(t,t,r),t};N.transformMat4=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3];return t[0]=e[0]*i+e[4]*n+e[8]*a+e[12]*s,t[1]=e[1]*i+e[5]*n+e[9]*a+e[13]*s,t[2]=e[2]*i+e[6]*n+e[10]*a+e[14]*s,t[3]=e[3]*i+e[7]*n+e[11]*a+e[15]*s,t};N.transformQuat=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=e[0],o=e[1],f=e[2],u=e[3],h=u*i+o*a-f*n,l=u*n+f*i-s*a,c=u*a+s*n-o*i,v=-s*i-o*n-f*a;return t[0]=h*u+v*-s+l*-f-c*-o,t[1]=l*u+v*-o+c*-s-h*-f,t[2]=c*u+v*-f+h*-o-l*-s,t};N.forEach=(function(){var t=N.create();return function(r,e,i,n,a,s){var o,f;for(e||(e=4),i||(i=0),n?f=Math.min(n*e+i,r.length):f=r.length,o=i;o<f;o+=e)t[0]=r[o],t[1]=r[o+1],t[2]=r[o+2],t[3]=r[o+3],a(t,t,s),r[o]=t[0],r[o+1]=t[1],r[o+2]=t[2],r[o+3]=t[3];return r}})();var Z={};Z.create=function(){var t=new Bt(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t};Z.fromMat4=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[4],t[4]=r[5],t[5]=r[6],t[6]=r[8],t[7]=r[9],t[8]=r[10],t};Z.clone=function(t){var r=new Bt(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r};Z.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t};Z.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t};Z.transpose=function(t,r){if(t===r){var e=r[1],i=r[2],n=r[5];t[1]=r[3],t[2]=r[6],t[3]=e,t[5]=r[7],t[6]=i,t[7]=n}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t};Z.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],f=r[6],u=r[7],h=r[8],l=h*s-o*u,c=-h*a+o*f,v=u*a-s*f,d=e*l+i*c+n*v;return d?(d=1/d,t[0]=l*d,t[1]=(-h*i+n*u)*d,t[2]=(o*i-n*s)*d,t[3]=c*d,t[4]=(h*e-n*f)*d,t[5]=(-o*e+n*a)*d,t[6]=v*d,t[7]=(-u*e+i*f)*d,t[8]=(s*e-i*a)*d,t):null};Z.adjoint=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],f=r[6],u=r[7],h=r[8];return t[0]=s*h-o*u,t[1]=n*u-i*h,t[2]=i*o-n*s,t[3]=o*f-a*h,t[4]=e*h-n*f,t[5]=n*a-e*o,t[6]=a*u-s*f,t[7]=i*f-e*u,t[8]=e*s-i*a,t};Z.determinant=function(t){var r=t[0],e=t[1],i=t[2],n=t[3],a=t[4],s=t[5],o=t[6],f=t[7],u=t[8];return r*(u*a-s*f)+e*(-u*n+s*o)+i*(f*n-a*o)};Z.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],f=r[5],u=r[6],h=r[7],l=r[8],c=e[0],v=e[1],d=e[2],_=e[3],p=e[4],y=e[5],g=e[6],m=e[7],T=e[8];return t[0]=c*i+v*s+d*u,t[1]=c*n+v*o+d*h,t[2]=c*a+v*f+d*l,t[3]=_*i+p*s+y*u,t[4]=_*n+p*o+y*h,t[5]=_*a+p*f+y*l,t[6]=g*i+m*s+T*u,t[7]=g*n+m*o+T*h,t[8]=g*a+m*f+T*l,t};Z.mul=Z.multiply;Z.translate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],f=r[5],u=r[6],h=r[7],l=r[8],c=e[0],v=e[1];return t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=f,t[6]=c*i+v*s+u,t[7]=c*n+v*o+h,t[8]=c*a+v*f+l,t};Z.rotate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],f=r[5],u=r[6],h=r[7],l=r[8],c=Math.sin(e),v=Math.cos(e);return t[0]=v*i+c*s,t[1]=v*n+c*o,t[2]=v*a+c*f,t[3]=v*s-c*i,t[4]=v*o-c*n,t[5]=v*f-c*a,t[6]=u,t[7]=h,t[8]=l,t};Z.scale=function(t,r,e){var i=e[0],n=e[1];return t[0]=i*r[0],t[1]=i*r[1],t[2]=i*r[2],t[3]=n*r[3],t[4]=n*r[4],t[5]=n*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t};Z.fromMat2d=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=0,t[3]=r[2],t[4]=r[3],t[5]=0,t[6]=r[4],t[7]=r[5],t[8]=1,t};Z.fromQuat=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e+e,o=i+i,f=n+n,u=e*s,h=i*s,l=i*o,c=n*s,v=n*o,d=n*f,_=a*s,p=a*o,y=a*f;return t[0]=1-l-d,t[3]=h-y,t[6]=c+p,t[1]=h+y,t[4]=1-u-d,t[7]=v-_,t[2]=c-p,t[5]=v+_,t[8]=1-u-l,t};Z.normalFromMat4=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],f=r[6],u=r[7],h=r[8],l=r[9],c=r[10],v=r[11],d=r[12],_=r[13],p=r[14],y=r[15],g=e*o-i*s,m=e*f-n*s,T=e*u-a*s,w=i*f-n*o,x=i*u-a*o,E=n*u-a*f,S=h*_-l*d,M=h*p-c*d,C=h*y-v*d,R=l*p-c*_,L=l*y-v*_,D=c*y-v*p,P=g*D-m*L+T*R+w*C-x*M+E*S;return P?(P=1/P,t[0]=(o*D-f*L+u*R)*P,t[1]=(f*C-s*D-u*M)*P,t[2]=(s*L-o*C+u*S)*P,t[3]=(n*L-i*D-a*R)*P,t[4]=(e*D-n*C+a*M)*P,t[5]=(i*C-e*L-a*S)*P,t[6]=(_*E-p*x+y*w)*P,t[7]=(p*T-d*E-y*m)*P,t[8]=(d*x-_*T+y*g)*P,t):null};Z.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))};var H={};H.create=function(){var t=new Bt(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t};H.rotationTo=(function(){var t=b.create(),r=b.fromValues(1,0,0),e=b.fromValues(0,1,0);return function(i,n,a){var s=b.dot(n,a);return s<-.999999?(b.cross(t,r,n),b.length(t)<1e-6&&b.cross(t,e,n),b.normalize(t,t),H.setAxisAngle(i,t,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(b.cross(t,n,a),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+s,H.normalize(i,i))}})();H.setAxes=(function(){var t=Z.create();return function(r,e,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],H.normalize(r,H.fromMat3(r,t))}})();H.clone=N.clone;H.fromValues=N.fromValues;H.copy=N.copy;H.set=N.set;H.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t};H.setAxisAngle=function(t,r,e){e=e*.5;var i=Math.sin(e);return t[0]=i*r[0],t[1]=i*r[1],t[2]=i*r[2],t[3]=Math.cos(e),t};H.add=N.add;H.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=e[0],f=e[1],u=e[2],h=e[3];return t[0]=i*h+s*o+n*u-a*f,t[1]=n*h+s*f+a*o-i*u,t[2]=a*h+s*u+i*f-n*o,t[3]=s*h-i*o-n*f-a*u,t};H.mul=H.multiply;H.scale=N.scale;H.rotateX=function(t,r,e){e*=.5;var i=r[0],n=r[1],a=r[2],s=r[3],o=Math.sin(e),f=Math.cos(e);return t[0]=i*f+s*o,t[1]=n*f+a*o,t[2]=a*f-n*o,t[3]=s*f-i*o,t};H.rotateY=function(t,r,e){e*=.5;var i=r[0],n=r[1],a=r[2],s=r[3],o=Math.sin(e),f=Math.cos(e);return t[0]=i*f-a*o,t[1]=n*f+s*o,t[2]=a*f+i*o,t[3]=s*f-n*o,t};H.rotateZ=function(t,r,e){e*=.5;var i=r[0],n=r[1],a=r[2],s=r[3],o=Math.sin(e),f=Math.cos(e);return t[0]=i*f+n*o,t[1]=n*f-i*o,t[2]=a*f+s*o,t[3]=s*f-a*o,t};H.calculateW=function(t,r){var e=r[0],i=r[1],n=r[2];return t[0]=e,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-e*e-i*i-n*n)),t};H.dot=N.dot;H.lerp=N.lerp;H.slerp=function(t,r,e,i){var n=r[0],a=r[1],s=r[2],o=r[3],f=e[0],u=e[1],h=e[2],l=e[3],c,v,d,_,p;return v=n*f+a*u+s*h+o*l,v<0&&(v=-v,f=-f,u=-u,h=-h,l=-l),1-v>1e-6?(c=Math.acos(v),d=Math.sin(c),_=Math.sin((1-i)*c)/d,p=Math.sin(i*c)/d):(_=1-i,p=i),t[0]=_*n+p*f,t[1]=_*a+p*u,t[2]=_*s+p*h,t[3]=_*o+p*l,t};H.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e*e+i*i+n*n+a*a,o=s?1/s:0;return t[0]=-e*o,t[1]=-i*o,t[2]=-n*o,t[3]=a*o,t};H.conjugate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t};H.length=N.length;H.len=H.length;H.squaredLength=N.squaredLength;H.sqrLen=H.squaredLength;H.normalize=N.normalize;H.fromMat3=function(t,r){var e=r[0]+r[4]+r[8],i;if(e>0)i=Math.sqrt(e+1),t[3]=.5*i,i=.5/i,t[0]=(r[5]-r[7])*i,t[1]=(r[6]-r[2])*i,t[2]=(r[1]-r[3])*i;else{var n=0;r[4]>r[0]&&(n=1),r[8]>r[n*3+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(r[n*3+n]-r[a*3+a]-r[s*3+s]+1),t[n]=.5*i,i=.5/i,t[3]=(r[a*3+s]-r[s*3+a])*i,t[a]=(r[a*3+n]+r[n*3+a])*i,t[s]=(r[s*3+n]+r[n*3+s])*i}return t};var V=function(){this._axisX=new O,this._axisY=new O,this._axisZ=new O,this.array=F.create(),this._dirty=!0};V.prototype={constructor:V,setArray:function(t){for(var r=0;r<this.array.length;r++)this.array[r]=t[r];return this._dirty=!0,this},adjoint:function(){return F.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return new V().copy(this)},copy:function(t){return F.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return F.determinant(this.array)},fromQuat:function(t){return F.fromQuat(this.array,t.array),this._dirty=!0,this},fromRotationTranslation:function(t,r){return F.fromRotationTranslation(this.array,t.array,r.array),this._dirty=!0,this},fromMat2d:function(t){return V.fromMat2d(this,t),this},frustum:function(t,r,e,i,n,a){return F.frustum(this.array,t,r,e,i,n,a),this._dirty=!0,this},identity:function(){return F.identity(this.array),this._dirty=!0,this},invert:function(){return F.invert(this.array,this.array),this._dirty=!0,this},lookAt:function(t,r,e){return F.lookAt(this.array,t.array,r.array,e.array),this._dirty=!0,this},mul:function(t){return F.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return F.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return F.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return F.multiply(this.array,t.array,this.array),this._dirty=!0,this},ortho:function(t,r,e,i,n,a){return F.ortho(this.array,t,r,e,i,n,a),this._dirty=!0,this},perspective:function(t,r,e,i){return F.perspective(this.array,t,r,e,i),this._dirty=!0,this},rotate:function(t,r){return F.rotate(this.array,this.array,t,r.array),this._dirty=!0,this},rotateX:function(t){return F.rotateX(this.array,this.array,t),this._dirty=!0,this},rotateY:function(t){return F.rotateY(this.array,this.array,t),this._dirty=!0,this},rotateZ:function(t){return F.rotateZ(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return F.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return F.translate(this.array,this.array,t.array),this._dirty=!0,this},transpose:function(){return F.transpose(this.array,this.array),this._dirty=!0,this},decomposeMatrix:(function(){var t=b.create(),r=b.create(),e=b.create(),i=Z.create();return function(n,a,s){var o=this.array;b.set(t,o[0],o[1],o[2]),b.set(r,o[4],o[5],o[6]),b.set(e,o[8],o[9],o[10]);var f=b.length(t),u=b.length(r),h=b.length(e),l=this.determinant();l<0&&(f=-f),n&&n.set(f,u,h),s.set(o[12],o[13],o[14]),Z.fromMat4(i,o),i[0]/=f,i[1]/=f,i[2]/=f,i[3]/=u,i[4]/=u,i[5]/=u,i[6]/=h,i[7]/=h,i[8]/=h,H.fromMat3(a.array,i),H.normalize(a.array,a.array),a._dirty=!0,s._dirty=!0}})(),toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var oa=Object.defineProperty;if(oa){var so=V.prototype;oa(so,"z",{get:function(){var t=this.array;return this._axisZ.set(t[8],t[9],t[10]),this._axisZ},set:function(t){var r=this.array;t=t.array,r[8]=t[0],r[9]=t[1],r[10]=t[2],this._dirty=!0}}),oa(so,"y",{get:function(){var t=this.array;return this._axisY.set(t[4],t[5],t[6]),this._axisY},set:function(t){var r=this.array;t=t.array,r[4]=t[0],r[5]=t[1],r[6]=t[2],this._dirty=!0}}),oa(so,"x",{get:function(){var t=this.array;return this._axisX.set(t[0],t[1],t[2]),this._axisX},set:function(t){var r=this.array;t=t.array,r[0]=t[0],r[1]=t[1],r[2]=t[2],this._dirty=!0}})}V.adjoint=function(t,r){return F.adjoint(t.array,r.array),t._dirty=!0,t};V.copy=function(t,r){return F.copy(t.array,r.array),t._dirty=!0,t};V.determinant=function(t){return F.determinant(t.array)};V.identity=function(t){return F.identity(t.array),t._dirty=!0,t};V.ortho=function(t,r,e,i,n,a,s){return F.ortho(t.array,r,e,i,n,a,s),t._dirty=!0,t};V.perspective=function(t,r,e,i,n){return F.perspective(t.array,r,e,i,n),t._dirty=!0,t};V.lookAt=function(t,r,e,i){return F.lookAt(t.array,r.array,e.array,i.array),t._dirty=!0,t};V.invert=function(t,r){return F.invert(t.array,r.array),t._dirty=!0,t};V.mul=function(t,r,e){return F.mul(t.array,r.array,e.array),t._dirty=!0,t};V.multiply=V.mul;V.fromQuat=function(t,r){return F.fromQuat(t.array,r.array),t._dirty=!0,t};V.fromRotationTranslation=function(t,r,e){return F.fromRotationTranslation(t.array,r.array,e.array),t._dirty=!0,t};V.fromMat2d=function(i,e){i._dirty=!0;var e=e.array,i=i.array;return i[0]=e[0],i[4]=e[2],i[12]=e[4],i[1]=e[1],i[5]=e[3],i[13]=e[5],i};V.rotate=function(t,r,e,i){return F.rotate(t.array,r.array,e,i.array),t._dirty=!0,t};V.rotateX=function(t,r,e){return F.rotateX(t.array,r.array,e),t._dirty=!0,t};V.rotateY=function(t,r,e){return F.rotateY(t.array,r.array,e),t._dirty=!0,t};V.rotateZ=function(t,r,e){return F.rotateZ(t.array,r.array,e),t._dirty=!0,t};V.scale=function(t,r,e){return F.scale(t.array,r.array,e.array),t._dirty=!0,t};V.transpose=function(t,r){return F.transpose(t.array,r.array),t._dirty=!0,t};V.translate=function(t,r,e){return F.translate(t.array,r.array,e.array),t._dirty=!0,t};var ht=function(t,r,e,i){t=t||0,r=r||0,e=e||0,i=i===void 0?1:i,this.array=H.fromValues(t,r,e,i),this._dirty=!0};ht.prototype={constructor:ht,add:function(t){return H.add(this.array,this.array,t.array),this._dirty=!0,this},calculateW:function(){return H.calculateW(this.array,this.array),this._dirty=!0,this},set:function(t,r,e,i){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this.array[3]=i,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this.array[3]=t[3],this._dirty=!0,this},clone:function(){return new ht(this.x,this.y,this.z,this.w)},conjugate:function(){return H.conjugate(this.array,this.array),this._dirty=!0,this},copy:function(t){return H.copy(this.array,t.array),this._dirty=!0,this},dot:function(t){return H.dot(this.array,t.array)},fromMat3:function(t){return H.fromMat3(this.array,t.array),this._dirty=!0,this},fromMat4:(function(){var t=Z.create();return function(r){return Z.fromMat4(t,r.array),Z.transpose(t,t),H.fromMat3(this.array,t),this._dirty=!0,this}})(),identity:function(){return H.identity(this.array),this._dirty=!0,this},invert:function(){return H.invert(this.array,this.array),this._dirty=!0,this},len:function(){return H.len(this.array)},length:function(){return H.length(this.array)},lerp:function(t,r,e){return H.lerp(this.array,t.array,r.array,e),this._dirty=!0,this},mul:function(t){return H.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return H.multiply(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return H.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return H.multiply(this.array,t.array,this.array),this._dirty=!0,this},normalize:function(){return H.normalize(this.array,this.array),this._dirty=!0,this},rotateX:function(t){return H.rotateX(this.array,this.array,t),this._dirty=!0,this},rotateY:function(t){return H.rotateY(this.array,this.array,t),this._dirty=!0,this},rotateZ:function(t){return H.rotateZ(this.array,this.array,t),this._dirty=!0,this},rotationTo:function(t,r){return H.rotationTo(this.array,t.array,r.array),this._dirty=!0,this},setAxes:function(t,r,e){return H.setAxes(this.array,t.array,r.array,e.array),this._dirty=!0,this},setAxisAngle:function(t,r){return H.setAxisAngle(this.array,t.array,r),this._dirty=!0,this},slerp:function(t,r,e){return H.slerp(this.array,t.array,r.array,e),this._dirty=!0,this},sqrLen:function(){return H.sqrLen(this.array)},squaredLength:function(){return H.squaredLength(this.array)},fromEuler:function(t,r){return ht.fromEuler(this,t,r)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var tn=Object.defineProperty;if(tn){var fa=ht.prototype;tn(fa,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),tn(fa,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}}),tn(fa,"z",{get:function(){return this.array[2]},set:function(t){this.array[2]=t,this._dirty=!0}}),tn(fa,"w",{get:function(){return this.array[3]},set:function(t){this.array[3]=t,this._dirty=!0}})}ht.add=function(t,r,e){return H.add(t.array,r.array,e.array),t._dirty=!0,t};ht.set=function(t,r,e,i,n){H.set(t.array,r,e,i,n),t._dirty=!0};ht.copy=function(t,r){return H.copy(t.array,r.array),t._dirty=!0,t};ht.calculateW=function(t,r){return H.calculateW(t.array,r.array),t._dirty=!0,t};ht.conjugate=function(t,r){return H.conjugate(t.array,r.array),t._dirty=!0,t};ht.identity=function(t){return H.identity(t.array),t._dirty=!0,t};ht.invert=function(t,r){return H.invert(t.array,r.array),t._dirty=!0,t};ht.dot=function(t,r){return H.dot(t.array,r.array)};ht.len=function(t){return H.length(t.array)};ht.lerp=function(t,r,e,i){return H.lerp(t.array,r.array,e.array,i),t._dirty=!0,t};ht.slerp=function(t,r,e,i){return H.slerp(t.array,r.array,e.array,i),t._dirty=!0,t};ht.mul=function(t,r,e){return H.multiply(t.array,r.array,e.array),t._dirty=!0,t};ht.multiply=ht.mul;ht.rotateX=function(t,r,e){return H.rotateX(t.array,r.array,e),t._dirty=!0,t};ht.rotateY=function(t,r,e){return H.rotateY(t.array,r.array,e),t._dirty=!0,t};ht.rotateZ=function(t,r,e){return H.rotateZ(t.array,r.array,e),t._dirty=!0,t};ht.setAxisAngle=function(t,r,e){return H.setAxisAngle(t.array,r.array,e),t._dirty=!0,t};ht.normalize=function(t,r){return H.normalize(t.array,r.array),t._dirty=!0,t};ht.sqrLen=function(t){return H.sqrLen(t.array)};ht.squaredLength=ht.sqrLen;ht.fromMat3=function(t,r){return H.fromMat3(t.array,r.array),t._dirty=!0,t};ht.setAxes=function(t,r,e,i){return H.setAxes(t.array,r.array,e.array,i.array),t._dirty=!0,t};ht.rotationTo=function(t,r,e){return H.rotationTo(t.array,r.array,e.array),t._dirty=!0,t};ht.fromEuler=function(t,r,h){t._dirty=!0,r=r.array;var i=t.array,n=Math.cos(r[0]/2),a=Math.cos(r[1]/2),s=Math.cos(r[2]/2),o=Math.sin(r[0]/2),f=Math.sin(r[1]/2),u=Math.sin(r[2]/2),h=(h||"XYZ").toUpperCase();switch(h){case"XYZ":i[0]=o*a*s+n*f*u,i[1]=n*f*s-o*a*u,i[2]=n*a*u+o*f*s,i[3]=n*a*s-o*f*u;break;case"YXZ":i[0]=o*a*s+n*f*u,i[1]=n*f*s-o*a*u,i[2]=n*a*u-o*f*s,i[3]=n*a*s+o*f*u;break;case"ZXY":i[0]=o*a*s-n*f*u,i[1]=n*f*s+o*a*u,i[2]=n*a*u+o*f*s,i[3]=n*a*s-o*f*u;break;case"ZYX":i[0]=o*a*s-n*f*u,i[1]=n*f*s+o*a*u,i[2]=n*a*u-o*f*s,i[3]=n*a*s+o*f*u;break;case"YZX":i[0]=o*a*s+n*f*u,i[1]=n*f*s+o*a*u,i[2]=n*a*u-o*f*s,i[3]=n*a*s-o*f*u;break;case"XZY":i[0]=o*a*s-n*f*u,i[1]=n*f*s-o*a*u,i[2]=n*a*u+o*f*s,i[3]=n*a*s+o*f*u;break}};var te=b.set,ua=b.copy,Ht=function(t,r){this.min=t||new O(1/0,1/0,1/0),this.max=r||new O(-1/0,-1/0,-1/0),this.vertices=null};Ht.prototype={constructor:Ht,updateFromVertices:function(t){if(t.length>0){var r=this.min,e=this.max,i=r.array,n=e.array;ua(i,t[0]),ua(n,t[0]);for(var a=1;a<t.length;a++){var s=t[a];s[0]<i[0]&&(i[0]=s[0]),s[1]<i[1]&&(i[1]=s[1]),s[2]<i[2]&&(i[2]=s[2]),s[0]>n[0]&&(n[0]=s[0]),s[1]>n[1]&&(n[1]=s[1]),s[2]>n[2]&&(n[2]=s[2])}r._dirty=!0,e._dirty=!0}},union:function(t){var r=this.min,e=this.max;return b.min(r.array,r.array,t.min.array),b.max(e.array,e.array,t.max.array),r._dirty=!0,e._dirty=!0,this},intersection:function(t){var r=this.min,e=this.max;return b.max(r.array,r.array,t.min.array),b.min(e.array,e.array,t.max.array),r._dirty=!0,e._dirty=!0,this},intersectBoundingBox:function(t){var r=this.min.array,e=this.max.array,i=t.min.array,n=t.max.array;return!(r[0]>n[0]||r[1]>n[1]||r[2]>n[2]||e[0]<i[0]||e[1]<i[1]||e[2]<i[2])},containBoundingBox:function(t){var r=this.min.array,e=this.max.array,i=t.min.array,n=t.max.array;return r[0]<=i[0]&&r[1]<=i[1]&&r[2]<=i[2]&&e[0]>=n[0]&&e[1]>=n[1]&&e[2]>=n[2]},containPoint:function(t){var r=this.min.array,e=this.max.array,i=t.array;return r[0]<=i[0]&&r[1]<=i[1]&&r[2]<=i[2]&&e[0]>=i[0]&&e[1]>=i[1]&&e[2]>=i[2]},isFinite:function(){var t=this.min.array,r=this.max.array;return isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])&&isFinite(r[0])&&isFinite(r[1])&&isFinite(r[2])},applyTransform:function(t){this.transformFrom(this,t)},transformFrom:(function(){var t=b.create(),r=b.create(),e=b.create(),i=b.create(),n=b.create(),a=b.create();return function(s,o){var f=s.min.array,u=s.max.array,h=o.array;return t[0]=h[0]*f[0],t[1]=h[1]*f[0],t[2]=h[2]*f[0],r[0]=h[0]*u[0],r[1]=h[1]*u[0],r[2]=h[2]*u[0],e[0]=h[4]*f[1],e[1]=h[5]*f[1],e[2]=h[6]*f[1],i[0]=h[4]*u[1],i[1]=h[5]*u[1],i[2]=h[6]*u[1],n[0]=h[8]*f[2],n[1]=h[9]*f[2],n[2]=h[10]*f[2],a[0]=h[8]*u[2],a[1]=h[9]*u[2],a[2]=h[10]*u[2],f=this.min.array,u=this.max.array,f[0]=Math.min(t[0],r[0])+Math.min(e[0],i[0])+Math.min(n[0],a[0])+h[12],f[1]=Math.min(t[1],r[1])+Math.min(e[1],i[1])+Math.min(n[1],a[1])+h[13],f[2]=Math.min(t[2],r[2])+Math.min(e[2],i[2])+Math.min(n[2],a[2])+h[14],u[0]=Math.max(t[0],r[0])+Math.max(e[0],i[0])+Math.max(n[0],a[0])+h[12],u[1]=Math.max(t[1],r[1])+Math.max(e[1],i[1])+Math.max(n[1],a[1])+h[13],u[2]=Math.max(t[2],r[2])+Math.max(e[2],i[2])+Math.max(n[2],a[2])+h[14],this.min._dirty=!0,this.max._dirty=!0,this}})(),applyProjection:function(t){var r=this.min.array,e=this.max.array,i=t.array,n=r[0],a=r[1],s=r[2],o=e[0],f=e[1],u=r[2],h=e[0],l=e[1],c=e[2];if(i[15]===1)r[0]=i[0]*n+i[12],r[1]=i[5]*a+i[13],e[2]=i[10]*s+i[14],e[0]=i[0]*h+i[12],e[1]=i[5]*l+i[13],r[2]=i[10]*c+i[14];else{var v=-1/s;r[0]=i[0]*n*v,r[1]=i[5]*a*v,e[2]=(i[10]*s+i[14])*v,v=-1/u,e[0]=i[0]*o*v,e[1]=i[5]*f*v,v=-1/c,r[2]=(i[10]*c+i[14])*v}return this.min._dirty=!0,this.max._dirty=!0,this},updateVertices:function(){var t=this.vertices;if(!t){t=[];for(var r=0;r<8;r++)t[r]=b.fromValues(0,0,0);this.vertices=t}var e=this.min.array,i=this.max.array;return te(t[0],e[0],e[1],e[2]),te(t[1],e[0],i[1],e[2]),te(t[2],i[0],e[1],e[2]),te(t[3],i[0],i[1],e[2]),te(t[4],e[0],e[1],i[2]),te(t[5],e[0],i[1],i[2]),te(t[6],i[0],e[1],i[2]),te(t[7],i[0],i[1],i[2]),this},copy:function(t){var r=this.min,e=this.max;return ua(r.array,t.min.array),ua(e.array,t.max.array),r._dirty=!0,e._dirty=!0,this},clone:function(){var t=new Ht;return t.copy(this),t}};var y1=0,he=Vt.extend({name:"",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,autoUpdateLocalTransform:!0,_parent:null,_scene:null,_needsUpdateWorldTransform:!0,_inIterating:!1,__depth:0},function(){this.name||(this.name=(this.type||"NODE")+"_"+y1++),this.position||(this.position=new O),this.rotation||(this.rotation=new ht),this.scale||(this.scale=new O(1,1,1)),this.worldTransform=new V,this.localTransform=new V,this._children=[]},{target:null,invisible:!1,isSkinnedMesh:function(){return!1},isRenderable:function(){return!1},setName:function(t){var r=this._scene;if(r){var e=r._nodeRepository;delete e[this.name],e[t]=this}this.name=t},add:function(t){var r=t._parent;if(r!==this){r&&r.remove(t),t._parent=this,this._children.push(t);var e=this._scene;e&&e!==t.scene&&t.traverse(this._addSelfToScene,this),t._needsUpdateWorldTransform=!0}},remove:function(t){var r=this._children,e=r.indexOf(t);e<0||(r.splice(e,1),t._parent=null,this._scene&&t.traverse(this._removeSelfFromScene,this))},removeAll:function(){for(var t=this._children,r=0;r<t.length;r++)t[r]._parent=null,this._scene&&t[r].traverse(this._removeSelfFromScene,this);this._children=[]},getScene:function(){return this._scene},getParent:function(){return this._parent},_removeSelfFromScene:function(t){t._scene.removeFromScene(t),t._scene=null},_addSelfToScene:function(t){this._scene.addToScene(t),t._scene=this._scene},isAncestor:function(t){for(var r=t._parent;r;){if(r===this)return!0;r=r._parent}return!1},children:function(){return this._children.slice()},childAt:function(t){return this._children[t]},getChildByName:function(t){for(var r=this._children,e=0;e<r.length;e++)if(r[e].name===t)return r[e]},getDescendantByName:function(t){for(var r=this._children,e=0;e<r.length;e++){var i=r[e];if(i.name===t)return i;var n=i.getDescendantByName(t);if(n)return n}},queryNode:function(t){if(t){for(var r=t.split("/"),e=this,i=0;i<r.length;i++){var n=r[i];if(n){for(var a=!1,s=e._children,o=0;o<s.length;o++){var f=s[o];if(f.name===n){e=f,a=!0;break}}if(!a)return}}return e}},getPath:function(t){if(!this._parent)return"/";for(var r=this._parent,e=this.name;r._parent&&(e=r.name+"/"+e,r._parent!=t);)r=r._parent;return!r._parent&&t?null:e},traverse:function(t,r){t.call(r,this);for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].traverse(t,r)},eachChild:function(t,r){for(var e=this._children,i=0,n=e.length;i<n;i++){var a=e[i];t.call(r,a,i)}},setLocalTransform:function(t){F.copy(this.localTransform.array,t.array),this.decomposeLocalTransform()},decomposeLocalTransform:function(t){var r=t?null:this.scale;this.localTransform.decomposeMatrix(r,this.rotation,this.position)},setWorldTransform:function(t){F.copy(this.worldTransform.array,t.array),this.decomposeWorldTransform()},decomposeWorldTransform:(function(){var t=F.create();return function(r){var e=this.localTransform,i=this.worldTransform;this._parent?(F.invert(t,this._parent.worldTransform.array),F.multiply(e.array,t,i.array)):F.copy(e.array,i.array);var n=r?null:this.scale;e.decomposeMatrix(n,this.rotation,this.position)}})(),transformNeedsUpdate:function(){return this.position._dirty||this.rotation._dirty||this.scale._dirty},updateLocalTransform:function(){var t=this.position,r=this.rotation,e=this.scale;if(this.transformNeedsUpdate()){var i=this.localTransform.array;F.fromRotationTranslation(i,r.array,t.array),F.scale(i,i,e.array),r._dirty=!1,e._dirty=!1,t._dirty=!1,this._needsUpdateWorldTransform=!0}},_updateWorldTransformTopDown:function(){var t=this.localTransform.array,r=this.worldTransform.array;this._parent?F.multiplyAffine(r,this._parent.worldTransform.array,t):F.copy(r,t)},updateWorldTransform:function(){for(var t=this;t&&t.getParent()&&t.getParent().transformNeedsUpdate();)t=t.getParent();t.update()},update:function(t){this.autoUpdateLocalTransform?this.updateLocalTransform():t=!0,(t||this._needsUpdateWorldTransform)&&(this._updateWorldTransformTopDown(),t=!0,this._needsUpdateWorldTransform=!1);for(var r=this._children,e=0,i=r.length;e<i;e++)r[e].update(t)},getBoundingBox:(function(){function t(n){return!n.invisible&&n.geometry}var r=new Ht,e=new V,i=new V;return function(n,a){return a=a||new Ht,this._parent?V.invert(i,this._parent.worldTransform):V.identity(i),this.traverse(function(s){s.geometry&&s.geometry.boundingBox&&(r.copy(s.geometry.boundingBox),V.multiply(e,i,s.worldTransform),r.applyTransform(e),a.union(r))},this,t),a}})(),getWorldPosition:function(t){this.transformNeedsUpdate()&&this.updateWorldTransform();var r=this.worldTransform.array;if(t){var e=t.array;return e[0]=r[12],e[1]=r[13],e[2]=r[14],t}else return new O(r[12],r[13],r[14])},clone:function(){var t=new this.constructor,r=this._children;t.setName(this.name),t.position.copy(this.position),t.rotation.copy(this.rotation),t.scale.copy(this.scale);for(var e=0;e<r.length;e++)t.add(r[e].clone());return t},rotateAround:(function(){var t=new O,r=new V;return function(e,i,n){t.copy(this.position).subtract(e);var a=this.localTransform;a.identity(),a.translate(e),a.rotate(n,i),r.fromRotationTranslation(this.rotation,t),a.multiply(r),a.scale(this.scale),this.decomposeLocalTransform(),this._needsUpdateWorldTransform=!0}})(),lookAt:(function(){var t=new V;return function(r,e){t.lookAt(this.position,r,e||this.localTransform.y).invert(),this.setLocalTransform(t),this.target=r}})()}),jt=he.extend({material:null,geometry:null,mode:I.TRIANGLES,_renderInfo:null},{__program:null,lightGroup:0,renderOrder:0,culling:!0,cullFace:I.BACK,frontFace:I.CCW,frustumCulling:!0,receiveShadow:!0,castShadow:!0,ignorePicking:!1,ignorePreZ:!1,ignoreGBuffer:!1,isRenderable:function(){return this.geometry&&this.material&&this.material.shader&&!this.invisible&&this.geometry.vertexCount>0},beforeRender:function(t){},afterRender:function(t,r){},getBoundingBox:function(t,r){return r=he.prototype.getBoundingBox.call(this,t,r),this.geometry&&this.geometry.boundingBox&&r.union(this.geometry.boundingBox),r},clone:(function(){var t=["castShadow","receiveShadow","mode","culling","cullFace","frontFace","frustumCulling","renderOrder","lineWidth","ignorePicking","ignorePreZ","ignoreGBuffer"];return function(){var r=he.prototype.clone.call(this);r.geometry=this.geometry,r.material=this.material;for(var e=0;e<t.length;e++){var i=t[e];r[i]!==this[i]&&(r[i]=this[i])}return r}})()});jt.POINTS=I.POINTS;jt.LINES=I.LINES;jt.LINE_LOOP=I.LINE_LOOP;jt.LINE_STRIP=I.LINE_STRIP;jt.TRIANGLES=I.TRIANGLES;jt.TRIANGLE_STRIP=I.TRIANGLE_STRIP;jt.TRIANGLE_FAN=I.TRIANGLE_FAN;jt.BACK=I.BACK;jt.FRONT=I.FRONT;jt.FRONT_AND_BACK=I.FRONT_AND_BACK;jt.CW=I.CW;jt.CCW=I.CCW;var av=Vt.extend({scene:null,camera:null,renderer:null},function(){this._ray=new Li,this._ndc=new tt},{pick:function(t,r,e){var i=this.pickAll(t,r,[],e);return i[0]||null},pickAll:function(t,r,e,i){return this.renderer.screenToNDC(t,r,this._ndc),this.camera.castRay(this._ndc,this._ray),e=e||[],this._intersectNode(this.scene,e,i||!1),e.sort(this._intersectionCompareFunc),e},_intersectNode:function(t,r,e){t instanceof jt&&t.isRenderable()&&(!t.ignorePicking||e)&&(t.mode===I.TRIANGLES&&t.geometry.isUseIndices()||t.geometry.pickByRay||t.geometry.pick)&&this._intersectRenderable(t,r);for(var i=0;i<t._children.length;i++)this._intersectNode(t._children[i],r,e)},_intersectRenderable:(function(){var t=new O,r=new O,e=new O,i=new Li,n=new V;return function(a,s){var o=a.isSkinnedMesh();i.copy(this._ray),V.invert(n,a.worldTransform),o||i.applyTransform(n);var f=a.geometry,u=o?a.skeleton.boundingBox:f.boundingBox;if(!(u&&!i.intersectBoundingBox(u))){if(f.pick){f.pick(this._ndc.x,this._ndc.y,this.renderer,this.camera,a,s);return}else if(f.pickByRay){f.pickByRay(i,a,s);return}var h=a.cullFace===I.BACK&&a.frontFace===I.CCW||a.cullFace===I.FRONT&&a.frontFace===I.CW,l,c=f.indices,v=f.attributes.position,d=f.attributes.weight,_=f.attributes.joint,p,y=[];if(!(!v||!v.value||!c)){if(o){p=a.skeleton.getSubSkinMatrices(a.__uid__,a.joints);for(var g=0;g<a.joints.length;g++){y[g]=y[g]||[];for(var m=0;m<16;m++)y[g][m]=p[g*16+m]}var T=[],w=[],x=[],E=[],S=[],M=f.attributes.skinnedPosition;(!M||!M.value)&&(f.createAttribute("skinnedPosition","f",3),M=f.attributes.skinnedPosition,M.init(f.vertexCount));for(var g=0;g<f.vertexCount;g++){v.get(g,T),d.get(g,w),_.get(g,x),w[3]=1-w[0]-w[1]-w[2],b.set(E,0,0,0);for(var m=0;m<4;m++)x[m]>=0&&w[m]>1e-4&&(b.transformMat4(S,T,y[x[m]]),b.scaleAndAdd(E,E,S,w[m]));M.set(g,E)}}for(var g=0;g<c.length;g+=3){var C=c[g],R=c[g+1],L=c[g+2],D=o?f.attributes.skinnedPosition:v;if(D.get(C,t.array),D.get(R,r.array),D.get(L,e.array),h?l=i.intersectTriangle(t,r,e,a.culling):l=i.intersectTriangle(t,e,r,a.culling),l){var P=new O;o?O.copy(P,l):O.transformMat4(P,l,a.worldTransform),s.push(new av.Intersection(l,P,a,[C,R,L],g/3,O.dist(P,this._ray.origin)))}}}}}})(),_intersectionCompareFunc:function(t,r){return t.distance-r.distance}});av.Intersection=function(t,r,e,i,n,a){this.point=t,this.pointWorld=r,this.target=e,this.triangle=i,this.triangleIndex=n,this.distance=a};var rn="__dt__",Ni=function(){this._contextId=0,this._caches=[],this._context={}};Ni.prototype={use:function(t,r){var e=this._caches;e[t]||(e[t]={},r&&(e[t]=r())),this._contextId=t,this._context=e[t]},put:function(t,r){this._context[t]=r},get:function(t){return this._context[t]},dirty:function(t){t=t||"";var r=rn+t;this.put(r,!0)},dirtyAll:function(t){t=t||"";for(var r=rn+t,e=this._caches,i=0;i<e.length;i++)e[i]&&(e[i][r]=!0)},fresh:function(t){t=t||"";var r=rn+t;this.put(r,!1)},freshAll:function(t){t=t||"";for(var r=rn+t,e=this._caches,i=0;i<e.length;i++)e[i]&&(e[i][r]=!1)},isDirty:function(t){t=t||"";var r=rn+t,e=this._context;return!e.hasOwnProperty(r)||e[r]===!0},deleteContext:function(t){delete this._caches[t],this._context={}},delete:function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},eachContext:function(t,r){var e=Object.keys(this._caches);e.forEach(function(i){t&&t.call(r,i)})},miss:function(t){return!this._context.hasOwnProperty(t)}};Ni.prototype.constructor=Ni;var q=Vt.extend({width:512,height:512,type:I.UNSIGNED_BYTE,format:I.RGBA,wrapS:I.REPEAT,wrapT:I.REPEAT,minFilter:I.LINEAR_MIPMAP_LINEAR,magFilter:I.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,sRGB:!0,unpackAlignment:4,premultiplyAlpha:!1,dynamic:!1,NPOT:!1,__used:0},function(){this._cache=new Ni},{getWebGLTexture:function(t){var r=t.gl,e=this._cache;return e.use(t.__uid__),e.miss("webgl_texture")&&e.put("webgl_texture",r.createTexture()),this.dynamic?this.update(t):e.isDirty()&&(this.update(t),e.fresh()),e.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){this._cache&&this._cache.dirtyAll()},update:function(t){},updateCommon:function(t){var r=t.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),this.format===I.DEPTH_COMPONENT&&(this.useMipmap=!1);var e=t.getGLExtension("EXT_sRGB");this.format===q.SRGB&&!e&&(this.format=q.RGB),this.format===q.SRGB_ALPHA&&!e&&(this.format=q.RGBA),this.NPOT=!this.isPowerOfTwo()},getAvailableWrapS:function(){return this.NPOT?I.CLAMP_TO_EDGE:this.wrapS},getAvailableWrapT:function(){return this.NPOT?I.CLAMP_TO_EDGE:this.wrapT},getAvailableMinFilter:function(){var t=this.minFilter;return this.NPOT||!this.useMipmap?t===I.NEAREST_MIPMAP_NEAREST||t===I.NEAREST_MIPMAP_LINEAR?I.NEAREST:t===I.LINEAR_MIPMAP_LINEAR||t===I.LINEAR_MIPMAP_NEAREST?I.LINEAR:t:t},getAvailableMagFilter:function(){return this.magFilter},nextHighestPowerOfTwo:function(t){--t;for(var r=1;r<32;r<<=1)t=t|t>>r;return t+1},dispose:function(t){var r=this._cache;r.use(t.__uid__);var e=r.get("webgl_texture");e&&t.gl.deleteTexture(e),r.deleteContext(t.__uid__)},isRenderable:function(){},isPowerOfTwo:function(){}});Object.defineProperty(q.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}});Object.defineProperty(q.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}});q.BYTE=I.BYTE;q.UNSIGNED_BYTE=I.UNSIGNED_BYTE;q.SHORT=I.SHORT;q.UNSIGNED_SHORT=I.UNSIGNED_SHORT;q.INT=I.INT;q.UNSIGNED_INT=I.UNSIGNED_INT;q.FLOAT=I.FLOAT;q.HALF_FLOAT=36193;q.UNSIGNED_INT_24_8_WEBGL=34042;q.DEPTH_COMPONENT=I.DEPTH_COMPONENT;q.DEPTH_STENCIL=I.DEPTH_STENCIL;q.ALPHA=I.ALPHA;q.RGB=I.RGB;q.RGBA=I.RGBA;q.LUMINANCE=I.LUMINANCE;q.LUMINANCE_ALPHA=I.LUMINANCE_ALPHA;q.SRGB=35904;q.SRGB_ALPHA=35906;q.COMPRESSED_RGB_S3TC_DXT1_EXT=33776;q.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777;q.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778;q.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779;q.NEAREST=I.NEAREST;q.LINEAR=I.LINEAR;q.NEAREST_MIPMAP_NEAREST=I.NEAREST_MIPMAP_NEAREST;q.LINEAR_MIPMAP_NEAREST=I.LINEAR_MIPMAP_NEAREST;q.NEAREST_MIPMAP_LINEAR=I.NEAREST_MIPMAP_LINEAR;q.LINEAR_MIPMAP_LINEAR=I.LINEAR_MIPMAP_LINEAR;q.REPEAT=I.REPEAT;q.CLAMP_TO_EDGE=I.CLAMP_TO_EDGE;q.MIRRORED_REPEAT=I.MIRRORED_REPEAT;var nr=jt.extend({skeleton:null,joints:null},function(){this.joints||(this.joints=[])},{offsetMatrix:null,isInstancedMesh:function(){return!1},isSkinnedMesh:function(){return!!(this.skeleton&&this.joints&&this.joints.length>0)},clone:function(){var t=jt.prototype.clone.call(this);return t.skeleton=this.skeleton,this.joints&&(t.joints=this.joints.slice()),t}});nr.POINTS=I.POINTS;nr.LINES=I.LINES;nr.LINE_LOOP=I.LINE_LOOP;nr.LINE_STRIP=I.LINE_STRIP;nr.TRIANGLES=I.TRIANGLES;nr.TRIANGLE_STRIP=I.TRIANGLE_STRIP;nr.TRIANGLE_FAN=I.TRIANGLE_FAN;nr.BACK=I.BACK;nr.FRONT=I.FRONT;nr.FRONT_AND_BACK=I.FRONT_AND_BACK;nr.CW=I.CW;nr.CCW=I.CCW;var Fn={};Fn.isPowerOfTwo=function(t){return(t&t-1)===0};Fn.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t};Fn.nearestPowerOfTwo=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))};var el=Fn.isPowerOfTwo;function il(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}function g1(t,r){var e=il(t.width),i=il(t.height);r=r||document.createElement("canvas"),r.width=e,r.height=i;var n=r.getContext("2d");return n.drawImage(t.image,0,0,e,i),r}var Wt=q.extend(function(){return{image:null,pixels:null,mipmaps:[],convertToPOT:!1}},{textureType:"texture2D",update:function(t){var r=t.gl;r.bindTexture(r.TEXTURE_2D,this._cache.get("webgl_texture")),this.updateCommon(t);var e=this.format,i=this.type,n=!!(this.convertToPOT&&!this.mipmaps.length&&this.image&&(this.wrapS===q.REPEAT||this.wrapT===q.REPEAT)&&this.NPOT);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,n?this.wrapS:this.getAvailableWrapS()),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n?this.wrapT:this.getAvailableWrapT()),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n?this.magFilter:this.getAvailableMagFilter()),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n?this.minFilter:this.getAvailableMinFilter());var a=t.getGLExtension("EXT_texture_filter_anisotropic");if(a&&this.anisotropic>1&&r.texParameterf(r.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),i===36193){var s=t.getGLExtension("OES_texture_half_float");s||(i=I.FLOAT)}if(this.mipmaps.length)for(var o=this.width,f=this.height,u=0;u<this.mipmaps.length;u++){var h=this.mipmaps[u];this._updateTextureData(r,h,u,o,f,e,i,!1),o/=2,f/=2}else this._updateTextureData(r,this,0,this.width,this.height,e,i,n),this.useMipmap&&(!this.NPOT||n)&&r.generateMipmap(r.TEXTURE_2D);r.bindTexture(r.TEXTURE_2D,null)},_updateTextureData:function(t,r,e,i,n,a,s,o){if(r.image){var f=r.image;o&&(this._potCanvas=g1(this,this._potCanvas),f=this._potCanvas),t.texImage2D(t.TEXTURE_2D,e,a,a,s,f)}else a<=q.COMPRESSED_RGBA_S3TC_DXT5_EXT&&a>=q.COMPRESSED_RGB_S3TC_DXT1_EXT?t.compressedTexImage2D(t.TEXTURE_2D,e,a,i,n,0,r.pixels):t.texImage2D(t.TEXTURE_2D,e,a,i,n,0,a,s,r.pixels)},generateMipmap:function(t){var r=t.gl;this.useMipmap&&!this.NPOT&&(r.bindTexture(r.TEXTURE_2D,this._cache.get("webgl_texture")),r.generateMipmap(r.TEXTURE_2D))},isPowerOfTwo:function(){return el(this.width)&&el(this.height)},isRenderable:function(){return this.image?this.image.width>0&&this.image.height>0:!!(this.width&&this.height)},bind:function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,this.getWebGLTexture(t))},unbind:function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,null)},load:function(t,r){var e=at.createImage();r&&(e.crossOrigin=r);var i=this;return e.onload=function(){i.dirty(),i.trigger("success",i)},e.onerror=function(){i.trigger("error",i)},e.src=t,this.image=e,this}});Object.defineProperty(Wt.prototype,"width",{get:function(){return this.image?this.image.width:this._width},set:function(t){this.image?console.warn("Texture from image can't set width"):(this._width!==t&&this.dirty(),this._width=t)}});Object.defineProperty(Wt.prototype,"height",{get:function(){return this.image?this.image.height:this._height},set:function(t){this.image?console.warn("Texture from image can't set height"):(this._height!==t&&this.dirty(),this._height=t)}});function sv(t){return{byte:at.Int8Array,ubyte:at.Uint8Array,short:at.Int16Array,ushort:at.Uint16Array}[t]||at.Float32Array}function oo(t){return"attr_"+t}function Fi(t,r,e,i){switch(this.name=t,this.type=r,this.size=e,this.semantic=i||"",this.value=null,e){case 1:this.get=function(n){return this.value[n]},this.set=function(n,a){this.value[n]=a},this.copy=function(n,a){this.value[n]=this.value[n]};break;case 2:this.get=function(n,a){var s=this.value;return a[0]=s[n*2],a[1]=s[n*2+1],a},this.set=function(n,a){var s=this.value;s[n*2]=a[0],s[n*2+1]=a[1]},this.copy=function(n,a){var s=this.value;a*=2,n*=2,s[n]=s[a],s[n+1]=s[a+1]};break;case 3:this.get=function(n,a){var s=n*3,o=this.value;return a[0]=o[s],a[1]=o[s+1],a[2]=o[s+2],a},this.set=function(n,a){var s=n*3,o=this.value;o[s]=a[0],o[s+1]=a[1],o[s+2]=a[2]},this.copy=function(n,a){var s=this.value;a*=3,n*=3,s[n]=s[a],s[n+1]=s[a+1],s[n+2]=s[a+2]};break;case 4:this.get=function(n,a){var s=this.value,o=n*4;return a[0]=s[o],a[1]=s[o+1],a[2]=s[o+2],a[3]=s[o+3],a},this.set=function(n,a){var s=this.value,o=n*4;s[o]=a[0],s[o+1]=a[1],s[o+2]=a[2],s[o+3]=a[3]},this.copy=function(n,a){var s=this.value;a*=4,n*=4,s[n]=s[a],s[n+1]=s[a+1],s[n+2]=s[a+2],s[n+3]=s[a+3]}}}Fi.prototype.init=function(t){if(!this.value||this.value.length!==t*this.size){var r=sv(this.type);this.value=new r(t*this.size)}};Fi.prototype.fromArray=function(t){var r=sv(this.type),e;if(t[0]&&t[0].length){var i=0,n=this.size;e=new r(t.length*n);for(var a=0;a<t.length;a++)for(var s=0;s<n;s++)e[i++]=t[a][s]}else e=new r(t);this.value=e};Fi.prototype.clone=function(t){var r=new Fi(this.name,this.type,this.size,this.semantic);return t&&console.warn("todo"),r};function ov(t,r,e,i,n){this.name=t,this.type=r,this.buffer=e,this.size=i,this.semantic=n,this.symbol="",this.needsRemove=!1}function fv(t){this.buffer=t,this.count=0}var $t=Vt.extend(function(){return{attributes:{},indices:null,dynamic:!0,_enabledAttributes:null,__used:0}},function(){this._cache=new Ni,this._attributeList=Object.keys(this.attributes),this.__vaoCache={}},{mainAttribute:"",pick:null,pickByRay:null,dirty:function(){for(var t=this.getEnabledAttributes(),r=0;r<t.length;r++)this.dirtyAttribute(t[r]);this.dirtyIndices(),this._enabledAttributes=null,this._cache.dirty("any")},dirtyIndices:function(){this._cache.dirtyAll("indices")},dirtyAttribute:function(t){this._cache.dirtyAll(oo(t)),this._cache.dirtyAll("attributes")},getTriangleIndices:function(t,r){if(t<this.triangleCount&&t>=0){r||(r=[]);var e=this.indices;return r[0]=e[t*3],r[1]=e[t*3+1],r[2]=e[t*3+2],r}},setTriangleIndices:function(t,r){var e=this.indices;e[t*3]=r[0],e[t*3+1]=r[1],e[t*3+2]=r[2]},isUseIndices:function(){return!!this.indices},initIndicesFromArray:function(t){var r,e=this.vertexCount>65535?at.Uint32Array:at.Uint16Array;if(t[0]&&t[0].length){var i=0,n=3;r=new e(t.length*n);for(var a=0;a<t.length;a++)for(var s=0;s<n;s++)r[i++]=t[a][s]}else r=new e(t);this.indices=r},createAttribute:function(t,r,e,i){var n=new Fi(t,r,e,i);return this.attributes[t]&&this.removeAttribute(t),this.attributes[t]=n,this._attributeList.push(t),n},removeAttribute:function(t){var r=this._attributeList,e=r.indexOf(t);return e>=0?(r.splice(e,1),delete this.attributes[t],!0):!1},getAttribute:function(t){return this.attributes[t]},getEnabledAttributes:function(){var t=this._enabledAttributes,r=this._attributeList;if(t)return t;for(var e=[],i=this.vertexCount,n=0;n<r.length;n++){var a=r[n],s=this.attributes[a];s.value&&s.value.length===i*s.size&&e.push(a)}return this._enabledAttributes=e,e},getBufferChunks:function(t){var r=this._cache;r.use(t.__uid__);var e=r.isDirty("attributes"),i=r.isDirty("indices");if(e||i){this._updateBuffer(t.gl,e,i);for(var n=this.getEnabledAttributes(),a=0;a<n.length;a++)r.fresh(oo(n[a]));r.fresh("attributes"),r.fresh("indices")}return r.fresh("any"),r.get("chunks")},_updateBuffer:function(t,r,e){var i=this._cache,n=i.get("chunks"),a=!1;n||(n=[],n[0]={attributeBuffers:[],indicesBuffer:null},i.put("chunks",n),a=!0);var s=n[0],o=s.attributeBuffers,f=s.indicesBuffer;if(r||a){var u=this.getEnabledAttributes(),h={};if(!a)for(var l=0;l<o.length;l++)h[o[l].name]=o[l];for(var c=0;c<u.length;c++){var v=u[c],d=this.attributes[v],_;a||(_=h[v]);var p;_?p=_.buffer:p=t.createBuffer(),i.isDirty(oo(v))&&(t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,d.value,this.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW)),o[c]=new ov(v,d.type,p,d.size,d.semantic)}for(var l=c;l<o.length;l++)t.deleteBuffer(o[l].buffer);o.length=c}this.isUseIndices()&&(e||a)&&(f||(f=new fv(t.createBuffer()),s.indicesBuffer=f),f.count=this.indices.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,f.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,this.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW))},dispose:function(t){var r=this._cache;r.use(t.__uid__);var e=r.get("chunks");if(e)for(var i=0;i<e.length;i++){for(var n=e[i],a=0;a<n.attributeBuffers.length;a++){var s=n.attributeBuffers[a];t.gl.deleteBuffer(s.buffer)}n.indicesBuffer&&t.gl.deleteBuffer(n.indicesBuffer.buffer)}if(this.__vaoCache){var o=t.getGLExtension("OES_vertex_array_object");for(var f in this.__vaoCache){var u=this.__vaoCache[f].vao;u&&o.deleteVertexArrayOES(u)}}this.__vaoCache={},r.deleteContext(t.__uid__)}});Object.defineProperty&&(Object.defineProperty($t.prototype,"vertexCount",{enumerable:!1,get:function(){var t=this.attributes[this.mainAttribute];return t||(t=this.attributes[this._attributeList[0]]),!t||!t.value?0:t.value.length/t.size}}),Object.defineProperty($t.prototype,"triangleCount",{enumerable:!1,get:function(){var t=this.indices;return t?t.length/3:0}}));$t.STATIC_DRAW=I.STATIC_DRAW;$t.DYNAMIC_DRAW=I.DYNAMIC_DRAW;$t.STREAM_DRAW=I.STREAM_DRAW;$t.AttributeBuffer=ov;$t.IndicesBuffer=fv;$t.Attribute=Fi;var Xt=b.create,ci=b.add,De=b.set,Fr=$t.Attribute,Kr=$t.extend(function(){return{attributes:{position:new Fr("position","float",3,"POSITION"),texcoord0:new Fr("texcoord0","float",2,"TEXCOORD_0"),texcoord1:new Fr("texcoord1","float",2,"TEXCOORD_1"),normal:new Fr("normal","float",3,"NORMAL"),tangent:new Fr("tangent","float",4,"TANGENT"),color:new Fr("color","float",4,"COLOR"),weight:new Fr("weight","float",3,"WEIGHT"),joint:new Fr("joint","float",4,"JOINT"),barycentric:new Fr("barycentric","float",3,null)},boundingBox:null}},{mainAttribute:"position",updateBoundingBox:function(){var t=this.boundingBox;t||(t=this.boundingBox=new Ht);var r=this.attributes.position.value;if(r&&r.length){var e=t.min,i=t.max,n=e.array,a=i.array;b.set(n,r[0],r[1],r[2]),b.set(a,r[0],r[1],r[2]);for(var s=3;s<r.length;){var o=r[s++],f=r[s++],u=r[s++];o<n[0]&&(n[0]=o),f<n[1]&&(n[1]=f),u<n[2]&&(n[2]=u),o>a[0]&&(a[0]=o),f>a[1]&&(a[1]=f),u>a[2]&&(a[2]=u)}e._dirty=!0,i._dirty=!0}},generateVertexNormals:function(){if(this.vertexCount){var t=this.indices,r=this.attributes,e=r.position.value,i=r.normal.value;if(!i||i.length!==e.length)i=r.normal.value=new at.Float32Array(e.length);else for(var n=0;n<i.length;n++)i[n]=0;for(var a=Xt(),s=Xt(),o=Xt(),f=Xt(),u=Xt(),h=Xt(),l=t?t.length:this.vertexCount,c,v,d,_=0;_<l;){t?(c=t[_++],v=t[_++],d=t[_++]):(c=_++,v=_++,d=_++),De(a,e[c*3],e[c*3+1],e[c*3+2]),De(s,e[v*3],e[v*3+1],e[v*3+2]),De(o,e[d*3],e[d*3+1],e[d*3+2]),b.sub(f,a,s),b.sub(u,s,o),b.cross(h,f,u);for(var n=0;n<3;n++)i[c*3+n]=i[c*3+n]+h[n],i[v*3+n]=i[v*3+n]+h[n],i[d*3+n]=i[d*3+n]+h[n]}for(var n=0;n<i.length;)De(h,i[n],i[n+1],i[n+2]),b.normalize(h,h),i[n++]=h[0],i[n++]=h[1],i[n++]=h[2];this.dirty()}},generateFaceNormals:function(){if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var t=this.indices,r=this.attributes,e=r.position.value,i=r.normal.value,n=Xt(),a=Xt(),s=Xt(),o=Xt(),f=Xt(),u=Xt();i||(i=r.normal.value=new Float32Array(e.length));for(var h=t?t.length:this.vertexCount,l,c,v,d=0;d<h;){t?(l=t[d++],c=t[d++],v=t[d++]):(l=d++,c=d++,v=d++),De(n,e[l*3],e[l*3+1],e[l*3+2]),De(a,e[c*3],e[c*3+1],e[c*3+2]),De(s,e[v*3],e[v*3+1],e[v*3+2]),b.sub(o,n,a),b.sub(f,a,s),b.cross(u,o,f),b.normalize(u,u);for(var _=0;_<3;_++)i[l*3+_]=u[_],i[c*3+_]=u[_],i[v*3+_]=u[_]}this.dirty()}},generateTangents:function(){if(this.vertexCount){var t=this.vertexCount,r=this.attributes;r.tangent.value||(r.tangent.value=new Float32Array(t*4));var e=r.texcoord0.value,i=r.position.value,n=r.tangent.value,a=r.normal.value;if(!e){console.warn("Geometry without texcoords can't generate tangents.");return}for(var s=[],o=[],f=0;f<t;f++)s[f]=[0,0,0],o[f]=[0,0,0];for(var u=[0,0,0],h=[0,0,0],l=this.indices,c=l?l.length:this.vertexCount,v,d,_,f=0;f<c;){l?(v=l[f++],d=l[f++],_=l[f++]):(v=f++,d=f++,_=f++);var p=e[v*2],y=e[d*2],g=e[_*2],m=e[v*2+1],T=e[d*2+1],w=e[_*2+1],x=i[v*3],E=i[d*3],S=i[_*3],M=i[v*3+1],C=i[d*3+1],R=i[_*3+1],L=i[v*3+2],D=i[d*3+2],P=i[_*3+2],z=E-x,A=S-x,B=C-M,k=R-M,j=D-L,$=P-L,rt=y-p,Q=g-p,st=T-m,et=w-m,pt=1/(rt*et-st*Q);u[0]=(et*z-st*A)*pt,u[1]=(et*B-st*k)*pt,u[2]=(et*j-st*$)*pt,h[0]=(rt*A-Q*z)*pt,h[1]=(rt*k-Q*B)*pt,h[2]=(rt*$-Q*j)*pt,ci(s[v],s[v],u),ci(s[d],s[d],u),ci(s[_],s[_],u),ci(o[v],o[v],h),ci(o[d],o[d],h),ci(o[_],o[_],h)}for(var At=Xt(),Kt=Xt(),G=Xt(),f=0;f<t;f++){G[0]=a[f*3],G[1]=a[f*3+1],G[2]=a[f*3+2];var X=s[f];b.scale(At,G,b.dot(G,X)),b.sub(At,X,At),b.normalize(At,At),b.cross(Kt,G,X),n[f*4]=At[0],n[f*4+1]=At[1],n[f*4+2]=At[2],n[f*4+3]=b.dot(Kt,o[f])<0?-1:1}this.dirty()}},isUniqueVertex:function(){return this.isUseIndices()?this.vertexCount===this.indices.length:!0},generateUniqueVertex:function(){if(!(!this.vertexCount||!this.indices)){this.indices.length>65535&&(this.indices=new at.Uint32Array(this.indices));for(var t=this.attributes,r=this.indices,e=this.getEnabledAttributes(),i={},n=0;n<e.length;n++){var a=e[n];i[a]=t[a].value,t[a].init(this.indices.length)}for(var s=0,o=0;o<r.length;o++){for(var f=r[o],n=0;n<e.length;n++)for(var a=e[n],u=t[a].value,h=t[a].size,l=0;l<h;l++)u[s*h+l]=i[a][f*h+l];r[o]=s,s++}this.dirty()}},generateBarycentric:function(){if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var t=this.attributes,r=t.barycentric.value,e=this.indices;if(!(r&&r.length===e.length*3)){r=t.barycentric.value=new Float32Array(e.length*3);for(var i=0;i<(e?e.length:this.vertexCount/3);)for(var n=0;n<3;n++){var a=e?e[i++]:i*3+n;r[a*3+n]=1}this.dirty()}}},applyTransform:function(t){var r=this.attributes,e=r.position.value,i=r.normal.value,n=r.tangent.value;t=t.array;var a=F.create();F.invert(a,t),F.transpose(a,a);var s=b.transformMat4,o=b.forEach;o(e,3,0,null,s,t),i&&o(i,3,0,null,s,a),n&&o(n,4,0,null,s,a),this.boundingBox&&this.updateBoundingBox()},dispose:function(t){var r=this._cache;r.use(t.__uid__);var e=r.get("chunks");if(e)for(var i=0;i<e.length;i++){for(var n=e[i],a=0;a<n.attributeBuffers.length;a++){var s=n.attributeBuffers[a];t.gl.deleteBuffer(s.buffer)}n.indicesBuffer&&t.gl.deleteBuffer(n.indicesBuffer.buffer)}if(this.__vaoCache){var o=t.getGLExtension("OES_vertex_array_object");for(var f in this.__vaoCache){var u=this.__vaoCache[f].vao;u&&o.deleteVertexArrayOES(u)}}this.__vaoCache={},r.deleteContext(t.__uid__)}});Kr.STATIC_DRAW=$t.STATIC_DRAW;Kr.DYNAMIC_DRAW=$t.DYNAMIC_DRAW;Kr.STREAM_DRAW=$t.STREAM_DRAW;Kr.AttributeBuffer=$t.AttributeBuffer;Kr.IndicesBuffer=$t.IndicesBuffer;Kr.Attribute=Fr;const m1=`vec3 calcAmbientSHLight(int idx, vec3 N) {
 int offset = 9 * idx;
 return ambientSHLightCoefficients[0]
 + ambientSHLightCoefficients[1] * N.x
 + ambientSHLightCoefficients[2] * N.y
 + ambientSHLightCoefficients[3] * N.z
 + ambientSHLightCoefficients[4] * N.x * N.z
 + ambientSHLightCoefficients[5] * N.z * N.y
 + ambientSHLightCoefficients[6] * N.y * N.x
 + ambientSHLightCoefficients[7] * (3.0 * N.z * N.z - 1.0)
 + ambientSHLightCoefficients[8] * (N.x * N.x - N.y * N.y);
}`;var gr="uniform vec3 ",en="uniform float ",vi="@export clay.header.",di="@end",Ft=":unconfigurable;";const T1=[vi+"directional_light",gr+"directionalLightDirection[DIRECTIONAL_LIGHT_COUNT]"+Ft,gr+"directionalLightColor[DIRECTIONAL_LIGHT_COUNT]"+Ft,di,vi+"ambient_light",gr+"ambientLightColor[AMBIENT_LIGHT_COUNT]"+Ft,di,vi+"ambient_sh_light",gr+"ambientSHLightColor[AMBIENT_SH_LIGHT_COUNT]"+Ft,gr+"ambientSHLightCoefficients[AMBIENT_SH_LIGHT_COUNT * 9]"+Ft,m1,di,vi+"ambient_cubemap_light",gr+"ambientCubemapLightColor[AMBIENT_CUBEMAP_LIGHT_COUNT]"+Ft,"uniform samplerCube ambientCubemapLightCubemap[AMBIENT_CUBEMAP_LIGHT_COUNT]"+Ft,"uniform sampler2D ambientCubemapLightBRDFLookup[AMBIENT_CUBEMAP_LIGHT_COUNT]"+Ft,di,vi+"point_light",gr+"pointLightPosition[POINT_LIGHT_COUNT]"+Ft,en+"pointLightRange[POINT_LIGHT_COUNT]"+Ft,gr+"pointLightColor[POINT_LIGHT_COUNT]"+Ft,di,vi+"spot_light",gr+"spotLightPosition[SPOT_LIGHT_COUNT]"+Ft,gr+"spotLightDirection[SPOT_LIGHT_COUNT]"+Ft,en+"spotLightRange[SPOT_LIGHT_COUNT]"+Ft,en+"spotLightUmbraAngleCosine[SPOT_LIGHT_COUNT]"+Ft,en+"spotLightPenumbraAngleCosine[SPOT_LIGHT_COUNT]"+Ft,en+"spotLightFalloffFactor[SPOT_LIGHT_COUNT]"+Ft,gr+"spotLightColor[SPOT_LIGHT_COUNT]"+Ft,di].join(`
`);J.import(T1);var Rr=he.extend(function(){return{color:[1,1,1],intensity:1,castShadow:!0,shadowResolution:512,group:0}},{type:"",clone:function(){var t=he.prototype.clone.call(this);return t.color=Array.prototype.slice.call(this.color),t.intensity=this.intensity,t.castShadow=this.castShadow,t.shadowResolution=this.shadowResolution,t}}),Ta=function(t,r){this.normal=t||new O(0,1,0),this.distance=r||0};Ta.prototype={constructor:Ta,distanceToPoint:function(t){return b.dot(t.array,this.normal.array)-this.distance},projectPoint:function(t,r){r||(r=new O);var e=this.distanceToPoint(t);return b.scaleAndAdd(r.array,t.array,this.normal.array,-e),r._dirty=!0,r},normalize:function(){var t=1/b.len(this.normal.array);b.scale(this.normal.array,t),this.distance*=t},intersectFrustum:function(t){for(var r=t.vertices,e=this.normal.array,i=b.dot(r[0].array,e)>this.distance,n=1;n<8;n++)if(b.dot(r[n].array,e)>this.distance!=i)return!0},intersectLine:(function(){var t=b.create();return function(r,e,i){var n=this.distanceToPoint(r),a=this.distanceToPoint(e);if(n>0&&a>0||n<0&&a<0)return null;var s=this.normal.array,o=this.distance,f=r.array;b.sub(t,e.array,r.array),b.normalize(t,t);var u=b.dot(s,t);if(u===0)return null;i||(i=new O);var h=(b.dot(s,f)-o)/u;return b.scaleAndAdd(i.array,f,t,-h),i._dirty=!0,i}})(),applyTransform:(function(){var t=F.create(),r=N.create(),e=N.create();return e[3]=1,function(i){i=i.array,b.scale(e,this.normal.array,this.distance),N.transformMat4(e,e,i),this.distance=b.dot(e,this.normal.array),F.invert(t,i),F.transpose(t,t),r[3]=0,b.copy(r,this.normal.array),N.transformMat4(r,r,t),b.copy(this.normal.array,r)}})(),copy:function(t){b.copy(this.normal.array,t.normal.array),this.normal._dirty=!0,this.distance=t.distance},clone:function(){var t=new Ta;return t.copy(this),t}};var Rt=b.set,nl=b.copy,al=b.transformMat4,fo=Math.min,uo=Math.max,Cf=function(){this.planes=[];for(var t=0;t<6;t++)this.planes.push(new Ta);this.boundingBox=new Ht,this.vertices=[];for(var t=0;t<8;t++)this.vertices[t]=b.fromValues(0,0,0)};Cf.prototype={setFromProjection:function(t){var r=this.planes,e=t.array,i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],f=e[5],u=e[6],h=e[7],l=e[8],c=e[9],v=e[10],d=e[11],_=e[12],p=e[13],y=e[14],g=e[15];Rt(r[0].normal.array,s-i,h-o,d-l),r[0].distance=-(g-_),r[0].normalize(),Rt(r[1].normal.array,s+i,h+o,d+l),r[1].distance=-(g+_),r[1].normalize(),Rt(r[2].normal.array,s+n,h+f,d+c),r[2].distance=-(g+p),r[2].normalize(),Rt(r[3].normal.array,s-n,h-f,d-c),r[3].distance=-(g-p),r[3].normalize(),Rt(r[4].normal.array,s-a,h-u,d-v),r[4].distance=-(g-y),r[4].normalize(),Rt(r[5].normal.array,s+a,h+u,d+v),r[5].distance=-(g+y),r[5].normalize();var m=this.boundingBox,T=this.vertices;if(g===0){var w=f/i,x=-y/(v-1),E=-y/(v+1),S=-E/f,M=-x/f;m.min.set(-S*w,-S,E),m.max.set(S*w,S,x),Rt(T[0],-S*w,-S,E),Rt(T[1],-S*w,S,E),Rt(T[2],S*w,-S,E),Rt(T[3],S*w,S,E),Rt(T[4],-M*w,-M,x),Rt(T[5],-M*w,M,x),Rt(T[6],M*w,-M,x),Rt(T[7],M*w,M,x)}else{var C=(-1-_)/i,R=(1-_)/i,L=(1-p)/f,D=(-1-p)/f,P=(-1-y)/v,z=(1-y)/v;m.min.set(Math.min(C,R),Math.min(D,L),Math.min(z,P)),m.max.set(Math.max(R,C),Math.max(L,D),Math.max(P,z));var A=m.min.array,B=m.max.array;Rt(T[0],A[0],A[1],A[2]),Rt(T[1],A[0],B[1],A[2]),Rt(T[2],B[0],A[1],A[2]),Rt(T[3],B[0],B[1],A[2]),Rt(T[4],A[0],A[1],B[2]),Rt(T[5],A[0],B[1],B[2]),Rt(T[6],B[0],A[1],B[2]),Rt(T[7],B[0],B[1],B[2])}},getTransformedBoundingBox:(function(){var t=b.create();return function(r,e){var i=this.vertices,n=e.array,a=r.min,s=r.max,o=a.array,f=s.array,u=i[0];al(t,u,n),nl(o,t),nl(f,t);for(var h=1;h<8;h++)u=i[h],al(t,u,n),o[0]=fo(t[0],o[0]),o[1]=fo(t[1],o[1]),o[2]=fo(t[2],o[2]),f[0]=uo(t[0],f[0]),f[1]=uo(t[1],f[1]),f[2]=uo(t[2],f[2]);return a._dirty=!0,s._dirty=!0,r}})()};var Bi=he.extend(function(){return{projectionMatrix:new V,invProjectionMatrix:new V,viewMatrix:new V,frustum:new Cf}},function(){this.update(!0)},{update:function(t){he.prototype.update.call(this,t),V.invert(this.viewMatrix,this.worldTransform),this.updateProjectionMatrix(),V.invert(this.invProjectionMatrix,this.projectionMatrix),this.frustum.setFromProjection(this.projectionMatrix)},setViewMatrix:function(t){V.copy(this.viewMatrix,t),V.invert(this.worldTransform,t),this.decomposeWorldTransform()},decomposeProjectionMatrix:function(){},setProjectionMatrix:function(t){V.copy(this.projectionMatrix,t),V.invert(this.invProjectionMatrix,t),this.decomposeProjectionMatrix()},updateProjectionMatrix:function(){},castRay:(function(){var t=N.create();return function(r,e){var i=e!==void 0?e:new Li,n=r.array[0],a=r.array[1];return N.set(t,n,a,-1,1),N.transformMat4(t,t,this.invProjectionMatrix.array),N.transformMat4(t,t,this.worldTransform.array),b.scale(i.origin.array,t,1/t[3]),N.set(t,n,a,1,1),N.transformMat4(t,t,this.invProjectionMatrix.array),N.transformMat4(t,t,this.worldTransform.array),b.scale(t,t,1/t[3]),b.sub(i.direction.array,t,i.origin.array),b.normalize(i.direction.array,i.direction.array),i.direction._dirty=!0,i.origin._dirty=!0,i}})()}),x1=F.create(),sl=F.create(),ho={};function w1(t){var r=[],e=Object.keys(t);e.sort();for(var i=0;i<e.length;i++){var n=e[i];r.push(n+" "+t[n])}var a=r.join(`
`);if(ho[a])return ho[a];var s=Ct.genGUID();return ho[a]=s,s}function es(){this.opaque=[],this.transparent=[],this._opaqueCount=0,this._transparentCount=0}es.prototype.startCount=function(){this._opaqueCount=0,this._transparentCount=0};es.prototype.add=function(t,r){r?this.transparent[this._transparentCount++]=t:this.opaque[this._opaqueCount++]=t};es.prototype.endCount=function(){this.transparent.length=this._transparentCount,this.opaque.length=this._opaqueCount};var Pf=he.extend(function(){return{material:null,lights:[],viewBoundingBoxLastFrame:new Ht,shadowUniforms:{},_cameraList:[],_lightUniforms:{},_previousLightNumber:{},_lightNumber:{},_lightProgramKeys:{},_nodeRepository:{},_renderLists:new ti(20)}},function(){this._scene=this},{addToScene:function(t){t instanceof Bi?(this._cameraList.length>0&&console.warn("Found multiple camera in one scene. Use the fist one."),this._cameraList.push(t)):t instanceof Rr&&this.lights.push(t),t.name&&(this._nodeRepository[t.name]=t)},removeFromScene:function(t){var r;t instanceof Bi?(r=this._cameraList.indexOf(t),r>=0&&this._cameraList.splice(r,1)):t instanceof Rr&&(r=this.lights.indexOf(t),r>=0&&this.lights.splice(r,1)),t.name&&delete this._nodeRepository[t.name]},getNode:function(t){return this._nodeRepository[t]},setMainCamera:function(t){var r=this._cameraList.indexOf(t);r>=0&&this._cameraList.splice(r,1),this._cameraList.unshift(t)},getMainCamera:function(){return this._cameraList[0]},getLights:function(){return this.lights},updateLights:function(){var t=this.lights;this._previousLightNumber=this._lightNumber;for(var r={},e=0;e<t.length;e++){var i=t[e];if(!i.invisible){var n=i.group;r[n]||(r[n]={}),r[n][i.type]=r[n][i.type]||0,r[n][i.type]++}}this._lightNumber=r;for(var a in r)this._lightProgramKeys[a]=w1(r[a]);this._updateLightUniforms()},cloneNode:function(t){var r=t.clone(),e={};function i(n,a){e[n.__uid__]=a;for(var s=0;s<n._children.length;s++){var o=n._children[s],f=a._children[s];i(o,f)}}return i(t,r),r.traverse(function(n){n.skeleton&&(n.skeleton=n.skeleton.clone(e)),n.material&&(n.material=n.material.clone())}),r},updateRenderList:function(t,r){var e=t.__uid__,i=this._renderLists.get(e);i||(i=new es,this._renderLists.put(e,i)),i.startCount(),r&&(this.viewBoundingBoxLastFrame.min.set(1/0,1/0,1/0),this.viewBoundingBoxLastFrame.max.set(-1/0,-1/0,-1/0));var n=this.material&&this.material.transparent||!1;return this._doUpdateRenderList(this,t,n,i,r),i.endCount(),i},getRenderList:function(t){return this._renderLists.get(t.__uid__)},_doUpdateRenderList:function(t,r,e,i,n){if(!t.invisible)for(var a=0;a<t._children.length;a++){var s=t._children[a];if(s.isRenderable()){var o=s.isSkinnedMesh()?x1:s.worldTransform.array,f=s.geometry;F.multiplyAffine(sl,r.viewMatrix.array,o),(n&&!f.boundingBox||!this.isFrustumCulled(s,r,sl))&&i.add(s,s.material.transparent||e)}s._children.length>0&&this._doUpdateRenderList(s,r,e,i,n)}},isFrustumCulled:(function(){var t=new Ht,r=new V;return function(e,i,n){var a=e.boundingBox;if(a||(e.skeleton&&e.skeleton.boundingBox?a=e.skeleton.boundingBox:a=e.geometry.boundingBox),!a)return!1;if(r.array=n,t.transformFrom(a,r),e.castShadow&&this.viewBoundingBoxLastFrame.union(t),e.frustumCulling){if(!t.intersectBoundingBox(i.frustum.boundingBox))return!0;r.array=i.projectionMatrix.array,t.max.array[2]>0&&t.min.array[2]<0&&(t.max.array[2]=-1e-20),t.applyProjection(r);var s=t.min.array,o=t.max.array;if(o[0]<-1||s[0]>1||o[1]<-1||s[1]>1||o[2]<-1||s[2]>1)return!0}return!1}})(),_updateLightUniforms:function(){var t=this.lights;t.sort(E1);var r=this._lightUniforms;for(var e in r)for(var i in r[e])r[e][i].value.length=0;for(var n=0;n<t.length;n++){var a=t[n];if(!a.invisible){var e=a.group;for(var i in a.uniformTemplates){var s=a.uniformTemplates[i],o=s.value(a);if(o!=null){r[e]||(r[e]={}),r[e][i]||(r[e][i]={type:"",value:[]});var f=r[e][i];switch(f.type=s.type+"v",s.type){case"1i":case"1f":case"t":f.value.push(o);break;case"2f":case"3f":case"4f":for(var u=0;u<o.length;u++)f.value.push(o[u]);break;default:console.error("Unkown light uniform type "+s.type)}}}}}},getLightGroups:function(){var t=[];for(var r in this._lightNumber)t.push(r);return t},getNumberChangedLightGroups:function(){var t=[];for(var r in this._lightNumber)this.isLightNumberChanged(r)&&t.push(r);return t},isLightNumberChanged:function(t){var r=this._previousLightNumber,e=this._lightNumber;for(var i in e[t])if(!r[t]||e[t][i]!==r[t][i])return!0;for(var i in r[t])if(!e[t]||e[t][i]!==r[t][i])return!0;return!1},getLightsNumbers:function(t){return this._lightNumber[t]},getProgramKey:function(t){return this._lightProgramKeys[t]},setLightUniforms:(function(){function t(r,e,i){for(var n in r){var a=r[n];if(a.type==="tv"){if(!e.hasUniform(n))continue;for(var s=[],o=0;o<a.value.length;o++){var f=a.value[o],u=e.takeCurrentTextureSlot(i,f);s.push(u)}e.setUniform(i.gl,"1iv",n,s)}else e.setUniform(i.gl,a.type,n,a.value)}}return function(r,e,i){t(this._lightUniforms[e],r,i),t(this.shadowUniforms,r,i)}})(),dispose:function(){this.material=null,this._opaqueList=[],this._transparentList=[],this.lights=[],this._lightUniforms={},this._lightNumber={},this._nodeRepository={}}});function E1(t,r){if(r.castShadow&&!t.castShadow)return!0}var ha=Fn.isPowerOfTwo,b1=["px","nx","py","ny","pz","nz"],Ke=q.extend(function(){return{image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},mipmaps:[]}},{textureType:"textureCube",update:function(t){var r=t.gl;r.bindTexture(r.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),this.updateCommon(t);var e=this.format,i=this.type;r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,this.getAvailableWrapS()),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,this.getAvailableWrapT()),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,this.getAvailableMagFilter()),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,this.getAvailableMinFilter());var n=t.getGLExtension("EXT_texture_filter_anisotropic");if(n&&this.anisotropic>1&&r.texParameterf(r.TEXTURE_CUBE_MAP,n.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),i===36193){var a=t.getGLExtension("OES_texture_half_float");a||(i=I.FLOAT)}if(this.mipmaps.length)for(var s=this.width,o=this.height,f=0;f<this.mipmaps.length;f++){var u=this.mipmaps[f];this._updateTextureData(r,u,f,s,o,e,i),s/=2,o/=2}else this._updateTextureData(r,this,0,this.width,this.height,e,i),!this.NPOT&&this.useMipmap&&r.generateMipmap(r.TEXTURE_CUBE_MAP);r.bindTexture(r.TEXTURE_CUBE_MAP,null)},_updateTextureData:function(t,r,e,i,n,a,s){for(var o=0;o<6;o++){var f=b1[o],u=r.image&&r.image[f];u?t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+o,e,a,a,s,u):t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+o,e,a,i,n,0,a,s,r.pixels&&r.pixels[f])}},generateMipmap:function(t){var r=t.gl;this.useMipmap&&!this.NPOT&&(r.bindTexture(r.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),r.generateMipmap(r.TEXTURE_CUBE_MAP))},bind:function(t){t.gl.bindTexture(t.gl.TEXTURE_CUBE_MAP,this.getWebGLTexture(t))},unbind:function(t){t.gl.bindTexture(t.gl.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){return this.image.px?ha(this.image.px.width)&&ha(this.image.px.height):ha(this.width)&&ha(this.height)},isRenderable:function(){return this.image.px?pi(this.image.px)&&pi(this.image.nx)&&pi(this.image.py)&&pi(this.image.ny)&&pi(this.image.pz)&&pi(this.image.nz):!!(this.width&&this.height)},load:function(t,r){var e=0,i=this;return Ct.each(t,function(n,a){var s=at.createImage();r&&(s.crossOrigin=r),s.onload=function(){e--,e===0&&(i.dirty(),i.trigger("success",i))},s.onerror=function(){e--},e++,s.src=n,i.image[a]=s}),this}});Object.defineProperty(Ke.prototype,"width",{get:function(){return this.image&&this.image.px?this.image.px.width:this._width},set:function(t){this.image&&this.image.px?console.warn("Texture from image can't set width"):(this._width!==t&&this.dirty(),this._width=t)}});Object.defineProperty(Ke.prototype,"height",{get:function(){return this.image&&this.image.px?this.image.px.height:this._height},set:function(t){this.image&&this.image.px?console.warn("Texture from image can't set height"):(this._height!==t&&this.dirty(),this._height=t)}});function pi(t){return t.width>0&&t.height>0}var Zt=Bi.extend({fov:50,aspect:1,near:.1,far:2e3},{updateProjectionMatrix:function(){var t=this.fov/180*Math.PI;this.projectionMatrix.perspective(t,this.aspect,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix.array,r=Math.atan(1/t[5])*2;this.fov=r/Math.PI*180,this.aspect=t[5]/t[0],this.near=t[14]/(t[10]-1),this.far=t[14]/(t[10]+1)},clone:function(){var t=Bi.prototype.clone.call(this);return t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t}}),la="framebuffer",jr="renderbuffer",ol=jr+"_width",fl=jr+"_height",lo=jr+"_attached",co="depthtexture_attached",Oe=I.FRAMEBUFFER,nn=I.RENDERBUFFER,cn=I.DEPTH_ATTACHMENT,uv=I.COLOR_ATTACHMENT0,Cr=Vt.extend({depthBuffer:!0,viewport:null,_width:0,_height:0,_textures:null,_boundRenderer:null},function(){this._cache=new Ni,this._textures={}},{getTextureWidth:function(){return this._width},getTextureHeight:function(){return this._height},bind:function(t){if(t.__currentFrameBuffer){if(t.__currentFrameBuffer===this)return;console.warn("Renderer already bound with another framebuffer. Unbind it first")}t.__currentFrameBuffer=this;var r=t.gl;r.bindFramebuffer(Oe,this._getFrameBufferGL(t)),this._boundRenderer=t;var e=this._cache;e.put("viewport",t.viewport);var i=!1,n,a;for(var s in this._textures){i=!0;var o=this._textures[s];o&&(n=o.texture.width,a=o.texture.height,this._doAttach(t,o.texture,s,o.target))}this._width=n,this._height=a,!i&&this.depthBuffer&&console.error("Must attach texture before bind, or renderbuffer may have incorrect width and height."),this.viewport?t.setViewport(this.viewport):t.setViewport(0,0,n,a,1);var f=e.get("attached_textures");if(f){for(var s in f)if(!this._textures[s]){var u=f[s];this._doDetach(r,s,u)}}if(!e.get(co)&&this.depthBuffer){e.miss(jr)&&e.put(jr,r.createRenderbuffer());var h=e.get(jr);(n!==e.get(ol)||a!==e.get(fl))&&(r.bindRenderbuffer(nn,h),r.renderbufferStorage(nn,r.DEPTH_COMPONENT16,n,a),e.put(ol,n),e.put(fl,a),r.bindRenderbuffer(nn,null)),e.get(lo)||(r.framebufferRenderbuffer(Oe,cn,nn,h),e.put(lo,!0))}},unbind:function(t){t.__currentFrameBuffer=null;var r=t.gl;r.bindFramebuffer(Oe,null),this._boundRenderer=null,this._cache.use(t.__uid__);var e=this._cache.get("viewport");e&&t.setViewport(e),this.updateMipmap(t)},updateMipmap:function(t){var r=t.gl;for(var e in this._textures){var i=this._textures[e];if(i){var n=i.texture;if(!n.NPOT&&n.useMipmap&&n.minFilter===q.LINEAR_MIPMAP_LINEAR){var a=n.textureType==="textureCube"?I.TEXTURE_CUBE_MAP:I.TEXTURE_2D;r.bindTexture(a,n.getWebGLTexture(t)),r.generateMipmap(a),r.bindTexture(a,null)}}}},checkStatus:function(t){return t.checkFramebufferStatus(Oe)},_getFrameBufferGL:function(t){var r=this._cache;return r.use(t.__uid__),r.miss(la)&&r.put(la,t.gl.createFramebuffer()),r.get(la)},attach:function(t,r,e){if(!t.width)throw new Error("The texture attached to color buffer is not a valid.");r=r||uv,e=e||I.TEXTURE_2D;var i=this._boundRenderer,n=i&&i.gl,a;if(n){var s=this._cache;s.use(i.__uid__),a=s.get("attached_textures")}var o=this._textures[r];if(!(o&&o.target===e&&o.texture===t&&a&&a[r]!=null)){var f=!0;i&&(f=this._doAttach(i,t,r,e),this.viewport||i.setViewport(0,0,t.width,t.height,1)),f&&(this._textures[r]=this._textures[r]||{},this._textures[r].texture=t,this._textures[r].target=e)}},_doAttach:function(t,r,e,i){var n=t.gl,a=r.getWebGLTexture(t),s=this._cache.get("attached_textures");if(s&&s[e]){var o=s[e];if(o.texture===r&&o.target===i)return}e=+e;var f=!0;if(e===cn||e===I.DEPTH_STENCIL_ATTACHMENT){var u=t.getGLExtension("WEBGL_depth_texture");if(u||(console.error("Depth texture is not supported by the browser"),f=!1),r.format!==I.DEPTH_COMPONENT&&r.format!==I.DEPTH_STENCIL&&(console.error("The texture attached to depth buffer is not a valid."),f=!1),f){var h=this._cache.get(jr);h&&(n.framebufferRenderbuffer(Oe,cn,nn,null),n.deleteRenderbuffer(h),this._cache.put(jr,!1)),this._cache.put(lo,!1),this._cache.put(co,!0)}}return n.framebufferTexture2D(Oe,e,i,a,0),s||(s={},this._cache.put("attached_textures",s)),s[e]=s[e]||{},s[e].texture=r,s[e].target=i,f},_doDetach:function(t,r,e){t.framebufferTexture2D(Oe,r,e,null,0);var i=this._cache.get("attached_textures");i&&i[r]&&(i[r]=null),(r===cn||r===I.DEPTH_STENCIL_ATTACHMENT)&&this._cache.put(co,!1)},detach:function(t,r){if(this._textures[t]=null,this._boundRenderer){var e=this._cache;e.use(this._boundRenderer.__uid__),this._doDetach(this._boundRenderer.gl,t,r)}},dispose:function(t){var r=t.gl,e=this._cache;e.use(t.__uid__);var i=e.get(jr);i&&r.deleteRenderbuffer(i);var n=e.get(la);n&&r.deleteFramebuffer(n),e.deleteContext(t.__uid__),this._textures={}}});Cr.DEPTH_ATTACHMENT=cn;Cr.COLOR_ATTACHMENT0=uv;Cr.STENCIL_ATTACHMENT=I.STENCIL_ATTACHMENT;Cr.DEPTH_STENCIL_ATTACHMENT=I.DEPTH_STENCIL_ATTACHMENT;var S1=["px","nx","py","ny","pz","nz"],Lf=Vt.extend(function(){var t={position:new O,far:1e3,near:.1,texture:null,shadowMapPass:null},r=t._cameras={px:new Zt({fov:90}),nx:new Zt({fov:90}),py:new Zt({fov:90}),ny:new Zt({fov:90}),pz:new Zt({fov:90}),nz:new Zt({fov:90})};return r.px.lookAt(O.POSITIVE_X,O.NEGATIVE_Y),r.nx.lookAt(O.NEGATIVE_X,O.NEGATIVE_Y),r.py.lookAt(O.POSITIVE_Y,O.POSITIVE_Z),r.ny.lookAt(O.NEGATIVE_Y,O.NEGATIVE_Z),r.pz.lookAt(O.POSITIVE_Z,O.NEGATIVE_Y),r.nz.lookAt(O.NEGATIVE_Z,O.NEGATIVE_Y),t._frameBuffer=new Cr,t},{getCamera:function(t){return this._cameras[t]},render:function(t,r,e){var i=t.gl;e||r.update();for(var n=this.texture.width,a=2*Math.atan(n/(n-.5))/Math.PI*180,s=0;s<6;s++){var o=S1[s],f=this._cameras[o];if(O.copy(f.position,this.position),f.far=this.far,f.near=this.near,f.fov=a,this.shadowMapPass){f.update();var u=r.getBoundingBox();u.applyTransform(f.viewMatrix),r.viewBoundingBoxLastFrame.copy(u),this.shadowMapPass.render(t,r,f,!0)}this._frameBuffer.attach(this.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+s),this._frameBuffer.bind(t),t.render(r,f,!0),this._frameBuffer.unbind(t)}},dispose:function(t){this._frameBuffer.dispose(t)}}),hv=Kr.extend({dynamic:!1,widthSegments:1,heightSegments:1},function(){this.build()},{build:function(){for(var t=this.heightSegments,r=this.widthSegments,e=this.attributes,i=[],n=[],a=[],s=[],o=0;o<=t;o++)for(var f=o/t,u=0;u<=r;u++){var h=u/r;if(i.push([2*h-1,2*f-1,0]),n&&n.push([h,f]),a&&a.push([0,0,1]),u<r&&o<t){var l=u+o*(r+1);s.push([l,l+1,l+r+1]),s.push([l+r+1,l+1,l+r+2])}}e.position.fromArray(i),e.texcoord0.fromArray(n),e.normal.fromArray(a),this.initIndicesFromArray(s),this.boundingBox=new Ht,this.boundingBox.min.set(-1,-1,0),this.boundingBox.max.set(1,1,0)}}),bt=new V,M1=Kr.extend({dynamic:!1,widthSegments:1,heightSegments:1,depthSegments:1,inside:!1},function(){this.build()},{build:function(){var t={px:_i("px",this.depthSegments,this.heightSegments),nx:_i("nx",this.depthSegments,this.heightSegments),py:_i("py",this.widthSegments,this.depthSegments),ny:_i("ny",this.widthSegments,this.depthSegments),pz:_i("pz",this.widthSegments,this.heightSegments),nz:_i("nz",this.widthSegments,this.heightSegments)},r=["position","texcoord0","normal"],e=0,i=0;for(var n in t)e+=t[n].vertexCount,i+=t[n].indices.length;for(var a=0;a<r.length;a++)this.attributes[r[a]].init(e);this.indices=new at.Uint16Array(i);var s=0,o=0;for(var n in t){for(var f=t[n],a=0;a<r.length;a++)for(var u=r[a],h=f.attributes[u].value,l=f.attributes[u].size,c=u==="normal",v=0;v<h.length;v++){var d=h[v];this.inside&&c&&(d=-d),this.attributes[u].value[v+l*o]=d}for(var _=f.indices.length,v=0;v<f.indices.length;v++)this.indices[v+s]=o+f.indices[this.inside?_-v-1:v];s+=f.indices.length,o+=f.vertexCount}this.boundingBox=new Ht,this.boundingBox.max.set(1,1,1),this.boundingBox.min.set(-1,-1,-1)}});function _i(t,r,e){bt.identity();var i=new hv({widthSegments:r,heightSegments:e});switch(t){case"px":V.translate(bt,bt,O.POSITIVE_X),V.rotateY(bt,bt,Math.PI/2);break;case"nx":V.translate(bt,bt,O.NEGATIVE_X),V.rotateY(bt,bt,-Math.PI/2);break;case"py":V.translate(bt,bt,O.POSITIVE_Y),V.rotateX(bt,bt,-Math.PI/2);break;case"ny":V.translate(bt,bt,O.NEGATIVE_Y),V.rotateX(bt,bt,Math.PI/2);break;case"pz":V.translate(bt,bt,O.POSITIVE_Z);break;case"nz":V.translate(bt,bt,O.NEGATIVE_Z),V.rotateY(bt,bt,Math.PI);break}return i.applyTransform(bt),i}const A1=`@export clay.skybox.vertex
#define SHADER_NAME skybox
uniform mat4 world : WORLD;
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
attribute vec3 position : POSITION;
varying vec3 v_WorldPosition;
void main()
{
 v_WorldPosition = (world * vec4(position, 1.0)).xyz;
 gl_Position = worldViewProjection * vec4(position, 1.0);
}
@end
@export clay.skybox.fragment
#define PI 3.1415926
uniform mat4 viewInverse : VIEWINVERSE;
#ifdef EQUIRECTANGULAR
uniform sampler2D environmentMap;
#else
uniform samplerCube environmentMap;
#endif
uniform float lod: 0.0;
varying vec3 v_WorldPosition;
@import clay.util.rgbm
@import clay.util.srgb
@import clay.util.ACES
void main()
{
 vec3 eyePos = viewInverse[3].xyz;
 vec3 V = normalize(v_WorldPosition - eyePos);
#ifdef EQUIRECTANGULAR
 float phi = acos(V.y);
 float theta = atan(-V.x, V.z) + PI * 0.5;
 vec2 uv = vec2(theta / 2.0 / PI, phi / PI);
 vec4 texel = decodeHDR(texture2D(environmentMap, fract(uv)));
#else
 #if defined(LOD) || defined(SUPPORT_TEXTURE_LOD)
 vec4 texel = decodeHDR(textureCubeLodEXT(environmentMap, V, lod));
 #else
 vec4 texel = decodeHDR(textureCube(environmentMap, V));
 #endif
#endif
#ifdef SRGB_DECODE
 texel = sRGBToLinear(texel);
#endif
#ifdef TONEMAPPING
 texel.rgb = ACESToneMapping(texel.rgb);
#endif
#ifdef SRGB_ENCODE
 texel = linearTosRGB(texel);
#endif
 gl_FragColor = encodeHDR(vec4(texel.rgb, 1.0));
}
@end`;J.import(A1);var Wa=nr.extend(function(){var t=new J({vertex:J.source("clay.skybox.vertex"),fragment:J.source("clay.skybox.fragment")}),r=new Nn({shader:t,depthMask:!1});return{scene:null,geometry:new M1,material:r,environmentMap:null,culling:!1,_dummyCamera:new Zt}},function(){var t=this.scene;t&&this.attachScene(t),this.environmentMap&&this.setEnvironmentMap(this.environmentMap)},{attachScene:function(t){this.scene&&this.detachScene(),t.skybox=this,this.scene=t,t.on("beforerender",this._beforeRenderScene,this)},detachScene:function(){this.scene&&(this.scene.off("beforerender",this._beforeRenderScene),this.scene.skybox=null),this.scene=null},dispose:function(t){this.detachScene(),this.geometry.dispose(t)},setEnvironmentMap:function(t){t.textureType==="texture2D"?(this.material.define("EQUIRECTANGULAR"),t.minFilter=q.LINEAR):this.material.undefine("EQUIRECTANGULAR"),this.material.set("environmentMap",t)},getEnvironmentMap:function(){return this.material.get("environmentMap")},_beforeRenderScene:function(t,r,e){this.renderSkybox(t,e)},renderSkybox:function(t,r){var e=this._dummyCamera;e.aspect=t.getViewportAspect(),e.fov=r.fov||50,e.updateProjectionMatrix(),V.invert(e.invProjectionMatrix,e.projectionMatrix),e.worldTransform.copy(r.worldTransform),e.viewMatrix.copy(r.viewMatrix),this.position.copy(r.getWorldPosition()),this.update(),t.gl.disable(t.gl.BLEND),this.material.get("lod")>0?this.material.define("fragment","LOD"):this.material.undefine("fragment","LOD"),t.renderPass([this],e)}}),R1=542327876,C1=131072,P1=512,L1=4;function Df(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}var D1=31,O1=Df("DXT1"),I1=Df("DXT3"),N1=Df("DXT5"),F1=0,B1=1,U1=2,H1=3,z1=4,k1=7,G1=20,W1=21,V1=28,q1={parse:function(t,r){var e=new Int32Array(t,0,D1);if(e[F1]!==R1||!e(G1)&L1)return null;var i=e(W1),n=e[z1],a=e[H1],s=e[V1]&P1,o=e[U1]&C1,f,u;switch(i){case O1:f=8,u=q.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case I1:f=16,u=q.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case N1:f=16,u=q.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}var h=e[B1]+4,l=s?6:1,c=1;o&&(c=Math.max(1,e[k1]));for(var v=[],d=0;d<l;d++){var _=n,p=a;v[d]=new Wt({width:_,height:p,format:u});for(var y=[],g=0;g<c;g++){var m=Math.max(4,_)/4*Math.max(4,p)/4*f,T=new Uint8Array(t,h,m);h+=m,_*=.5,p*=.5,y[g]=T}v[d].pixels=y[0],o&&(v[d].mipmaps=y)}if(r)r.width=v[0].width,r.height=v[0].height,r.format=v[0].format,r.pixels=v[0].pixels,r.mipmaps=v[0].mipmaps;else return v[0]}},xa=String.fromCharCode,X1=8,Y1=32767;function Z1(t,r,e,i){if(t[3]>0){var n=Math.pow(2,t[3]-128-8+i);r[e+0]=t[0]*n,r[e+1]=t[1]*n,r[e+2]=t[2]*n}else r[e+0]=0,r[e+1]=0,r[e+2]=0;return r[e+3]=1,r}function j1(t,r,e){for(var i="",n=r;n<e;n++)i+=xa(t[n]);return i}function $1(t,r){r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]}function ul(t,r,e,i){for(var n=0,a=0,s=i;s>0;)if(t[a][0]=r[e++],t[a][1]=r[e++],t[a][2]=r[e++],t[a][3]=r[e++],t[a][0]===1&&t[a][1]===1&&t[a][2]===1){for(var o=t[a][3]<<n>>>0;o>0;o--)$1(t[a-1],t[a]),a++,s--;n+=8}else a++,s--,n=0;return e}function K1(t,r,e,i){if(i<X1|i>Y1)return ul(t,r,e,i);var n=r[e++];if(n!=2)return ul(t,r,e-1,i);if(t[0][1]=r[e++],t[0][2]=r[e++],n=r[e++],(t[0][2]<<8>>>0|n)>>>0!==i)return null;for(var n=0;n<4;n++)for(var a=0;a<i;){var s=r[e++];if(s>128){s=(s&127)>>>0;for(var o=r[e++];s--;)t[a++][n]=o}else for(;s--;)t[a++][n]=r[e++]}return e}var Q1={parseRGBE:function(t,r,e){e==null&&(e=0);var i=new Uint8Array(t),n=i.length;if(j1(i,0,2)==="#?"){for(var a=2;a<n&&!(xa(i[a])===`
`&&xa(i[a+1])===`
`);a++);if(!(a>=n)){a+=2;for(var s="";a<n;a++){var o=xa(i[a]);if(o===`
`)break;s+=o}var f=s.split(" "),u=parseInt(f[1]),h=parseInt(f[3]);if(!(!h||!u)){for(var l=a+1,c=[],v=0;v<h;v++){c[v]=[];for(var d=0;d<4;d++)c[v][d]=0}for(var _=new Float32Array(h*u*4),p=0,y=0;y<u;y++){var l=K1(c,i,l,h);if(!l)return null;for(var v=0;v<h;v++)Z1(c[v],_,p,e),p+=4}return r||(r=new Wt),r.width=h,r.height=u,r.pixels=_,r.type=q.FLOAT,r}}}},parseRGBEFromPNG:function(t){}},wa={loadTexture:function(t,r,e,i){var n;if(typeof r=="function"?(e=r,i=e,r={}):r=r||{},typeof t=="string"){if(t.match(/.hdr$/)||r.fileType==="hdr")return n=new Wt({width:0,height:0,sRGB:!1}),wa._fetchTexture(t,function(a){Q1.parseRGBE(a,n,r.exposure),n.dirty(),e&&e(n)},i),n;t.match(/.dds$/)||r.fileType==="dds"?(n=new Wt({width:0,height:0}),wa._fetchTexture(t,function(a){q1.parse(a,n),n.dirty(),e&&e(n)},i)):(n=new Wt,n.load(t),n.success(e),n.error(i))}else typeof t=="object"&&typeof t.px<"u"&&(n=new Ke,n.load(t),n.success(e),n.error(i));return n},loadPanorama:function(t,r,e,i,n,a){var s=this;typeof i=="function"?(n=i,a=n,i={}):i=i||{},wa.loadTexture(r,i,function(o){o.flipY=i.flipY||!1,s.panoramaToCubeMap(t,o,e,i),o.dispose(t),n&&n(e)},a)},panoramaToCubeMap:function(t,r,e,i){var n=new Lf,a=new Wa({scene:new Pf});return a.setEnvironmentMap(r),i=i||{},i.encodeRGBM&&a.material.define("fragment","RGBM_ENCODE"),e.sRGB=r.sRGB,n.texture=e,n.render(t,a.scene),n.texture=null,n.dispose(t),e},heightToNormal:function(t,r){var e=document.createElement("canvas"),i=e.width=t.width,n=e.height=t.height,a=e.getContext("2d");a.drawImage(t,0,0,i,n),r=r||!1;for(var s=a.getImageData(0,0,i,n),o=a.createImageData(i,n),f=0;f<s.data.length;f+=4){if(r){var u=s.data[f],h=s.data[f+1],l=s.data[f+2],c=Math.abs(u-h)+Math.abs(h-l);if(c>20)return console.warn("Given image is not a height map"),t}var v,d,_,p;f%(i*4)===0?(v=s.data[f],_=s.data[f+4]):f%(i*4)===(i-1)*4?(v=s.data[f-4],_=s.data[f]):(v=s.data[f-4],_=s.data[f+4]),f<i*4?(d=s.data[f],p=s.data[f+i*4]):f>i*(n-1)*4?(d=s.data[f-i*4],p=s.data[f]):(d=s.data[f-i*4],p=s.data[f+i*4]),o.data[f]=v-_+127,o.data[f+1]=d-p+127,o.data[f+2]=255,o.data[f+3]=255}return a.putImageData(o,0,0),e},isHeightImage:function(t,r,e){if(!t||!t.width||!t.height)return!1;var i=document.createElement("canvas"),n=i.getContext("2d"),a=r||32;e=e||20,i.width=i.height=a,n.drawImage(t,0,0,a,a);for(var s=n.getImageData(0,0,a,a),o=0;o<s.data.length;o+=4){var f=s.data[o],u=s.data[o+1],h=s.data[o+2],l=Math.abs(f-u)+Math.abs(u-h);if(l>e)return!1}return!0},_fetchTexture:function(t,r,e){at.request.get({url:t,responseType:"arraybuffer",onload:r,onerror:e})},createChessboard:function(t,r,e,i){t=t||512,r=r||64,e=e||"black",i=i||"white";var n=Math.ceil(t/r),a=document.createElement("canvas");a.width=t,a.height=t;var s=a.getContext("2d");s.fillStyle=i,s.fillRect(0,0,t,t),s.fillStyle=e;for(var o=0;o<n;o++)for(var f=0;f<n;f++){var u=f%2?o%2:o%2-1;u&&s.fillRect(o*r,f*r,r,r)}var h=new Wt({image:a,anisotropic:8});return h},createBlank:function(t){var r=document.createElement("canvas");r.width=1,r.height=1;var e=r.getContext("2d");e.fillStyle=t,e.fillRect(0,0,1,1);var i=new Wt({image:r});return i}},lv=Bi.extend({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix.array;this.left=(-1-t[12])/t[0],this.right=(1-t[12])/t[0],this.top=(1-t[13])/t[5],this.bottom=(-1-t[13])/t[5],this.near=-(-1-t[14])/t[10],this.far=-(1-t[14])/t[10]},clone:function(){var t=Bi.prototype.clone.call(this);return t.left=this.left,t.right=this.right,t.near=this.near,t.far=this.far,t.top=this.top,t.bottom=this.bottom,t}});const J1=`
@export clay.compositor.vertex
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
attribute vec3 position : POSITION;
attribute vec2 texcoord : TEXCOORD_0;
varying vec2 v_Texcoord;
void main()
{
 v_Texcoord = texcoord;
 gl_Position = worldViewProjection * vec4(position, 1.0);
}
@end`;J.import(J1);var tg=new hv,hl=new nr({geometry:tg,frustumCulling:!1}),rg=new lv,gn=Vt.extend(function(){return{fragment:"",outputs:null,material:null,blendWithPrevious:!1,clearColor:!1,clearDepth:!0}},function(){var t=new J(J.source("clay.compositor.vertex"),this.fragment),r=new Nn({shader:t});r.enableTexturesAll(),this.material=r},{setUniform:function(t,r){this.material.setUniform(t,r)},getUniform:function(t){var r=this.material.uniforms[t];if(r)return r.value},attachOutput:function(t,r){this.outputs||(this.outputs={}),r=r||I.COLOR_ATTACHMENT0,this.outputs[r]=t},detachOutput:function(t){for(var r in this.outputs)this.outputs[r]===t&&(this.outputs[r]=null)},bind:function(t,r){if(this.outputs)for(var e in this.outputs){var i=this.outputs[e];i&&r.attach(i,e)}r&&r.bind(t)},unbind:function(t,r){r.unbind(t)},render:function(t,r){var e=t.gl;if(r){this.bind(t,r);var i=t.getGLExtension("EXT_draw_buffers");if(i&&this.outputs){var n=[];for(var a in this.outputs)a=+a,a>=e.COLOR_ATTACHMENT0&&a<=e.COLOR_ATTACHMENT0+8&&n.push(a);i.drawBuffersEXT(n)}}this.trigger("beforerender",this,t);var s=this.clearDepth?e.DEPTH_BUFFER_BIT:0;if(e.depthMask(!0),this.clearColor){s=s|e.COLOR_BUFFER_BIT,e.colorMask(!0,!0,!0,!0);var o=this.clearColor;Array.isArray(o)&&e.clearColor(o[0],o[1],o[2],o[3])}e.clear(s),this.blendWithPrevious?(e.enable(e.BLEND),this.material.transparent=!0):(e.disable(e.BLEND),this.material.transparent=!1),this.renderQuad(t),this.trigger("afterrender",this,t),r&&this.unbind(t,r)},renderQuad:function(t){hl.material=this.material,t.renderPass([hl],rg)},dispose:function(t){}});const eg=`#define SAMPLE_NUMBER 1024
#define PI 3.14159265358979
uniform sampler2D normalDistribution;
uniform vec2 viewportSize : [512, 256];
const vec3 N = vec3(0.0, 0.0, 1.0);
const float fSampleNumber = float(SAMPLE_NUMBER);
vec3 importanceSampleNormal(float i, float roughness, vec3 N) {
 vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;
 vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);
 vec3 tangentX = normalize(cross(N, upVector));
 vec3 tangentZ = cross(N, tangentX);
 return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);
}
float G_Smith(float roughness, float NoV, float NoL) {
 float k = roughness * roughness / 2.0;
 float G1V = NoV / (NoV * (1.0 - k) + k);
 float G1L = NoL / (NoL * (1.0 - k) + k);
 return G1L * G1V;
}
void main() {
 vec2 uv = gl_FragCoord.xy / viewportSize;
 float NoV = uv.x;
 float roughness = uv.y;
 vec3 V;
 V.x = sqrt(1.0 - NoV * NoV);
 V.y = 0.0;
 V.z = NoV;
 float A = 0.0;
 float B = 0.0;
 for (int i = 0; i < SAMPLE_NUMBER; i++) {
 vec3 H = importanceSampleNormal(float(i) / fSampleNumber, roughness, N);
 vec3 L = reflect(-V, H);
 float NoL = clamp(L.z, 0.0, 1.0);
 float NoH = clamp(H.z, 0.0, 1.0);
 float VoH = clamp(dot(V, H), 0.0, 1.0);
 if (NoL > 0.0) {
 float G = G_Smith(roughness, NoV, NoL);
 float G_Vis = G * VoH / (NoH * NoV);
 float Fc = pow(1.0 - VoH, 5.0);
 A += (1.0 - Fc) * G_Vis;
 B += Fc * G_Vis;
 }
 }
 gl_FragColor = vec4(vec2(A, B) / fSampleNumber, 0.0, 1.0);
}
`,ig=`#define SHADER_NAME prefilter
#define SAMPLE_NUMBER 1024
#define PI 3.14159265358979
uniform mat4 viewInverse : VIEWINVERSE;
uniform samplerCube environmentMap;
uniform sampler2D normalDistribution;
uniform float roughness : 0.5;
varying vec2 v_Texcoord;
varying vec3 v_WorldPosition;
@import clay.util.rgbm
vec3 importanceSampleNormal(float i, float roughness, vec3 N) {
 vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;
 vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);
 vec3 tangentX = normalize(cross(N, upVector));
 vec3 tangentZ = cross(N, tangentX);
 return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);
}
void main() {
 vec3 eyePos = viewInverse[3].xyz;
 vec3 V = normalize(v_WorldPosition - eyePos);
 vec3 N = V;
 vec3 prefilteredColor = vec3(0.0);
 float totalWeight = 0.0;
 float fMaxSampleNumber = float(SAMPLE_NUMBER);
 for (int i = 0; i < SAMPLE_NUMBER; i++) {
 vec3 H = importanceSampleNormal(float(i) / fMaxSampleNumber, roughness, N);
 vec3 L = reflect(-V, H);
 float NoL = clamp(dot(N, L), 0.0, 1.0);
 if (NoL > 0.0) {
 prefilteredColor += decodeHDR(textureCube(environmentMap, L)).rgb * NoL;
 totalWeight += NoL;
 }
 }
 gl_FragColor = encodeHDR(vec4(prefilteredColor / totalWeight, 1.0));
}
`;var $r={},vo=["px","nx","py","ny","pz","nz"];$r.prefilterEnvironmentMap=function(t,r,e,i,n){(!n||!i)&&(i=$r.generateNormalDistribution(),n=$r.integrateBRDF(t,i)),e=e||{};var a=e.width||64,s=e.height||64,o=e.type||r.type,f=new Ke({width:a,height:s,type:o,flipY:!1,mipmaps:[]});f.isPowerOfTwo()||console.warn("Width and height must be power of two to enable mipmap.");var u=Math.min(a,s),h=Math.log(u)/Math.log(2)+1,l=new Nn({shader:new J({vertex:J.source("clay.skybox.vertex"),fragment:ig})});l.set("normalDistribution",i),e.encodeRGBM&&l.define("fragment","RGBM_ENCODE"),e.decodeRGBM&&l.define("fragment","RGBM_DECODE");var c=new Pf,v;if(r.textureType==="texture2D"){var d=new Ke({width:a,height:s,type:o===q.FLOAT?q.HALF_FLOAT:o});wa.panoramaToCubeMap(t,r,d,{encodeRGBM:e.decodeRGBM}),r=d}v=new Wa({scene:c,material:l}),v.material.set("environmentMap",r);var _=new Lf({texture:f});e.encodeRGBM&&(o=f.type=q.UNSIGNED_BYTE);for(var p=new Wt({width:a,height:s,type:o}),y=new Cr({depthBuffer:!1}),g=at[o===q.UNSIGNED_BYTE?"Uint8Array":"Float32Array"],m=0;m<h;m++){f.mipmaps[m]={pixels:{}},v.material.set("roughness",m/(h-1));for(var T=p.width,w=2*Math.atan(T/(T-.5))/Math.PI*180,x=0;x<vo.length;x++){var E=new g(p.width*p.height*4);y.attach(p),y.bind(t);var S=_.getCamera(vo[x]);S.fov=w,t.render(c,S),t.gl.readPixels(0,0,p.width,p.height,q.RGBA,o,E),y.unbind(t),f.mipmaps[m].pixels[vo[x]]=E}p.width/=2,p.height/=2,p.dirty()}return y.dispose(t),p.dispose(t),v.dispose(t),i.dispose(t),{environmentMap:f,brdfLookup:n,normalDistribution:i,maxMipmapLevel:h}};$r.integrateBRDF=function(t,r){r=r||$r.generateNormalDistribution();var e=new Cr({depthBuffer:!1}),i=new gn({fragment:eg}),n=new Wt({width:512,height:256,type:q.HALF_FLOAT,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,minFilter:q.NEAREST,magFilter:q.NEAREST,useMipmap:!1});return i.setUniform("normalDistribution",r),i.setUniform("viewportSize",[512,256]),i.attachOutput(n),i.render(t,e),e.dispose(t),n};$r.generateNormalDistribution=function(e,i){for(var e=e||256,i=i||1024,n=new Wt({width:e,height:i,type:q.FLOAT,minFilter:q.NEAREST,magFilter:q.NEAREST,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,useMipmap:!1}),a=new Float32Array(i*e*4),s=[],o=0;o<e;o++){for(var f=o/e,u=f*f,h=0;h<i;h++){var l=(h<<16|h>>>16)>>>0;l=((l&1431655765)<<1|(l&2863311530)>>>1)>>>0,l=((l&858993459)<<2|(l&3435973836)>>>2)>>>0,l=((l&252645135)<<4|(l&4042322160)>>>4)>>>0,l=(((l&16711935)<<8|(l&4278255360)>>>8)>>>0)/4294967296;var c=Math.sqrt((1-l)/(1+(u*u-1)*l));s[h]=c}for(var h=0;h<i;h++){var v=(h*e+o)*4,c=s[h],d=Math.sqrt(1-c*c),_=h/i,p=2*Math.PI*_;a[v]=d*Math.cos(p),a[v+1]=c,a[v+2]=d*Math.sin(p),a[v+3]=1}}return n.pixels=a,n};var um=Rr.extend({cubemap:null,castShadow:!1,_normalDistribution:null,_brdfLookup:null},{type:"AMBIENT_CUBEMAP_LIGHT",prefilter:function(t,r){if(!t.getGLExtension("EXT_shader_texture_lod")){console.warn("Device not support textureCubeLodEXT");return}this._brdfLookup||(this._normalDistribution=$r.generateNormalDistribution(),this._brdfLookup=$r.integrateBRDF(t,this._normalDistribution));var e=this.cubemap;if(!e.__prefiltered){var i=$r.prefilterEnvironmentMap(t,e,{encodeRGBM:!0,width:r,height:r},this._normalDistribution,this._brdfLookup);this.cubemap=i.environmentMap,this.cubemap.__prefiltered=!0,e.dispose(t)}},getBRDFLookup:function(){return this._brdfLookup},uniformTemplates:{ambientCubemapLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}},ambientCubemapLightCubemap:{type:"t",value:function(t){return t.cubemap}},ambientCubemapLightBRDFLookup:{type:"t",value:function(t){return t._brdfLookup}}}}),hm=Rr.extend({castShadow:!1,coefficients:[]},function(){this._coefficientsTmpArr=new at.Float32Array(27)},{type:"AMBIENT_SH_LIGHT",uniformTemplates:{ambientSHLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}},ambientSHLightCoefficients:{type:"3f",value:function(t){for(var r=t._coefficientsTmpArr,e=0;e<t.coefficients.length;e++)r[e]=t.coefficients[e];return r}}}}),ng={},qe=["px","nx","py","ny","pz","nz"];function ag(t,r){var e=t[0],i=t[1],n=t[2];return r===0?1:r===1?e:r===2?i:r===3?n:r===4?e*n:r===5?i*n:r===6?e*i:r===7?3*n*n-1:e*e-i*i}var sg={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]};function og(t,r,e,i){for(var n=new at.Float32Array(27),a=b.create(),s=b.create(),o=b.create(),f=0;f<9;f++){for(var u=b.create(),h=0;h<qe.length;h++){for(var l=r[qe[h]],c=b.create(),v=0,d=0,_=sg[qe[h]],p=0;p<i;p++)for(var y=0;y<e;y++){a[0]=y/(e-1)*2-1,a[1]=p/(i-1)*2-1,a[2]=-1,b.normalize(a,a),o[0]=a[_[0]]*_[3],o[1]=a[_[1]]*_[4],o[2]=a[_[2]]*_[5],s[0]=l[d++]/255,s[1]=l[d++]/255,s[2]=l[d++]/255;var g=l[d++]/255*8.12;s[0]*=g,s[1]*=g,s[2]*=g,b.scaleAndAdd(c,c,s,ag(o,f)*-a[2]),v+=-a[2]}b.scaleAndAdd(u,u,c,1/v)}n[f*3]=u[0]/6,n[f*3+1]=u[1]/6,n[f*3+2]=u[2]/6}return n}ng.projectEnvironmentMap=function(t,r,e){e=e||{},e.lod=e.lod||0;var i,n=new Pf,a=64;r.textureType==="texture2D"?i=new Wa({scene:n,environmentMap:r}):(a=r.image&&r.image.px?r.image.px.width:r.width,i=new Wa({scene:n,environmentMap:r}));var s=Math.ceil(a/Math.pow(2,e.lod)),o=Math.ceil(a/Math.pow(2,e.lod)),f=new Wt({width:s,height:o}),u=new Cr;i.material.define("fragment","RGBM_ENCODE"),e.decodeRGBM&&i.material.define("fragment","RGBM_DECODE"),i.material.set("lod",e.lod);for(var h=new Lf({texture:f}),l={},c=0;c<qe.length;c++){l[qe[c]]=new Uint8Array(s*o*4);var v=h.getCamera(qe[c]);v.fov=90,u.attach(f),u.bind(t),t.render(n,v),t.gl.readPixels(0,0,s,o,q.RGBA,q.UNSIGNED_BYTE,l[qe[c]]),u.unbind(t)}return i.dispose(t),u.dispose(t),f.dispose(t),og(t,l,s,o)};var lm=Kr.extend({dynamic:!1,widthSegments:40,heightSegments:20,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI,radius:1},function(){this.build()},{build:function(){var t=this.heightSegments,r=this.widthSegments,e=this.attributes.position,i=this.attributes.texcoord0,n=this.attributes.normal,a=(r+1)*(t+1);e.init(a),i.init(a),n.init(a);var s=a>65535?Uint32Array:Uint16Array,o=this.indices=new s(r*t*6),f,u,h,l,c,v,d,m=this.radius,_=this.phiStart,p=this.phiLength,y=this.thetaStart,g=this.thetaLength,m=this.radius,T=[],w=[],x=0,E=1/m;for(d=0;d<=t;d++)for(v=0;v<=r;v++)l=v/r,c=d/t,f=-m*Math.cos(_+l*p)*Math.sin(y+c*g),u=m*Math.cos(y+c*g),h=m*Math.sin(_+l*p)*Math.sin(y+c*g),T[0]=f,T[1]=u,T[2]=h,w[0]=l,w[1]=c,e.set(x,T),i.set(x,w),T[0]*=E,T[1]*=E,T[2]*=E,n.set(x,T),x++;var S,M,C,R,L=r+1,D=0;for(d=0;d<t;d++)for(v=0;v<r;v++)M=d*L+v,S=d*L+v+1,R=(d+1)*L+v+1,C=(d+1)*L+v,o[D++]=S,o[D++]=M,o[D++]=R,o[D++]=M,o[D++]=C,o[D++]=R;this.boundingBox=new Ht,this.boundingBox.max.set(m,m,m),this.boundingBox.min.set(-m,-m,-m)}}),cm=Rr.extend({castShadow:!1},{type:"AMBIENT_LIGHT",uniformTemplates:{ambientLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}}}}),vm=Rr.extend({shadowBias:.001,shadowSlopeScale:2,shadowCascade:1,cascadeSplitLogFactor:.2},{type:"DIRECTIONAL_LIGHT",uniformTemplates:{directionalLightDirection:{type:"3f",value:function(t){return t.__dir=t.__dir||new O,t.__dir.copy(t.worldTransform.z).normalize().negate().array}},directionalLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}}},clone:function(){var t=Rr.prototype.clone.call(this);return t.shadowBias=this.shadowBias,t.shadowSlopeScale=this.shadowSlopeScale,t}}),dm=Rr.extend({range:100,castShadow:!1},{type:"POINT_LIGHT",uniformTemplates:{pointLightPosition:{type:"3f",value:function(t){return t.getWorldPosition().array}},pointLightRange:{type:"1f",value:function(t){return t.range}},pointLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}}},clone:function(){var t=Rr.prototype.clone.call(this);return t.range=this.range,t}}),pm=Rr.extend({range:20,umbraAngle:30,penumbraAngle:45,falloffFactor:2,shadowBias:.001,shadowSlopeScale:2},{type:"SPOT_LIGHT",uniformTemplates:{spotLightPosition:{type:"3f",value:function(t){return t.getWorldPosition().array}},spotLightRange:{type:"1f",value:function(t){return t.range}},spotLightUmbraAngleCosine:{type:"1f",value:function(t){return Math.cos(t.umbraAngle*Math.PI/180)}},spotLightPenumbraAngleCosine:{type:"1f",value:function(t){return Math.cos(t.penumbraAngle*Math.PI/180)}},spotLightFalloffFactor:{type:"1f",value:function(t){return t.falloffFactor}},spotLightDirection:{type:"3f",value:function(t){return t.__dir=t.__dir||new O,t.__dir.copy(t.worldTransform.z).negate().array}},spotLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}}},clone:function(){var t=Rr.prototype.clone.call(this);return t.range=this.range,t.umbraAngle=this.umbraAngle,t.penumbraAngle=this.penumbraAngle,t.falloffFactor=this.falloffFactor,t.shadowBias=this.shadowBias,t.shadowSlopeScale=this.shadowSlopeScale,t}}),nt=function(t,r,e,i){t=t||0,r=r||0,e=e||0,i=i||0,this.array=N.fromValues(t,r,e,i),this._dirty=!0};nt.prototype={constructor:nt,add:function(t){return N.add(this.array,this.array,t.array),this._dirty=!0,this},set:function(t,r,e,i){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this.array[3]=i,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this.array[3]=t[3],this._dirty=!0,this},clone:function(){return new nt(this.x,this.y,this.z,this.w)},copy:function(t){return N.copy(this.array,t.array),this._dirty=!0,this},dist:function(t){return N.dist(this.array,t.array)},distance:function(t){return N.distance(this.array,t.array)},div:function(t){return N.div(this.array,this.array,t.array),this._dirty=!0,this},divide:function(t){return N.divide(this.array,this.array,t.array),this._dirty=!0,this},dot:function(t){return N.dot(this.array,t.array)},len:function(){return N.len(this.array)},length:function(){return N.length(this.array)},lerp:function(t,r,e){return N.lerp(this.array,t.array,r.array,e),this._dirty=!0,this},min:function(t){return N.min(this.array,this.array,t.array),this._dirty=!0,this},max:function(t){return N.max(this.array,this.array,t.array),this._dirty=!0,this},mul:function(t){return N.mul(this.array,this.array,t.array),this._dirty=!0,this},multiply:function(t){return N.multiply(this.array,this.array,t.array),this._dirty=!0,this},negate:function(){return N.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return N.normalize(this.array,this.array),this._dirty=!0,this},random:function(t){return N.random(this.array,t),this._dirty=!0,this},scale:function(t){return N.scale(this.array,this.array,t),this._dirty=!0,this},scaleAndAdd:function(t,r){return N.scaleAndAdd(this.array,this.array,t.array,r),this._dirty=!0,this},sqrDist:function(t){return N.sqrDist(this.array,t.array)},squaredDistance:function(t){return N.squaredDistance(this.array,t.array)},sqrLen:function(){return N.sqrLen(this.array)},squaredLength:function(){return N.squaredLength(this.array)},sub:function(t){return N.sub(this.array,this.array,t.array),this._dirty=!0,this},subtract:function(t){return N.subtract(this.array,this.array,t.array),this._dirty=!0,this},transformMat4:function(t){return N.transformMat4(this.array,this.array,t.array),this._dirty=!0,this},transformQuat:function(t){return N.transformQuat(this.array,this.array,t.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var an=Object.defineProperty;if(an){var ca=nt.prototype;an(ca,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),an(ca,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}}),an(ca,"z",{get:function(){return this.array[2]},set:function(t){this.array[2]=t,this._dirty=!0}}),an(ca,"w",{get:function(){return this.array[3]},set:function(t){this.array[3]=t,this._dirty=!0}})}nt.add=function(t,r,e){return N.add(t.array,r.array,e.array),t._dirty=!0,t};nt.set=function(t,r,e,i,n){N.set(t.array,r,e,i,n),t._dirty=!0};nt.copy=function(t,r){return N.copy(t.array,r.array),t._dirty=!0,t};nt.dist=function(t,r){return N.distance(t.array,r.array)};nt.distance=nt.dist;nt.div=function(t,r,e){return N.divide(t.array,r.array,e.array),t._dirty=!0,t};nt.divide=nt.div;nt.dot=function(t,r){return N.dot(t.array,r.array)};nt.len=function(t){return N.length(t.array)};nt.lerp=function(t,r,e,i){return N.lerp(t.array,r.array,e.array,i),t._dirty=!0,t};nt.min=function(t,r,e){return N.min(t.array,r.array,e.array),t._dirty=!0,t};nt.max=function(t,r,e){return N.max(t.array,r.array,e.array),t._dirty=!0,t};nt.mul=function(t,r,e){return N.multiply(t.array,r.array,e.array),t._dirty=!0,t};nt.multiply=nt.mul;nt.negate=function(t,r){return N.negate(t.array,r.array),t._dirty=!0,t};nt.normalize=function(t,r){return N.normalize(t.array,r.array),t._dirty=!0,t};nt.random=function(t,r){return N.random(t.array,r),t._dirty=!0,t};nt.scale=function(t,r,e){return N.scale(t.array,r.array,e),t._dirty=!0,t};nt.scaleAndAdd=function(t,r,e,i){return N.scaleAndAdd(t.array,r.array,e.array,i),t._dirty=!0,t};nt.sqrDist=function(t,r){return N.sqrDist(t.array,r.array)};nt.squaredDistance=nt.sqrDist;nt.sqrLen=function(t){return N.sqrLen(t.array)};nt.squaredLength=nt.sqrLen;nt.sub=function(t,r,e){return N.subtract(t.array,r.array,e.array),t._dirty=!0,t};nt.subtract=nt.sub;nt.transformMat4=function(t,r,e){return N.transformMat4(t.array,r.array,e.array),t._dirty=!0,t};nt.transformQuat=function(t,r,e){return N.transformQuat(t.array,r.array,e.array),t._dirty=!0,t};var it={};it.create=function(){var t=new Bt(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t};it.clone=function(t){var r=new Bt(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r};it.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t};it.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t};it.transpose=function(t,r){if(t===r){var e=r[1];t[1]=r[2],t[2]=e}else t[0]=r[0],t[1]=r[2],t[2]=r[1],t[3]=r[3];return t};it.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e*a-n*i;return s?(s=1/s,t[0]=a*s,t[1]=-i*s,t[2]=-n*s,t[3]=e*s,t):null};it.adjoint=function(t,r){var e=r[0];return t[0]=r[3],t[1]=-r[1],t[2]=-r[2],t[3]=e,t};it.determinant=function(t){return t[0]*t[3]-t[2]*t[1]};it.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=e[0],f=e[1],u=e[2],h=e[3];return t[0]=i*o+a*f,t[1]=n*o+s*f,t[2]=i*u+a*h,t[3]=n*u+s*h,t};it.mul=it.multiply;it.rotate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=Math.sin(e),f=Math.cos(e);return t[0]=i*f+a*o,t[1]=n*f+s*o,t[2]=i*-o+a*f,t[3]=n*-o+s*f,t};it.scale=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=e[0],f=e[1];return t[0]=i*o,t[1]=n*o,t[2]=a*f,t[3]=s*f,t};it.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))};it.LDU=function(t,r,e,i){return t[2]=i[2]/i[0],e[0]=i[0],e[1]=i[1],e[3]=i[3]-t[2]*e[1],[t,r,e]};var ir=function(){this.array=it.create(),this._dirty=!0};ir.prototype={constructor:ir,setArray:function(t){for(var r=0;r<this.array.length;r++)this.array[r]=t[r];return this._dirty=!0,this},clone:function(){return new ir().copy(this)},copy:function(t){return it.copy(this.array,t.array),this._dirty=!0,this},adjoint:function(){return it.adjoint(this.array,this.array),this._dirty=!0,this},determinant:function(){return it.determinant(this.array)},identity:function(){return it.identity(this.array),this._dirty=!0,this},invert:function(){return it.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return it.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return it.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return it.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return it.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return it.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return it.scale(this.array,this.array,t.array),this._dirty=!0,this},transpose:function(){return it.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};ir.adjoint=function(t,r){return it.adjoint(t.array,r.array),t._dirty=!0,t};ir.copy=function(t,r){return it.copy(t.array,r.array),t._dirty=!0,t};ir.determinant=function(t){return it.determinant(t.array)};ir.identity=function(t){return it.identity(t.array),t._dirty=!0,t};ir.invert=function(t,r){return it.invert(t.array,r.array),t._dirty=!0,t};ir.mul=function(t,r,e){return it.mul(t.array,r.array,e.array),t._dirty=!0,t};ir.multiply=ir.mul;ir.rotate=function(t,r,e){return it.rotate(t.array,r.array,e),t._dirty=!0,t};ir.scale=function(t,r,e){return it.scale(t.array,r.array,e.array),t._dirty=!0,t};ir.transpose=function(t,r){return it.transpose(t.array,r.array),t._dirty=!0,t};var ft={};ft.create=function(){var t=new Bt(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t};ft.clone=function(t){var r=new Bt(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r};ft.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t};ft.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t};ft.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],f=e*a-i*n;return f?(f=1/f,t[0]=a*f,t[1]=-i*f,t[2]=-n*f,t[3]=e*f,t[4]=(n*o-a*s)*f,t[5]=(i*s-e*o)*f,t):null};ft.determinant=function(t){return t[0]*t[3]-t[1]*t[2]};ft.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],f=r[5],u=e[0],h=e[1],l=e[2],c=e[3],v=e[4],d=e[5];return t[0]=i*u+a*h,t[1]=n*u+s*h,t[2]=i*l+a*c,t[3]=n*l+s*c,t[4]=i*v+a*d+o,t[5]=n*v+s*d+f,t};ft.mul=ft.multiply;ft.rotate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],f=r[5],u=Math.sin(e),h=Math.cos(e);return t[0]=i*h+a*u,t[1]=n*h+s*u,t[2]=i*-u+a*h,t[3]=n*-u+s*h,t[4]=o,t[5]=f,t};ft.scale=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],f=r[5],u=e[0],h=e[1];return t[0]=i*u,t[1]=n*u,t[2]=a*h,t[3]=s*h,t[4]=o,t[5]=f,t};ft.translate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],f=r[5],u=e[0],h=e[1];return t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=i*u+a*h+o,t[5]=n*u+s*h+f,t};ft.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)};var hr=function(){this.array=ft.create(),this._dirty=!0};hr.prototype={constructor:hr,setArray:function(t){for(var r=0;r<this.array.length;r++)this.array[r]=t[r];return this._dirty=!0,this},clone:function(){return new hr().copy(this)},copy:function(t){return ft.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return ft.determinant(this.array)},identity:function(){return ft.identity(this.array),this._dirty=!0,this},invert:function(){return ft.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return ft.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return ft.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return ft.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return ft.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return ft.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return ft.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return ft.translate(this.array,this.array,t.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};hr.copy=function(t,r){return ft.copy(t.array,r.array),t._dirty=!0,t};hr.determinant=function(t){return ft.determinant(t.array)};hr.identity=function(t){return ft.identity(t.array),t._dirty=!0,t};hr.invert=function(t,r){return ft.invert(t.array,r.array),t._dirty=!0,t};hr.mul=function(t,r,e){return ft.mul(t.array,r.array,e.array),t._dirty=!0,t};hr.multiply=hr.mul;hr.rotate=function(t,r,e){return ft.rotate(t.array,r.array,e),t._dirty=!0,t};hr.scale=function(t,r,e){return ft.scale(t.array,r.array,e.array),t._dirty=!0,t};hr.translate=function(t,r,e){return ft.translate(t.array,r.array,e.array),t._dirty=!0,t};var It=function(){this.array=Z.create(),this._dirty=!0};It.prototype={constructor:It,setArray:function(t){for(var r=0;r<this.array.length;r++)this.array[r]=t[r];return this._dirty=!0,this},adjoint:function(){return Z.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return new It().copy(this)},copy:function(t){return Z.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return Z.determinant(this.array)},fromMat2d:function(t){return Z.fromMat2d(this.array,t.array),this._dirty=!0,this},fromMat4:function(t){return Z.fromMat4(this.array,t.array),this._dirty=!0,this},fromQuat:function(t){return Z.fromQuat(this.array,t.array),this._dirty=!0,this},identity:function(){return Z.identity(this.array),this._dirty=!0,this},invert:function(){return Z.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return Z.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return Z.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return Z.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return Z.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return Z.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return Z.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return Z.translate(this.array,this.array,t.array),this._dirty=!0,this},normalFromMat4:function(t){return Z.normalFromMat4(this.array,t.array),this._dirty=!0,this},transpose:function(){return Z.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};It.adjoint=function(t,r){return Z.adjoint(t.array,r.array),t._dirty=!0,t};It.copy=function(t,r){return Z.copy(t.array,r.array),t._dirty=!0,t};It.determinant=function(t){return Z.determinant(t.array)};It.identity=function(t){return Z.identity(t.array),t._dirty=!0,t};It.invert=function(t,r){return Z.invert(t.array,r.array),t};It.mul=function(t,r,e){return Z.mul(t.array,r.array,e.array),t._dirty=!0,t};It.multiply=It.mul;It.fromMat2d=function(t,r){return Z.fromMat2d(t.array,r.array),t._dirty=!0,t};It.fromMat4=function(t,r){return Z.fromMat4(t.array,r.array),t._dirty=!0,t};It.fromQuat=function(t,r){return Z.fromQuat(t.array,r.array),t._dirty=!0,t};It.normalFromMat4=function(t,r){return Z.normalFromMat4(t.array,r.array),t._dirty=!0,t};It.rotate=function(t,r,e){return Z.rotate(t.array,r.array,e),t._dirty=!0,t};It.scale=function(t,r,e){return Z.scale(t.array,r.array,e.array),t._dirty=!0,t};It.transpose=function(t,r){return Z.transpose(t.array,r.array),t._dirty=!0,t};It.translate=function(t,r,e){return Z.translate(t.array,r.array,e.array),t._dirty=!0,t};const _m=`
@export clay.util.rand
highp float rand(vec2 uv) {
 const highp float a = 12.9898, b = 78.233, c = 43758.5453;
 highp float dt = dot(uv.xy, vec2(a,b)), sn = mod(dt, 3.141592653589793);
 return fract(sin(sn) * c);
}
@end
@export clay.util.calculate_attenuation
uniform float attenuationFactor : 5.0;
float lightAttenuation(float dist, float range)
{
 float attenuation = 1.0;
 attenuation = dist*dist/(range*range+1.0);
 float att_s = attenuationFactor;
 attenuation = 1.0/(attenuation*att_s+1.0);
 att_s = 1.0/(att_s+1.0);
 attenuation = attenuation - att_s;
 attenuation /= 1.0 - att_s;
 return clamp(attenuation, 0.0, 1.0);
}
@end
@export clay.util.edge_factor
#ifdef SUPPORT_STANDARD_DERIVATIVES
float edgeFactor(float width)
{
 vec3 d = fwidth(v_Barycentric);
 vec3 a3 = smoothstep(vec3(0.0), d * width, v_Barycentric);
 return min(min(a3.x, a3.y), a3.z);
}
#else
float edgeFactor(float width)
{
 return 1.0;
}
#endif
@end
@export clay.util.encode_float
vec4 encodeFloat(const in float depth)
{
 const vec4 bitShifts = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);
 const vec4 bit_mask = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);
 vec4 res = fract(depth * bitShifts);
 res -= res.xxyz * bit_mask;
 return res;
}
@end
@export clay.util.decode_float
float decodeFloat(const in vec4 color)
{
 const vec4 bitShifts = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);
 return dot(color, bitShifts);
}
@end
@export clay.util.float
@import clay.util.encode_float
@import clay.util.decode_float
@end
@export clay.util.rgbm_decode
vec3 RGBMDecode(vec4 rgbm, float range) {
 return range * rgbm.rgb * rgbm.a;
}
@end
@export clay.util.rgbm_encode
vec4 RGBMEncode(vec3 color, float range) {
 if (dot(color, color) == 0.0) {
 return vec4(0.0);
 }
 vec4 rgbm;
 color /= range;
 rgbm.a = clamp(max(max(color.r, color.g), max(color.b, 1e-6)), 0.0, 1.0);
 rgbm.a = ceil(rgbm.a * 255.0) / 255.0;
 rgbm.rgb = color / rgbm.a;
 return rgbm;
}
@end
@export clay.util.rgbm
@import clay.util.rgbm_decode
@import clay.util.rgbm_encode
vec4 decodeHDR(vec4 color)
{
#if defined(RGBM_DECODE) || defined(RGBM)
 return vec4(RGBMDecode(color, 8.12), 1.0);
#else
 return color;
#endif
}
vec4 encodeHDR(vec4 color)
{
#if defined(RGBM_ENCODE) || defined(RGBM)
 return RGBMEncode(color.xyz, 8.12);
#else
 return color;
#endif
}
@end
@export clay.util.srgb
vec4 sRGBToLinear(in vec4 value) {
 return vec4(mix(pow(value.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), value.rgb * 0.0773993808, vec3(lessThanEqual(value.rgb, vec3(0.04045)))), value.w);
}
vec4 linearTosRGB(in vec4 value) {
 return vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.w);
}
@end
@export clay.chunk.skinning_header
#ifdef SKINNING
attribute vec3 weight : WEIGHT;
attribute vec4 joint : JOINT;
#ifdef USE_SKIN_MATRICES_TEXTURE
uniform sampler2D skinMatricesTexture : ignore;
uniform float skinMatricesTextureSize: ignore;
mat4 getSkinMatrix(sampler2D tex, float idx) {
 float j = idx * 4.0;
 float x = mod(j, skinMatricesTextureSize);
 float y = floor(j / skinMatricesTextureSize) + 0.5;
 vec2 scale = vec2(skinMatricesTextureSize);
 return mat4(
 texture2D(tex, vec2(x + 0.5, y) / scale),
 texture2D(tex, vec2(x + 1.5, y) / scale),
 texture2D(tex, vec2(x + 2.5, y) / scale),
 texture2D(tex, vec2(x + 3.5, y) / scale)
 );
}
mat4 getSkinMatrix(float idx) {
 return getSkinMatrix(skinMatricesTexture, idx);
}
#else
uniform mat4 skinMatrix[JOINT_COUNT] : SKIN_MATRIX;
mat4 getSkinMatrix(float idx) {
 return skinMatrix[int(idx)];
}
#endif
#endif
@end
@export clay.chunk.skin_matrix
mat4 skinMatrixWS = getSkinMatrix(joint.x) * weight.x;
if (weight.y > 1e-4)
{
 skinMatrixWS += getSkinMatrix(joint.y) * weight.y;
}
if (weight.z > 1e-4)
{
 skinMatrixWS += getSkinMatrix(joint.z) * weight.z;
}
float weightW = 1.0-weight.x-weight.y-weight.z;
if (weightW > 1e-4)
{
 skinMatrixWS += getSkinMatrix(joint.w) * weightW;
}
@end
@export clay.chunk.instancing_header
#ifdef INSTANCING
attribute vec4 instanceMat1;
attribute vec4 instanceMat2;
attribute vec4 instanceMat3;
#endif
@end
@export clay.chunk.instancing_matrix
mat4 instanceMat = mat4(
 vec4(instanceMat1.xyz, 0.0),
 vec4(instanceMat2.xyz, 0.0),
 vec4(instanceMat3.xyz, 0.0),
 vec4(instanceMat1.w, instanceMat2.w, instanceMat3.w, 1.0)
);
@end
@export clay.util.parallax_correct
vec3 parallaxCorrect(in vec3 dir, in vec3 pos, in vec3 boxMin, in vec3 boxMax) {
 vec3 first = (boxMax - pos) / dir;
 vec3 second = (boxMin - pos) / dir;
 vec3 further = max(first, second);
 float dist = min(further.x, min(further.y, further.z));
 vec3 fixedPos = pos + dir * dist;
 vec3 boxCenter = (boxMax + boxMin) * 0.5;
 return normalize(fixedPos - boxCenter);
}
@end
@export clay.util.clamp_sample
vec4 clampSample(const in sampler2D texture, const in vec2 coord)
{
#ifdef STEREO
 float eye = step(0.5, coord.x) * 0.5;
 vec2 coordClamped = clamp(coord, vec2(eye, 0.0), vec2(0.5 + eye, 1.0));
#else
 vec2 coordClamped = clamp(coord, vec2(0.0), vec2(1.0));
#endif
 return texture2D(texture, coordClamped);
}
@end
@export clay.util.ACES
vec3 ACESToneMapping(vec3 color)
{
 const float A = 2.51;
 const float B = 0.03;
 const float C = 2.43;
 const float D = 0.59;
 const float E = 0.14;
 return (color * (A * color + B)) / (color * (C * color + D) + E);
}
@end`,ym={vec3:b};var Va=function(){this._pool={},this._allocatedTextures=[]};Va.prototype={constructor:Va,get:function(t){var r=ll(t);this._pool.hasOwnProperty(r)||(this._pool[r]=[]);var e=this._pool[r];if(!e.length){var i=new Wt(t);return this._allocatedTextures.push(i),i}return e.pop()},put:function(t){var r=ll(t);this._pool.hasOwnProperty(r)||(this._pool[r]=[]);var e=this._pool[r];e.push(t)},clear:function(t){for(var r=0;r<this._allocatedTextures.length;r++)this._allocatedTextures[r].dispose(t);this._pool={},this._allocatedTextures=[]}};var cv={width:512,height:512,type:I.UNSIGNED_BYTE,format:I.RGBA,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE,minFilter:I.LINEAR_MIPMAP_LINEAR,magFilter:I.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1},po=Object.keys(cv);function ll(t){Ct.defaultsWithPropList(t,cv,po),fg(t);for(var r="",e=0;e<po.length;e++){var i=po[e],n=t[i].toString();r+=n}return r}function fg(t){var r=ug(t.width,t.height);t.format===I.DEPTH_COMPONENT&&(t.useMipmap=!1),(!r||!t.useMipmap)&&(t.minFilter==I.NEAREST_MIPMAP_NEAREST||t.minFilter==I.NEAREST_MIPMAP_LINEAR?t.minFilter=I.NEAREST:(t.minFilter==I.LINEAR_MIPMAP_LINEAR||t.minFilter==I.LINEAR_MIPMAP_NEAREST)&&(t.minFilter=I.LINEAR)),r||(t.wrapS=I.CLAMP_TO_EDGE,t.wrapT=I.CLAMP_TO_EDGE)}function ug(t,r){return(t&t-1)===0&&(r&r-1)===0}const hg=`@export clay.sm.depth.vertex
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
attribute vec3 position : POSITION;
attribute vec2 texcoord : TEXCOORD_0;
uniform vec2 uvRepeat = vec2(1.0, 1.0);
uniform vec2 uvOffset = vec2(0.0, 0.0);
@import clay.chunk.skinning_header
@import clay.chunk.instancing_header
varying vec4 v_ViewPosition;
varying vec2 v_Texcoord;
void main(){
 vec4 P = vec4(position, 1.0);
#ifdef SKINNING
 @import clay.chunk.skin_matrix
 P = skinMatrixWS * P;
#endif
#ifdef INSTANCING
 @import clay.chunk.instancing_matrix
 P = instanceMat * P;
#endif
 v_ViewPosition = worldViewProjection * P;
 gl_Position = v_ViewPosition;
 v_Texcoord = texcoord * uvRepeat + uvOffset;
}
@end
@export clay.sm.depth.fragment
varying vec4 v_ViewPosition;
varying vec2 v_Texcoord;
uniform float bias : 0.001;
uniform float slopeScale : 1.0;
uniform sampler2D alphaMap;
uniform float alphaCutoff: 0.0;
@import clay.util.encode_float
void main(){
 float depth = v_ViewPosition.z / v_ViewPosition.w;
 if (alphaCutoff > 0.0) {
 if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {
 discard;
 }
 }
#ifdef USE_VSM
 depth = depth * 0.5 + 0.5;
 float moment1 = depth;
 float moment2 = depth * depth;
 #ifdef SUPPORT_STANDARD_DERIVATIVES
 float dx = dFdx(depth);
 float dy = dFdy(depth);
 moment2 += 0.25*(dx*dx+dy*dy);
 #endif
 gl_FragColor = vec4(moment1, moment2, 0.0, 1.0);
#else
 #ifdef SUPPORT_STANDARD_DERIVATIVES
 float dx = dFdx(depth);
 float dy = dFdy(depth);
 depth += sqrt(dx*dx + dy*dy) * slopeScale + bias;
 #else
 depth += bias;
 #endif
 gl_FragColor = encodeFloat(depth * 0.5 + 0.5);
#endif
}
@end
@export clay.sm.debug_depth
uniform sampler2D depthMap;
varying vec2 v_Texcoord;
@import clay.util.decode_float
void main() {
 vec4 tex = texture2D(depthMap, v_Texcoord);
#ifdef USE_VSM
 gl_FragColor = vec4(tex.rgb, 1.0);
#else
 float depth = decodeFloat(tex);
 gl_FragColor = vec4(depth, depth, depth, 1.0);
#endif
}
@end
@export clay.sm.distance.vertex
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform mat4 world : WORLD;
attribute vec3 position : POSITION;
@import clay.chunk.skinning_header
varying vec3 v_WorldPosition;
void main (){
 vec4 P = vec4(position, 1.0);
#ifdef SKINNING
 @import clay.chunk.skin_matrix
 P = skinMatrixWS * P;
#endif
#ifdef INSTANCING
 @import clay.chunk.instancing_matrix
 P = instanceMat * P;
#endif
 gl_Position = worldViewProjection * P;
 v_WorldPosition = (world * P).xyz;
}
@end
@export clay.sm.distance.fragment
uniform vec3 lightPosition;
uniform float range : 100;
varying vec3 v_WorldPosition;
@import clay.util.encode_float
void main(){
 float dist = distance(lightPosition, v_WorldPosition);
#ifdef USE_VSM
 gl_FragColor = vec4(dist, dist * dist, 0.0, 0.0);
#else
 dist = dist / range;
 gl_FragColor = encodeFloat(dist);
#endif
}
@end
@export clay.plugin.shadow_map_common
@import clay.util.decode_float
float tapShadowMap(sampler2D map, vec2 uv, float z){
 vec4 tex = texture2D(map, uv);
 return step(z, decodeFloat(tex) * 2.0 - 1.0);
}
float pcf(sampler2D map, vec2 uv, float z, float textureSize, vec2 scale) {
 float shadowContrib = tapShadowMap(map, uv, z);
 vec2 offset = vec2(1.0 / textureSize) * scale;
#ifdef PCF_KERNEL_SIZE
 for (int _idx_ = 0; _idx_ < PCF_KERNEL_SIZE; _idx_++) {{
 shadowContrib += tapShadowMap(map, uv + offset * pcfKernel[_idx_], z);
 }}
 return shadowContrib / float(PCF_KERNEL_SIZE + 1);
#else
 shadowContrib += tapShadowMap(map, uv+vec2(offset.x, 0.0), z);
 shadowContrib += tapShadowMap(map, uv+vec2(offset.x, offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(0.0, offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, 0.0), z);
 shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, -offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(offset.x, -offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(0.0, -offset.y), z);
 return shadowContrib / 9.0;
#endif
}
float pcf(sampler2D map, vec2 uv, float z, float textureSize) {
 return pcf(map, uv, z, textureSize, vec2(1.0));
}
float chebyshevUpperBound(vec2 moments, float z){
 float p = 0.0;
 z = z * 0.5 + 0.5;
 if (z <= moments.x) {
 p = 1.0;
 }
 float variance = moments.y - moments.x * moments.x;
 variance = max(variance, 0.0000001);
 float mD = moments.x - z;
 float pMax = variance / (variance + mD * mD);
 pMax = clamp((pMax-0.4)/(1.0-0.4), 0.0, 1.0);
 return max(p, pMax);
}
float computeShadowContrib(
 sampler2D map, mat4 lightVPM, vec3 position, float textureSize, vec2 scale, vec2 offset
) {
 vec4 posInLightSpace = lightVPM * vec4(position, 1.0);
 posInLightSpace.xyz /= posInLightSpace.w;
 float z = posInLightSpace.z;
 if(all(greaterThan(posInLightSpace.xyz, vec3(-0.99, -0.99, -1.0))) &&
 all(lessThan(posInLightSpace.xyz, vec3(0.99, 0.99, 1.0)))){
 vec2 uv = (posInLightSpace.xy+1.0) / 2.0;
 #ifdef USE_VSM
 vec2 moments = texture2D(map, uv * scale + offset).xy;
 return chebyshevUpperBound(moments, z);
 #else
 return pcf(map, uv * scale + offset, z, textureSize, scale);
 #endif
 }
 return 1.0;
}
float computeShadowContrib(sampler2D map, mat4 lightVPM, vec3 position, float textureSize) {
 return computeShadowContrib(map, lightVPM, position, textureSize, vec2(1.0), vec2(0.0));
}
float computeShadowContribOmni(samplerCube map, vec3 direction, float range)
{
 float dist = length(direction);
 vec4 shadowTex = textureCube(map, direction);
#ifdef USE_VSM
 vec2 moments = shadowTex.xy;
 float variance = moments.y - moments.x * moments.x;
 float mD = moments.x - dist;
 float p = variance / (variance + mD * mD);
 if(moments.x + 0.001 < dist){
 return clamp(p, 0.0, 1.0);
 }else{
 return 1.0;
 }
#else
 return step(dist, (decodeFloat(shadowTex) + 0.0002) * range);
#endif
}
@end
@export clay.plugin.compute_shadow_map
#if defined(SPOT_LIGHT_SHADOWMAP_COUNT) || defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT) || defined(POINT_LIGHT_SHADOWMAP_COUNT)
#ifdef SPOT_LIGHT_SHADOWMAP_COUNT
uniform sampler2D spotLightShadowMaps[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
uniform mat4 spotLightMatrices[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
uniform float spotLightShadowMapSizes[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
#endif
#ifdef DIRECTIONAL_LIGHT_SHADOWMAP_COUNT
#if defined(SHADOW_CASCADE)
uniform sampler2D directionalLightShadowMaps[1]:unconfigurable;
uniform mat4 directionalLightMatrices[SHADOW_CASCADE]:unconfigurable;
uniform float directionalLightShadowMapSizes[1]:unconfigurable;
uniform float shadowCascadeClipsNear[SHADOW_CASCADE]:unconfigurable;
uniform float shadowCascadeClipsFar[SHADOW_CASCADE]:unconfigurable;
#else
uniform sampler2D directionalLightShadowMaps[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
uniform mat4 directionalLightMatrices[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
uniform float directionalLightShadowMapSizes[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
#endif
#endif
#ifdef POINT_LIGHT_SHADOWMAP_COUNT
uniform samplerCube pointLightShadowMaps[POINT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
#endif
uniform bool shadowEnabled : true;
#ifdef PCF_KERNEL_SIZE
uniform vec2 pcfKernel[PCF_KERNEL_SIZE];
#endif
@import clay.plugin.shadow_map_common
#if defined(SPOT_LIGHT_SHADOWMAP_COUNT)
void computeShadowOfSpotLights(vec3 position, inout float shadowContribs[SPOT_LIGHT_COUNT] ) {
 float shadowContrib;
 for(int _idx_ = 0; _idx_ < SPOT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{
 shadowContrib = computeShadowContrib(
 spotLightShadowMaps[_idx_], spotLightMatrices[_idx_], position,
 spotLightShadowMapSizes[_idx_]
 );
 shadowContribs[_idx_] = shadowContrib;
 }}
 for(int _idx_ = SPOT_LIGHT_SHADOWMAP_COUNT; _idx_ < SPOT_LIGHT_COUNT; _idx_++){{
 shadowContribs[_idx_] = 1.0;
 }}
}
#endif
#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
#ifdef SHADOW_CASCADE
void computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){
 float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)
 / (gl_DepthRange.far - gl_DepthRange.near);
 float shadowContrib;
 shadowContribs[0] = 1.0;
 for (int _idx_ = 0; _idx_ < SHADOW_CASCADE; _idx_++) {{
 if (
 depth >= shadowCascadeClipsNear[_idx_] &&
 depth <= shadowCascadeClipsFar[_idx_]
 ) {
 shadowContrib = computeShadowContrib(
 directionalLightShadowMaps[0], directionalLightMatrices[_idx_], position,
 directionalLightShadowMapSizes[0],
 vec2(1.0 / float(SHADOW_CASCADE), 1.0),
 vec2(float(_idx_) / float(SHADOW_CASCADE), 0.0)
 );
 shadowContribs[0] = shadowContrib;
 }
 }}
 for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{
 shadowContribs[_idx_] = 1.0;
 }}
}
#else
void computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){
 float shadowContrib;
 for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_++) {{
 shadowContrib = computeShadowContrib(
 directionalLightShadowMaps[_idx_], directionalLightMatrices[_idx_], position,
 directionalLightShadowMapSizes[_idx_]
 );
 shadowContribs[_idx_] = shadowContrib;
 }}
 for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{
 shadowContribs[_idx_] = 1.0;
 }}
}
#endif
#endif
#if defined(POINT_LIGHT_SHADOWMAP_COUNT)
void computeShadowOfPointLights(vec3 position, inout float shadowContribs[POINT_LIGHT_COUNT] ){
 vec3 lightPosition;
 vec3 direction;
 for(int _idx_ = 0; _idx_ < POINT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{
 lightPosition = pointLightPosition[_idx_];
 direction = position - lightPosition;
 shadowContribs[_idx_] = computeShadowContribOmni(pointLightShadowMaps[_idx_], direction, pointLightRange[_idx_]);
 }}
 for(int _idx_ = POINT_LIGHT_SHADOWMAP_COUNT; _idx_ < POINT_LIGHT_COUNT; _idx_++) {{
 shadowContribs[_idx_] = 1.0;
 }}
}
#endif
#endif
@end`;var re=["px","nx","py","ny","pz","nz"];J.import(hg);function _o(t,r,e){if(e==="alphaMap")return t.material.get("diffuseMap");if(e==="alphaCutoff"){if(t.material.isDefined("fragment","ALPHA_TEST")&&t.material.get("diffuseMap")){var i=t.material.get("alphaCutoff");return i||0}return 0}else return e==="uvRepeat"?t.material.get("uvRepeat"):e==="uvOffset"?t.material.get("uvOffset"):r.get(e)}function cl(t,r){var e=t.material,i=r.material;return e.get("diffuseMap")!==i.get("diffuseMap")||(e.get("alphaCutoff")||0)!==(i.get("alphaCutoff")||0)}var Zr=Vt.extend(function(){return{softShadow:Zr.PCF,shadowBlur:1,lightFrustumBias:"auto",kernelPCF:new Float32Array([1,0,1,1,-1,1,0,1,-1,0,-1,-1,1,-1,0,-1]),precision:"highp",_lastRenderNotCastShadow:!1,_frameBuffer:new Cr,_textures:{},_shadowMapNumber:{POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},_depthMaterials:{},_distanceMaterials:{},_receivers:[],_lightsCastShadow:[],_lightCameras:{},_lightMaterials:{},_texturePool:new Va}},function(){this._gaussianPassH=new gn({fragment:J.source("clay.compositor.gaussian_blur")}),this._gaussianPassV=new gn({fragment:J.source("clay.compositor.gaussian_blur")}),this._gaussianPassH.setUniform("blurSize",this.shadowBlur),this._gaussianPassH.setUniform("blurDir",0),this._gaussianPassV.setUniform("blurSize",this.shadowBlur),this._gaussianPassV.setUniform("blurDir",1),this._outputDepthPass=new gn({fragment:J.source("clay.sm.debug_depth")})},{render:function(t,r,e,i){e||(e=r.getMainCamera()),this.trigger("beforerender",this,t,r,e),this._renderShadowPass(t,r,e,i),this.trigger("afterrender",this,t,r,e)},renderDebug:function(t,r){t.saveClear();var e=t.viewport,i=0,n=0,a=r||e.width/4,s=a;this.softShadow===Zr.VSM?this._outputDepthPass.material.define("fragment","USE_VSM"):this._outputDepthPass.material.undefine("fragment","USE_VSM");for(var o in this._textures){var f=this._textures[o];t.setViewport(i,n,a*f.width/f.height,s),this._outputDepthPass.setUniform("depthMap",f),this._outputDepthPass.render(t),i+=a*f.width/f.height}t.setViewport(e),t.restoreClear()},_updateReceivers:function(t,r){if(r.receiveShadow?(this._receivers.push(r),r.material.set("shadowEnabled",1),r.material.set("pcfKernel",this.kernelPCF)):r.material.set("shadowEnabled",0),this.softShadow===Zr.VSM)r.material.define("fragment","USE_VSM"),r.material.undefine("fragment","PCF_KERNEL_SIZE");else{r.material.undefine("fragment","USE_VSM");var e=this.kernelPCF;e&&e.length?r.material.define("fragment","PCF_KERNEL_SIZE",e.length/2):r.material.undefine("fragment","PCF_KERNEL_SIZE")}},_update:function(t,r){var e=this;r.traverse(function(a){a.isRenderable()&&e._updateReceivers(t,a)});for(var i=0;i<r.lights.length;i++){var n=r.lights[i];n.castShadow&&!n.invisible&&this._lightsCastShadow.push(n)}},_renderShadowPass:function(t,r,e,i){for(var n in this._shadowMapNumber)this._shadowMapNumber[n]=0;this._lightsCastShadow.length=0,this._receivers.length=0;var a=t.gl;if(i||r.update(),e&&e.update(),r.updateLights(),this._update(t,r),!this._lightsCastShadow.length&&this._lastRenderNotCastShadow)return;this._lastRenderNotCastShadow=this._lightsCastShadow===0,a.enable(a.DEPTH_TEST),a.depthMask(!0),a.disable(a.BLEND),a.clearColor(1,1,1,1);for(var s=[],o=[],f=[],u=[],h=[],l=[],c,v=0;v<this._lightsCastShadow.length;v++){var d=this._lightsCastShadow[v];if(d.type==="DIRECTIONAL_LIGHT"){if(c){console.warn("Only one direectional light supported with shadow cascade");continue}if(d.shadowCascade>4){console.warn("Support at most 4 cascade");continue}d.shadowCascade>1&&(c=d),this.renderDirectionalLightShadow(t,r,e,d,h,u,f)}else d.type==="SPOT_LIGHT"?this.renderSpotLightShadow(t,r,d,o,s):d.type==="POINT_LIGHT"&&this.renderPointLightShadow(t,r,d,l);this._shadowMapNumber[d.type]++}for(var _ in this._shadowMapNumber)for(var p=this._shadowMapNumber[_],y=_+"_SHADOWMAP_COUNT",v=0;v<this._receivers.length;v++){var g=this._receivers[v],m=g.material;m.fragmentDefines[y]!==p&&(p>0?m.define("fragment",y,p):m.isDefined("fragment",y)&&m.undefine("fragment",y))}for(var v=0;v<this._receivers.length;v++){var g=this._receivers[v],m=g.material;c?m.define("fragment","SHADOW_CASCADE",c.shadowCascade):m.undefine("fragment","SHADOW_CASCADE")}var T=r.shadowUniforms;function w(C){return C.height}if(f.length>0){var x=f.map(w);if(T.directionalLightShadowMaps={value:f,type:"tv"},T.directionalLightMatrices={value:u,type:"m4v"},T.directionalLightShadowMapSizes={value:x,type:"1fv"},c){var E=h.slice(),S=h.slice();E.pop(),S.shift(),E.reverse(),S.reverse(),u.reverse(),T.shadowCascadeClipsNear={value:E,type:"1fv"},T.shadowCascadeClipsFar={value:S,type:"1fv"}}}if(s.length>0){var M=s.map(w),T=r.shadowUniforms;T.spotLightShadowMaps={value:s,type:"tv"},T.spotLightMatrices={value:o,type:"m4v"},T.spotLightShadowMapSizes={value:M,type:"1fv"}}l.length>0&&(T.pointLightShadowMaps={value:l,type:"tv"})},renderDirectionalLightShadow:(function(){var t=new Cf,r=new V,e=new Ht,i=new V,n=new V,a=new V,s=new V;return function(o,f,u,h,l,c,v){var d=this._getDepthMaterial(h),_={getMaterial:function(st){return st.shadowDepthMaterial||d},isMaterialChanged:cl,getUniform:_o,ifRender:function(st){return st.castShadow},sortCompare:zr.opaqueSortCompare};if(!f.viewBoundingBoxLastFrame.isFinite()){var p=f.getBoundingBox();f.viewBoundingBoxLastFrame.copy(p).applyTransform(u.viewMatrix)}var y=Math.min(-f.viewBoundingBoxLastFrame.min.z,u.far),g=Math.max(-f.viewBoundingBoxLastFrame.max.z,u.near),m=this._getDirectionalLightCamera(h,f,u),T=a.array;s.copy(m.projectionMatrix),F.invert(n.array,m.worldTransform.array),F.multiply(n.array,n.array,u.worldTransform.array),F.multiply(T,s.array,n.array);for(var w=[],x=u instanceof Zt,E=(u.near+u.far)/(u.near-u.far),S=2*u.near*u.far/(u.near-u.far),M=0;M<=h.shadowCascade;M++){var C=g*Math.pow(y/g,M/h.shadowCascade),R=g+(y-g)*M/h.shadowCascade,L=C*h.cascadeSplitLogFactor+R*(1-h.cascadeSplitLogFactor);w.push(L),l.push(-(-L*E+S)/-L)}var D=this._getTexture(h,h.shadowCascade);v.push(D);var P=o.viewport,z=o.gl;this._frameBuffer.attach(D),this._frameBuffer.bind(o),z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT);for(var M=0;M<h.shadowCascade;M++){var A=w[M],B=w[M+1];x?F.perspective(r.array,u.fov/180*Math.PI,u.aspect,A,B):F.ortho(r.array,u.left,u.right,u.bottom,u.top,A,B),t.setFromProjection(r),t.getTransformedBoundingBox(e,n),e.applyProjection(s);var k=e.min.array,j=e.max.array;k[0]=Math.max(k[0],-1),k[1]=Math.max(k[1],-1),j[0]=Math.min(j[0],1),j[1]=Math.min(j[1],1),i.ortho(k[0],j[0],k[1],j[1],1,-1),m.projectionMatrix.multiplyLeft(i);var $=h.shadowResolution||512;o.setViewport((h.shadowCascade-M-1)*$,0,$,$,1);var rt=f.updateRenderList(m);o.renderPass(rt.opaque,m,_),this.softShadow===Zr.VSM&&this._gaussianFilter(o,D,D.width);var Q=new V;Q.copy(m.viewMatrix).multiplyLeft(m.projectionMatrix),c.push(Q.array),m.projectionMatrix.copy(s)}this._frameBuffer.unbind(o),o.setViewport(P)}})(),renderSpotLightShadow:function(t,r,e,i,n){var a=this._getTexture(e),s=this._getSpotLightCamera(e),o=t.gl;this._frameBuffer.attach(a),this._frameBuffer.bind(t),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);var f=this._getDepthMaterial(e),u={getMaterial:function(c){return c.shadowDepthMaterial||f},isMaterialChanged:cl,getUniform:_o,ifRender:function(c){return c.castShadow},sortCompare:zr.opaqueSortCompare},h=r.updateRenderList(s);t.renderPass(h.opaque,s,u),this._frameBuffer.unbind(t),this.softShadow===Zr.VSM&&this._gaussianFilter(t,a,a.width);var l=new V;l.copy(s.worldTransform).invert().multiplyLeft(s.projectionMatrix),n.push(a),i.push(l.array)},renderPointLightShadow:function(t,r,e,i){var n=this._getTexture(e),a=t.gl;i.push(n);var s=this._getDepthMaterial(e),o={getMaterial:function(g){return g.shadowDepthMaterial||s},getUniform:_o,sortCompare:zr.opaqueSortCompare},f={px:[],py:[],pz:[],nx:[],ny:[],nz:[]},u=new Ht,h=e.getWorldPosition().array,l=new Ht,c=e.range;l.min.setArray(h),l.max.setArray(h);var v=new O(c,c,c);l.max.add(v),l.min.sub(v);var d={px:!1,py:!1,pz:!1,nx:!1,ny:!1,nz:!1};r.traverse(function(g){if(g.isRenderable()&&g.castShadow){var m=g.geometry;if(!m.boundingBox){for(var T=0;T<re.length;T++)f[re[T]].push(g);return}if(u.transformFrom(m.boundingBox,g.worldTransform),!u.intersectBoundingBox(l))return;u.updateVertices();for(var T=0;T<re.length;T++)d[re[T]]=!1;for(var T=0;T<8;T++){var w=u.vertices[T],x=w[0]-h[0],E=w[1]-h[1],S=w[2]-h[2],M=Math.abs(x),C=Math.abs(E),R=Math.abs(S);M>C?M>R?d[x>0?"px":"nx"]=!0:d[S>0?"pz":"nz"]=!0:C>R?d[E>0?"py":"ny"]=!0:d[S>0?"pz":"nz"]=!0}for(var T=0;T<re.length;T++)d[re[T]]&&f[re[T]].push(g)}});for(var _=0;_<6;_++){var p=re[_],y=this._getPointLightCamera(e,p);this._frameBuffer.attach(n,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+_),this._frameBuffer.bind(t),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),t.renderPass(f[p],y,o)}this._frameBuffer.unbind(t)},_getDepthMaterial:function(t){var r=this._lightMaterials[t.__uid__],e=t.type==="POINT_LIGHT";if(!r){var i=e?"clay.sm.distance.":"clay.sm.depth.";r=new Nn({precision:this.precision,shader:new J(J.source(i+"vertex"),J.source(i+"fragment"))}),this._lightMaterials[t.__uid__]=r}return t.shadowSlopeScale!=null&&r.setUniform("slopeScale",t.shadowSlopeScale),t.shadowBias!=null&&r.setUniform("bias",t.shadowBias),this.softShadow===Zr.VSM?r.define("fragment","USE_VSM"):r.undefine("fragment","USE_VSM"),e&&(r.set("lightPosition",t.getWorldPosition().array),r.set("range",t.range)),r},_gaussianFilter:function(t,r,e){var i={width:e,height:e,type:q.FLOAT},n=this._texturePool.get(i);this._frameBuffer.attach(n),this._frameBuffer.bind(t),this._gaussianPassH.setUniform("texture",r),this._gaussianPassH.setUniform("textureWidth",e),this._gaussianPassH.render(t),this._frameBuffer.attach(r),this._gaussianPassV.setUniform("texture",n),this._gaussianPassV.setUniform("textureHeight",e),this._gaussianPassV.render(t),this._frameBuffer.unbind(t),this._texturePool.put(n)},_getTexture:function(t,r){var e=t.__uid__,i=this._textures[e],n=t.shadowResolution||512;return r=r||1,i||(t.type==="POINT_LIGHT"?i=new Ke:i=new Wt,i.width=n*r,i.height=n,this.softShadow===Zr.VSM?(i.type=q.FLOAT,i.anisotropic=4):(i.minFilter=I.NEAREST,i.magFilter=I.NEAREST,i.useMipmap=!1),this._textures[e]=i),i},_getPointLightCamera:function(t,r){this._lightCameras.point||(this._lightCameras.point={px:new Zt,nx:new Zt,py:new Zt,ny:new Zt,pz:new Zt,nz:new Zt});var e=this._lightCameras.point[r];switch(e.far=t.range,e.fov=90,e.position.set(0,0,0),r){case"px":e.lookAt(O.POSITIVE_X,O.NEGATIVE_Y);break;case"nx":e.lookAt(O.NEGATIVE_X,O.NEGATIVE_Y);break;case"py":e.lookAt(O.POSITIVE_Y,O.POSITIVE_Z);break;case"ny":e.lookAt(O.NEGATIVE_Y,O.NEGATIVE_Z);break;case"pz":e.lookAt(O.POSITIVE_Z,O.NEGATIVE_Y);break;case"nz":e.lookAt(O.NEGATIVE_Z,O.NEGATIVE_Y);break}return t.getWorldPosition(e.position),e.update(),e},_getDirectionalLightCamera:(function(){var t=new V,r=new Ht,e=new Ht;return function(i,n,a){this._lightCameras.directional||(this._lightCameras.directional=new lv);var s=this._lightCameras.directional;r.copy(n.viewBoundingBoxLastFrame),r.intersection(a.frustum.boundingBox),s.position.copy(r.min).add(r.max).scale(.5).transformMat4(a.worldTransform),s.rotation.copy(i.rotation),s.scale.copy(i.scale),s.updateWorldTransform(),V.invert(t,s.worldTransform),V.multiply(t,t,a.worldTransform),e.copy(r).applyTransform(t);var o=e.min.array,f=e.max.array;return s.position.set((o[0]+f[0])/2,(o[1]+f[1])/2,f[2]).transformMat4(s.worldTransform),s.near=0,s.far=-o[2]+f[2],isNaN(this.lightFrustumBias)?s.far*=4:s.far+=this.lightFrustumBias,s.left=o[0],s.right=f[0],s.top=f[1],s.bottom=o[1],s.update(!0),s}})(),_getSpotLightCamera:function(t){this._lightCameras.spot||(this._lightCameras.spot=new Zt);var r=this._lightCameras.spot;return r.fov=t.penumbraAngle*2,r.far=t.range,r.worldTransform.copy(t.worldTransform),r.updateProjectionMatrix(),F.invert(r.viewMatrix.array,r.worldTransform.array),r},dispose:function(t){var r=t.gl||t;this._frameBuffer&&this._frameBuffer.dispose(r);for(var e in this._textures)this._textures[e].dispose(r);this._texturePool.clear(t.gl),this._depthMaterials={},this._distanceMaterials={},this._textures={},this._lightCameras={},this._shadowMapNumber={POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},this._meshMaterials={};for(var i=0;i<this._receivers.length;i++){var n=this._receivers[i];if(n.material){var a=n.material;a.undefine("fragment","POINT_LIGHT_SHADOW_COUNT"),a.undefine("fragment","DIRECTIONAL_LIGHT_SHADOW_COUNT"),a.undefine("fragment","AMBIENT_LIGHT_SHADOW_COUNT"),a.set("shadowEnabled",0)}}this._receivers=[],this._lightsCastShadow=[]}});Zr.VSM=1;Zr.PCF=2;var Pn=Vt.extend(function(){return{name:"",inputLinks:{},outputLinks:{},_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}},{updateParameter:function(t,r){var e=this.outputs[t],i=e.parameters,n=e._parametersCopy;if(n||(n=e._parametersCopy={}),i)for(var a in i)a!=="width"&&a!=="height"&&(n[a]=i[a]);var s,o;return i.width instanceof Function?s=i.width.call(this,r):s=i.width,i.height instanceof Function?o=i.height.call(this,r):o=i.height,(n.width!==s||n.height!==o)&&this._outputTextures[t]&&this._outputTextures[t].dispose(r.gl),n.width=s,n.height=o,n},setParameter:function(t,r){},getParameter:function(t){},setParameters:function(t){for(var r in t)this.setParameter(r,t[r])},render:function(){},getOutput:function(t,r){if(r==null)return r=t,this._outputTextures[r];var e=this.outputs[r];if(e)return this._rendered?e.outputLastFrame?this._prevOutputTextures[r]:this._outputTextures[r]:this._rendering?(this._prevOutputTextures[r]||(this._prevOutputTextures[r]=this._compositor.allocateTexture(e.parameters||{})),this._prevOutputTextures[r]):(this.render(t),this._outputTextures[r])},removeReference:function(t){if(this._outputReferences[t]--,this._outputReferences[t]===0){var r=this.outputs[t];r.keepLastFrame?(this._prevOutputTextures[t]&&this._compositor.releaseTexture(this._prevOutputTextures[t]),this._prevOutputTextures[t]=this._outputTextures[t]):this._compositor.releaseTexture(this._outputTextures[t])}},link:function(t,r,e){this.inputLinks[t]={node:r,pin:e},r.outputLinks[e]||(r.outputLinks[e]=[]),r.outputLinks[e].push({node:this,pin:t}),this.pass.material.enableTexture(t)},clear:function(){this.inputLinks={},this.outputLinks={}},updateReference:function(t){if(!this._rendering){this._rendering=!0;for(var r in this.inputLinks){var e=this.inputLinks[r];e.node.updateReference(e.pin)}this._rendering=!1}t&&this._outputReferences[t]++},beforeFrame:function(){this._rendered=!1;for(var t in this.outputLinks)this._outputReferences[t]=0},afterFrame:function(){for(var t in this.outputLinks)if(this._outputReferences[t]>0){var r=this.outputs[t];r.keepLastFrame?(this._prevOutputTextures[t]&&this._compositor.releaseTexture(this._prevOutputTextures[t]),this._prevOutputTextures[t]=this._outputTextures[t]):this._compositor.releaseTexture(this._outputTextures[t])}}}),vl=Vt.extend(function(){return{nodes:[]}},{dirty:function(){this._dirty=!0},addNode:function(t){this.nodes.indexOf(t)>=0||(this.nodes.push(t),this._dirty=!0)},removeNode:function(t){typeof t=="string"&&(t=this.getNodeByName(t));var r=this.nodes.indexOf(t);r>=0&&(this.nodes.splice(r,1),this._dirty=!0)},getNodeByName:function(t){for(var r=0;r<this.nodes.length;r++)if(this.nodes[r].name===t)return this.nodes[r]},update:function(){for(var t=0;t<this.nodes.length;t++)this.nodes[t].clear();for(var t=0;t<this.nodes.length;t++){var r=this.nodes[t];if(r.inputs){for(var e in r.inputs)if(r.inputs[e]){if(r.pass&&!r.pass.material.isUniformEnabled(e)){console.warn("Pin "+r.name+"."+e+" not used.");continue}var i=r.inputs[e],n=this.findPin(i);n?r.link(e,n.node,n.pin):console.warn(typeof i=="string"?"Node "+i+" not exist":"Pin of "+i.node+"."+i.pin+" not exist")}}}},findPin:function(t){var r;if((typeof t=="string"||t instanceof Pn)&&(t={node:t}),typeof t.node=="string")for(var e=0;e<this.nodes.length;e++){var i=this.nodes[e];i.name===t.node&&(r=i)}else r=t.node;if(r){var n=t.pin;if(n||r.outputs&&(n=Object.keys(r.outputs)[0]),r.outputs[n])return{node:r,pin:n}}}}),lg=vl.extend(function(){return{_outputs:[],_texturePool:new Va,_frameBuffer:new Cr({depthBuffer:!1})}},{addNode:function(t){vl.prototype.addNode.call(this,t),t._compositor=this},render:function(t,r){if(this._dirty){this.update(),this._dirty=!1,this._outputs.length=0;for(var e=0;e<this.nodes.length;e++)this.nodes[e].outputs||this._outputs.push(this.nodes[e])}for(var e=0;e<this.nodes.length;e++)this.nodes[e].beforeFrame();for(var e=0;e<this._outputs.length;e++)this._outputs[e].updateReference();for(var e=0;e<this._outputs.length;e++)this._outputs[e].render(t,r);for(var e=0;e<this.nodes.length;e++)this.nodes[e].afterFrame()},allocateTexture:function(t){return this._texturePool.get(t)},releaseTexture:function(t){this._texturePool.put(t)},getFrameBuffer:function(){return this._frameBuffer},dispose:function(t){this._texturePool.clear(t)}}),cg=Pn.extend({name:"scene",scene:null,camera:null,autoUpdateScene:!0,preZ:!1},function(){this.frameBuffer=new Cr},{render:function(t){this._rendering=!0;var r=t.gl;this.trigger("beforerender");var e;if(!this.outputs)e=t.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ);else{var i=this.frameBuffer;for(var n in this.outputs){var a=this.updateParameter(n,t),s=this.outputs[n],o=this._compositor.allocateTexture(a);this._outputTextures[n]=o;var f=s.attachment||r.COLOR_ATTACHMENT0;typeof f=="string"&&(f=r[f]),i.attach(o,f)}i.bind(t);var u=t.getGLExtension("EXT_draw_buffers");if(u){var h=[];for(var f in this.outputs)f=parseInt(f),f>=r.COLOR_ATTACHMENT0&&f<=r.COLOR_ATTACHMENT0+8&&h.push(f);u.drawBuffersEXT(h)}t.saveClear(),t.clearBit=I.DEPTH_BUFFER_BIT|I.COLOR_BUFFER_BIT,e=t.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ),t.restoreClear(),i.unbind(t)}this.trigger("afterrender",e),this._rendering=!1,this._rendered=!0}}),vg=Pn.extend(function(){return{texture:null,outputs:{color:{}}}},function(){},{getOutput:function(t,r){return this.texture},beforeFrame:function(){},afterFrame:function(){}}),dg=Pn.extend(function(){return{name:"",inputs:{},outputs:null,shader:"",inputLinks:{},outputLinks:{},pass:null,_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}},function(){var t=new gn({fragment:this.shader});this.pass=t},{render:function(t,r){this.trigger("beforerender",t),this._rendering=!0;var e=t.gl;for(var i in this.inputLinks){var n=this.inputLinks[i],a=n.node.getOutput(t,n.pin);this.pass.setUniform(i,a)}if(!this.outputs)this.pass.outputs=null,this._compositor.getFrameBuffer().unbind(t),this.pass.render(t,r);else{this.pass.outputs={};var s={};for(var o in this.outputs){var f=this.updateParameter(o,t);isNaN(f.width)&&this.updateParameter(o,t);var u=this.outputs[o],h=this._compositor.allocateTexture(f);this._outputTextures[o]=h;var l=u.attachment||e.COLOR_ATTACHMENT0;typeof l=="string"&&(l=e[l]),s[l]=h}this._compositor.getFrameBuffer().bind(t);for(var l in s)this._compositor.getFrameBuffer().attach(s[l],l);this.pass.render(t),this._compositor.getFrameBuffer().updateMipmap(t)}for(var i in this.inputLinks){var n=this.inputLinks[i];n.node.removeReference(n.pin)}this._rendering=!1,this._rendered=!0,this.trigger("afterrender",t)},updateParameter:function(t,r){var e=this.outputs[t],i=e.parameters,n=e._parametersCopy;if(n||(n=e._parametersCopy={}),i)for(var a in i)a!=="width"&&a!=="height"&&(n[a]=i[a]);var s,o;return typeof i.width=="function"?s=i.width.call(this,r):s=i.width,typeof i.height=="function"?o=i.height.call(this,r):o=i.height,s=Math.ceil(s),o=Math.ceil(o),(n.width!==s||n.height!==o)&&this._outputTextures[t]&&this._outputTextures[t].dispose(r),n.width=s,n.height=o,n},setParameter:function(t,r){this.pass.setUniform(t,r)},getParameter:function(t){return this.pass.getUniform(t)},setParameters:function(t){for(var r in t)this.setParameter(r,t[r])},define:function(t,r){this.pass.material.define("fragment",t,r)},undefine:function(t){this.pass.material.undefine("fragment",t)},removeReference:function(t){if(this._outputReferences[t]--,this._outputReferences[t]===0){var r=this.outputs[t];r.keepLastFrame?(this._prevOutputTextures[t]&&this._compositor.releaseTexture(this._prevOutputTextures[t]),this._prevOutputTextures[t]=this._outputTextures[t]):this._compositor.releaseTexture(this._outputTextures[t])}},clear:function(){Pn.prototype.clear.call(this),this.pass.material.disableTexturesAll()}});const pg=`@export clay.compositor.coloradjust
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float brightness : 0.0;
uniform float contrast : 1.0;
uniform float exposure : 0.0;
uniform float gamma : 1.0;
uniform float saturation : 1.0;
const vec3 w = vec3(0.2125, 0.7154, 0.0721);
void main()
{
 vec4 tex = texture2D( texture, v_Texcoord);
 vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);
 color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);
 color = clamp( color * pow(2.0, exposure), 0.0, 1.0);
 color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);
 float luminance = dot( color, w );
 color = mix(vec3(luminance), color, saturation);
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.brightness
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float brightness : 0.0;
void main()
{
 vec4 tex = texture2D( texture, v_Texcoord);
 vec3 color = tex.rgb + vec3(brightness);
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.contrast
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float contrast : 1.0;
void main()
{
 vec4 tex = texture2D( texture, v_Texcoord);
 vec3 color = (tex.rgb-vec3(0.5))*contrast+vec3(0.5);
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.exposure
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float exposure : 0.0;
void main()
{
 vec4 tex = texture2D(texture, v_Texcoord);
 vec3 color = tex.rgb * pow(2.0, exposure);
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.gamma
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float gamma : 1.0;
void main()
{
 vec4 tex = texture2D(texture, v_Texcoord);
 vec3 color = pow(tex.rgb, vec3(gamma));
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.saturation
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float saturation : 1.0;
const vec3 w = vec3(0.2125, 0.7154, 0.0721);
void main()
{
 vec4 tex = texture2D(texture, v_Texcoord);
 vec3 color = tex.rgb;
 float luminance = dot(color, w);
 color = mix(vec3(luminance), color, saturation);
 gl_FragColor = vec4(color, tex.a);
}
@end`,_g=`@export clay.compositor.kernel.gaussian_9
float gaussianKernel[9];
gaussianKernel[0] = 0.07;
gaussianKernel[1] = 0.09;
gaussianKernel[2] = 0.12;
gaussianKernel[3] = 0.14;
gaussianKernel[4] = 0.16;
gaussianKernel[5] = 0.14;
gaussianKernel[6] = 0.12;
gaussianKernel[7] = 0.09;
gaussianKernel[8] = 0.07;
@end
@export clay.compositor.kernel.gaussian_13
float gaussianKernel[13];
gaussianKernel[0] = 0.02;
gaussianKernel[1] = 0.03;
gaussianKernel[2] = 0.06;
gaussianKernel[3] = 0.08;
gaussianKernel[4] = 0.11;
gaussianKernel[5] = 0.13;
gaussianKernel[6] = 0.14;
gaussianKernel[7] = 0.13;
gaussianKernel[8] = 0.11;
gaussianKernel[9] = 0.08;
gaussianKernel[10] = 0.06;
gaussianKernel[11] = 0.03;
gaussianKernel[12] = 0.02;
@end
@export clay.compositor.gaussian_blur
#define SHADER_NAME gaussian_blur
uniform sampler2D texture;varying vec2 v_Texcoord;
uniform float blurSize : 2.0;
uniform vec2 textureSize : [512.0, 512.0];
uniform float blurDir : 0.0;
@import clay.util.rgbm
@import clay.util.clamp_sample
void main (void)
{
 @import clay.compositor.kernel.gaussian_9
 vec2 off = blurSize / textureSize;
 off *= vec2(1.0 - blurDir, blurDir);
 vec4 sum = vec4(0.0);
 float weightAll = 0.0;
 for (int i = 0; i < 9; i++) {
 float w = gaussianKernel[i];
 vec4 texel = decodeHDR(clampSample(texture, v_Texcoord + float(i - 4) * off));
 sum += texel * w;
 weightAll += w;
 }
 gl_FragColor = encodeHDR(sum / max(weightAll, 0.01));
}
@end
`,yg=`@export clay.compositor.hdr.log_lum
varying vec2 v_Texcoord;
uniform sampler2D texture;
const vec3 w = vec3(0.2125, 0.7154, 0.0721);
@import clay.util.rgbm
void main()
{
 vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));
 float luminance = dot(tex.rgb, w);
 luminance = log(luminance + 0.001);
 gl_FragColor = encodeHDR(vec4(vec3(luminance), 1.0));
}
@end
@export clay.compositor.hdr.lum_adaption
varying vec2 v_Texcoord;
uniform sampler2D adaptedLum;
uniform sampler2D currentLum;
uniform float frameTime : 0.02;
@import clay.util.rgbm
void main()
{
 float fAdaptedLum = decodeHDR(texture2D(adaptedLum, vec2(0.5, 0.5))).r;
 float fCurrentLum = exp(encodeHDR(texture2D(currentLum, vec2(0.5, 0.5))).r);
 fAdaptedLum += (fCurrentLum - fAdaptedLum) * (1.0 - pow(0.98, 30.0 * frameTime));
 gl_FragColor = encodeHDR(vec4(vec3(fAdaptedLum), 1.0));
}
@end
@export clay.compositor.lum
varying vec2 v_Texcoord;
uniform sampler2D texture;
const vec3 w = vec3(0.2125, 0.7154, 0.0721);
void main()
{
 vec4 tex = texture2D( texture, v_Texcoord );
 float luminance = dot(tex.rgb, w);
 gl_FragColor = vec4(vec3(luminance), 1.0);
}
@end`,gg=`
@export clay.compositor.lut
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform sampler2D lookup;
void main()
{
 vec4 tex = texture2D(texture, v_Texcoord);
 float blueColor = tex.b * 63.0;
 vec2 quad1;
 quad1.y = floor(floor(blueColor) / 8.0);
 quad1.x = floor(blueColor) - (quad1.y * 8.0);
 vec2 quad2;
 quad2.y = floor(ceil(blueColor) / 8.0);
 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
 vec2 texPos1;
 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);
 texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);
 vec2 texPos2;
 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);
 texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);
 vec4 newColor1 = texture2D(lookup, texPos1);
 vec4 newColor2 = texture2D(lookup, texPos2);
 vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
 gl_FragColor = vec4(newColor.rgb, tex.w);
}
@end`,mg=`@export clay.compositor.vignette
#define OUTPUT_ALPHA
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float darkness: 1;
uniform float offset: 1;
@import clay.util.rgbm
void main()
{
 vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));
 gl_FragColor.rgb = texel.rgb;
 vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(offset);
 gl_FragColor = encodeHDR(vec4(mix(texel.rgb, vec3(1.0 - darkness), dot(uv, uv)), texel.a));
}
@end`,Tg=`@export clay.compositor.output
#define OUTPUT_ALPHA
varying vec2 v_Texcoord;
uniform sampler2D texture;
@import clay.util.rgbm
void main()
{
 vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));
 gl_FragColor.rgb = tex.rgb;
#ifdef OUTPUT_ALPHA
 gl_FragColor.a = tex.a;
#else
 gl_FragColor.a = 1.0;
#endif
 gl_FragColor = encodeHDR(gl_FragColor);
#ifdef PREMULTIPLY_ALPHA
 gl_FragColor.rgb *= gl_FragColor.a;
#endif
}
@end`,xg=`@export clay.compositor.bright
uniform sampler2D texture;
uniform float threshold : 1;
uniform float scale : 1.0;
uniform vec2 textureSize: [512, 512];
varying vec2 v_Texcoord;
const vec3 lumWeight = vec3(0.2125, 0.7154, 0.0721);
@import clay.util.rgbm
vec4 median(vec4 a, vec4 b, vec4 c)
{
 return a + b + c - min(min(a, b), c) - max(max(a, b), c);
}
void main()
{
 vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));
#ifdef ANTI_FLICKER
 vec3 d = 1.0 / textureSize.xyx * vec3(1.0, 1.0, 0.0);
 vec4 s1 = decodeHDR(texture2D(texture, v_Texcoord - d.xz));
 vec4 s2 = decodeHDR(texture2D(texture, v_Texcoord + d.xz));
 vec4 s3 = decodeHDR(texture2D(texture, v_Texcoord - d.zy));
 vec4 s4 = decodeHDR(texture2D(texture, v_Texcoord + d.zy));
 texel = median(median(texel, s1, s2), s3, s4);
#endif
 float lum = dot(texel.rgb , lumWeight);
 vec4 color;
 if (lum > threshold && texel.a > 0.0)
 {
 color = vec4(texel.rgb * scale, texel.a * scale);
 }
 else
 {
 color = vec4(0.0);
 }
 gl_FragColor = encodeHDR(color);
}
@end
`,wg=`@export clay.compositor.downsample
uniform sampler2D texture;
uniform vec2 textureSize : [512, 512];
varying vec2 v_Texcoord;
@import clay.util.rgbm
float brightness(vec3 c)
{
 return max(max(c.r, c.g), c.b);
}
@import clay.util.clamp_sample
void main()
{
 vec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / textureSize.xyxy;
#ifdef ANTI_FLICKER
 vec3 s1 = decodeHDR(clampSample(texture, v_Texcoord + d.xy)).rgb;
 vec3 s2 = decodeHDR(clampSample(texture, v_Texcoord + d.zy)).rgb;
 vec3 s3 = decodeHDR(clampSample(texture, v_Texcoord + d.xw)).rgb;
 vec3 s4 = decodeHDR(clampSample(texture, v_Texcoord + d.zw)).rgb;
 float s1w = 1.0 / (brightness(s1) + 1.0);
 float s2w = 1.0 / (brightness(s2) + 1.0);
 float s3w = 1.0 / (brightness(s3) + 1.0);
 float s4w = 1.0 / (brightness(s4) + 1.0);
 float oneDivideSum = 1.0 / (s1w + s2w + s3w + s4w);
 vec4 color = vec4(
 (s1 * s1w + s2 * s2w + s3 * s3w + s4 * s4w) * oneDivideSum,
 1.0
 );
#else
 vec4 color = decodeHDR(clampSample(texture, v_Texcoord + d.xy));
 color += decodeHDR(clampSample(texture, v_Texcoord + d.zy));
 color += decodeHDR(clampSample(texture, v_Texcoord + d.xw));
 color += decodeHDR(clampSample(texture, v_Texcoord + d.zw));
 color *= 0.25;
#endif
 gl_FragColor = encodeHDR(color);
}
@end`,Eg=`
@export clay.compositor.upsample
#define HIGH_QUALITY
uniform sampler2D texture;
uniform vec2 textureSize : [512, 512];
uniform float sampleScale: 0.5;
varying vec2 v_Texcoord;
@import clay.util.rgbm
@import clay.util.clamp_sample
void main()
{
#ifdef HIGH_QUALITY
 vec4 d = vec4(1.0, 1.0, -1.0, 0.0) / textureSize.xyxy * sampleScale;
 vec4 s;
 s = decodeHDR(clampSample(texture, v_Texcoord - d.xy));
 s += decodeHDR(clampSample(texture, v_Texcoord - d.wy)) * 2.0;
 s += decodeHDR(clampSample(texture, v_Texcoord - d.zy));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.zw)) * 2.0;
 s += decodeHDR(clampSample(texture, v_Texcoord )) * 4.0;
 s += decodeHDR(clampSample(texture, v_Texcoord + d.xw)) * 2.0;
 s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.wy)) * 2.0;
 s += decodeHDR(clampSample(texture, v_Texcoord + d.xy));
 gl_FragColor = encodeHDR(s / 16.0);
#else
 vec4 d = vec4(-1.0, -1.0, +1.0, +1.0) / textureSize.xyxy;
 vec4 s;
 s = decodeHDR(clampSample(texture, v_Texcoord + d.xy));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.xw));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.zw));
 gl_FragColor = encodeHDR(s / 4.0);
#endif
}
@end`,bg=`@export clay.compositor.hdr.composite
#define TONEMAPPING
uniform sampler2D texture;
#ifdef BLOOM_ENABLED
uniform sampler2D bloom;
#endif
#ifdef LENSFLARE_ENABLED
uniform sampler2D lensflare;
uniform sampler2D lensdirt;
#endif
#ifdef LUM_ENABLED
uniform sampler2D lum;
#endif
#ifdef LUT_ENABLED
uniform sampler2D lut;
#endif
#ifdef COLOR_CORRECTION
uniform float brightness : 0.0;
uniform float contrast : 1.0;
uniform float saturation : 1.0;
#endif
#ifdef VIGNETTE
uniform float vignetteDarkness: 1.0;
uniform float vignetteOffset: 1.0;
#endif
uniform float exposure : 1.0;
uniform float bloomIntensity : 0.25;
uniform float lensflareIntensity : 1;
varying vec2 v_Texcoord;
@import clay.util.srgb
vec3 ACESToneMapping(vec3 color)
{
 const float A = 2.51;
 const float B = 0.03;
 const float C = 2.43;
 const float D = 0.59;
 const float E = 0.14;
 return (color * (A * color + B)) / (color * (C * color + D) + E);
}
float eyeAdaption(float fLum)
{
 return mix(0.2, fLum, 0.5);
}
#ifdef LUT_ENABLED
vec3 lutTransform(vec3 color) {
 float blueColor = color.b * 63.0;
 vec2 quad1;
 quad1.y = floor(floor(blueColor) / 8.0);
 quad1.x = floor(blueColor) - (quad1.y * 8.0);
 vec2 quad2;
 quad2.y = floor(ceil(blueColor) / 8.0);
 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
 vec2 texPos1;
 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);
 texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);
 vec2 texPos2;
 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);
 texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);
 vec4 newColor1 = texture2D(lut, texPos1);
 vec4 newColor2 = texture2D(lut, texPos2);
 vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
 return newColor.rgb;
}
#endif
@import clay.util.rgbm
void main()
{
 vec4 texel = vec4(0.0);
 vec4 originalTexel = vec4(0.0);
#ifdef TEXTURE_ENABLED
 texel = decodeHDR(texture2D(texture, v_Texcoord));
 originalTexel = texel;
#endif
#ifdef BLOOM_ENABLED
 vec4 bloomTexel = decodeHDR(texture2D(bloom, v_Texcoord));
 texel.rgb += bloomTexel.rgb * bloomIntensity;
 texel.a += bloomTexel.a * bloomIntensity;
#endif
#ifdef LENSFLARE_ENABLED
 texel += decodeHDR(texture2D(lensflare, v_Texcoord)) * texture2D(lensdirt, v_Texcoord) * lensflareIntensity;
#endif
 texel.a = min(texel.a, 1.0);
#ifdef LUM_ENABLED
 float fLum = texture2D(lum, vec2(0.5, 0.5)).r;
 float adaptedLumDest = 3.0 / (max(0.1, 1.0 + 10.0*eyeAdaption(fLum)));
 float exposureBias = adaptedLumDest * exposure;
#else
 float exposureBias = exposure;
#endif
#ifdef TONEMAPPING
 texel.rgb *= exposureBias;
 texel.rgb = ACESToneMapping(texel.rgb);
#endif
 texel = linearTosRGB(texel);
#ifdef LUT_ENABLED
 texel.rgb = lutTransform(clamp(texel.rgb,vec3(0.0),vec3(1.0)));
#endif
#ifdef COLOR_CORRECTION
 texel.rgb = clamp(texel.rgb + vec3(brightness), 0.0, 1.0);
 texel.rgb = clamp((texel.rgb - vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);
 float lum = dot(texel.rgb, vec3(0.2125, 0.7154, 0.0721));
 texel.rgb = mix(vec3(lum), texel.rgb, saturation);
#endif
#ifdef VIGNETTE
 vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(vignetteOffset);
 texel.rgb = mix(texel.rgb, vec3(1.0 - vignetteDarkness), dot(uv, uv));
#endif
 gl_FragColor = encodeHDR(texel);
#ifdef DEBUG
 #if DEBUG == 1
 gl_FragColor = encodeHDR(decodeHDR(texture2D(texture, v_Texcoord)));
 #elif DEBUG == 2
 gl_FragColor = encodeHDR(decodeHDR(texture2D(bloom, v_Texcoord)) * bloomIntensity);
 #elif DEBUG == 3
 gl_FragColor = encodeHDR(decodeHDR(texture2D(lensflare, v_Texcoord) * lensflareIntensity));
 #endif
#endif
 if (originalTexel.a <= 0.01 && gl_FragColor.a > 1e-5) {
 gl_FragColor.a = dot(gl_FragColor.rgb, vec3(0.2125, 0.7154, 0.0721));
 }
#ifdef PREMULTIPLY_ALPHA
 gl_FragColor.rgb *= gl_FragColor.a;
#endif
}
@end`,Sg=`@export clay.compositor.lensflare
#define SAMPLE_NUMBER 8
uniform sampler2D texture;
uniform sampler2D lenscolor;
uniform vec2 textureSize : [512, 512];
uniform float dispersal : 0.3;
uniform float haloWidth : 0.4;
uniform float distortion : 1.0;
varying vec2 v_Texcoord;
@import clay.util.rgbm
vec4 textureDistorted(
 in vec2 texcoord,
 in vec2 direction,
 in vec3 distortion
) {
 return vec4(
 decodeHDR(texture2D(texture, texcoord + direction * distortion.r)).r,
 decodeHDR(texture2D(texture, texcoord + direction * distortion.g)).g,
 decodeHDR(texture2D(texture, texcoord + direction * distortion.b)).b,
 1.0
 );
}
void main()
{
 vec2 texcoord = -v_Texcoord + vec2(1.0); vec2 textureOffset = 1.0 / textureSize;
 vec2 ghostVec = (vec2(0.5) - texcoord) * dispersal;
 vec2 haloVec = normalize(ghostVec) * haloWidth;
 vec3 distortion = vec3(-textureOffset.x * distortion, 0.0, textureOffset.x * distortion);
 vec4 result = vec4(0.0);
 for (int i = 0; i < SAMPLE_NUMBER; i++)
 {
 vec2 offset = fract(texcoord + ghostVec * float(i));
 float weight = length(vec2(0.5) - offset) / length(vec2(0.5));
 weight = pow(1.0 - weight, 10.0);
 result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;
 }
 result *= texture2D(lenscolor, vec2(length(vec2(0.5) - texcoord)) / length(vec2(0.5)));
 float weight = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));
 weight = pow(1.0 - weight, 10.0);
 vec2 offset = fract(texcoord + haloVec);
 result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;
 gl_FragColor = result;
}
@end`,Mg=`@export clay.compositor.blend
#define SHADER_NAME blend
#ifdef TEXTURE1_ENABLED
uniform sampler2D texture1;
uniform float weight1 : 1.0;
#endif
#ifdef TEXTURE2_ENABLED
uniform sampler2D texture2;
uniform float weight2 : 1.0;
#endif
#ifdef TEXTURE3_ENABLED
uniform sampler2D texture3;
uniform float weight3 : 1.0;
#endif
#ifdef TEXTURE4_ENABLED
uniform sampler2D texture4;
uniform float weight4 : 1.0;
#endif
#ifdef TEXTURE5_ENABLED
uniform sampler2D texture5;
uniform float weight5 : 1.0;
#endif
#ifdef TEXTURE6_ENABLED
uniform sampler2D texture6;
uniform float weight6 : 1.0;
#endif
varying vec2 v_Texcoord;
@import clay.util.rgbm
void main()
{
 vec4 tex = vec4(0.0);
#ifdef TEXTURE1_ENABLED
 tex += decodeHDR(texture2D(texture1, v_Texcoord)) * weight1;
#endif
#ifdef TEXTURE2_ENABLED
 tex += decodeHDR(texture2D(texture2, v_Texcoord)) * weight2;
#endif
#ifdef TEXTURE3_ENABLED
 tex += decodeHDR(texture2D(texture3, v_Texcoord)) * weight3;
#endif
#ifdef TEXTURE4_ENABLED
 tex += decodeHDR(texture2D(texture4, v_Texcoord)) * weight4;
#endif
#ifdef TEXTURE5_ENABLED
 tex += decodeHDR(texture2D(texture5, v_Texcoord)) * weight5;
#endif
#ifdef TEXTURE6_ENABLED
 tex += decodeHDR(texture2D(texture6, v_Texcoord)) * weight6;
#endif
 gl_FragColor = encodeHDR(tex);
}
@end`,Ag=`@export clay.compositor.fxaa
uniform sampler2D texture;
uniform vec4 viewport : VIEWPORT;
varying vec2 v_Texcoord;
#define FXAA_REDUCE_MIN (1.0/128.0)
#define FXAA_REDUCE_MUL (1.0/8.0)
#define FXAA_SPAN_MAX 8.0
@import clay.util.rgbm
void main()
{
 vec2 resolution = 1.0 / viewport.zw;
 vec3 rgbNW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ) ).xyz;
 vec3 rgbNE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ) ).xyz;
 vec3 rgbSW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ) ).xyz;
 vec3 rgbSE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ) ).xyz;
 vec4 rgbaM = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution ) );
 vec3 rgbM = rgbaM.xyz;
 float opacity = rgbaM.w;
 vec3 luma = vec3( 0.299, 0.587, 0.114 );
 float lumaNW = dot( rgbNW, luma );
 float lumaNE = dot( rgbNE, luma );
 float lumaSW = dot( rgbSW, luma );
 float lumaSE = dot( rgbSE, luma );
 float lumaM = dot( rgbM, luma );
 float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );
 float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );
 vec2 dir;
 dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
 dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));
 float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );
 float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );
 dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX),
 max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
 dir * rcpDirMin)) * resolution;
 vec3 rgbA = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ) ).xyz;
 rgbA += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ) ).xyz;
 rgbA *= 0.5;
 vec3 rgbB = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * -0.5 ) ).xyz;
 rgbB += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * 0.5 ) ).xyz;
 rgbB *= 0.25;
 rgbB += rgbA * 0.5;
 float lumaB = dot( rgbB, luma );
 if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )
 {
 gl_FragColor = vec4( rgbA, opacity );
 }
 else {
 gl_FragColor = vec4( rgbB, opacity );
 }
}
@end`;function Rg(t){t.import(pg),t.import(_g),t.import(yg),t.import(gg),t.import(mg),t.import(Tg),t.import(xg),t.import(wg),t.import(Eg),t.import(bg),t.import(Sg),t.import(Mg),t.import(Ag)}Rg(J);var Cg=/^#source\((.*?)\)/;function gm(t,r){var e=new lg;r=r||{};var i={textures:{},parameters:{}},n=function(o,f){for(var u=0;u<t.nodes.length;u++){var h=t.nodes[u],l=Pg(h,i,r);l&&e.addNode(l)}};for(var a in t.parameters){var s=t.parameters[a];i.parameters[a]=Of(s)}return Og(t,i,r,function(o){i.textures=o,n()}),e}function Pg(t,r,e){var i=t.type||"filter",n,a,s;if(i==="filter"){var o=t.shader.trim(),f=Cg.exec(o);if(f?n=J.source(f[1].trim()):o.charAt(0)==="#"&&(n=r.shaders[o.substr(1)]),n||(n=o),!n)return}if(t.inputs){a={};for(var u in t.inputs)typeof t.inputs[u]=="string"?a[u]=t.inputs[u]:a[u]={node:t.inputs[u].node,pin:t.inputs[u].pin}}if(t.outputs){s={};for(var u in t.outputs){var h=t.outputs[u];s[u]={},h.attachment!=null&&(s[u].attachment=h.attachment),h.keepLastFrame!=null&&(s[u].keepLastFrame=h.keepLastFrame),h.outputLastFrame!=null&&(s[u].outputLastFrame=h.outputLastFrame),h.parameters&&(s[u].parameters=Of(h.parameters))}}var l;if(i==="scene"?l=new cg({name:t.name,scene:e.scene,camera:e.camera,outputs:s}):i==="texture"?l=new vg({name:t.name,outputs:s}):l=new dg({name:t.name,shader:n,inputs:a,outputs:s}),l){if(t.parameters)for(var u in t.parameters){var c=t.parameters[u];typeof c=="string"?(c=c.trim(),c.charAt(0)==="#"?c=r.textures[c.substr(1)]:l.on("beforerender",Ig(u,vv(c)))):typeof c=="function"&&l.on("beforerender",c),l.setParameter(u,c)}if(t.defines&&l.pass)for(var u in t.defines){var c=t.defines[u];l.pass.material.define("fragment",u,c)}}return l}function Lg(t,r){return t}function Dg(t,r){return r}function Of(t){var r={};if(!t)return r;["type","minFilter","magFilter","wrapS","wrapT","flipY","useMipmap"].forEach(function(i){var n=t[i];n!=null&&(typeof n=="string"&&(n=q[n]),r[i]=n)});var e=t.scale||1;return["width","height"].forEach(function(i){if(t[i]!=null){var n=t[i];typeof n=="string"?(n=n.trim(),r[i]=Ng(i,vv(n),e)):r[i]=n}}),r.width||(r.width=Lg),r.height||(r.height=Dg),t.useMipmap!=null&&(r.useMipmap=t.useMipmap),r}function Og(t,r,e,i){if(!t.textures){i({});return}var n={},a=0,s=!1,o=e.textureRootPath;Ct.each(t.textures,function(f,u){var h,l=f.path,c=Of(f.parameters);if(Array.isArray(l)&&l.length===6)o&&(l=l.map(function(v){return Ct.relative2absolute(v,o)})),h=new Ke(c);else if(typeof l=="string")o&&(l=Ct.relative2absolute(l,o)),h=new Wt(c);else return;h.load(l),a++,h.once("success",function(){n[u]=h,a--,a===0&&(i(n),s=!0)})}),a===0&&!s&&i(n)}function Ig(t,r){return function(e){var i=e.getDevicePixelRatio(),n=e.getWidth(),a=e.getHeight(),s=r(n,a,i);this.setParameter(t,s)}}function Ng(t,r,e){return e=e||1,function(i){var n=i.getDevicePixelRatio(),a=i.getWidth()*e,s=i.getHeight()*e;return r(a,s,n)}}function vv(t){var r=/^expr\((.*)\)$/.exec(t);if(r)try{var e=new Function("width","height","dpr","return "+r[1]);return e(1,1),e}catch{throw new Error("Invalid expression.")}}export{L0 as $,Ac as A,Sn as B,Ec as C,e_ as D,bc as E,n_ as F,wi as G,mn as H,Bl as I,Ri as J,M0 as K,Rc as L,A0 as M,Mt as N,a_ as O,Dt as P,Ne as Q,j0 as R,Go as S,gf as T,Jg as U,s_ as V,Qg as W,ut as X,o_ as Y,ki as Z,yt as _,To as a,jl as a$,Ue as a0,Be as a1,ce as a2,sf as a3,Sl as a4,Ad as a5,id as a6,wl as a7,Sa as a8,ed as a9,Yd as aA,Kn as aB,em as aC,im as aD,Vl as aE,Ut as aF,$l as aG,f0 as aH,vn as aI,sd as aJ,vf as aK,td as aL,qg as aM,Od as aN,oy as aO,nm as aP,_y as aQ,In as aR,cf as aS,fe as aT,cd as aU,Kv as aV,dc as aW,Ra as aX,df as aY,fr as aZ,Je as a_,od as aa,ld as ab,oe as ac,Lp as ad,tm as ae,Za as af,je as ag,E_ as ah,zi as ai,kg as aj,kp as ak,qd as al,Xp as am,qp as an,of as ao,bn as ap,bl as aq,rm as ar,He as as,ze as at,jg as au,Pp as av,Dl as aw,Il as ax,de as ay,$d as az,$e as b,ir as b$,op as b0,sp as b1,Cl as b2,Ll as b3,va as b4,Qe as b5,Pl as b6,uf as b7,dd as b8,vd as b9,om as bA,Wf as bB,Wt as bC,O as bD,tt as bE,yf as bF,he as bG,J as bH,_m as bI,l1 as bJ,Pf as bK,Nn as bL,zr as bM,nr as bN,q as bO,Kr as bP,lm as bQ,hv as bR,M1 as bS,cm as bT,vm as bU,dm as bV,pm as bW,Zt as bX,lv as bY,nt as bZ,ht as b_,La as ba,Gt as bb,Xe as bc,Fd as bd,eu as be,ai as bf,h0 as bg,Ao as bh,En as bi,da as bj,Ma as bk,Ld as bl,xr as bm,Vg as bn,ad as bo,$o as bp,Kc as bq,am as br,sm as bs,wc as bt,Yg as bu,Xg as bv,Wg as bw,Gg as bx,Zg as by,fm as bz,Hr as c,hr as c0,It as c1,V as c2,Ta as c3,Li as c4,Ht as c5,Cf as c6,wa as c7,um as c8,hm as c9,zg as cA,ng as ca,av as cb,Wy as cc,Ca as cd,ym as ce,gn as cf,Cr as cg,$r as ch,gm as ci,_g as cj,gg as ck,Tg as cl,xg as cm,wg as cn,Eg as co,bg as cp,Mg as cq,Ag as cr,Zr as cs,Vt as ct,Wa as cu,dv as cv,Fg as cw,Hg as cx,Ug as cy,Bg as cz,Mi as d,nd as e,hd as f,zt as g,Er as h,Ar as i,St as j,Jv as k,dt as l,Lt as m,Hi as n,Kl as o,Mr as p,wt as q,Ln as r,Pt as s,Kg as t,$g as u,z0 as v,lr as w,Fl as x,Ci as y,Tf as z};
